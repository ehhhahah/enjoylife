!function(){"use strict";window.TralbumData&&$(document).ready((function(){!function(){const e=$("#pagedata").data("blob");window.LogView&&LogView.show();e.shows_list&&window.Showography&&Showography.domReady("do_pull"===e.shows_list);window.BandFollow&&window.BandFollowData&&BandFollow.init(BandFollowData)}();const e=TralbumData.item_type;"track"!==e&&"album"!==e||function(e){if(window.Player){const t="album"===e?AlbumPage.onPlayerInit:TralbumLimits.onPlayerInit;Player.init(TralbumData,t)}"phone"!==MediaView.mode&&TralbumData.use_expando_lyrics&&$(".track_row_view .info_link a[data-lyrics]","#track_table").click((function(e){e.preventDefault();const t=$(this).parents("tr.track_row_view");t.hasClass("current_track")?t.parents(".track_list").toggleClass("auto_lyrics"):t.toggleClass("showlyrics")}));TralbumData.has_video&&(window.tracklistVideoPlayer||TralbumPageVideoPlayer.init("album"===e&&gplaylist,!0),"album"===e?$(".track_row_view td.title-col a.has-video","#track_table").click((function(e){e.preventDefault();const t=$(this).data();tracklistVideoPlayer.doVideo(t.videoSource,t.videoId,t.caption,!0,!0)})):"track"===e&&tracklistVideoPlayer.doVideo(TralbumData.trackinfo[0].video_source_type,TralbumData.trackinfo[0].video_id,TralbumData.trackinfo[0].video_caption));"album"===e&&window.AlbumPage&&AlbumPage.videoInit&&AlbumPage.videoInit();window.TralbumDownload&&(TralbumDownload.init(),$(".download-link").click((function(e){e.preventDefault();const t=!!$(this).closest(".send-as-gift")[0];TralbumDownload.begin(e,t)})));window.TralbumUpdater&&TralbumUpdater.init();window.PackageOrder&&(PackageOrder.init(),$(".order_package_link").click((function(e){e.preventDefault();const t=$(this),n=!!t.closest(".send-as-gift")[0];if(t.hasClass("subscriber-only-buy-link")&&!t.hasClass("subscriber-view"))return void(window.location.href="/subscribe");const i=$(this).attr("data-pkg"),a=TralbumData.packages[i];a&&a.is_live_ticket?window.location.href=a.url:(PackageOrder.begin(i,n),TralbumData.album_upsell_url&&Stats.record({kind:"click",click:"t_order_package_link"}))})));$("#buy-disc-link").click((function(){return Stats.record({kind:"click",click:"buy_disc"}),!0})),TralbumData.album_upsell_url&&$("#buyAlbumLink").click((function(){return Stats.record({kind:"click",click:"upsell_album"}),!0}));const t=EmbedData.embed_info;let n,i;if("album"===e)if(t)n=t.public_embeddable||t.exclusive_embeddable,i=t.no_track_preorder;else{const e=TralbumData.current;n=e.publish_date&&!e.private&&!TralbumData.tralbum_subscriber_only,i=!1}else"track"===e&&(n=!TralbumData.tralbum_subscriber_only&&t&&(t.public_embeddable||t.exclusive_embeddable));(n||i)&&window.Share&&Share.initPanel("track"===e,BandData.facebook_like_enabled,TralbumData.url);window.FanControls&&FanControls.init(TralbumCollectInfo)}(e)}))}(),function(){"use strict";window.TralbumData&&"package"===TralbumData.item_type&&$(document).ready((function(){$("#pagedata").data("blob");PackageOrder.init(),$(".order_package_link").click((function(e){e.preventDefault();const t=!!$(this).closest(".send-as-gift")[0];PackageOrder.begin(0,t)})),$("a.delete_item_link").click((function(e){e.preventDefault(),Merch.deleteItem(TralbumData.current.id)}))}))}(),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/fan/band_follow.liquid","warn"):Templ.register({"fan/band_follow":["\n",{type:"ef",blocks:[{type:"ncondition",expression:"is_subscribed ",attachment:['\n<button type="button" class="follow-unfollow subscribed compound-button">\n    <div>',{type:"translate",nodelist:["Subscribed!"]},"</div>\n</button>\n"]},{type:"else_ncondition",attachment:['\n<a class="dismiss-link dismiss-tooltip"></a>\n<button id="follow-unfollow" type="button" class="follow-unfollow',{type:"ef",blocks:[{type:"ncondition",expression:"is_following ",attachment:[" following"]}]},' compound-button">\n    <div>',{type:"ef",blocks:[{type:"ncondition",expression:"!is_following ",attachment:[{type:"translate",nodelist:["Follow"]}]},{type:"else_ncondition",attachment:[{type:"translate",nodelist:["Following"]}]}]},"</div>\n</button>\n"]}]},"\n"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/fan/band_follow_mailing_list_opt_in.liquid","warn"):Templ.register({"fan/band_follow_mailing_list_opt_in":['<div class="heading">\n    ',{type:"ef",blocks:[{type:"ncondition",expression:"label ",attachment:["\n        ",{type:"translate",nodelist:["\n        You are now following ",{type:"translateVariable",var_name:"artist_name",nodelist:[{type:"variable",name:"artist",filters:[["h",[]]]}]}," and will receive a notification\n        whenever they release new music. Would you also like to join their mailing list, or their labelâ€™s mailing list?\n        "]},"\n    "]},{type:"else_ncondition",attachment:["\n        ",{type:"translate",nodelist:["\n        You are now following ",{type:"translateVariable",var_name:"artist_name",nodelist:[{type:"variable",name:"artist",filters:[["h",[]]]}]}," and will receive a notification\n        whenever they release new music. Would you also like to join their mailing list?\n        "]},"\n    "]}]},"\n</div>\n",{type:"ef",blocks:[{type:"ncondition",expression:"label ",attachment:['\n<div class="notify-me-container">\n    <div class="notify-me-inner first">\n        <label for="notify-me-band">\n            <input id="notify-me-band" name="notify-me-band" type="checkbox" data-bind="checked: false">\n            <div class="notify-me-message">',{type:"translate",nodelist:["Add me to the mailing list for ",{type:"translateVariable",var_name:"seller",nodelist:[{type:"variable",name:"artist",filters:[["h",[]]]}]},"."]},'</div>\n        </label>\n    </div>\n    <div class="notify-me-inner">\n        <label for="notify-me-label">\n            <input id="notify-me-label" name="notify-me-label" type="checkbox" data-bind="checked: false">\n            <div class="notify-me-message">',{type:"translate",nodelist:["Add me to the mailing list for ",{type:"translateVariable",var_name:"seller",nodelist:[{type:"variable",name:"label",filters:[["h",[]]]}]},"."]},"</div>\n        </label>\n    </div>\n</div>\n"]}]},'\n<div class="email-abuse">\n    ',{type:"translate",nodelist:["\n    Emails will be sent to ",{type:"translateVariable",var_name:"email_address",nodelist:[{type:"variable",name:"email_address",filters:[["h",[]]]}]},".\n    "]},"\n</div>\n"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/fan/band_follow_acceptance.liquid","warn"):Templ.register({"fan/band_follow_acceptance":['<div class="heading">\n    ',{type:"translate",nodelist:["Would you like to follow ",{type:"variable",name:"artist",filters:[["h",[]]]}," and get notified of all their future releases?"]},"\n<div>"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/limits/band_play_limits_dialog.liquid","warn"):Templ.register({"limits/band_play_limits_dialog":['<div class="play-limits-dialog">\n    <div class="play-limits-dialog-header">\n\n    ',{type:"ef",blocks:[{type:"ncondition",expression:"fan_image_id && (band_image_id  || tralbum_art_id) ",attachment:['\n        <div id="play-limits-dialog-fan-img" style="background-image:url(',{type:"variable",name:"fan_image_id",filters:[["image_url",["'fan_bio_thumb'"]]]},');"></div>\n    ']}]},'\n\n        <div class="play-limits-dialog-heart">\n            <img id="play-limits-dialog-heart-img" src="',{type:"variable",name:"static_siteroot",filters:[]},"/img/heartbreak",{type:"ef",blocks:[{type:"ncondition",expression:"is_mobile ",attachment:["@2x"]}]},'.png" />\n        </div>\n\n    ',{type:"ef",blocks:[{type:"ncondition",expression:"fan_image_id && (band_image_id  || tralbum_art_id) ",attachment:['\n        <div id="play-limits-dialog-band-img" style="background-image:url(',{type:"ef",blocks:[{type:"ncondition",expression:"band_image_id ",attachment:[{type:"variable",name:"band_image_id",filters:[["image_url",["'fan_bio_thumb'"]]]}]},{type:"else_ncondition",attachment:[{type:"variable",name:"tralbum_art_id",filters:[["art_url",["'art_thumb'"]]]}]}]},');"></div>\n    ']}]},"\n\n    </div>\n    <h2>",{type:"translate",nodelist:["The time has come to open thy heart/wallet."]},'</h2>\n    <div class="play-limits-dialog-perks',{type:"ef",blocks:[{type:"ncondition",expression:"is_mobile || !tralbum_art_id ",attachment:[" no-pkg-art"]}]},'">\n    \n    ',{type:"ef",blocks:[{type:"ncondition",expression:"!is_mobile && tralbum_art_id ",attachment:['\n        <div class="play-limits-dialog-pkg-art">\n            <img class="pkg-image" alt="',{type:"variable",name:"tralbum_title",filters:[["a",[]]]},'" title="',{type:"variable",name:"tralbum_title",filters:[["a",[]]]},'" ',{type:"variable",name:"tralbum_art_id",filters:[["art",["'art_thumb'"]]]}," />\n        </div>\n    "]}]},"\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"purchase_type == 'album' ",attachment:["\n        ",{type:"capture",to:"buy_text",nodelist:["\n            ",{type:"translate",nodelist:["Buy this album to:"]},"\n        "]},"\n    "]},{type:"ncondition",expression:"purchase_type == 'track' ",attachment:["\n        ",{type:"capture",to:"buy_text",nodelist:["\n            ",{type:"translate",nodelist:["Buy this track to:"]},"\n        "]},"\n    "]},{type:"else_ncondition",attachment:["\n        ",{type:"capture",to:"buy_text",nodelist:["\n            ",{type:"translate",nodelist:["Buy this item to:"]},"\n        "]},"\n    "]}]},'\n        <div class="play-limits-dialog-bullets">\n            <span class="play-limits-dialog-bullets-title">',{type:"variable",name:"buy_text",filters:[]},"</span>\n            <ul>\n                <li><span>",{type:"translate",nodelist:["directly support ",{type:"translateVariable",var_name:"band_name",nodelist:['<span class="band-name">',{type:"variable",name:"band_name",filters:[["a",[]]]},"</span>"]},""]},"</span></li>\n                <li><span>",{type:"translate",nodelist:["get unlimited streaming"]},"</span></li>\n                <li><span>",{type:"translate",nodelist:["get a high-quality download"]},'</span></li>\n            </ul>\n        </div>\n    </div>\n\n    <div class="play-limits-dialog-button-pane">\n        <button id="play-limits-dialog-buy-btn">',{type:"translate",nodelist:["Purchase info"]},'</button>\n        <button id="play-limits-dialog-cancel-btn" class="weak">',{type:"translate",nodelist:["No thanks"]},"</button>\n    </div>\n\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"!logged_in ",attachment:['\n        <div class="play-limits-dialog-footer">\n            <span>',{type:"translate",nodelist:["Already own this? <a ",{type:"translateVariable",var_name:"login_link",nodelist:['href="',{type:"variable",name:"login_bounce_url",filters:[["h",[]]]},'&from=ltnlgn"']},">Log in</a> to your fan account or <a ",{type:"translateVariable",var_name:"learn_link",nodelist:['href="',{type:"variable",name:"siteroot_https",filters:[["h",[]]]},'/fans?from=ltnlrn"']},">learn more</a>."]},"</span>\n        </div>\n    "]}]},"\n</div>\n"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/tralbum_common/share_collect_controls.liquid","warn"):Templ.register({"tralbum_common/share_collect_controls":['\n\n\n<div class="share-collect-controls',{type:"ef",blocks:[{type:"ncondition",expression:"embed_info.exclusive_embeddable ",attachment:[" exclusive-case",{type:"ef",blocks:[{type:"ncondition",expression:"embed_info.exembed_is_new ",attachment:[" new-badged"]}]}]}]},'">\n    <ul>\n        ',{type:"ef",blocks:[{type:"ncondition",expression:"embed_info.public_embeddable ",attachment:['\n        <li class="share-embed">\n    \t\t<span class="bc-ui2 share-embed-icon"></span>\n    \t\t<span class="share-embed-label"><button type="button">',{type:"ef",blocks:[{type:"ncondition",expression:"embed_info.exclusive_embeddable ",attachment:[{type:"translate",nodelist:["Share / Embed / Exclusive"]}]},{type:"else_ncondition",attachment:[{type:"translate",nodelist:["Share / Embed"]}]}]},"</button>\n            ",{type:"ef",blocks:[{type:"ncondition",expression:"embed_info.exclusive_embeddable ",attachment:[{type:"ef",blocks:[{type:"ncondition",expression:"embed_info.exembed_is_new ",attachment:['<span class="newbadge">',{type:"translate",nodelist:["new"]},"</span>"]}]}]}]},"</span>\n        </li>\n        "]},{type:"ncondition",expression:"embed_info.exclusive_embeddable ",attachment:['\n        <li class="exclusive-embed">\n            <span class="bc-ui2 share-embed-icon"></span>\n            <span class="share-embed-label"><button type="button">',{type:"translate",nodelist:["Exclusive Embed"]},"</button></span>\n            ",{type:"ef",blocks:[{type:"ncondition",expression:"embed_info.exembed_is_new ",attachment:['<span class="newbadge">',{type:"translate",nodelist:["new"]},"</span>"]}]},"\n        </li>\n        "]}]},"\n        \n        ",{type:"ef",blocks:[{type:"ncondition",expression:"embed_info.public_embeddable || embed_info.no_track_preorder ",attachment:['\n        <a id="collect-anchor"></a>\n        ']}]},"\n    </ul>    \n</div>"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/tralbum_common/share_embed_panel.liquid","warn"):Templ.register({"tralbum_common/share_embed_panel":['\n<div class="share-embed-container">\n  <div class="share-embed-container-indicator"></div>\n  <div class="share-embed-container-inner">\n\n    <div class="close round3"><span class="bc-ui">x</span></div>\n\n\n    \n    ',{type:"ef",blocks:[{type:"ncondition",expression:"enable_social_buttons ",attachment:["\n      ",{type:"capture",to:"twitter_username",nodelist:[{type:"ef",blocks:[{type:"ncondition",expression:"twitter_username ",attachment:[" (@",{type:"variable",name:"twitter_username",filters:[["a",[]]]},")"]}]}]},"\n      ",{type:"ef",blocks:[{type:"ncondition",expression:"is_track ",attachment:["\n      ",{type:"capture",to:"tweet_text",nodelist:[{type:"translate",nodelist:["omg best track ever",{type:"variable",name:"twitter_username",filters:[]},": "]}]},"\n      "]},{type:"else_ncondition",attachment:["\n      ",{type:"capture",to:"tweet_text",nodelist:[{type:"translate",nodelist:["omg best album ever",{type:"variable",name:"twitter_username",filters:[]},": "]}]},"\n      "]}]},"\n      \n      ",{type:"capture",to:"tumblr_caption_html",nodelist:[{type:"ef",blocks:[{type:"ncondition",expression:"download_pref == 1 ",attachment:[{type:"translate",nodelist:["Listen/download"]}]},{type:"ncondition",expression:"download_pref == 2 ",attachment:[{type:"translate",nodelist:["Listen/purchase"]}]},{type:"else_ncondition",attachment:[{type:"translate",nodelist:["Listen to"]}]}]},': <a href="',{type:"variable",name:"linkback",filters:[["a",[]]]},'">',{type:"translate",nodelist:["",{type:"variable",name:"title",filters:[["h",[]]]}," by ",{type:"variable",name:"artist",filters:[["h",[]]]},""]},"</a>"]},'\n    <div class="share-buttons panel-section first">\n      <ul class="share-buttons-list social-controls" data-url="',{type:"variable",name:"linkback",filters:[["a",[]]]},'">\n        <li class="facebook-like-ctrl" data-stat="like_button" data-stat-off="dislike_button"></li>\n        <li class="twitter-ctrl btn" data-text="',{type:"variable",name:"tweet_text",filters:[["a",[]]]},'" data-stat="tweet_button"></li>\n        <li class="tumblr-ctrl btn" data-type="audio" data-text="',{type:"variable",name:"tumblr_caption_html",filters:[["a",[]]]},'" data-stat="tumblr_button"></li>\n      </ul>\n    </div>\n    ']}]},'\n\n\n    \n    <div class="embed-other-services panel-section ',{type:"ef",blocks:[{type:"ncondition",expression:"!enable_social_buttons ",attachment:["first"]}]},'">\n      <a>',{type:"ef",blocks:[{type:"ncondition",expression:"is_track ",attachment:[{type:"translate",nodelist:["Embed this track"]}]},{type:"else_ncondition",attachment:[{type:"translate",nodelist:["Embed this album"]}]}]},'<div class="icons"><div class="small bc-ui2">',{type:"translate",nodelist:["small"]},'</div><div class="medium bc-ui2">',{type:"translate",nodelist:["medium"]},'</div><div class="large bc-ui2">',{type:"translate",nodelist:["large"]},"</div></div></a>\n    </div>\n\n    \n    ",{type:"ef",blocks:[{type:"ncondition",expression:"embed_info.exclusive_embeddable ",attachment:['\n    <div class="embed-other-services-exclusive panel-section">\n      <a>',{type:"translate",nodelist:["Exclusive embed"]},'</a>\n      <div class="hint">\n      ',{type:"ef",blocks:[{type:"ncondition",expression:"is_track ",attachment:["\n      ",{type:"translate",nodelist:["Exclusive embeds let blogs and websites stream tracks that you arenâ€™t streaming on your public Bandcamp page."]},"\n      "]},{type:"else_ncondition",attachment:["\n      ",{type:"translate",nodelist:["Exclusive embeds let blogs and websites stream tracks that you arenâ€™t streaming on your public album page."]},"\n      "]}]},"\n    </div>\n   </div>\n   "]}]},'\n\n    \n    \n    <div class="email-im-link panel-section">\n      <dl>\n        \n        <dt>',{type:"translate",nodelist:["Email"]},'</dt>\n        <dd><input type="text" value="',{type:"variable",name:"linkback",filters:[["a",[]]]},'" name="email-im-link" class="email-im-link-text"></dd>\n      </dl>\n    </div>\n\n  </div>\n</div>\n']}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/tralbum_common/tralbum_collect_controls.liquid","warn"):Templ.register({"tralbum_common/tralbum_collect_controls":["\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"collect_item_type == 'album' ",attachment:["\n  ",{type:"capture",to:"add_this_title",nodelist:[{type:"translate",nodelist:["Add this album to your wishlist"]}]},"\n  ",{type:"capture",to:"remove_this_title",nodelist:[{type:"translate",nodelist:["Remove this album from your wishlist"]}]},"\n"]},{type:"else_ncondition",attachment:["\n  ",{type:"capture",to:"add_this_title",nodelist:[{type:"translate",nodelist:["Add this track to your wishlist"]}]},"\n  ",{type:"capture",to:"remove_this_title",nodelist:[{type:"translate",nodelist:["Remove this track from your wishlist"]}]},"\n"]}]},'\n\n<li id="collect-item" class="',{type:"ef",blocks:[{type:"ncondition",expression:"!is_collected || is_private_fan ",attachment:["wishlist"]},{type:"ncondition",expression:"is_purchased == true ",attachment:["purchased"]},{type:"else_ncondition",attachment:["wishlisted"]}]},'">\n    <span id="wishlist-msg" class="action compound-button" title="',{type:"variable",name:"add_this_title",filters:[]},'">\n        <span class="bc-ui2 collect-item-icon"></span>\n        <span class="collect-msg">\n            <span><a>',{type:"translate",nodelist:["Wishlist"]},'</a></span>\n        </span>\n    </span>\n\n    <span id="wishlisted-msg" class="compound-button">\n        <span class="action" title="',{type:"variable",name:"remove_this_title",filters:[]},'">\n            <span class="bc-ui2 collect-item-icon"></span>\n            <span class="collect-msg">\n                <span><a>',{type:"translate",nodelist:["In Wishlist"]},'</a></span>\n            </span>\n        </span>\n        <span class="wishlist-wrapper">\n            <a target="_blank" class="view"\n                href="',{type:"ef",blocks:[{type:"ncondition",expression:"fan_trackpipe_url ",attachment:[{type:"variable",name:"fan_trackpipe_url",filters:[["a",[]]]},"/wishlist"]},{type:"else_ncondition",attachment:["#"]}]},'"\n            >\n                ',{type:"translate",nodelist:["view"]},'\n            </a>\n            <div class="signup-tooltip-outer wishlist-button-tooltip-outer"></div>\n        </span>\n    </span>\n    \n    <span id="purchased-msg" class="collect-msg compound-button">\n        <span class="bc-ui2 collect-item-icon"></span>\n        <span><a target="_blank"\n            href="',{type:"ef",blocks:[{type:"ncondition",expression:"fan_trackpipe_url ",attachment:[{type:"variable",name:"fan_trackpipe_url",filters:[["a",[]]]}]},{type:"else_ncondition",attachment:["#"]}]},'">',{type:"translate",nodelist:["You own this"]},'</a></span>\n    </span>\n</li>\n<div id="wishlist-alert">\n    ',{type:"translate",nodelist:["Unable to save changes to your wishlist."]},"\n</div>\n"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/tralbum_common/package_buy_button.liquid","warn"):Templ.register({"tralbum_common/package_buy_button":[{type:"ef",blocks:[{type:"ncondition",expression:"cant_buy_package ",attachment:["\n    ",{type:"variable",name:"_buy_text",filters:[]},"&nbsp;\n"]},{type:"else_ncondition",attachment:["\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"!package_sold_out ",attachment:["\n        ",{type:"capture",to:"_buy_button_inner",nodelist:['\n            <button class="order_package_link buy-link ',{type:"ef",blocks:[{type:"ncondition",expression:"package.subscriber_only ",attachment:["subscriber-only-buy-link",{type:"ef",blocks:[{type:"ncondition",expression:"is_pkg_subscriber || member_of_current_band ",attachment:[" subscriber-view"]}]}]}]},'" type="button" data-pkg="',{type:"variable",name:"package_index",filters:[["attr",[]]]},'">\n                ',{type:"variable",name:"_buy_text",filters:[]},"\n            </button>&nbsp;\n        "]},"\n    "]}]},"\n    \n    ",{type:"ef",blocks:[{type:"ncondition",expression:"package.subscriber_only && !(is_pkg_subscriber || member_of_current_band) ",attachment:['\n        <a class="buy-link subscribe-link" data-pkg="',{type:"variable",name:"package_index",filters:[["attr",[]]]},'" href="',{type:"variable",name:"pkg_sub.url_bits",filters:[["band_url",[]],["a",[]]]},"/",{type:"variable",name:"pkg_sub.url_fragment",filters:[]},'">',{type:"variable",name:"_buy_text",filters:[]},"</a>\n        ",{type:"variable",name:"_buy_button_inner",filters:[]},"\n    "]},{type:"else_ncondition",attachment:["\n        ",{type:"variable",name:"_buy_button_inner",filters:[]},"\n    "]}]},"\n"]}]},"\n"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/tralbum_common/you_own_this_package_css.liquid","warn"):Templ.register({"tralbum_common/you_own_this_package_css":["<style>\n",{type:"for",collection_name:"packages_data",nodelist:["\n    ",{type:"let",variable:"package_index",expression:"forloop.index0 "},"\n    ",{type:"let",variable:"sold_out",expression:"(package.quantity_warning && package.quantity_available <= 0) || (package.quantity_limits && package.quantity_limits <= 0) "},"\n\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"!sold_out ",attachment:["\n        .owns-p-",{type:"variable",name:"package.id",filters:[]}," #package-price-",{type:"variable",name:"package.id",filters:[]}," .you-own-this.physical,\n        .owns-p-",{type:"variable",name:"package.id",filters:[]}," #package-price-",{type:"variable",name:"package.id",filters:[]}," .compound-button.buy-again-wrapper {\n            display: block;\n        }\n        .owns-p-",{type:"variable",name:"package.id",filters:[]}," #package-price-",{type:"variable",name:"package.id",filters:[]}," .compound-button.main-button {\n            display: none;\n        }\n    "]}]},"\n"],variable_name:"package",reversed:null,attribs:{}},"\n</style>"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/tralbum_common/you_own_this.liquid","warn"):Templ.register({"tralbum_common/you_own_this":[{type:"let",variable:"link_to_collection",expression:"(you_own_this_type == 'digital' || you_own_this_type == 'buyfulldisco') "},"\n\n",{type:"let",variable:"buy_again_link",expression:"false "},"\n\n",{type:"case",blocks:[{type:"condition",left:"you_own_this_type",right:"'digital'",operator:"==",attachment:["\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"is_admin ",attachment:["\n            ",{type:"capture",to:"buy_again_link",nodelist:["\n                \n                <button class='download-link buy-link buy-again' type=\"button\">Buy again (admin)</button>\n            "]},"\n        "]},{type:"ncondition",expression:"env == 'dev' ",attachment:["\n            ",{type:"capture",to:"buy_again_link",nodelist:["\n                \n                <button class='download-link buy-link buy-again' type=\"button\">Buy again (dev)</button>\n            "]},"\n        "]},{type:"ncondition",expression:"env == 'staging' ",attachment:["\n            ",{type:"capture",to:"buy_again_link",nodelist:["\n                \n                <button class='download-link buy-link buy-again' type=\"button\">Buy again (staging)</button>\n            "]},"\n        "]}]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"you_own_this_type",right:"'physical'",operator:"==",attachment:["\n        ",{type:"capture",to:"buy_again_link",nodelist:["\n            ",{type:"include",template_name:"'tralbum_common/package_buy_button'"},"\n        "]},"\n        \n        ",{type:"capture",to:"buy_again_link_noblanks",nodelist:[{type:"variable",name:"buy_again_link",filters:[["noblanks",["true"]]]}]},"\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"buy_again_link_noblanks == '' ",attachment:["\n            ",{type:"let",variable:"buy_again_link",expression:"false "},"\n        "]}]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"you_own_this_type",right:"'buyfulldisco'",operator:"==",attachment:["\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"is_admin ",attachment:["\n            ",{type:"capture",to:"buy_again_link",nodelist:['\n                \n                <button class=\'buy-link buy-again\' type="button" data-bind="click: fullDiscographyBuyDialog">Buy again (admin)</button>\n            ']},"\n        "]},{type:"ncondition",expression:"env == 'dev' ",attachment:["\n            ",{type:"capture",to:"buy_again_link",nodelist:['\n                \n                <button class=\'buy-link buy-again\' type="button" data-bind="click: fullDiscographyBuyDialog">Buy again (dev)</button>\n            ']},"\n        "]},{type:"ncondition",expression:"env == 'staging' ",attachment:["\n            ",{type:"capture",to:"buy_again_link",nodelist:['\n                \n                <button class=\'buy-link buy-again\' type="button" data-bind="click: fullDiscographyBuyDialog">Buy again (staging)</button>\n            ']},"\n        "]}]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"you_own_this_type",right:"'crowdfunding-campaign'",operator:"==",attachment:["\n        ",{type:"capture",to:"view_pledge_link",nodelist:['\n            <a href="',{type:"variable",name:"crowdfunding_campaign_data.url",filters:[["a",[]]]},'" class="crowdfunding-view-pledge">',{type:"translate",nodelist:["view pledge"]},"</a>\n        "]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"you_own_this_type",right:"'live-ticket'",operator:"==",attachment:["\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"is_admin ",attachment:["\n            \n            ",{type:"capture",to:"_buy_text",nodelist:['\n                <span class="buy-again">Buy again (admin)</span>\n            ']},"\n            ",{type:"capture",to:"buy_again_link",nodelist:["\n                ",{type:"include",template_name:"'tralbum_common/package_buy_button'"},"\n            "]},"\n        "]},{type:"ncondition",expression:"env == 'dev' ",attachment:["\n            \n            ",{type:"capture",to:"_buy_text",nodelist:['\n                <span class="buy-again">Buy again (dev)</span>\n            ']},"\n            ",{type:"capture",to:"buy_again_link",nodelist:["\n                ",{type:"include",template_name:"'tralbum_common/package_buy_button'"},"\n            "]},"\n        "]},{type:"ncondition",expression:"env == 'staging' ",attachment:["\n            \n            ",{type:"capture",to:"_buy_text",nodelist:['\n                <span class="buy-again">Buy again (stagin)</span>\n            ']},"\n            ",{type:"capture",to:"buy_again_link",nodelist:["\n                ",{type:"include",template_name:"'tralbum_common/package_buy_button'"},"\n            "]},"\n        "]}]},"\n"],child_relation:null,child_condition:null}]},'\n\n\n<h3 class="you-own-this ',{type:"variable",name:"you_own_this_type",filters:[]},'">\n    ',{type:"ef",blocks:[{type:"ncondition",expression:"you_own_this_type == 'live-ticket' ",attachment:['\n        <button class="button-blue live-event live-event-stream-button" ',{type:"ef",blocks:[{type:"ncondition",expression:"!show_live_stream_link ",attachment:['style="display: none"']}]},' data-pkg="',{type:"variable",name:"package_index",filters:[["a",[]]]},'">',{type:"translate",nodelist:["Join live stream"]},'</button>\n        <button class="live-event attending live-event-attending-button ',{type:"ef",blocks:[{type:"ncondition",expression:"live_event_type == 'f' ",attachment:["free"]}]},'" ',{type:"ef",blocks:[{type:"ncondition",expression:"show_live_stream_link ",attachment:['style="display: none"']}]},'>\n            <span class="dot"><svg class="check-icon" viewBox="0 0 18 18"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#following-checkmark"></use></svg></span>\n            ',{type:"translate",nodelist:["Youâ€™re attending this event"]},"\n        </button>\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"live_event_type == 'f' ",attachment:['\n        <button class="live-event attending live-event-attending-button live-event-unattend-button" ',{type:"ef",blocks:[{type:"ncondition",expression:"show_live_stream_link ",attachment:['style="display: none"']}]},">\n            ",{type:"translate",nodelist:["I canâ€™t make it"]},"\n        </button>\n        "]}]},"\n    "]},{type:"else_ncondition",attachment:['\n        <span class="bc-ui2 you-own-this-icon"></span>\n        <span>\n            ',{type:"ef",blocks:[{type:"ncondition",expression:"you_own_this_type == 'crowdfunding-campaign' ",attachment:["\n                ",{type:"translate",nodelist:["You pledged ",{type:"variable",name:"pledge_amount",filters:[["money",["2"]],["h",[]]]},""]},"\n            "]},{type:"else_ncondition",attachment:["\n                ",{type:"ef",blocks:[{type:"ncondition",expression:"link_to_collection ",attachment:['<a class="you-own-this-link" target="_blank" href="',{type:"variable",name:"tralbum_collect_info.fan_trackpipe_url",filters:[["a",[]]]},'">']}]},{type:"translate",nodelist:["You own this"]},{type:"ef",blocks:[{type:"ncondition",expression:"link_to_collection ",attachment:["</a>"]}]},"\n            "]}]},"\n        </span>\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"buy_again_link && !is_phone ",attachment:["\n            ",{type:"variable",name:"buy_again_link",filters:[]},"\n        "]},{type:"ncondition",expression:"view_pledge_link && !is_phone ",attachment:["\n            ",{type:"variable",name:"view_pledge_link",filters:[]},"\n        "]}]},"\n    "]}]},"\n</h3>\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"you_own_this_type != 'live-ticket' ",attachment:["\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"buy_again_link && is_phone ",attachment:['\n        <h4 class="compound-button buy-again-wrapper">',{type:"variable",name:"buy_again_link",filters:[]},"</h4>\n    "]},{type:"ncondition",expression:"view_pledge_link && is_phone ",attachment:['\n        <h4 class="compound-button buy-again-wrapper">',{type:"variable",name:"view_pledge_link",filters:[]},"</h4>\n    "]}]},"\n"]}]}]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/tralbum_common/tralbum_collectors.liquid","warn"):Templ.register({"tralbum_common/tralbum_collectors":[{type:"let",variable:"max_thumbs",expression:"thumbs.length "},"\n\n",{type:"for",collection_name:"reviews",nodelist:["\n\t",{type:"let",variable:"loop_index",expression:"forloop.index "},"\n    ",{type:"include",template_name:"'fan/collection/grid/also_collected_by_review_innards'"},"\n"],variable_name:"review",reversed:null,attribs:{}},"\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"more_reviews_available ",attachment:['\n    <a class="more-writing">',{type:"translate",nodelist:["more..."]},'</a>\n    <span class="loading loading-writing" style="display: none;"></span>\n']}]},'\n\n<div class="no-writing">\n',{type:"for",collection_name:"thumbs",nodelist:["\n\t",{type:"let",variable:"loop_index",expression:"forloop.index "},"\n    ",{type:"include",template_name:"'fan/collection/grid/also_collected_by_no_review_innards'"},"\n"],variable_name:"fan",reversed:null,attribs:{}},"\n</div>\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"more_thumbs_available ",attachment:['\n\t<a class="more-thumbs">',{type:"translate",nodelist:["more..."]},'</a>\n\t<span class="loading loading-thumbs" style="display: none;"></span>\n']}]}]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/fan/collection/grid/also_collected_by_deets.liquid","warn"):Templ.register({"fan/collection/grid/also_collected_by_deets":[{type:"ef",blocks:[{type:"ncondition",expression:"!max_reviews ",attachment:["\n    ",{type:"let",variable:"max_reviews",expression:"6 "},"\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"reviews.length > max_reviews ",attachment:["\n         ",{type:"let",variable:"max_reviews",expression:"3 "},"\n    "]}]},"\n"]}]},"\n",{type:"let",variable:"num_reviews_shown",expression:"0 "},"\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"!max_thumbs ",attachment:["\n    ",{type:"let",variable:"max_thumbs",expression:"80 "},"\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"no_reviews.length > max_thumbs ",attachment:["\n         ",{type:"let",variable:"max_thumbs",expression:"50 "},"\n    "]}]},"\n"]}]},"\n",{type:"let",variable:"num_thumbs_shown",expression:"0 "},"\n\n",{type:"for",collection_name:"reviews",nodelist:["\n    ",{type:"let",variable:"loop_index",expression:"forloop.index "},"\n    ",{type:"include",template_name:"'fan/collection/grid/also_collected_by_review_innards'"},"\n    ",{type:"let",variable:"num_reviews_shown",expression:"num_reviews_shown + 1 "},"\n"],variable_name:"review",reversed:null,attribs:{limit:"max_reviews"}},"\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"reviews.length > max_reviews && !single_toggle ",attachment:['\n    <a class="more-writing">',{type:"translate",nodelist:["more..."]},"</a>\n"]}]},'\n\n<div class="no-writing">\n',{type:"for",collection_name:"no_reviews",nodelist:["\n    ",{type:"let",variable:"loop_index",expression:"forloop.index "},"\n    ",{type:"include",template_name:"'fan/collection/grid/also_collected_by_no_review_innards'"},"\n    ",{type:"let",variable:"num_thumbs_shown",expression:"num_thumbs_shown + 1 "},"\n"],variable_name:"fan",reversed:null,attribs:{limit:"max_thumbs"}},"\n\n",{type:"let",variable:"num_total",expression:"reviews.length + no_reviews.length "},"\n",{type:"let",variable:"num_shown",expression:"num_reviews_shown + num_thumbs_shown "},"\n",{type:"ef",blocks:[{type:"ncondition",expression:"single_toggle && num_shown < num_total ",attachment:["\n",{type:"let",variable:"total_to_display",expression:"num_total - num_shown "},'\n<a class="more-everything" \n   data-more-reviews="',{type:"ef",blocks:[{type:"ncondition",expression:"num_reviews_shown < reviews.length ",attachment:["true"]},{type:"else_ncondition",attachment:["false"]}]},'" \n   data-more-thumbs="',{type:"ef",blocks:[{type:"ncondition",expression:"num_thumbs_shown < no_reviews.length ",attachment:["true"]},{type:"else_ncondition",attachment:["false"]}]},'">\n\t',{type:"translatePlural",blocks:[{type:"ncondition",expression:"total_to_display== 1",attachment:["and 1 other"]},{type:"else_ncondition",attachment:["and ",{type:"variable",name:"total_to_display",filters:[["h",[]]]}," others"]}]},"\n</a>\n"]},{type:"ncondition",expression:"show_more_collectors ",attachment:['\n<a class="ellipsis show-more">\n    <div class="ellipsis-bg"></div>\n    <div class="ellipsis-text">&hellip;</div>\n</a>\n']},{type:"ncondition",expression:"no_reviews.length > max_thumbs ",attachment:['\n<a class="more-thumbs">',{type:"translate",nodelist:["more..."]},"</a>\n"]}]},"\n\n</div>\n"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/fan/collection/grid/also_collected_by_review_innards.liquid","warn"):Templ.register({"fan/collection/grid/also_collected_by_review_innards":['<div class="writing">\n    <a class="pic" href="',{type:"variable",name:"review.username",filters:[["fan_page_url",[]],["a",[]]]},"?from=",{type:"variable",name:"from_parm",filters:[["a",[]]]},'">\n        ',{type:"ef",blocks:[{type:"ncondition",expression:"show_tooltips ",attachment:['\n        <div class="tooltip">\n            <div class="round3">\n                <img class="grid lazy" src="/img/0.gif" data-original="',{type:"variable",name:"review.image_id",filters:[["image_url",["50"]]]},'" style="display: inline-block;"/>\n                <div class="name">',{type:"variable",name:"review.name",filters:[["h",[]]]},"</div>\n            </div>\n        </div>\n        "]}]},"\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"loop_index > 20 ",attachment:['\n        <img class="thumb lazy" src="/img/0.gif" data-original="',{type:"ef",blocks:[{type:"ncondition",expression:"is_phone ",attachment:[{type:"variable",name:"review.image_id",filters:[["image_url",["50"]]]}]},{type:"else_ncondition",attachment:[{type:"variable",name:"review.image_id",filters:[["image_url",["42"]]]}]}]},'" style="display: inline-block" alt="',{type:"variable",name:"review.name",filters:[["a",[]]]},' thumbnail">\n        ']},{type:"else_ncondition",attachment:['\n        <img class="thumb" src="',{type:"ef",blocks:[{type:"ncondition",expression:"is_phone ",attachment:[{type:"variable",name:"review.image_id",filters:[["image_url",["50"]]]}]},{type:"else_ncondition",attachment:[{type:"variable",name:"review.image_id",filters:[["image_url",["42"]]]}]}]},'" alt="',{type:"variable",name:"review.name",filters:[["a",[]]]},' thumbnail"/>\n        ']}]},'\n    </a>\n    <div class="text">\n        ',{type:"ef",blocks:[{type:"ncondition",expression:"member_of_current_band ",attachment:['\n            <a class="censor round3"\n                data-fan-id="',{type:"variable",name:"review.fan_id",filters:[["a",[]]]},'"\n                data-item-type="',{type:"variable",name:"review.item_type",filters:[["a",[]]]},'"\n                data-item-id="',{type:"variable",name:"review.item_id",filters:[["a",[]]]},'"\n                data-fan-name="',{type:"variable",name:"review.name",filters:[["a",[]]]},'"\n            >\n                X\n            </a>\n        ']}]},'\n        <a class="name notSkinnable" href="',{type:"variable",name:"review.username",filters:[["fan_page_url",[]],["a",[]]]},"?from=",{type:"variable",name:"from_parm",filters:[["a",[]]]},'">',{type:"variable",name:"review.name",filters:[["h",[]]]},"</a>\n        ",{type:"variable",name:"review.why",filters:[["html_autolink",["'target=\"_blank\"'"]],["newline_to_gap",["true"]]]},"\n\n        ",{type:"ef",blocks:[{type:"ncondition",expression:'review.fav_track_title && review.item_type != "t" ',attachment:['\n            <span class="fav-track">',{type:"translate",nodelist:["Favorite track: ",{type:"translateVariable",var_name:"fave_track",nodelist:[{type:"variable",name:"review.fav_track_title",filters:[["h",[]]]}]},"."]},"</span>\n        "]}]},"\n    </div>\n</div>\n"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/fan/collection/grid/also_collected_by_no_review_innards.liquid","warn"):Templ.register({"fan/collection/grid/also_collected_by_no_review_innards":['<a class="fan pic',{type:"ef",blocks:[{type:"ncondition",expression:"fan.why ",attachment:[" just"]}]},'" href="',{type:"variable",name:"fan.username",filters:[["fan_page_url",[]],["a",[]]]},"?from=",{type:"variable",name:"from_parm",filters:[["a",[]]]},'">\n    ',{type:"ef",blocks:[{type:"ncondition",expression:"show_tooltips ",attachment:['\n    <div class="tooltip">\n        <div class="round3">\n        \t<img class="grid lazy" src="/img/0.gif" data-original="',{type:"variable",name:"fan.image_id",filters:[["image_url",["50"]]]},'" style="display: inline-block;"/>\n            <div class="name">',{type:"variable",name:"fan.name",filters:[["h",[]]]},"</div>\n            ",{type:"ef",blocks:[{type:"ncondition",expression:"fan.why ",attachment:['\n            <div class="writing">\n                &ldquo;',{type:"variable",name:"fan.why",filters:[]},"&rdquo;\n            </div>\n            "]}]},"\n        </div>\n    </div>\n    "]}]},"\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"fan.why ",attachment:['\n    <div class="just-icon-bg"></div>\n    <div class="just-icon">&ldquo;</div>\n    ']}]},"\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"loop_index > max_thumbs ",attachment:['\n    <img class="thumb lazy" src="/img/0.gif" data-original="',{type:"ef",blocks:[{type:"ncondition",expression:"is_phone ",attachment:[{type:"variable",name:"fan.image_id",filters:[["image_url",["50"]]]}]},{type:"else_ncondition",attachment:[{type:"variable",name:"fan.image_id",filters:[["image_url",["42"]]]}]}]},'" style="display: inline-block" alt="',{type:"variable",name:"fan.name",filters:[["a",[]]]},' thumbnail">\n    ']},{type:"else_ncondition",attachment:['\n    <img class="thumb" src="',{type:"ef",blocks:[{type:"ncondition",expression:"is_phone ",attachment:[{type:"variable",name:"fan.image_id",filters:[["image_url",["50"]]]}]},{type:"else_ncondition",attachment:[{type:"variable",name:"fan.image_id",filters:[["image_url",["42"]]]}]}]},'" alt="',{type:"variable",name:"fan.name",filters:[["a",[]]]},' thumbnail"/>\n    ']}]},"\n</a>\n"]}),void 0===window.Templ?Log.server("Premature template registration: common/layout/templates/_autocomplete_responsive_widget.liquid","warn"):Templ.register({_autocomplete_responsive_widget:['<form aria-label="autocomplete search" class="menubar-search signup-tooltip-parent" action="/search" method="get" data-tooltip-id="s" aria-busy="false">\n  <input tabindex="0" aria-autocomplete="list" class="dismiss-tooltip-alt search-bar" type="text" name="q" placeholder="',{type:"translate",nodelist:["Search for artist, album, or track"]},'" autocomplete="off">\n    <div role="progressbar" class="loading-icon" id="search-loading-icon" aria-busy="false">\n        <svg aria-label="loading icon" class="search-spinner" width="15" height="16" viewBox="-1 -1 16 16">\n            <use href="#search-spinner"></use>\n        </svg>\n    </div>\n    <div aria-label="clear search" class="clear-autocomplete" >Ã—</div>\n  </input>\n  <input type="hidden" class="selected-filter" name="item_type" value="" />\n  <button type="submit" tabindex="-1" aria-label="submit for full search page" class="menubar-search-icon"><svg width="15" height="16" viewBox="0 0 15 16"><use href="#menubar-search-input-icon" /></svg></button>\n  <ul role="listbox" class="genre-list" aria-busy="false"></ul>\n  <ul class="filter-list" aria-busy="false"></ul>\n  <ul role="listbox" class="search-autocomplete" aria-busy="false">\n    \n    <li class="simple results-see-all">\n      <a tabindex="-1" aria-label="visit full-search page">\n        <span>',{type:"translate",nodelist:["See all results"]},'</span>\n        <span><svg class="arrow" viewBox="0 0 24 24"><use href="#discover-arrow"></svg></span>\n      </a>\n    </li>\n    <li class="simple results-tags">\n      <a tabindex="-1" >\n        <span class="msg"></span>\n        <span><svg class="arrow" viewBox="0 0 24 24"><use href="#discover-arrow"></svg></span>\n      </a>\n    </li>\n    <li class="simple results-genre">\n      <a tabindex="-1">\n        <span class="msg"></span>\n        <span><svg class="arrow" viewBox="0 0 24 24"><use href="#discover-arrow"></svg></span>\n      </a>\n    </li>\n    <li aria-label="no matching results" class="autocomplete-no-results" >\n      <p class="noresults-header">',{type:"translate",nodelist:["No matching results"]},'</p>\n      <p class="noresults-text">',{type:"translate",nodelist:["Try a different filter or a new search keyword."]},'</p>\n      <div class="tumbleweed">\n        <img src="/img/search/tumbleweed-emptystate-lightbg.gif"/>\n      </div>\n    </li>\n  </ul>\n  <li class="simple mobile-results-tags no-show">\n    <a>\n      <span class="msg"></span>\n      <span><svg class="arrow" viewBox="0 0 24 24"><use href="#discover-arrow"></svg></span>\n    </a>\n  </li>\n  <div class="mobile-placeholder">\n      <p>',{type:"translate",nodelist:["Search all Bandcamp artists, tracks, and albums"]},'</p>\n  </div>\n  <template id="autocomplete-results-item"><li class="result-item">\n    <a tabindex="-1">\n      <span class="result-art"><img></span>\n      <span class="result-info">\n        <div class="result-title"><strong></strong></div>\n        <cite></cite>\n        <div class="result-type"></div>\n      </span>\n    </a>\n  </li></template>\n  <div class="signup-tooltip-outer search-tooltip-outer header-2018"></div>\n</form>\n<div aria-label="cancel search" class="cancel-autocomplete" >',{type:"translate",nodelist:["cancel"]},"</div>"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/_tralbum_physical_gift_title.liquid","warn"):Templ.register({_tralbum_physical_gift_title:[{type:"ef",blocks:[{type:"ncondition",expression:"merch_type == 1 ",attachment:["\n    ",{type:"translate",nodelist:["Gift â€“ CD, ",{type:"variable",name:"merch_title",filters:[]},""]},"\n"]},{type:"ncondition",expression:"merch_type == 2 || merch_type == 15 || merch_type == 16 || merch_type == 17 || merch_type == 18 ",attachment:["\n    ",{type:"translate",nodelist:["Gift â€“ Vinyl, ",{type:"variable",name:"merch_title",filters:[]},""]},"\n"]},{type:"ncondition",expression:"merch_type == 3 ",attachment:["\n    ",{type:"translate",nodelist:["Gift - Cassette, ",{type:"variable",name:"merch_title",filters:[]},""]},"\n"]},{type:"else_ncondition",attachment:["\n    ",{type:"translate",nodelist:["Gift â€“ ",{type:"variable",name:"merch_title",filters:[]},""]},"\n"]}]},"\n"]}),void 0===window.Templ?Log.server("Premature template registration: common/layout/templates/menubar.liquid","warn"):Templ.register({menubar:["\n\n\n\n",{type:"let",variable:"has_full_access",expression:"!menubar.force_no_control && (page_identities.is_page_band_member || page_identities.is_admin) "},"\n",{type:"let",variable:"has_limited_access",expression:"page_identities.page_band_parent_label_id && !page_identities.page_band.authed "},"\n",{type:"let",variable:"has_access",expression:"has_full_access || has_limited_access "},"\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"page_identities.bands.length >= 1 ",attachment:["\n    ",{type:"let",variable:"b",expression:"page_identities.bands[0] "},"\n    ",{type:"let",variable:"artistsmenu_title",expression:"b.name "},"\n    ",{type:"let",variable:"artistsmenu_show_photo",expression:"true "},"\n    ",{type:"let",variable:"artistsmenu_photo",expression:"b.photo "},"\n    ",{type:"let",variable:"artistsmenu_show_pro",expression:"b.is_pro "},"\n"]},{type:"else_ncondition",attachment:["\n    ",{type:"let",variable:"artistsmenu_title",expression:'"artists" '},"\n    ",{type:"let",variable:"artistsmenu_show_photo",expression:"false "},"\n    ",{type:"let",variable:"artistsmenu_photo",expression:"nil "},"\n    ",{type:"let",variable:"artistsmenu_show_pro",expression:"menubar.any_pro "},"\n"]}]},"\n\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"page_identities.page_band && has_full_access ",attachment:["\n    ",{type:"let",variable:"hide_unless_has_full_access",expression:'"" '},"\n"]},{type:"else_ncondition",attachment:["\n    ",{type:"let",variable:"hide_unless_has_full_access",expression:'"hidden-while-loading" '},"\n"]}]},"\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"page_identities.page_band && has_access ",attachment:["\n    ",{type:"let",variable:"hide_unless_has_access",expression:'"" '},"\n    ",{type:"let",variable:"hide_if_has_access",expression:'"hidden-while-loading" '},"\n"]},{type:"else_ncondition",attachment:["\n    ",{type:"let",variable:"hide_unless_has_access",expression:'"hidden-while-loading" '},"\n    ",{type:"let",variable:"hide_if_has_access",expression:'"" '},"\n"]}]},"\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"page_identities.page_band && page_identities.page_band.is_label && has_full_access ",attachment:["\n    ",{type:"let",variable:"hide_if_not_logged_in_label",expression:'"" '},"\n    ",{type:"let",variable:"hide_if_logged_in_label",expression:'"hidden-while-loading" '},"\n"]},{type:"else_ncondition",attachment:["\n    ",{type:"let",variable:"hide_if_not_logged_in_label",expression:'"hidden-while-loading" '},"\n    ",{type:"let",variable:"hide_if_logged_in_label",expression:'"" '},"\n"]}]},"\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"page_identities.page_band && page_identities.page_band.is_label && menubar.artist_subscriptions_enabled ",attachment:["\n    ",{type:"ef",blocks:[{type:"ncondition",expression:'menubar.unshipped_order_count == "async" ',attachment:["\n        ",{type:"let",variable:"wide",expression:"false "},"\n        ",{type:"let",variable:"extra_wide",expression:"true "},"\n    "]},{type:"else_ncondition",attachment:["\n        ",{type:"let",variable:"wide",expression:"true "},"\n        ",{type:"let",variable:"extra_wide",expression:"false "},"\n    "]}]},"\n"]},{type:"ncondition",expression:"!hide_search && page_identities.fan ",attachment:["\n        ",{type:"let",variable:"wide",expression:"false "},"\n        ",{type:"let",variable:"extra_wide",expression:"true "},"\n"]},{type:"else_ncondition",attachment:["\n    ",{type:"let",variable:"wide",expression:"false "},"\n    ",{type:"let",variable:"extra_wide",expression:"false "},"\n"]}]},"\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"!cfg.header_rework_2018 && page_identities.bands.length > 0 && page_identities.fan ",attachment:["\n    ",{type:"let",variable:"show_balance_number",expression:"false "},"\n"]},{type:"else_ncondition",attachment:["\n    ",{type:"let",variable:"show_balance_number",expression:"true "},"\n"]}]},'\n\n<div id="menubar-vm" class="menubar-outer loading" data-initial-values="',{type:"variable",name:"menubar",filters:[["json",[]],["a",[]]]},'">\n<div id="menubar"\n    class="\n        menubar-2018\n        ',{type:"ef",blocks:[{type:"ncondition",expression:"(!page_identities.page_band || menubar.force_no_control) && (!has_full_access || (is_admin && page_identities.page_band != 0)) ",attachment:["out"]}]}," ",{type:"ef",blocks:[{type:"ncondition",expression:"wide ",attachment:["wide"]}]},"\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"extra_wide ",attachment:["extra-wide"]}]},"\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"is_admin_impersonating ",attachment:["admin-impersonating"]}]},'\n    "\n>\n<ul id="site-nav" class="menubar-section horizontal" data-test="site-nav">\n\n    \n    <li class="bclogo white" data-test="mb-bandcamp-logo"><a href="',{type:"variable",name:"siteroot_current",filters:[["a",[]]]},"/?from=",{type:"ef",blocks:[{type:"ncondition",expression:"!(page_identities.user) ",attachment:["menubar_logo_logged_out"]},{type:"else_ncondition",attachment:["menubar_logo_logged_in"]}]},'"><svg width="108px" height="17px" viewBox="0 0 127 20"><use xlink:href="#bandcamp-logo-color-white"></svg></a></li>\n    <li class="bclogo aqua" data-test="mb-bandcamp-logo"><a href="',{type:"variable",name:"siteroot_current",filters:[["a",[]]]},"/?from=",{type:"ef",blocks:[{type:"ncondition",expression:"!(page_identities.user) ",attachment:["menubar_logo_logged_out"]},{type:"else_ncondition",attachment:["menubar_logo_logged_in"]}]},'"><svg width="108px" height="17px" viewBox="0 0 127 20"><use xlink:href="#bandcamp-logo-color-bcaqua"></svg></a></li>\n\n\n    \x3c!-- ko if: showBandControls() || showLimitedAccessControls() --\x3e\n    ',{type:"ef",blocks:[{type:"ncondition",expression:"menubar.show_dashboard_link ",attachment:['\n    <li class="menubar-item hoverable ',{type:"variable",name:"hide_unless_has_access",filters:[]},'" data-test="mb-dashboard">\n        <a data-bind="attr: {href: dashboardLinkHref()}">',{type:"translate",nodelist:["dashboard"]},'</a>\n    </li>\n    <li class="tralbum-tooltip-parent dash-link" data-bind="css: {\'show-tooltip\': dashboardTooltipVM().showing}">\n        <div class="tralbum-tooltip-outer">\n            <div class="inner-circle-wrapper">\n                <div class="inner-circle"></div>\n                <div class="inner-circle-contents">\n                    <a class="tooltip-action" data-bind="click: dashboardTooltipVM().close, attr: {href: dashboardLinkHref()}, text: dashboardTooltipVM().centralText"></a>\n                </div>\n            </div>\n            <div class="tralbum-tooltip">\n                <div class="tralbum-tooltip-inner">\n                    <span class="progress" data-bind="text: dashboardTooltipVM().progress"></span>\n                    <span data-bind="text: dashboardTooltipVM().tipText"></span>\n                    <a class="dismiss-tooltip" data-bind="click: dashboardTooltipVM().continueTips, text: dashboardTooltipVM().closeText"></a>\n                </div>\n            </div>\n        </div>\n    </li>\n    ']}]},'\n    <li class="menubar-item hoverable ',{type:"variable",name:"hide_unless_has_access",filters:[]},' add-menu" data-test="mb-add">\n        <a class="menubar-add-link">',{type:"translate",nodelist:["+ add"]},'</a>\n        <ul class="menu hidden-while-loading">\n            \n            \x3c!-- ko if: showBandControls() || showLimitedAccessControls() --\x3e\n            <ol data-bind="css: {\'page-band-links\': pageBand.isLabel()}">\n                <li class="submenu-item" data-test="mb-add-album"><a data-bind="attr: {href: pageBand.trackpipeLocalUrl() + \'/edit_album\'}, click: addAlbumClick">',{type:"translate",nodelist:["album"]},'</a></li>\n                <li class="submenu-item" data-test="mb-add-track"><a data-bind="attr: {href: pageBand.trackpipeLocalUrl() + \'/edit_track\'}, click: addTrackClick">',{type:"translate",nodelist:["track"]},'</a></li>\n                <li class="submenu-item"data-test="mb-add-merch"><a id="menubar-add-merch-link" data-bind="attr: {href: pageBand.trackpipeLocalUrl() + \'/edit_merch\'}, click: addMerchClick"><span class="add-music">',{type:"translate",nodelist:["merch"]},"</span></a></li>\n                ",{type:"ef",blocks:[{type:"ncondition",expression:"menubar.show_crowdfunding_link ",attachment:['\n                    <li class="submenu-item" data-test="mb-add-vinyl"><a id="menubar-add-merch-link" data-bind="attr: {href: pageBand.trackpipeLocalUrl() + \'/edit_vinyl_campaign\'}"><span class="add-music">',{type:"translate",nodelist:["vinyl campaign"]},"</span></a></li>\n                "]}]},"\n\n                ",{type:"ef",blocks:[{type:"ncondition",expression:"menubar.show_add_live_show ",attachment:['\n                    <li class="submenu-item" data-test="mb-add-livestream"><a data-bind="attr: {href: pageBand.trackpipeLocalUrl() + \'/edit_live_show\'}, click: addLiveEventClick">',{type:"translate",nodelist:["live stream"]},"</a></li>\n                "]}]},'\n            </ol>\n            \x3c!-- /ko --\x3e\n            \x3c!-- ko if: showBandControls() && pageBand.isLabel() --\x3e\n            <ol>\n                <li class="ui-widget-content ui-menu-divider"></li>\n                <li class="submenu-item"><a data-bind="click: addNewArtist">',{type:"translate",nodelist:["new artist"]},'</a></li>\n                <li class="submenu-item"><a data-bind="click: addExistingArtist">',{type:"translate",nodelist:["existing artist"]},"</a></li>\n            </ol>\n            \x3c!-- /ko --\x3e\n        </ul>\n    </li>\n    \x3c!-- /ko --\x3e\n\n    \n\n    \x3c!-- ko if: showBandControls() || showLimitedAccessControls() --\x3e\n    \n    ",{type:"ef",blocks:[{type:"ncondition",expression:"menubar.unshipped_order_count ",attachment:['\n        <li class="menubar-item hoverable ',{type:"variable",name:"hide_unless_has_access",filters:[]},'">\n            <a data-bind="attr: {href: ordersLinkHref}">\n                ',{type:"ef",blocks:[{type:"ncondition",expression:"menubar.unshipped_order_count == 0 ",attachment:["\n                    ",{type:"translate",nodelist:["orders"]},"\n                "]},{type:"else_ncondition",attachment:['\n                    <span class="menubar-async-order-count">\n                        <span class="unshipped-order-count-value-wrapper">\n                            <span class="unshipped-order-count-value order-count-loading"></span>\n                        </span>\n                        <span class="unshipped-order-count-label">orders</span>\n                    </span>\n                ']}]},"\n            </a>\n        </li>\n    "]}]},'\n\n    \n        <li class="menubar-item hoverable ',{type:"variable",name:"hide_unless_has_access",filters:[]},'" data-test="mb-stats">\n            <a data-bind="attr: {href: statsLinkHref2018}">',{type:"translate",nodelist:["stats"]},"</a>\n        </li>\n\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"menubar.artist_subscriptions_enabled ",attachment:['\n        <li class="menubar-item ',{type:"ef",blocks:[{type:"ncondition",expression:"menubar.artist_service_active ",attachment:["hoverable"]}]},'" data-test="mb-subscriptions">\n        \x3c!-- ko if: pageBand.hasService() --\x3e\n            <a><span class="subscription-name add-music has-children ',{type:"variable",name:"hide_unless_has_access",filters:[]}," ",{type:"ef",blocks:[{type:"ncondition",expression:"!menubar.artist_service_active ",attachment:["hidden-while-loading"]}]},'">',{type:"translate",nodelist:["subscription"]},'</span></a>\n            <ul class="menu subscription-menu">\n                <li class="submenu-item"><a data-bind="attr: {href: pageBand.trackpipeLocalUrl() + \'/\' + pageBand.serviceUrlFragment() + \'?from=menubar\'}"><strong data-bind="text: pageBand.serviceName">',{type:"variable",name:"menubar.artist_service_name",filters:[["h",[]]]},'</strong></a></li> \x3c!-- clairenote artist_service_name is for pageartist artist_service_has_subscribers too--\x3e\n                <li class="submenu-item"><a data-bind="attr: {href: pageBand.trackpipeLocalUrl() + \'/edit_subscription?from=menubar\'}">',{type:"translate",nodelist:["edit"]},'</a></li>\n                <li class="',{type:"ef",blocks:[{type:"ncondition",expression:"!menubar.artist_service_has_subscribers ",attachment:["ui-state-disabled"]}]},' submenu-item">\n                    <a ',{type:"ef",blocks:[{type:"ncondition",expression:"menubar.artist_service_has_subscribers ",attachment:["data-bind=\"attr: {href: pageBand.trackpipeLocalUrl() + '/subscribers?from=menubar'}\""]}]},">",{type:"translate",nodelist:["subscribers"]},'</a>\n                </li>\n                <li class="submenu-item">\n                    <a data-bind="attr: {href: pageBand.trackpipeLocalUrl() + \'/community?from=menubar\'}">',{type:"translate",nodelist:["message subscribers"]},"</a>\n                </li>\n            </ul>\n        \x3c!-- /ko --\x3e\n        </li>\n    "]}]},"\n\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"menubar.live_events ",attachment:['\n        <li class="menubar-item hoverable" data-test="mb-livestreams">\n            <a><span class="add-music has-children ',{type:"variable",name:"hide_unless_has_access",filters:[]},'">',{type:"translate",nodelist:["live streams"]},'</span></a>\n            <ul class="menu live-menu">\n                <ol class="live-events">\n                    \x3c!-- ko if: artistsMenu.liveEvents().drafts.length --\x3e\n                        <li class="submenu-label" data-test="mb-livestreams-drafts"><b>',{type:"translate",nodelist:["draft events"]},'</b></li>\n                        <ol data-bind="foreach: { data: artistsMenu.liveEvents().drafts, as: \'event\' }">\n                            <li class="submenu-item">\n                                <a data-bind="text: event.title, attr: { href: event.url }"></a>\n                            </li>\n                        </ol>\n                    \x3c!-- /ko --\x3e\n                    \x3c!-- ko if: artistsMenu.liveEvents().upcoming.length --\x3e\n                        <li class="submenu-label" data-test="mb-livestreams-upcoming"><b>',{type:"translate",nodelist:["upcoming events"]},'</b></li>\n                        <ol data-bind="foreach: { data: artistsMenu.liveEvents().upcoming, as: \'event\' }">\n                            <li class="submenu-item"><a data-bind="text: event.title, attr: { href: event.url }"></a></li>\n                        </ol>\n                    \x3c!-- /ko --\x3e\n                    \x3c!-- ko if: artistsMenu.liveEvents().past.length --\x3e\n                        <li class="submenu-label" data-test="mb-livestreams-past"><b>',{type:"translate",nodelist:["past events"]},'</b></li>\n                        <ol data-bind="foreach: { data: artistsMenu.liveEvents().past, as: \'event\' }">\n                            <li class="submenu-item"><a data-bind="text: event.title, attr: { href: event.url }"></a></li>\n                        </ol>\n                    \x3c!-- /ko --\x3e\n                </ol>\n            </ul>\n        </li>\n    ']}]},"\n\n    \x3c!-- /ko --\x3e\n    \x3c!-- ko ifnot: showBandControls() || showLimitedAccessControls() --\x3e\n    \x3c!-- ko ifnot: showMobileAutocomplete() --\x3e\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"!hide_search ",attachment:['\n        <li id="main-search-container" class="search extended menubar-item ',{type:"variable",name:"hide_if_has_access",filters:[]},'" data-test="mb-search-box">\n            ',{type:"include",template_name:"'_autocomplete_responsive_widget'"},"\n        </li>\n    "]}]},'\n    \x3c!-- /ko --\x3e\n    \x3c!-- /ko --\x3e\n</ul>\n\n<ul id="user-nav" class="menubar-section horizontal">\n\x3c!-- ko if: user() --\x3e\n\n    \n    \x3c!-- ko if: partner() --\x3e\n    <li class="menubar-item hoverable ',{type:"ef",blocks:[{type:"ncondition",expression:"!page_identities.partner ",attachment:["hidden-while-loading"]}]},'">\n        <a href="',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},'/partner">',{type:"translate",nodelist:["partner"]},"</a>\n    </li>\n    \x3c!-- /ko --\x3e\n\n    \x3c!-- ko if: showBandControls() || showLimitedAccessControls() --\x3e\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"!hide_search ",attachment:['\n        \n        \n        \x3c!-- ko ifnot: showMobileAutocomplete() --\x3e\n        \x3c!-- ko if: altSearch() --\x3e\n        <li id="alt-search-container" class="search extended menubar-item ',{type:"variable",name:"hide_if_has_access",filters:[]},' hidden-while-loading" data-bind="visible: altSearch()">\n            ',{type:"include",template_name:"'_autocomplete_responsive_widget'"},'\n        </li>\n        \x3c!-- /ko --\x3e\n        \n        <li class="you-autocomplete-me menubar-item ',{type:"variable",name:"hide_unless_has_access",filters:[]},' hoverable" data-bind="click: showAltSearch, visible: !altSearch()">\n            <a><svg width="26px" height="26px" viewBox="0 0 26 26" class="svg-icon"><use xlink:href="#menubar-search-icon"></svg></a>\n        </li>\n        \x3c!-- /ko --\x3e\n    ']}]},"\n    \x3c!-- /ko --\x3e \x3c!-- claire minimized search for artist --\x3e\n\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"has_corp_header ",attachment:["\n        ",{type:"include",template_name:"'corp_hiring_banner'"},"\n    "]}]},"\n\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"menubar.gift_card_balance ",attachment:['\n    <li class="menubar-item hoverable menubar-gift-card-balance">\n        <a href="',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},'/redeem">\n            <svg class="icon gift-card-icon-bordered" width="9px" height="10px" viewBox="0 0 9 10"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#gift-card-icon"></use></svg>\n            \n            <span class="gift-card-balance">',{type:"variable",name:"menubar.gift_card_balance",filters:[["money",["1"]],["h",[]]]}," ",{type:"variable",name:"menubar.gift_card_balance.currency",filters:[["h",[]]]},"</span>\n        </a>\n    </li>\n    "]}]},"\n\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"page_identities.user && !hide_cart_icon ",attachment:['\n    <li data-bind="visible: hasCart" class="menubar-item hoverable cart-wrapper ',{type:"ef",blocks:[{type:"ncondition",expression:"!has_cart ",attachment:["hidden-while-loading"]}]},'" data-test="mb-cart">\n        <a href="',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},'/cart" ',{type:"ef",blocks:[{type:"ncondition",expression:"menubar.is_tralbum_page ",attachment:['data-bind="click: goCart"']}]},' title="',{type:"translate",nodelist:["cart"]},'">\n            <svg width="26" height="26" class="menubar-cart-icon svg-icon">\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#menubar-cart-icon"></use>\n                <text data-bind="text: numCartItemsDisplay" x="15" y="12" dominant-baseline="middle" text-anchor="middle">\n                    ',{type:"variable",name:"cart_quantity",filters:[["h",[]]]},"\n                </text>\n            </svg>\n        </a>\n    </li>\n    "]}]},"\n\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"menubar.has_notifications && !hide_notification_center ",attachment:['\n        <li class="menubar-item hoverable ',{type:"ef",blocks:[{type:"ncondition",expression:"!(page_identities.user) ",attachment:["hidden-while-loading"]}]},' notification-center-menubar-button">\n            <a href="#">\n                <span class="unread-messages-indicator ',{type:"ef",blocks:[{type:"ncondition",expression:"menubar.hide_unseen_notification_indicator ",attachment:["hide"]}]},'" data-bind="css: {\'hide\': hide_unseen_notification_indicator}"></span>\n                <svg width="26px" height="26px" class="svg-icon"><use xlink:href="#menubar-messages-icon"></svg>\n            </a>\n        </li>\n        ',{type:"include",template_name:"'_notification_center_widget'"},"\n    "]}]},"\n\n    \x3c!-- ko if: (fan() && !fan().private) --\x3e\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"!hide_feed ",attachment:['\n        <li id="feed-main" class="signup-tooltip-parent menubar-item hoverable ',{type:"ef",blocks:[{type:"ncondition",expression:"!(page_identities.user && page_identities.fan && !page_identities.fan.private) ",attachment:["hidden-while-loading"]}]},'" data-tooltip-id="f" data-test="mb-feed">\n            <a href="',{type:"ef",blocks:[{type:"ncondition",expression:"page_identities.fan.url ",attachment:[{type:"variable",name:"page_identities.fan.url",filters:[["a",[]]]},"/feed?from=menubar"]}]},'" title="',{type:"translate",nodelist:["feed"]},'">\n                <svg width="26px" height="26px" viewBox="0 0 26 26" class="svg-icon"><use xlink:href="#menubar-feed-icon"></svg>\n            </a>\n            <div class="signup-tooltip-outer feed-tooltip-outer header-2018"></div>\n        </li>\n    ']}]},"\n\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"!hide_collection_wishlist ",attachment:["\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"menubar.has_collection || (!menubar.has_collection && !menubar.has_wishlist) ",attachment:['\n        <li id="collection-main" class="menubar-item hoverable signup-tooltip-parent ',{type:"ef",blocks:[{type:"ncondition",expression:"!(page_identities.user && page_identities.fan && !page_identities.fan.private) ",attachment:["hidden-while-loading"]}]},'" data-tooltip-id="c" data-test="mb-collection">\n            <a href="',{type:"variable",name:"page_identities.fan.url",filters:[["a",[]]]},'" title="',{type:"translate",nodelist:["collection"]},'">\n                <svg width="26" height="26" viewBox="0 0 26 26" class="svg-icon"><use xlink:href="#menubar-collection-icon"></svg>\n            </a>\n            <div class="signup-tooltip-outer collection-tooltip-outer header-2018"></div>\n        </li>\n        ']},{type:"ncondition",expression:"menubar.has_wishlist ",attachment:['\n        <li id="collection-main" class="signup-tooltip-parent menubar-item hoverable ',{type:"ef",blocks:[{type:"ncondition",expression:"!(page_identities.user && page_identities.fan && !page_identities.fan.private) ",attachment:["hidden-while-loading"]}]},'" data-tooltip-id="w" data-test="mb-collection">\n            <a href="',{type:"variable",name:"page_identities.fan.url",filters:[["a",[]]]},'/wishlist" title="',{type:"translate",nodelist:["wishlist"]},'">\n                <svg width="26" height="26" viewBox="0 0 26 26" class="svg-icon"><use xlink:href="#menubar-collection-icon"></svg>\n            </a>\n            <div class="signup-tooltip-outer wishlist-tooltip-outer header-2018"></div>\n        </li>\n        ']}]},"\n    "]}]},'\n    \x3c!-- /ko --\x3e\n        <li class="menubar-item hoverable ',{type:"ef",blocks:[{type:"ncondition",expression:"!(page_identities.user) ",attachment:["hidden-while-loading"]}]},'" data-test="user-menu">\n        <a>\n            <div data-bind="with: artistsMenu">\n                ',{type:"ef",blocks:[{type:"ncondition",expression:"page_identities.bands[0] ",attachment:['\n                    \x3c!-- Artist (and possibly fanartist) profile pic --\x3e\n                    \x3c!-- ko if: optionsLoggedInBand() && optionsLoggedInBand().photo --\x3e\n                    <div class="userpic ',{type:"ef",blocks:[{type:"ncondition",expression:"is_admin ",attachment:["admin"]}]}," ",{type:"ef",blocks:[{type:"ncondition",expression:"!menubar.active_profile_photo ",attachment:["hidden-while-loading"]}]},'">\n                        <img ',{type:"variable",name:"menubar.active_profile_photo",filters:[["image",["'art_embedded_player'"]]]},' data-bind="src_image: {image_id: optionsLoggedInBand().photo, format: \'art_embedded_player\'}"\n                        >\n                    </div>\n                    \x3c!-- /ko --\x3e\n                    \x3c!-- ko ifnot: optionsLoggedInBand() && optionsLoggedInBand().photo --\x3e\n                    <div class="userpic ',{type:"ef",blocks:[{type:"ncondition",expression:"is_admin ",attachment:["admin"]}]}," ",{type:"ef",blocks:[{type:"ncondition",expression:"menubar.active_profile_photo ",attachment:["hidden-while-loading"]}]},'">\n                        <div class="no-image-placeholder"></div>\n                    </div>\n                    \x3c!-- /ko --\x3e\n                ']},{type:"else_ncondition",attachment:['\n                    \x3c!-- Fan only profile pic --\x3e\n                    \x3c!-- ko if: $parent.loggedInFanPhoto() --\x3e\n                    <div class="userpic ',{type:"ef",blocks:[{type:"ncondition",expression:"is_admin ",attachment:["admin"]}]}," ",{type:"ef",blocks:[{type:"ncondition",expression:"!menubar.active_profile_photo ",attachment:["hidden-while-loading"]}]},'">\n                        <img ',{type:"variable",name:"menubar.active_profile_photo",filters:[["image",["'art_embedded_player'"]]]},' data-bind="src_image: {image_id: $parent.loggedInFanPhoto(), format: \'art_embedded_player\'}"\n                        >\n                    </div>\n                    \x3c!-- /ko --\x3e\n                    \x3c!-- ko ifnot: $parent.loggedInFanPhoto() --\x3e\n                    <div class="userpic ',{type:"ef",blocks:[{type:"ncondition",expression:"is_admin ",attachment:["admin"]}]}," ",{type:"ef",blocks:[{type:"ncondition",expression:"menubar.active_profile_photo ",attachment:["hidden-while-loading"]}]},'">\n                        <div class="no-image-placeholder"></div>\n                    </div>\n                    \x3c!-- /ko --\x3e\n                ']}]},'\n            </div>\n        </a>\n\n        <ul class="menu user-menu hidden-while-loading" data-bind="with: artistsMenu, css: { label: (artistsMenu.loggedInLabelMemberBands().length > 0 || artistsMenu.linkedNonLabelMemberBands().length > 1) }">\n        <ol class="user-menu-wrapper">\n            \x3c!-- ARTIST --\x3e\n            \x3c!-- ko if: bmgr.bands().length >= 1 && loggedInBand() --\x3e\n                <li class="submenu-item">\n                    <a data-bind="attr: { href: loggedInBand().trackpipeLocalUrl()}" class="name">\n                        <strong class="menu-bandname" data-bind="text: optionsLoggedInBand().title, css: { long: !optionsLoggedInBand().showPro}">',{type:"variable",name:"artistsmenu_title",filters:[["h",[]]]},"</strong>\n                        ",{type:"ef",blocks:[{type:"ncondition",expression:"page_identities.fan && page_identities.bands.length >= 0 ",attachment:['\n                        \x3c!-- ko if: optionsLoggedInBand() && optionsLoggedInBand().photo --\x3e\n                        <div class="userpic menu-artistpic',{type:"ef",blocks:[{type:"ncondition",expression:"is_admin ",attachment:["admin"]}]}," ",{type:"ef",blocks:[{type:"ncondition",expression:"!menubar.active_profile_photo ",attachment:["hidden-while-loading"]}]},'">\n                            <img ',{type:"variable",name:"menubar.active_profile_photo",filters:[["image",["'art_embedded_player'"]]]},' data-bind="src_image: {image_id: optionsLoggedInBand().photo, format: \'art_embedded_player\'}"\n                            >\n                        </div>\n                        \x3c!-- /ko --\x3e\n                        \x3c!-- ko ifnot: optionsLoggedInBand() && optionsLoggedInBand().photo --\x3e\n                        <div class="userpic ',{type:"ef",blocks:[{type:"ncondition",expression:"is_admin ",attachment:["admin"]}]}," ",{type:"ef",blocks:[{type:"ncondition",expression:"menubar.active_profile_photo ",attachment:["hidden-while-loading"]}]},'">\n                            <div class="no-image-placeholder"></div>\n                        </div>\n                        \x3c!-- /ko --\x3e\n                        ']}]},'\n                        <div data-bind="visible: optionsLoggedInBand().showPro" class="menubar-badge-pro round3 ',{type:"ef",blocks:[{type:"ncondition",expression:"!artistsmenu_show_pro ",attachment:["hidden-while-loading"]}]},'">',{type:"translate",nodelist:["PRO"]},'</div>\n                        <div class="view-site">',{type:"translate",nodelist:["view site"]},'</div>              \n                    </a>\n                </li> \n\n                <li class="submenu-item">\n                    <a data-bind="\n                        attr: {href: \'',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},"/profile?from=menubar&id=' + loggedInBand().id},\n                        css: {admin: optionsLoggedInBand().adminAccess}\"\n                    >\n                        <span>",{type:"translate",nodelist:["edit profile"]},'</span>\n                    </a>\n                </li>\n                <li class="submenu-item">\n                    <a data-bind="\n                        attr: {href: \'',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},"/tools?from=menubar&id=' + loggedInBand().id},\n                        css: {admin: optionsLoggedInBand().adminAccess}\"\n                    >\n                        <span>",{type:"translate",nodelist:["tools"]},"</span>\n                    </a>\n                </li>\n                ",{type:"ef",blocks:[{type:"ncondition",expression:"menubar.band_has_items ",attachment:['\n                <li class="submenu-item">\n                    <a data-bind="click: launchPageDesign.bind($data, loggedInBand())">',{type:"translate",nodelist:["page design"]},"</a>\n                </li>\n                "]}]},'\n\n                <li class="ui-menu-item ',{type:"ef",blocks:[{type:"ncondition",expression:"menubar.page_path == '/edit_subscription' ",attachment:["disabled"]}]},' submenu-item">\n                    \x3c!-- ko ifnot: loggedInBand().hasService() --\x3e\n                        <a data-bind="attr: { href: \'',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},"/subscriptions?band_id=' + loggedInBand().id + '&from=menubar'}\">",{type:"translate",nodelist:["subscription"]},"</a>\n                    \x3c!-- /ko --\x3e\n                    \x3c!-- ko if: loggedInBand().hasService() --\x3e\n                        <a data-bind=\"attr: { href: loggedInBand().trackpipeLocalUrl() + '/' + loggedInBand().serviceUrlFragment() + '?from=menubar'}\">",{type:"translate",nodelist:["subscription"]},'</a>\n                    \x3c!-- /ko --\x3e\n                </li>\n            \x3c!-- /ko --\x3e\n            \n            \x3c!-- FAN --\x3e\n            \x3c!-- ko if: ($parent.fan() && !$parent.fan().private) --\x3e\n            <li class="submenu-item">\n                <a href="',{type:"variable",name:"page_identities.fan.url",filters:[["a",[]]]},'" class="name">\n                    <strong class="menu-bandname long" data-test="fan-username">',{type:"variable",name:"page_identities.fan.name",filters:[["h",[]]]},"</strong>\n                    ",{type:"ef",blocks:[{type:"ncondition",expression:"page_identities.bands.length > 0 ",attachment:['\n                    <div class="userpic fanpic ',{type:"ef",blocks:[{type:"ncondition",expression:"!page_identities.fan ",attachment:["hidden-while-loading"]}]},'">\n                        ',{type:"ef",blocks:[{type:"ncondition",expression:"!page_identities.fan.photo ",attachment:['\n                            <div class="no-image-placeholder"></div>\n                        ']},{type:"else_ncondition",attachment:["\n                            <img ",{type:"variable",name:"page_identities.fan.photo",filters:[["image",["'art_embedded_player'"]]]},">\n                        "]}]},"\n                    </div>\n                    "]}]},'\n                    <div class="view-collection" data-test="submenu-item-view-collection">',{type:"translate",nodelist:["view collection"]},'</div>\n                </a>\n            </li>\n            <li class="submenu-item"><a href="',{type:"ef",blocks:[{type:"ncondition",expression:"page_identities.fan.url ",attachment:[{type:"variable",name:"page_identities.fan.url",filters:[["a",[]]]},"/purchases?from=menubar"]}]},'"><span data-test="submenu-item-purchases">',{type:"translate",nodelist:["purchases"]},'</span></a></li>\n            \x3c!-- /ko --\x3e\n            <li class="ui-widget-content ui-menu-divider first"></li>\n\n            \x3c!-- LABEL ARTISTS --\x3e\n            \x3c!-- ko if: loggedInLabelMemberBands() && loggedInLabelMemberBands().length > 0 --\x3e\n            <li class="menu-switch ui-menu-item submenu-item ui-state-disabled" data-bind="visible: !showLinkedBands()">\n                <span data-bind="attr: {href: loggedInBand().trackpipeLocalUrl() + \'/artists?from=menubar_artist_dropdown\'}, text: loggedInLabelMemberBandsCountStr()"></span>\n            </li>\n\n            <ol class="label-artist-menu no-pro-badges ui-state-disabled ui-menu-item" data-bind="visible: !showLinkedBands()" data-test="label-artists">\n            <input type="text" class="artist-filter-text" data-bind="textInput: labelMemberBandsSearchTerm, visible: loggedInLabelMemberBands().length > 10" placeholder="',{type:"translate",nodelist:["Search all artists"]},'">\n\n                \x3c!-- ko foreach: filteredLoggedInLabelMemberBands() --\x3e\n                    <li class="label-member-band submenu-item" data-bind="template: {\n                        \'name\': \'band-menuitem-template-options\'\n                    }"></li>\n                \x3c!-- /ko --\x3e\n\n                \x3c!-- ko if: filteredLoggedInLabelMemberBands().length == 0 --\x3e\n                    <li class="no-results submenu-item">',{type:"translate",nodelist:["no results"]},'</li>\n                \x3c!-- /ko --\x3e\n            </ol>\n            <li class="ui-widget-content ui-menu-divider" data-bind="visible: !showLinkedBands()"></li>\n            \x3c!-- /ko --\x3e\n\n            \x3c!-- LINKED ACCOUNTS --\x3e\n            \x3c!-- ko if: linkedNonLabelMemberBands().length > 1 --\x3e\n            <ol class="linked-accounts-wrapper">\n                <li class="menu-switch ui-menu-item submenu-item linked-accounts-menu ui-state-disabled" data-bind="click: () => showLinkedBands(!showLinkedBands())" data-test="linked-accounts-header">\n                <span data-bind="text: loggedInLinkedBandsCountStr()"></span><div data-bind="css: { \'arrow-down\': showLinkedBands(), \'arrow-right\' : !showLinkedBands() }"></div>\n                </li>\n                <ol class="linked-accounts-menu-content" data-bind="visible: showLinkedBands()" data-test="linked-accounts">\n                \x3c!-- ko foreach: linkedNonLabelMemberBands() --\x3e\n                    <li class="submenu-item" data-bind="template: {\n                        \'name\': \'band-menuitem-template\'\n                    },\n                    css: {\n                        \'hidden\': ($data.id == $root.artistsMenu.loggedInBand().id)\n                    }"></li>\n                \x3c!-- /ko --\x3e\n                </ol>\n            </ol>\n            <li class="ui-widget-content ui-menu-divider"></li>\n            \x3c!-- /ko --\x3e\n\n\n            \x3c!-- ALL USERS --\x3e\n            <ol class="all-user-option">\n                <li class="submenu-item"><a href="',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},'/settings?from=menubar" data-test="submenu-item-settings">',{type:"translate",nodelist:["settings"]},"</a></li>\n                ",{type:"ef",blocks:[{type:"ncondition",expression:"menubar.show_guide_link ",attachment:['\n                <li class="submenu-item"><a href="',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},'/guide?from=artistmenu">',{type:"translate",nodelist:["guide"]},"</a></li>\n                "]}]},'\n                <li class="submenu-item"><a href="https://get.bandcamp.help" data-test="submenu-item-help">',{type:"translate",nodelist:["help"]},'</a></li>\n                <li class="submenu-item"><a class="logout-action" href="',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},'/logout" data-test="submenu-item-logout">',{type:"translate",nodelist:["log out"]},"</a></li>\n            </ol>\n        </ol>\n        </ul>\n    </li>\n\x3c!-- /ko --\x3e\n\n\x3c!-- ko ifnot: user() --\x3e\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"!page_identities.user && !hide_cart_icon ",attachment:['\n    <li data-bind="visible: hasCart" class="menubar-item hoverable cart-wrapper hidden-while-loading svg-icon" data-test="mb-cart">\n        <a href="',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},'/cart" ',{type:"ef",blocks:[{type:"ncondition",expression:"menubar.is_tralbum_page ",attachment:['data-bind="click: goCart"']}]},' title="',{type:"translate",nodelist:["cart"]},'">\n            <svg width="26" height="26" class="menubar-cart-icon">\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#menubar-cart-icon"></use>\n                <text data-bind="text: numCartItemsDisplay" x="15" y="12" dominant-baseline="middle" text-anchor="middle">\n                    ',{type:"variable",name:"cart_quantity",filters:[["h",[]]]},"\n                </text>\n            </svg>\n        </a>\n    </li>\n    "]}]},"\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"!hide_login_signup ",attachment:["\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"!hide_signup ",attachment:['\n            <li class="menubar-item hoverable ',{type:"ef",blocks:[{type:"ncondition",expression:"!(!page_identities.user) ",attachment:["hidden-while-loading"]}]}," ",{type:"ef",blocks:[{type:"ncondition",expression:"is_fan_page ",attachment:["mobile-hidden"]}]},'">\n                <a class="all-signup-link">',{type:"translate",nodelist:["sign up"]},"</a>\n            </li>\n        "]}]},'\n        <li class="menubar-item hoverable ',{type:"ef",blocks:[{type:"ncondition",expression:"!(!page_identities.user) ",attachment:["hidden-while-loading"]}]}," ",{type:"ef",blocks:[{type:"ncondition",expression:'menubar.page_path == "/login" ',attachment:["mobile-hidden"]}]},'">\n            <a href="',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},"/login",{type:"ef",blocks:[{type:"ncondition",expression:"is_fan_page ",attachment:["?from=fan_page"]},{type:"else_ncondition",attachment:["?from=menubar"]}]},{type:"ef",blocks:[{type:"ncondition",expression:"menubar_login_bounce_param ",attachment:[{type:"variable",name:"menubar_login_bounce_param",filters:[["a",[]]]}]}]},'" class="login-link">',{type:"translate",nodelist:["log in"]},"</a>\n        </li>\n    "]}]},"\n\x3c!-- /ko --\x3e\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"ppp_menubar ",attachment:['\n\x3c!-- ko ifnot: fan() --\x3e\n    \x3c!-- ko ifnot: user() --\x3e\n    <li class="menubar-item hoverable ',{type:"ef",blocks:[{type:"ncondition",expression:"!(!page_identities.fan) || !(!page_identities.user) ",attachment:["hidden-while-loading"]}]}," ",{type:"ef",blocks:[{type:"ncondition",expression:"is_fan_page ",attachment:["mobile-hidden"]}]},'">\n        <a class="fan-signup-modal-link" href="',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},'/fans?from=menubar"\n            ',{type:"ef",blocks:[{type:"ncondition",expression:"fan_signup_params ",attachment:['\n            data-from="',{type:"variable",name:"fan_signup_params.from",filters:[["a",[]]]},'"\n            data-email="',{type:"variable",name:"fan_signup_params.email",filters:[["a",[]]]},'"\n            data-token="',{type:"variable",name:"fan_signup_params.signup_token",filters:[["a",[]]]},'"\n            data-tsig="',{type:"variable",name:"fan_signup_params.tsig",filters:[["a",[]]]},'"\n            data-verified="',{type:"variable",name:"fan_signup_params.verified",filters:[["a",[]]]},'"\n            ']}]},"\n            >",{type:"translate",nodelist:["sign up"]},'</a>\n    </li>\n    \x3c!-- /ko --\x3e\n    \x3c!-- ko if: user() --\x3e\n    <li class="menubar-item hoverable ',{type:"ef",blocks:[{type:"ncondition",expression:"!(!page_identities.fan) || !page_identities.user ",attachment:["hidden-while-loading"]}]}," ",{type:"ef",blocks:[{type:"ncondition",expression:"is_fan_page ",attachment:["mobile-hidden"]}]},'">\n        <a class="fan-signup-modal-link" href="',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},'/fans?from=menubar">',{type:"translate",nodelist:["sign up as fan"]},"</a>\n    </li>\n    \x3c!-- /ko --\x3e\n</li>\n\x3c!-- /ko --\x3e\n"]}]},"\n",{type:"ef",blocks:[{type:"ncondition",expression:"ppp_menubar || cc_menubar ",attachment:['\n\x3c!-- ko ifnot: fan() --\x3e\n    \x3c!-- ko ifnot: user() --\x3e\n    <li class="menubar-item hoverable ',{type:"ef",blocks:[{type:"ncondition",expression:"!(!page_identities.fan) || !(!page_identities.user)",attachment:["hidden-while-loading"]}]}," ",{type:"ef",blocks:[{type:"ncondition",expression:"is_fan_page ",attachment:["mobile-hidden"]}]},'">\n       <a href="',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},'/login?from=menubar">',{type:"translate",nodelist:["log in"]},'</a>\n    </li>\n    \x3c!-- /ko --\x3e\n    \x3c!-- ko if: user() --\x3e\n    <li class="menubar-item hoverable ',{type:"ef",blocks:[{type:"ncondition",expression:"!(!page_identities.fan) || !page_identities.user ",attachment:["hidden-while-loading"]}]}," ",{type:"ef",blocks:[{type:"ncondition",expression:"is_fan_page ",attachment:["mobile-hidden"]}]},'">\n        <a href="',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},'/logout?login=1">',{type:"translate",nodelist:["log in as fan"]},"</a>\n    </li>\n    \x3c!-- /ko --\x3e\n\x3c!-- /ko --\x3e\n"]}]},"\n\n</ul>\n</div>\n\n<div class='corp-banners'>\n\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"is_corp_home && fan_onboarding ",attachment:["\n        ",{type:"let",variable:"is_unverified_fan",expression:"page_identities.fan && !page_identities.fan.verified && !page_identities.fan.private "},"\n        ",{type:"let",variable:"show_verify_banner",expression:"fan_onboarding.show_verify_banner && is_unverified_fan && !skip_verification_banner "},"\n        ",{type:"let",variable:"verify_email",expression:"fan_onboarding.email "},"\n        ",{type:"include",template_name:"'home_2016/fan_verify_banner'"},"\n\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"show_tos_banner && !show_verify_banner ",attachment:["\n            ",{type:"include",template_name:"'tos_update_banner'"},"\n        "]}]},"\n    "]},{type:"else_ncondition",attachment:["\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"is_corp_home && show_tos_banner ",attachment:["\n            ",{type:"include",template_name:"'tos_update_banner'"},"\n        "]}]},"\n    "]}]},'\n</div>\n\n\x3c!-- Knockout template for list items in the artists menu --\x3e\n<script type="text/html" id="band-menuitem-template">\n    <a class="menu-artistitem"\n        data-bind="css: {\'is-pro\': isPro()}, attr: {href: $root.artistsMenu.isPageBand(id) ? \'\' : trackpipeLocalUrl()}"\n    >\n        <span class="menu-artistpic">\n            \x3c!-- ko if: photo() --\x3e\n            <img data-bind="src_image: {image_id: photo(), format: \'art_embedded_player\'}">\n            \x3c!-- /ko --\x3e\n            \x3c!-- ko ifnot: photo() --\x3e\n            <div class="no-image-placeholder"></div>\n            \x3c!-- /ko --\x3e\n        </span>\n        <span data-bind="text: name()" class="menu-bandname menu-text"></span>\n        <span data-bind="visible: isPro()" class="menubar-badge-pro round3">',{type:"translate",nodelist:["PRO"]},'</span>\n    </a>\n<\/script>\n\n<script type="text/html" id="band-menuitem-template-options">\n    <a data-bind="attr: {href: trackpipeLocalUrl()}" class="menu-artistitem">\n        <span class="menu-artistpic">\n            \x3c!-- ko if: photo() --\x3e\n            <img data-bind="src_image: {image_id: photo(), format: \'art_embedded_player\'}">\n            \x3c!-- /ko --\x3e\n            \x3c!-- ko ifnot: photo() --\x3e\n            <div class="no-image-placeholder"></div>\n            \x3c!-- /ko --\x3e\n        </span>\n        <span data-bind="text: name()" class="menu-bandname menu-text"></span>\n        <span class="show-more" data-bind="visible: $root.artistsMenu.bmgr.bandByID(id) || $root.artistsMenu.lmgr.isMemberBandAuthed(id), click: () => $root.artistsMenu.setActiveLabelMemberBand(id)">â€¢â€¢â€¢</span>\n    </a>\n    \x3c!-- ko if: ($root.artistsMenu.activeLabelMemberBand() == id) --\x3e\n    <div class="label-artist-menu-links ui-menu-item">\n        <span data-bind="visible: $root.artistsMenu.bmgr.bandByID(id) || $root.artistsMenu.lmgr.isMemberBandAuthed(id)">\n            <a data-bind="\n                attr: {href: \'',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},'/profile?from=menubar&id=\' + id}"\n            >\n                <span class="menu-text">',{type:"translate",nodelist:["edit profile"]},"</span>\n            </a>\n            <a data-bind=\"\n                attr: {href: '",{type:"variable",name:"siteroot_https",filters:[["a",[]]]},'/tools?from=menubar&id=\' + id}"\n            >\n                <span class="menu-text">',{type:"translate",nodelist:["tools"]},'<span>\n            </a>\n            \x3c!-- ko if: hasItems --\x3e\n                <a data-bind="click: $root.artistsMenu.launchPageDesign.bind($data)"><span class="menu-text">',{type:"translate",nodelist:["page design"]},"</span></a>\n            \x3c!-- /ko --\x3e\n\n            \x3c!-- ko ifnot: hasService() --\x3e\n                <a data-bind=\"attr: { href: '",{type:"variable",name:"siteroot_https",filters:[["a",[]]]},"/subscriptions?band_id=' + id + '&from=menubar'}\"><span class=\"menu-text\">",{type:"translate",nodelist:["subscription"]},'</span></a>\n            \x3c!-- /ko --\x3e\n            \x3c!-- ko if: hasService() --\x3e\n                <a data-bind="attr: { href: trackpipeLocalUrl() + \'/\' + serviceUrlFragment() + \'?from=menubar\'}"><span data-bind="text: serviceName()" class="menu-text">',{type:"translate",nodelist:["subscription"]},'</span></a>\n            \x3c!-- /ko --\x3e\n        </span>\n    </div>\n    \x3c!-- /ko --\x3e\n    <span class="show-less" data-bind="visible: $root.artistsMenu.activeLabelMemberBand() == id && ($root.artistsMenu.bmgr.bandByID(id) || $root.artistsMenu.lmgr.isMemberBandAuthed(id)), click: () => $root.artistsMenu.setActiveLabelMemberBand(id)">show less</span>\n<\/script>\n\n\n\x3c!-- Knockout template for the parent label --\x3e\n<script type="text/html" id="band-parentlabel-template">\n    <div data-bind="css: {\'artist-listing-with-links\': $parent.columns() > 1}">\n        <a class="menu-artistitem" data-bind="attr: {href: trackpipeUrlHttps()}">\n        \x3c!-- ko if: $parent.columns() === 1 --\x3e\n            <span class="menu-artistpic">\n                <img data-bind="src_image: {image_id: photo(), format: \'bio_navbar\'}">\n            </span>\n            <span data-bind="text: name()" class="menu-bandname"></span>\n        \x3c!-- /ko --\x3e\n        \x3c!-- ko if: $parent.columns() > 1 --\x3e\n            \x3c!-- ko if: photo() --\x3e\n                <img class="photo" data-bind="src_image: {image_id: photo(), format: \'fan_bio_thumb_small\'}">\n            \x3c!-- /ko --\x3e\n            \x3c!-- ko ifnot: photo() --\x3e\n                <div class="photo none"></div>\n            \x3c!-- /ko --\x3e\n        \x3c!-- /ko --\x3e\n        </a>\n   \n        <div class="infobox">\n            <p class="name"><a data-bind="attr: {href: trackpipeUrl()}, text: name()"></a></p>\n            <p class="actions">\n                <a data-bind="attr: {href: \'',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},"/profile?from=menubar&id=' + id}\">",{type:"translate",nodelist:["profile"]},"</a> &middot;\n                <a data-bind=\"attr: {href: '",{type:"variable",name:"siteroot_https",filters:[["a",[]]]},"/tools?from=menubar&id=' + id}\">",{type:"translate",nodelist:["tools"]},"</a> &middot;\n                <a data-bind=\"attr: {href: trackpipeLocalUrl() + '/stats?from=menubar'}\">",{type:"translate",nodelist:["stats"]},"</a>\n            </p>\n        </div>\n    </div>\n<\/script>\n</div>"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/merch/grid_item_client.liquid","warn"):Templ.register({"merch/grid_item_client":['<li data-item-id="',{type:"variable",name:"id",filters:[["a",[]]]},'"\n    data-band-id="',{type:"variable",name:"band_id",filters:[["a",[]]]},'"\n    data-campaign-id="',{type:"variable",name:"campaign_id",filters:[["a",[]]]},'"\n    class="merch-grid-item\n    ',{type:"ef",blocks:[{type:"ncondition",expression:"odd ",attachment:["odd"]}]},"\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"campaign_id ",attachment:["crowdfunding-campaign"]}]},'"\n    ',{type:"ef",blocks:[{type:"ncondition",expression:"filtered ",attachment:['style="display:none"']}]},'\n>\n    <a href="',{type:"variable",name:"url",filters:[["a",[]]]},'">\n        <div class="art">\n            <img src="/img/43.gif"\n            ',{type:"ef",blocks:[{type:"ncondition",expression:"album_art ",attachment:['\n                data-original="',{type:"variable",name:"img_id",filters:[["art_url",["img_format"]],["a",[]]]},'"\n            ']},{type:"else_ncondition",attachment:['\n                data-original="',{type:"variable",name:"img_id",filters:[["image_url",["img_format"]],["a",[]]]},'"\n            ']}]},'\n                alt="" class="lazy"/>\n        </div>\n        <p class="title">\n            ',{type:"variable",name:"title",filters:[["h",[]]]},"\n            ",{type:"ef",blocks:[{type:"ncondition",expression:"campaign_id ",attachment:[{type:"translate",nodelist:["Vinyl Campaign"]}]}]},"\n            ",{type:"ef",blocks:[{type:"ncondition",expression:"album_artist ",attachment:['\n                <br><span class="artist-override">',{type:"variable",name:"album_artist",filters:[["h",[]]]},"</span>\n            "]}]},'\n        </p>\n    </a>\n    <div class="merchtype secondaryText">',{type:"variable",name:"merch_type",filters:[["h",[]]]},"</div>\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"sub_name ",attachment:['\n        <div class="release-label">\n            ',{type:"ef",blocks:[{type:"ncondition",expression:"sub_name == 'subscription' ",attachment:["\n                ",{type:"translate",nodelist:["subscriber exclusive"]},"\n            "]},{type:"else_ncondition",attachment:["\n                ",{type:"translate",nodelist:["",{type:"translateVariable",var_name:"subscription_name",nodelist:[{type:"variable",name:"sub_name",filters:[["h",[]]]}]}," exclusive"]},"\n            "]}]},"\n        </div>\n    "]}]},"\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"live_event_type ",attachment:['\n        <div class="live-event-date-time">\n            <div class="live-event-date-time-col-date">\n                <svg class="live-calendar-icon" viewBox="0 0 12 11"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#live-calendar-icon"></use></svg>\n                <div class="live-event-start-date live-event-date-time-text">&nbsp;</div>\n            </div>\n            <div class="live-event-date-time-col-time">\n                <svg class="live-clock-icon" viewBox="0 0 12 11"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#live-clock-icon"></use></svg>\n                <div class="live-event-start-time live-event-date-time-text">&nbsp;</div>\n            </div>\n        </div>\n    ']}]},'\n    <p class="price ',{type:"ef",blocks:[{type:"ncondition",expression:"sold_out ",attachment:["sold-out"]}]},'">\n        ',{type:"ef",blocks:[{type:"ncondition",expression:"live_event_type == 'f' ",attachment:["\n            ",{type:"translate",nodelist:["FREE"]},"\n        "]},{type:"else_ncondition",attachment:["\n            ",{type:"ef",blocks:[{type:"ncondition",expression:"sold_out ",attachment:["\n                ",{type:"translate",nodelist:["Sold Out"]},"\n            "]},{type:"else_ncondition",attachment:['\n                <span class="price">',{type:"variable",name:"price",filters:[["currency",["currency","false","true","true"]]]},'</span>\n                <span class="currency">',{type:"variable",name:"currency",filters:[["h",[]]]},"</span>\n            "]}]},"\n        "]}]},"\n    </p>\n</li>"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/music/grid_item_client.liquid","warn"):Templ.register({"music/grid_item_client":['<li data-item-id="',{type:"variable",name:"type",filters:[["a",[]]]},"-",{type:"variable",name:"id",filters:[["a",[]]]},'"\n    data-band-id="',{type:"variable",name:"band_id",filters:[["a",[]]]},'" class="music-grid-item square\n    ',{type:"ef",blocks:[{type:"ncondition",expression:"odd ",attachment:["odd"]}]},'"\n    ',{type:"ef",blocks:[{type:"ncondition",expression:"filtered ",attachment:['style="display:none"']}]},'\n>\n    <a href="',{type:"variable",name:"page_url",filters:[["a",[]]]},'">\n        <div class="art',{type:"ef",blocks:[{type:"ncondition",expression:"!art_id ",attachment:[" empty"]}]},'"> \n            ',{type:"ef",blocks:[{type:"ncondition",expression:"art_id ",attachment:['\n                <img class="lazy" src="/img/0.gif"\n                    data-original="',{type:"variable",name:"art_id",filters:[["art_url",["art_format"]]]},'" alt="">\n            ']}]},'\n        </div>\n        <p class="title">\n            ',{type:"variable",name:"title",filters:[["h",[]]]},"\n            ",{type:"ef",blocks:[{type:"ncondition",expression:"artist ",attachment:['\n                <br><span class="artist-override">',{type:"variable",name:"artist",filters:[["h",[]]]},"</span>\n            "]}]},"\n        </p>\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"sub_name ",attachment:['\n            <div class="release-label">\n                ',{type:"ef",blocks:[{type:"ncondition",expression:"sub_name == 'subscription' ",attachment:["\n                    ",{type:"translate",nodelist:["subscriber exclusive"]},"</div>\n                "]},{type:"else_ncondition",attachment:["\n                    ",{type:"translate",nodelist:["",{type:"translateVariable",var_name:"subscription_name",nodelist:[{type:"variable",name:"sub_name",filters:[["h",[]]]}]}," exclusive"]},"\n                "]}]},"\n            </div>\n        "]}]},"\n    </a>\n</li>"]});var Share={showFromEmbed:function(){Share.panelAsDialog()},openFacebookShare:function(e,t){let n="http://www.facebook.com/sharer.php?u="+encodeURIComponent(e);return n+="&p[title]=ptitle&p[summary]=psummary",t&&(n+="&t="+encodeURIComponent(t)),window.open(n,"sharer","toolbar=0,status=0,width=626,height=436"),!1},openTwitterShare:function(e,t){const n={};return n.text=e,t&&(n.url=t),window.open(Url.addQueryParams("https://twitter.com/intent/tweet",n)),!1},panelLinkPromise:new $.Deferred,_panelInited:!1,_panelData:null,initPanel:function(e,t,n){if("phone"==MediaView.mode||$(".share-embed").length)return;let i;$("#band-links a").each((function(){const e=/twitter\.com\/(?:#!)?(\w+)/i.exec($(this).attr("href"));if(e)return i=e[1],!1})),Share._panelData={linkback:n,is_track:e,enable_social_buttons:t,title:TralbumData.current.title,artist:TralbumData.artist,twitter_username:i,download_pref:TralbumData.current.download_pref,embed_info:EmbedData.embed_info};const a={embed_info:$("#pagedata").data("blob").embed_info};$(".share-panel-wrapper-desktop").append(Templ.render("tralbum_common/share_collect_controls",a)),$(".share-embed").click((function(){Share.togglePanel()})),$(".exclusive-embed").click((function(){EmbedDialog.open("exclusive")})),t&&Share.initSocialButtons(),Share.panelLinkPromise.resolve()},initSocialButtons:function(){FacebookUtils.initSDK()},panelAsDialog:function(){Share.panelLinkPromise.then(Share._panelAsDialog)},_panelAsDialog:function(){const e=Share._panelData,t=$(Templ.render("tralbum_common/share_embed_panel",e)).dialog({draggable:!0,position:"center",modal:!0,title:"Share",width:380,height:260});t.find(".email-im-link-text").blur(),Share._initPanelControls(t,e,(function(){t.dialog("close")})),Share._panelData.enable_social_buttons&&SocialControls.initFromDOM(t)},_initPanelControls:function(e,t,n){const i=$(e);i.find(".close").click((function(){n()})),i.find(".embed-other-services a").click((function(){Stats.record({kind:"click",click:"embed_other"}),EmbedDialog.open(),n()})),i.find(".embed-other-services-exclusive a").click((function(){Stats.record({kind:"click",click:"embed_other_exclusive"}),EmbedDialog.open("exclusive"),n()})),i.find(".share-buttons").on("click",".twitter-link, .tumblr-link",(function(){n()})),i.find(".email-im-link input").focus((function(){EmailIMUtils.onFocus()})).click((function(){$(this).select()}))},togglePanel:function(){var e=null;if(Share._panelInited)e=Share._panelRoot;else{const t=Share._panelData;e=$(".share-panel-wrapper-desktop").append(Templ.render("tralbum_common/share_embed_panel",t));Share._initPanelControls(e,t,(function(){Share.togglePanel()})),Share._panelRoot=e}const t=e.find(".share-embed-container"),n="none"==t.css("display");t.slideToggle("fast",(function(){n&&Dom.scrollToElement(t,20,!0)})),Share._panelInited||(Share._panelData.enable_social_buttons&&SocialControls.initFromDOM(e),Share._panelInited=!0)},xxx:null};function PlayerEmbedVM(e,t,n){const i=this;i.PREVIEW_MAX_WIDTH=ko.observable(560),i.PREVIEW_MAX_HEIGHT=900;let a=$.extend({},{kind:"html",size:"large",width:350,height:470,bgcol:"FFFFFF",linkcol:"0687f5",layout:"standard",artwork:"large",show_art:!0,show_tracklist:!1,campaign:""},e);i.debug=ko.observable(Cookie.get("sharedebug")),i.exclusive=ko.observable("exclusive"===n),i.exclusive()?(i.exclusiveVM=new ExclusiveEmbedVM(i,TralbumData,a),a=i.exclusiveVM.opts,i.PREVIEW_MAX_WIDTH(a.width),a=i.exclusiveVM.opts):i.exclusiveVM=null;const o=$("#pagedata").data("blob").cfg.video_sharing;if(i.video_sharing_enabled=ko.observable(o),i.size=ko.observable(a.size),i.bgcol=ko.observable(a.bgcol),i.linkcol=ko.observable(a.linkcol),i.width=ko.observable(a.width),i.height=ko.observable(a.height),i.package=ko.observable(),i.packages=ko.observableArray(),i.video=ko.observable(),i.videos=ko.observableArray(),a.packages){for(var s=[],r=0;r<a.packages.length;r++){const e=a.packages[r];e.arts&&e.arts.length>0&&s.push(new l(e))}i.packages(s)}if(a.videos){for(s=[],r=0;r<a.videos.length;r++){const e=a.videos[r];s.push(new c(e))}i.videos(s)}function l(e){this.title=ko.observable(e.title),this.id=ko.observable(e.id)}function c(e){const t=this;this.track_name=ko.observable(e.track_name),this.track_id=ko.observable(e.track_id),this.track_number=ko.observable(e.track_number),this.description=ko.computed((function(){return t.track_number()+". "+t.track_name()}))}i.quieting_timeout=ko.observable(new Date),i.quiet_recheck=ko.observable(1),i.quiet_error=ko.computed((function(){return i.quiet_recheck(),new Date<i.quieting_timeout()})),i.quiet_errors_for_a_bit=function(){const e=new Date;e.setMilliseconds(e.getMilliseconds()+400),i.quieting_timeout(e),setTimeout((function(){i.quiet_recheck(i.quiet_recheck()+1)}),400)},"large"!==i.size()&&i.width("100%"),i.size_config_visible=ko.observable(!0),i.exclusive()&&1===i.exclusiveVM.num_tracks&&i.size_config_visible(!1),i.specifyWidth=function(){let e;if("slim"==i.layout()||"small"==i.artwork()||"none"==i.artwork())e=u;else{const t=i.widthRange(i.input_height());e=h(i.input_width(),t)}i._applying_dimensions=!0,i.input_width(e),i.width(e),i._applying_dimensions=!1,i.size_config_visible(!0)},i.dontSpecifyWidth=function(){i.width("100%"),i.size_config_visible(!1)},i.entered_campaign_string=ko.observable(!1),i.input_width=ko.observable(a.width),i.input_height=ko.observable(a.height),i.input_campaign=ko.observable(""),i.input_campaign.display=ko.pureComputed({read:function(){return i.input_campaign()},write:function(e){if(e.length<=50)if(/[^a-z0-9_-]/.test(e)){let t=e.toLowerCase();t=t.replace(" ","-").replace(/[^a-z0-9_-]/g,""),i.input_campaign(t)}else i.input_campaign(e);i.input_campaign().length>0?i.entered_campaign_string(!0):i.entered_campaign_string(!1),i.input_campaign.display.notifySubscribers()}}),i.input_width_error=ko.computed((function(){if(i.quiet_error())return!1;const e=i.size();return"large"===e?i.input_width()!=i.width():!!i.size_config_visible()&&(i.input_width()<d[e].min_width||i.input_width()>d[e].max_width)})),i.input_height_error=ko.computed((function(){return!i.quiet_error()&&i.input_height()!=i.height()})),i.t=ko.observable(a.t),i.selected_track_id=ko.observable(a.selected_track_id),i.type=ko.observable(a.type),i.id=ko.observable(a.id),i.itemarg=ko.computed((function(){return i.type()+"="+i.id()})),i.siteroot=ko.observable(a.siteroot),i.kind=ko.observable(a.kind),i.layout=ko.observable(a.layout),i.layout.subscribe((function(e){i.quiet_errors_for_a_bit(),"slim"==e?(i.show_art(!0),i.chooseSize("small")):"video"===e?i.input_width(_):(i.show_art(!0),i.artwork("large"),i.chooseSize("large"),"video"==e&&i.kind("html"))})),i.artwork=ko.observable(a.artwork),i.show_art=ko.observable(a.show_art),i.show_art.subscribe((function(e){return i.exclusive()&&e&&"large"===i.artwork()&&(i.size_config_visible()||(i.size_config_visible(!0),i.specifyWidth())),!0})),i.artwork_option=ko.computed((function(){return"minimal"==i.layout()?"large":i.show_art()?i.artwork():"none"})),i.allow_merch=ko.computed((function(){return i.packages().length>0&&"large"==i.size()&&"large"==i.artwork_option()})),i.show_merch=ko.observable(!!a.package),i.allow_video=ko.computed((function(){return i.videos().length>0&&i.video_sharing_enabled()})),i.allow_choose_video=ko.computed((function(){return i.videos().length>1})),i.show_standard_options=ko.computed((function(){return"large"==i.size()})).extend({notify:"always"}),i.showing_merch=ko.computed((function(){return i.show_standard_options()&&"large"==i.artwork_option()&&i.show_merch()&&i.package()})).extend({notify:"always"}),i.show_tracklist=ko.observable(a.show_tracklist),i.show_tracklist.subscribe((function(e){})),i.needHeightRecalc=ko.computed((function(){return i.layout()+i.show_tracklist()+i.showing_merch()+i.size()+(i.exclusive()?i.exclusiveVM.needHeightRecalc():"")})).extend({notify:"always"}),i.needHeightRecalc.subscribe((function(){setTimeout((function(){v("100%"===i.width()?i.width():i.input_width())}),0)})),i.isdark=ko.computed((function(){return"333333"==i.bgcol()})),i.title=ko.observable(a.title),i.art_id=ko.observable(a.art_id),i.artist=ko.observable(a.artist),i.linkback=ko.observable(a.linkback),i.sizekey=ko.computed((function(){return i.size()}));var d={large:{width:350,height:350,min_width:170,max_width:700},medium:{width:"100%",height:120,min_width:250,max_width:700},small:{width:"100%",height:42,min_width:170,max_width:700}};const p={standard:{infopanel:120,list_base:-14,list_item:33,list_small_art:36,track:-28,merch_nominal:57,merch_absolute:10},sidebar:{infopanel:142,list_base:-16,list_item:33,list_small_art:38,track:-28,merch_nominal:53,merch_absolute:10}};var u=400;const m=4e3;var _=560;function h(e,t){if("100%"===e)return e;if(t instanceof Array){let n=null,i=null;for(let a=0;a<t.length;a++){const o=t[a],s=Math.max(o.min,Math.min(e,o.max||1e5));if(s==e)return e;const r=Math.abs(e-s);(null==n||n>r)&&(n=r,i=s)}return i}return Math.max(t.min,Math.min(e,t.max||1e5))}function f(e,t){return{min:e,max:t}}function b(e,t,n,i,a,o,s,r,l){n=n||{};let c=t.height,d=0;if(i){let i=c,p=0;a||(l&&(i=0),p+=n.infopanel||0,s&&(i+=n.merch_nominal||0,p+=n.merch_absolute||0),r&&(p+=(n.list_base||0)+2*(n.list_item||0),d+=8*(n.list_item||0),l&&(p+=n.list_small_art||0)),o&&!l&&(p+=n.track||0));const u=e/t.width;c=Math.round(i*u)+p}return f(c,c+d)}function g(e,t,n,i,a,o,s,r,l){if(n=n||{},!i)return f(t.min_width,t.max_width);if(l)return f(250,t.max_width);if(a)return f(e,e);let c=e-(n.infopanel||0),d=0;if(o&&(c-=n.track||0),s&&(c-=n.merch_absolute||0),r){c-=(n.list_base||0)+2*(n.list_item||0),d+=8*(n.list_item||0)}const p=Math.max(t.min_width,c-d),u=Math.max(t.min_width,c);let m=t.height;s&&(m+=n.merch_nominal||0);const _=p/m,b=u/m,g=Math.round(t.width*_),y=Math.round(t.width*b),v=f(t.min_width,t.max_width);return f(h(g,v),h(y,v))}function y(e){return Math.round(e/1.7777777777777777+120)}function v(e){if(i._applying_dimensions)return;if("video"==i.layout()){if(e<360||e>m)return;const t=y(e);return i.height(t),i.width(e),i._applying_dimensions=!0,i.input_height(t),void(i._applying_dimensions=!1)}const t=i.sizekey(),n=d[t];if(e<n.min_width||e>n.max_width)return;if("large"==i.size()&&"large"!=i.artwork_option()&&e<250)return;i.width(e),"100%"==e&&(e=n.min_width);const o=i.heightRange(e),s=i.input_height();let r=h(s,o);if("large"==i.size()&&"minimal"!=i.layout()&&i.show_tracklist()){const e=Math.min(10,a.num_tracks||0);e>2&&(r=o.min+33*(e-2))}r!=s&&(i.height(r),i._applying_dimensions=!0,i.input_height(r),i._applying_dimensions=!1)}function k(e){const t=[i.itemarg()],n=["size","bgcol","linkcol"];for(let e=0;e<n.length;e++){const a=i.parm(n[e]);a&&t.push(a)}return TralbumData&&TralbumData.current.license_id&&t.push("license_id="+TralbumData.current.license_id),i.showing_merch()&&t.push("package="+escape(i.package())),i.exclusive()||!i.show_standard_options()||"minimal"==i.layout()||i.show_tracklist()||t.push("tracklist=false"),"minimal"==i.layout()&&t.push("minimal=true"),"large"==i.size()?"large"!=i.artwork_option()&&"minimal"!=i.layout()&&t.push("artwork="+i.artwork_option()):i.show_art()||t.push("artwork=none"),i.selected_track_id()&&!i.exclusive()&&t.push("track="+escape(i.selected_track_id())),"html"==i.kind()&&t.push("transparent=true"),i.exclusive()&&(i.show_tracklist()?t.push("tracklist=true"):t.push("tracklist=false"),t.push("tracks="+i.exclusiveVM.getSelectedTracks().join(","))),""!=i.input_campaign()&&i.input_campaign().length<=50&&/^[a-z0-9_-]+$/.test(i.input_campaign())&&t.push("campaign="+i.input_campaign()),t}function w(e,t,n){let a=i.width(),o=i.height();if("video"==i.layout())return n&&(a*=i.preview_scale(),o*=i.preview_scale()),function(e,t,n,a,o,s){const r=["bgcol="+o,"linkcol="+s];switch(e){case"wordpress":return r.unshift("height="+t),r.unshift("width="+n),r.unshift("video="+a),"[bandcamp "+r.join(" ")+"]";case"html":return r.unshift("track="+a),'<iframe style="border: 0; width: '+n+"px; height: "+t+'px;" src="'+i.siteroot()+"/VideoEmbed?"+r.join("&")+'" mozallowfullscreen="1" webkitallowfullscreen="1" allowfullscreen="1" seamless></iframe>';case"url":return r.unshift("track="+a),i.siteroot()+"/VideoEmbed?"+r.join("&")}}(e,o,a,i.video(),i.bgcol(),i.linkcol());switch(e){case"url":var s=t.join("/")+"/";return i.siteroot()+"/EmbeddedPlayer/"+s;case"html":s=t.join("/")+"/";if(n&&("100%"!==a||i.exclusive()&&"small"!==i.artwork())&&(i.exclusive()&&(a=i.PREVIEW_MAX_WIDTH()),a*=i.preview_scale(),"large"==i.size())){o*=i.preview_scale();const e=i.preview_dimensions();if(a=e.w,o=e.h,i.exclusive()){const e=$(".ui-dialog-content").height(),t=70;e>40&&o>e-t&&(o=e-t)}}return"100%"!==a&&(a+="px"),o+="px",'<iframe style="border: 0; width: '+a+"; height: "+o+';" src="'+i.siteroot()+"/EmbeddedPlayer/"+s+'" seamless><a href="'+i.linkback()+'">'+Templ.filters.h(i.title()+" by "+i.artist())+"</a></iframe>";case"wordpress":return"[bandcamp "+(s=["width="+a,"height="+o].concat(t).join(" "))+"]"}}i.hRange=b,i.heightRange=function(e){if("video"==i.layout()){const t=y(e);return f(t,t)}const t=i.sizekey();return b(e,d[t],e<=299&&"large"==i.artwork_option()?p.sidebar:p.standard,i.show_standard_options(),"minimal"==i.layout(),"track"==i.type(),i.showing_merch(),i.show_tracklist(),"large"!=i.artwork_option())},i.wRange=g,i.widthRange=function(e){const t=i.sizekey(),n=d[t];if("video"==i.layout())return f(360,m);const a=g(e,n,p.standard,i.show_standard_options(),"minimal"==i.layout(),"track"==i.type(),i.showing_merch(),i.show_tracklist(),"large"!=i.artwork_option());let o=null;return"large"==i.size()?(o=g(e,n,p.sidebar,i.show_standard_options(),"minimal"==i.layout(),"track"==i.type(),i.showing_merch(),i.show_tracklist(),"large"!=i.artwork_option()),a.max<299?o:[o,a]):a},i.minWidth=ko.computed((function(){if("video"==i.layout())return 360;if("large"==i.size()&&"large"!=i.artwork_option())return 250;const e=i.sizekey();return d[e].min_width})),i.maxWidth=ko.computed((function(){if("video"==i.layout())return m;const e=i.sizekey();return d[e].max_width})),i.isFixedHeight=ko.computed((function(){if("video"==i.layout())return!0;switch(i.size()){case"medium":case"small":return!0;case"large":return!(i.show_tracklist()||"large"==i.artwork_option())}})),i.allowAutoWidth=ko.computed((function(){return i.isFixedHeight()&&"video"!=i.layout()})),i.chooseSize=function(e){const t=e;switch("exclusive"==e&&(e="large"),e){case"video":i.layout("video"),i.input_width(_);break;case"large":i.size(e),("exclusive"!==t||i.exclusive()&&i.exclusiveVM.num_tracks>1)&&i.specifyWidth(),i.exclusive()?i.input_width(i.exclusiveVM.previewWidth()):i.input_width(d.large.width);break;case"medium":i.layout("standard"),i.size("large"),i.artwork("small"),i.dontSpecifyWidth();break;case"small":i.layout("slim"),i.size(e),i.dontSpecifyWidth()}},i.minHeight=ko.computed((function(){const e=i.sizekey(),t=d[e];return i.heightRange(t.min_width).min})),i.show_art.subscribe((function(e){e||i.dontSpecifyWidth()})),i.show_tracklist.subscribe((function(e){e&&(v(i.input_width()),i.specifyWidth())})),i.artwork.subscribe((function(e){if(i.quiet_errors_for_a_bit(),"large"==e||i.show_tracklist())if(i.specifyWidth(),"large"==e)i.input_width(d.large.width);else{const e=i.heightRange(i.input_width());i._applying_dimensions=!0,i.exclusive()?i.input_height(e.min):i.input_height(h(i.input_height(),e)),i.height(i.input_height()),i._applying_dimensions=!1}else i.dontSpecifyWidth()})),i.input_width.subscribe(v),i.input_height.subscribe((function(e){if(i._applying_dimensions)return;const t=i.widthRange(e),n=i.input_width(),a=h(n,t);h(e,i.heightRange(a))==e&&(i.height(e),i.width(a),a!=n&&(i._applying_dimensions=!0,i.input_width(a),i._applying_dimensions=!1))})),i.incrementNumTracks=function(e){const t=1==e,n=i.heightRange(i.width());let a=(Number(i.height())-n.min)/33;a=t?Math.floor(a)+e:Math.ceil(a)+e;const o=h(n.min+33*a,n);i.input_height(o)},i.parm=function(e){return i[e]&&i[e]()?e+"="+escape(i[e]()):""},i.preview_scale=ko.computed((function(){const e=i.width(),t=i.height();let n=1,a=1;return e>i.PREVIEW_MAX_WIDTH()&&(n=i.PREVIEW_MAX_WIDTH()/e),t>i.PREVIEW_MAX_HEIGHT&&(a=i.PREVIEW_MAX_HEIGHT/t),Math.min(n,a)})),i.preview_scale_w=ko.computed((function(){const e=i.width();let t=1;return e>i.PREVIEW_MAX_WIDTH()&&(t=i.PREVIEW_MAX_WIDTH()/e),t})),i.preview_dimensions=ko.computed((function(){let e=Number(i.width()),t=Number(i.height());return e>i.PREVIEW_MAX_WIDTH()&&(e=i.PREVIEW_MAX_WIDTH(),t=h(t,i.heightRange(e))),t>i.PREVIEW_MAX_HEIGHT&&(t=i.PREVIEW_MAX_HEIGHT,e=h(e,i.widthRange(t))),{w:e,h:t}})),i.debug_in_new_frame=function(){const e=w("url",k());window.open(e,"playerembeddebug")},i.code=ko.computed((function(){return w(i.kind(),k())})),i.asyncCode=ko.computed((function(){if(!i.exclusive())return;if(i.exclusiveVM.xhrInProgress())return"please wait...";if(i.exclusiveVM.xhrError())return"An error occurred - embed code not available - "+i.exclusiveVM.xhrError();const e=k();return e.push("esig="+i.exclusiveVM.exclusiveSignature),w(i.kind(),e)})),i.preview=ko.computed((function(){const e=k();if(i.exclusive()){if(i.exclusiveVM.xhrInProgress())return"";e.push(i.exclusiveVM.getPreviewParam())}return w("html",e,!0)})).extend({throttle:500}),i.exclusive()&&i.exclusiveVM.remoteInit()}function ShareVM(e,t,n){const i=this,a=$(e);i.$root=a;const o=t;i.exclusive=ko.observable("exclusive"===n),t.album_embed_data&&(t=t.album_embed_data);const s={title:t.title||t.album_title,linkback:t.linkback,art_id:t.art_id,artist:t.artist,type:t.tralbum_param.name,id:t.tralbum_param.value,siteroot:t.swf_base_url,packages:t.packages,videos:t.videos,num_tracks:t.num_tracks,selected_track_id:t.track_id,embed_info:t.embed_info,original_embeddata:o};i.embed=new PlayerEmbedVM(s,i,n),i.state=ko.observable("picksize"),i.test=ko.observable("testing"),i.embed_data=t,i.bg_color_index=ko.observable(0),i.link_color_index=ko.observable(0),i.pickingsize=ko.computed((function(){return"picksize"==i.state()})),i.customising=ko.computed((function(){return"customising"==i.state()})),i.querying=ko.observable(!1),i.previewloading=ko.observable(!0),i.preview=ko.observable(),i.allow_video=i.embed.allow_video,i.tralbum_type=t.tralbum_param.name,i.maxWidth=ko.observable(i.exclusive()?444:560),i.publicEmbeddable=ko.observable(t.embed_info&&t.embed_info.public_embeddable),i.privateTralbum=ko.observable(!t.embed_info.item_public),i.picksize=function(e){i.embed.chooseSize(e),m(i.bg_color_index()),i.state("customising")},i.repicksize=function(){i.preview(""),i.state("picksize")};const r=650,l=40,c=30,d=70;function p(e,t){let n=null;return a.find(e+" .color_sample").each((function(e,i){i==t&&(n=e)})),n}function u(e,t){return i.get_css_color(a.find(e+" .color_sample")[t])}function m(e){i.embed.bgcol(u(".bgcolor",e));const t=u(0===e?".linkcolor.light":".linkcolor.dark",i.link_color_index());i.embed.linkcol(t)}i.dialog_height=ko.observable(r),i.recalcDialogHeight=ko.computed((function(){return i.state()+i.embed.preview()+i.embed.artwork()+i.embed.show_art()})),i.recalcDialogHeight.subscribe((function(e){let n=r;if("picksize"!=i.state()){i.embed.show_standard_options()&&(n+=l,i.embed.showing_merch()&&(n+=c)),t.show_campaign&&(n+=d);const e=i.embed.preview_dimensions().h+185;e>n&&(n=e)}i.dialog_height(n)})),i.embed.preview.subscribe((function(e){i.previewloading(!0),i.preview(e)})),i.get_css_color=function(e){return function(e){function t(e){return("0"+parseInt(e).toString(16)).slice(-2)}const n=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/i);if(n)return t(n[1])+t(n[2])+t(n[3]);const i=e.match(/#([0-9a-fA-F]+)/);if(i)return i[1]}($(e).css("background-color"))},i.islink=function(e){return i.link_color_index()==e-1},i.isbg=function(e){return i.bg_color_index()==e-1},a.on("click",".linkcolor.light .color_sample",(function(e){i.link_color_index(p(".linkcolor.light",e.currentTarget))})),a.on("click",".linkcolor.dark .color_sample",(function(e){i.link_color_index(p(".linkcolor.dark",e.currentTarget))})),a.on("click",".bgcolor .color_sample",(function(e){i.bg_color_index(p(".bgcolor",e.currentTarget))})),a.on("keydown",".height",(function(e){if(e.altKey&&i.embed.show_standard_options()&&i.embed.show_tracklist())switch(e.which){case 38:i.embed.incrementNumTracks(1),e.preventDefault();break;case 40:i.embed.incrementNumTracks(-1),e.preventDefault()}})),a.on("keypress","[type=number]",(function(e){switch(0===e.keyCode?e.charCode:e.keyCode){case 8:case 9:case 37:case 38:case 39:case 40:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return!0;default:return e.preventDefault(),!1}})),i.link_color_index.subscribe((function(e){const t=u(0===i.bg_color_index()?".linkcolor.light":".linkcolor.dark",i.link_color_index());i.embed.linkcol(t)})),i.bg_color_index.subscribe(m),a.on("click",".embed_text",(function(e){$(e.currentTarget).focus().select(),e.preventDefault()})),a.on("click",".sizechoice",(function(e){const t=$(e.currentTarget).data("size");i.picksize(t)})),n&&i.picksize(n)}var EmbedDialog={_dialog:null,_viewmodel:null,open:function(e){const t="exclusive"===e;e=void 0!==e?e:null;const n=$("<div>"),i={draggable:!0,dialogClass:t?"share_dialog exclusive":"share_dialog",width:"1005",position:"center",modal:!0,title:t?"Exclusive Embed":"Customize"},a=n.dialog(i);EmbedDialog._dialog=a;const o={art_id:EmbedData.art_id,exclusive_embed:t,show_campaign:EmbedData.show_campaign};EmbedData.packages=TralbumData.packages,EmbedData.num_tracks=TralbumData.trackinfo.length,EmbedData.videos=[];for(let e=0;e<TralbumData.trackinfo.length;e++){const t=TralbumData.trackinfo[e];t.video_id&&(EmbedData.videos.push({track_id:t.track_id,track_number:t.track_num,track_name:t.title}),o.video_poster_url&&!t.video_featured||(o.video_poster_url=t.video_poster_url))}EmbedData.album_embed_data&&(EmbedData.album_embed_data.videos=EmbedData.videos),a.html(Templ.render("_share2",o));const s=new ShareVM(n[0],EmbedData,e);function r(){const t=s.dialog_height(),i=$(".ui-dialog-content").height();if("exclusive"===e){const e=Math.max(t,i);$(".ui-dialog.exclusive .ui-dialog-content").css("min-height",e),$(".ui-dialog.exclusive .ui-dialog-content").height("auto")}else n.dialog("option","height",t)}function l(){n.dialog("option","position","center")}return EmbedDialog._viewmodel=s,ko.applyBindings(s,n[0]),s.dialog_height.subscribe(r),r(),l(),$(window).on("resize",l),$(window).on("message",(function(e){"playerinited"==e.originalEvent.data&&s.previewloading(!1)})),t&&$(".ui-dialog-titlebar-close.ui-corner-all").on("mousedown",(function(e){return EmbedDialog._dialog.dialog("close"),!1})),a}};function ExclusiveEmbedVM(e,t,n){const i=this;i.parentVM=e,i.tralbumMembershipType=ko.observable("album"==t.item_type?"album":n.embed_info.mplayerdata_album?"albumtrack":"standalonetrack");let a=0,o=0;if("albumtrack"==i.tralbumMembershipType()){o=(c=n.embed_info.mplayerdata_album.data.tracks).length;for(var s=0;s<c.length;s++)(c[s].duration&&c[s].duration>0||c[s].encodings_id)&&a++}else{o=t.trackinfo.length;for(s=0;s<t.trackinfo.length;s++)(t.trackinfo[s].duration&&t.trackinfo[s].duration>0||t.trackinfo[s].encodings_id)&&a++}i.userSelectableTracks=ko.observable(a>1),i.heightEstimate=function(e){const t=Math.min(e,15);return t>2?530+30*(t-2):530},i.PREVIEW_MAX_HEIGHT=Math.min(950,i.heightEstimate(o)),i.PREVIEW_MAX_WIDTH=400,i.DEFAULT_HORIZ_WIDTH_SINGLE_TRACK=444,i.DEFAULT_HEIGHT_SINGLE_TRACK=120,i.num_tracks=n.original_embeddata?n.original_embeddata.num_tracks:n.num_tracks,1===i.num_tracks?(n.show_tracklist=!1,n.layout="standard",n.artwork="small",n.width=i.DEFAULT_HORIZ_WIDTH_SINGLE_TRACK):(n.show_tracklist=!0,n.width=i.PREVIEW_MAX_WIDTH),i.previewWidth=ko.observable(n.width),i.opts=n,i.trackListExpanded=ko.observable(!1),i.showMoreTracksLink=ko.observable(t.trackinfo&&t.trackinfo.length>15);function r(e,t){const n=this;n.parentVM=t;const i="track_num"in e;n.title=e.title,n.track_id=e.id,n.track_number=i&&e.track_num?e.track_num:e.tracknum,n.has_audio=!!(e.encodings_id||e.duration&&e.duration>0),n.isChecked=ko.observable(i?n.has_audio:n.has_audio&&e.default_albumtrack),n.preorder=e.album_preorder;let a=!1;a=i?e.album_preorder?e.streaming&&!e.unreleased_track:e.streaming:e.album_preorder?e.track_streaming&&e.preorder_download_track:e.track_streaming,n.alreadyStreamable=ko.observable(a),n.trackRowFaded=ko.computed((function(){const e=n.track_number;15===e&&!n.parentVM.trackListExpanded()&&n.parentVM.showMoreTracksLink();return 15===e&&!n.parentVM.trackListExpanded()&&n.parentVM.showMoreTracksLink()})),n.trackRowVisible=ko.computed((function(e){return n.track_number<=15||n.parentVM.trackListExpanded()})),n.notSelectable=ko.computed((function(){if(!n.isChecked())return!1;const e=t.tracks();let i=0;for(let t=0;t<e.length;t++)e[t].isChecked()&&i++;return i<=1})),n.trackNumberText=ko.computed((function(){return n.track_number?n.track_number+".":""})),n.selectTrack=function(e,n){return t.doToggleTrack(),!0},n.noChange=function(e,t){return!1}}function l(e,t,n){const i=this;i.parentVM=n,i.domainName=ko.observable(e),i.noEdit=ko.observable(!1),i.isInvalid=ko.observable(!1),i.prevalidated=void 0!==t&&!!t,i.isValid=ko.observable(!1),i.showError=ko.observable(!1),i.isNeedingSubdomain=ko.observable(!1),i.isSocialMedia=ko.observable(!1),i.errorMessage=ko.computed((function(){return i.isSocialMedia()?"You can't use an exclusive embed on this domain.":i.isNeedingSubdomain()?"This site requires a subdomain.":"This is not a valid site address."})),i.clone=function(){return new l(i.domainName(),i.prevalidated,i.parentVM)},i.markAsSaved=function(){i.domainName()&&(i.prevalidated||(i.prevalidated=!0))},i.reInit=function(){i.domainName(""),i.isInvalid(!1),i.isValid(!1),i.showError(!1),i.relevantDomainName=""},i.onKeypress=function(e,t){13===t.keyCode&&i.parentVM.doAddSite()},i.onUpdate=ko.computed((function(e,t){i.parentVM.markDirty(),i.showError(!1),i.parentVM.errNeedsAtLeastOne(!1);let n=i.domainName();if(i.relevantDomainName="",i.isNeedingSubdomain(!1),i.isSocialMedia(!1),!n&&!i.quiet)return i.isInvalid(!1),i.isValid(!1),!1;let a=Url.toHash(n,!0);if(a.hostname||a.protocol||(n="http://"+n,a=Url.toHash(n,!0)),!a.hostname)return i.isInvalid(!0),i.isValid(!1),!1;if(a.hostname.match(/\btwitter\.com$/i)||a.hostname.match(/\bfacebook\.com$/i)||a.hostname.match(/\binstagram\.com$/i)){if(!a.hostname.match(/[-\/_]twitter\.com$/i)&&!a.hostname.match(/[-\/_]facebook\.com$/i)&&!a.hostname.match(/[-\/_]instagram\.com$/i))return i.isSocialMedia(!0),i.isInvalid(!0),i.isValid(!1),!1}else if(a.hostname.match(/^wordpress\.com$/i)||a.hostname.match(/^www.wordpress\.com$/i)||a.hostname.match(/^tumblr\.com$/i)||a.hostname.match(/^www.tumblr\.com$/i))return i.isNeedingSubdomain(!0),i.isInvalid(!0),i.isValid(!1),!1;return i.relevantDomainName=a.hostname.toLowerCase(),i.isInvalid(!1),i.isValid(!0),i.isNeedingSubdomain(!1),i.isSocialMedia(!1),!0})),i.isSelected=ko.observable(!0)}if(i.errNeedsAtLeastOne=ko.observable(!1),i.xhrInProgress=ko.observable(!1),i.xhrError=ko.observable(!1),i.exclusiveSignature=null,i.tralbum_type=ko.observable(n.type),i.tracks=ko.observableArray(),i.candidateDomains=ko.observableArray(),i.permittedDomains=ko.observableArray(),i.needHeightRecalc=ko.computed((function(){return i.permittedDomains().length+","+i.candidateDomains().length})),i.domainsEditable=ko.observable(!1),i.domainsEditableFlag=!1,i.isDirty_tracks=ko.observable(!1),i.isDirty_sites=ko.observable(!1),i.markDirty=function(){return i.isDirty_sites(!0),!0},i.editSitesText=ko.computed((function(){return i.candidateDomains().length<1?"+ add site":"edit sites"})),i.allSitesValidated=ko.computed((function(){const e=i.candidateDomains();for(let t=0;t<e.length;t++)if(!e[t].isValid())return!1;return!0})),i.enableSitesSave=ko.computed((function(){return!(i.candidateDomains().length<1)&&(i.isDirty_sites()&&!i.xhrInProgress()&&i.noShownErrors())})),i.enableSitesCancel=ko.computed((function(){return i.permittedDomains().length>0})),i.noShownErrors=ko.computed((function(){for(let e=0;e<i.candidateDomains().length;e++)if(i.candidateDomains()[e].showError())return!1;return!0})),i.sitesErrorMessageExtra=ko.computed((function(){if(!i.candidateDomains)return!1;if(i.noShownErrors())return!1;const e=i.candidateDomains();for(let t=0;t<e.length;t++){const n=e[t];if(n.errorMessage()){if(n.isSocialMedia()){let e="Twitter";return n.domainName().match(/facebook/i)&&(e="Facebook"),n.domainName().match(/instagram/i)&&(e="Instagram"),"Exclusive embeds let specific blogs and websites stream tracks that you arenâ€™t streaming on your public album page. They're not intended for usage across an entire social media channel, such as "+e+". <a target= 'blank' href='/help/exclusive_embed'>Learn more about using exclusive embeds</a>."}if(n.isNeedingSubdomain()){let e="WordPress",t=null;return n.domainName().match(/tumblr\.com/i)&&(e="Tumblr"),n.domainName().match(/^www/i)&&(t=!0),"Sites hosted by "+e+" should include a subdomain"+(t?" other than www.":"")+" (i.e., they should look something like <em>yourblog."+e.toLowerCase()+".com</em>)."}}}return null})),i.isPreorder=ko.observable(!1),t.trackinfo.length>0){const e=[];if("albumtrack"==i.tralbumMembershipType()){const o=1===n.embed_info.mplayerdata_album.data.is_preorder;i.isPreorder(o);const l=t.trackinfo[0].id;var c=n.embed_info.mplayerdata_album.data.tracks;for(s=0;s<c.length;s++)c[s].default_albumtrack=l===c[s].id,c[s].album_preorder=o,e.push(new r(c[s],i)),(c[s].duration&&c[s].duration>0||c[s].encodings_id)&&a++}else for(s=0;s<t.trackinfo.length;s++)e.push(new r(t.trackinfo[s],i)),t.trackinfo[s].album_preorder&&!i.isPreorder()&&i.isPreorder(!0);i.tracks(e)}i.fillPermittedDomains=function(e,t){const n=[],a=[];for(var o=0;e&&o<e.length;o++)n.push(new l(e[o],!0,i)),t&&a.push(new l(e[o],!0,i));i.permittedDomains(n),t&&(i.candidateDomains(a),o>0&&i.showCheckMarks(!0)),i.permittedDomains().length<1&&i.doEditSites()},i.markAsSaved=function(){for(let e=0;e<i.candidateDomains().length;e++)i.candidateDomains()[e].markAsSaved();i.isDirty_tracks(!1),i.isDirty_sites(!1)},i.showAnywhere=ko.observable("r"),i.showEditSites=ko.computed((function(){return"r"===i.showAnywhere()&&!i.domainsEditable()})),i.showAddSite=ko.computed((function(){return"r"===i.showAnywhere()&&i.domainsEditable()})),i.showCheckMarks=ko.observable(!1),i.doEditSites=function(){i.domainsEditable()||(i.domainsEditable(!0),i.domainsEditableFlag=!0,i.candidateDomains().length<1&&i.doAddSite())},i.doAddSite=function(){i.candidateDomains.push(new l("",!1,i))},i.canDeleteCandidate=ko.computed((function(){return i.domainsEditable()&&i.candidateDomains().length>1})),i.doDeleteCandidate=function(e,t){return 1===i.candidateDomains().length?this.reInit():i.candidateDomains.remove(e),i.isDirty_sites(!0),!0},i.doSaveSites=function(){if(!i.enableSitesSave())return!1;let e=!1,t=!0;const n=i.candidateDomains();for(let i=0;i<n.length;i++)n[i].isInvalid()?(n[i].showError(!0),e=!0):n[i].relevantDomainName&&""!==n[i].relevantDomainName.trim()&&(t=!1);return!e&&(t?(i.errNeedsAtLeastOne(!0),!1):(i.candidateDomains.remove((function(e){return!e.relevantDomainName})),0!==i.candidateDomains().length&&(i.apiExclusiveEmbed("save","click-save"),!0)))},i.showDomainError=function(e){const t=i.candidateDomains();for(let n=0;n<t.length;n++)t[n].relevantDomainName===e&&(t[n].isInvalid(!0),t[n].showError(!0))},i.completeSave=function(e){if(i.isDirty_sites()){const e=i.candidateDomains();i.permittedDomains.removeAll();for(let t=0;t<e.length;t++)i.permittedDomains.push(e[t].clone());i.markAsSaved()}i.closeSiteEditor(),e&&"click-save"===e&&i.showCheckMarks(!0)},i.doCancelSitesEdit=function(){if(0===i.permittedDomains().length)return!1;if(i.isDirty_sites()){i.isDirty_sites(!1),i.candidateDomains.removeAll();const e=i.permittedDomains();for(let t=0;t<e.length;t++)i.candidateDomains.push(e[t].clone())}i.errNeedsAtLeastOne(!1),i.isDirty_tracks()?i.apiExclusiveEmbed("save"):i.closeSiteEditor()},i.closeSiteEditor=function(){i.domainsEditableFlag=!1,i.domainsEditable(!1)},i.playerOptionsVisible=ko.observable(!1),i.togglePlayerOptions=function(e,t){i.playerOptionsVisible(!i.playerOptionsVisible())},i.noExclusiveAudioWarning=ko.computed((function(){let e=0;const t=i.tracks();for(let n=0;n<t.length;n++)t[n].isChecked()&&!t[n].alreadyStreamable()&&e++;return e<1})),i.doToggleTrack=function(e,t){i.isDirty_tracks(!0);const n=i.tracks();let a=0;for(let e=0;e<n.length;e++)n[e].isChecked()&&a++;return(i.parentVM.show_tracklist()&&1===a||!i.parentVM.show_tracklist()&&a>1)&&i.toggleStandalone(a),i.domainsEditable()||i.apiExclusiveEmbed("save","click-save"),!0},i.toggleStandalone=function(e){e>1?(i.parentVM.artwork("large"),i.parentVM.show_tracklist(!0),i.previewWidth(i.PREVIEW_MAX_WIDTH),i.parentVM.PREVIEW_MAX_WIDTH(i.PREVIEW_MAX_WIDTH)):(i.parentVM.artwork("small"),i.parentVM.show_tracklist(!1),i.previewWidth(i.DEFAULT_HORIZ_WIDTH_SINGLE_TRACK),i.parentVM.PREVIEW_MAX_WIDTH(i.DEFAULT_HORIZ_WIDTH_SINGLE_TRACK))},i.textShowMoreTracks=ko.computed((function(){return i.trackListExpanded()?"less...":"more..."})),i.doShowMoreTracks=function(){i.trackListExpanded(!i.trackListExpanded())},i.showRowCandidateDomain=function(e){1===e.nodeType&&$(e).hide().slideDown()},i.hideRowCandidateDomain=function(e){1===e.nodeType&&$(e).slideUp((function(){$(e).remove()}))},i.getSelectedTracks=function(){const e=i.tracks(),t=[];for(let n=0;n<e.length;n++)e[n].isChecked()&&t.push(e[n].track_id);if(t.length<1)throw"at least one track must be permitted in exclusive embeds";return t},i.getDomainsForSave=function(){const e=[],t=i.isDirty_sites()?i.candidateDomains():i.permittedDomains();let n=0;for(let i=0;i<t.length;i++)t[i].relevantDomainName?e.push(t[i].relevantDomainName):n++;return n>1&&Log.debug("warning: unexpected number of empty values"),e},i.apiExclusiveEmbed=function(e,n){if("get"!==e&&"save"!==e)return;if(i.xhrInProgress())return;i.xhrInProgress(!0),i.xhrError(!1);const a=i.getSelectedTracks();let o=null;"save"==e&&(o=i.getDomainsForSave()),Crumb.ajax({type:"POST",url:"get"===e?"/api/embed/1/get_exclusive":"/api/embed/1/save_exclusive",data:{user_id:Identities.user().id,band_id:Identities.pageBand.id,licensee_band_id:t.current.licensee_band_id,tralbum_id:i.parentVM.id(),tralbum_type:"album"==i.tralbum_type()?"a":"t",permitted_domains:o,permitted_tracks:a&&a.length>0?a:null},success:function(t){const a=n;if(t.errors){let e=null;Iter.each(t.errors,(function(t){e||(e=t.reason),NuDialog.alert("Error",t.reason)})),i.xhrError(e||"Error")}else if(t.error){i.xhrError(t.error_message?t.error_message:"Error");let n=null;t.error_message&&(n=t.error_message.match(/^invalid domain name (.*)/)),n?i.showDomainError(n[1]):NuDialog.alert("Error",t.error_message?t.error_message:"Error "+("save"===e?"saving ":"getting ")+"exclusive embed")}else i.exclusiveSignature=t.signature,"get"===e?(i.showAnywhere("r"),i.fillPermittedDomains(t.permitted_domains,!0),i.markAsSaved()):i.completeSave(a);i.xhrInProgress(!1)},error:function(e){e&&e.error&&e.error_message?i.xhrError(e.error_message):i.xhrError("Error"),i.xhrInProgress(!1),Log.debug("Error saving exclusive embed:"),Log.debug(e)},dataAs:"JSON"})},i.getPreviewParam=function(){return i.domainsEditableFlag?"fesig=0xFFFF":"esig="+i.exclusiveSignature},i.remoteInit=function(){i.apiExclusiveEmbed("get")}}var PeekabooList={enhance:function(e,t,n,i,a){e=$(e),t=t||$.proxy(this,"defaultButtonText"),n=n||$.proxy(this,"defaultTruncateAfter"),i=i||$.proxy(this,"defaultTruncateTo"),a=!1!==a;let o=!0;e.addClass("peekaboo-list");var s=function(n){e.toggleClass("truncated");const i=e.hasClass("truncated");return e.find(".showMore a").text(t(i)),e.trigger("toggle",i),!1};const r=$.proxy((function(){Log.debug("PeekabooList refresh: "+e.get(0).id);const r=e.hasClass("truncated");e.removeClass("truncated").find(".showMore").remove();const l=e.find("li");if(l.removeClass("peekaboo-list-extra"),l.length>n()){l.slice(i()).addClass("peekaboo-list-extra");const n=r||o&&a;n&&e.addClass("truncated"),e.append('<div class="showMore"><a href="#"></a></div>').find(".showMore a").on("click",s).text(t(n))}o=!1}),this);return r(),r},defaultButtonText:function(e){return e?"more...":"fewer"},defaultTruncateAfter:function(){return 5},defaultTruncateTo:function(){return 3},zzz:null},Showography={refreshPeekaboo:null,domReady:function(){},enhance:function(){const e=$("#showography");e.length&&(this.refreshPeekaboo=PeekabooList.enhance(e,$.proxy(this,"moreButtonText"),$.proxy(this,"truncateAfter"),$.proxy(this,"truncateTo")),e.on("click","li a",$.proxy(this,"handleShowClick")))},truncateAfter:function(){return window.MediaView&&"phone"==MediaView.mode?7:5},truncateTo:function(){return window.MediaView&&"phone"==MediaView.mode?5:3},moreButtonText:function(e){return e?TM("more shows...",null,"used for live show listings","live shows"):TM("fewer shows",null,"used for live show listings","live shows")},handleShowClick:function(){Stats.record({kind:"click",click:"shows_link"})},zzz:null};Showography.enhance();var UpcomingLiveEvents={refreshPeekaboo:null,domReady:function(){},enhance:function(){const e=$("#upcoming-live-events");if(!e.length)return;const t=$("#pagedata").data("blob");if(!t)return;const n=t.upcoming_live_events_list;n&&(n.forEach((function(e){const t=Templ.filters.time(e.scheduled_start_date,"yyyyMMMMd",Intl.DateTimeFormat().resolvedOptions().timeZone),n=Templ.filters.time(e.scheduled_start_date,"hhmmzz",Intl.DateTimeFormat().resolvedOptions().timeZone);$("#upcoming-live-event-date-"+e.event_id).text(t),$("#upcoming-live-event-time-"+e.event_id).text(n)})),this.refreshPeekaboo=PeekabooList.enhance(e,$.proxy(this,"moreButtonText"),$.proxy(this,"truncateAfter"),$.proxy(this,"truncateTo")),e.on("click","li a",$.proxy(this,"handleUpcomingLiveEventClick")))},truncateAfter:function(){return 3},truncateTo:function(){return 3},moreButtonText:function(e){return e?TM("more live streams...",null,"used for upcoming live event listings","upcoming live events"):TM("fewer live streams",null,"used for upcoming live event listings","upcoming live events")},handleUpcomingLiveEventClick:function(){Stats.record({kind:"click",click:"upcoming_live_event_link"})},zzz:null};UpcomingLiveEvents.enhance();var Discography=function(){"use strict";return{enhance:function(e){if(e.music_grid&&e.discography_real_size>e.sidebar_max_size)return;const t=$("#discography");t.length&&(PeekabooList.enhance(t,$.proxy(this,"moreButtonText"),$.proxy(this,"truncateAfter"),$.proxy(this,"truncateTo"),"true"!=sessionStorage.getItem("discography_show_all")),t.on("toggle",(function(e,t){sessionStorage.setItem("discography_show_all",t?"false":"true")})))},truncateAfter:function(){return window.MediaView&&"phone"==MediaView.mode?6:3},truncateTo:function(){return window.MediaView&&"phone"==MediaView.mode?4:3},moreButtonText:function(e){return e?TM("more releases..."):TM("fewer releases")},zzz:null}}();$(document).ready((function(){"use strict";const e=U.pagedataBlob();Discography.enhance(e.sidebar_disco||{})}));var ReportTOUV={};!function(){"use strict";const e=function(e){const t=this;switch(t.itemType=e,t.cancel=function(){return t.showCopyright(!1),t.$dialog.dialog("close"),!0},t.showCopyright=ko.observable(!1),t.optionCopyright=function(){t.showCopyright(!t.showCopyright())},t.reportViolationUrlTOU=Url.addQueryParams(siteroot_https+"/report_violation",$.extend({},ReportTOUV.reportParams,{r_type:"t"})),t.reportViolationUrlCopyright=Url.addQueryParams(siteroot_https+"/report_violation",$.extend({},ReportTOUV.reportParams,{r_type:"c"})),t.templateHash=function(){return{standalone_form_tou_url:t.reportViolationUrlTOU,standalone_form_copyright_url:t.reportViolationUrlCopyright,something_else_url:Url.addQueryParams(siteroot_https+"/contact",$.extend({},ReportTOUV.reportParams,{tou_url:location.href}))}},t.templateName=ko.observable("touviolations/report_item_account_dialog"),t.titleString=null,t.itemType){case null:case"r":t.titleString=TM("Report account to Bandcamp");break;case"a":t.titleString=TM("Report album or account to Bandcamp");break;case"t":t.titleString=TM("Report track or account to Bandcamp");break;case"p":t.titleString=TM("Report merch item or account to Bandcamp")}t.dialogOptions=ko.observable({title:t.titleString,buttons:[],width:"phone"===MediaView.mode?"96%":"515px",dialogClass:"nu-dialog center-title ui-dialog-2018"}),t.showDialog=function(){t.$dialog=NuDialog.showViewModel(t),t.$dialog.on("dialogclose",(function(e){t.cancel()}))}};$(document).ready((function(){const t=$("#report-account-vm");if(0===t.length)return;let n=null;"undefined"!=typeof TralbumData&&TralbumData.current&&(n=TralbumData.current.type[0]),ReportTOUV.reportParams=t.data("tou-report-params");const i=new e(n);ko.applyBindings(i,t[0]),ReportTOUV.vm=i}))}(window,jQuery,ko),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/touviolations/report_item_account_dialog.liquid","warn"):Templ.register({"touviolations/report_item_account_dialog":['<div id="report-account-dialog">\n    <div class="report-account-header">\n        <strong>',{type:"translate",nodelist:["Why are you reporting this?"]},'</strong>\n    </div>\n    <ol class="options">\n        <li>\n            <a href="https://get.bandcamp.help/hc/en-us/articles/360007803574-I-haven-t-received-my-physical-order-what-should-I-do-"\n               target="_blank"\n               data-bind="click: cancel">\n                ',{type:"translate",nodelist:["I havenâ€™t gotten my merch"]},'\n            </a>\n        </li>\n        <li>\n            <a href="#" data-bind="click: optionCopyright">\n                ',{type:"translate",nodelist:["This seller does not own the rights to the content"]},'\n            </a>\n            <div data-bind="visible: showCopyright">\n                <ol class="options">\n                    <li>\n                        <a href="',{type:"variable",name:"siteroot_https",filters:[["a",[]]]},'/copyright#copyright_infringement_procedure"\n                           target="_blank"\n                           data-bind="click: cancel">\n                            ',{type:"translate",nodelist:["I am the rights holder"]},'\n                        </a>\n                    </li>\n                    <li>\n                        <a href="',{type:"variable",name:"standalone_form_copyright_url",filters:[["a",[]]]},'"\n                           target="_blank"\n                           data-bind="click: cancel">\n                            ',{type:"translate",nodelist:["I am not the rights holder"]},'\n                        </a>\n                    </li>\n                </ol>\n            </div>\n        </li>\n        <li>\n            <a href="',{type:"variable",name:"standalone_form_tou_url",filters:[["a",[]]]},'"\n               target="_blank"\n               data-bind="click: cancel">\n                ',{type:"translate",nodelist:["Itâ€™s abusive, spam, or a fake account"]},'\n            </a>\n        </li>\n        <li>\n            <a href="',{type:"variable",name:"something_else_url",filters:[["a",[]]]},'"\n               target="_blank"\n               data-bind="click: cancel">\n                ',{type:"translate",nodelist:["Something else"]},"\n            </a>\n        </li>\n    </ol>\n</div>\n"]});var Fixup=window.Fixup||{};!function(e){"use strict";e.neutralizeAnchors=function(e){n()&&$(e).on("touchend",(function(){const e=$(this),t=e.attr("href");t&&"#"!=t.substr(0,1)&&e.attr("href","#").attr("data-href",t)}))},e.compoundLinkButtons=function(t){t=$(t),e.neutralizeAnchors(t.find("a")),t.has("a").on("click",(function(e){if(n()){const e=$(this).find("a"),t=e.attr("data-href")||e.attr("href");if(t){const n=e.attr("target");return n&&"_self"!=n?window.open(t,n):location.href=t,!1}}}))},e.compoundLinkButtons($(".compound-button")),e.compoundButtons=function(e){(e=$(e)).has("button").on("click",(function(e){if(n()){const t=$(this).find("button")[0];!t||$(e.target).is(t)||$(t).has(e.target).length||(e.preventDefault(),t.click())}}))},e.compoundButtons($(".compound-button")),e.trackRows=function(t){t=$(t),e.neutralizeAnchors(t.find(".title-col a")),t.filter(".linked").find(".info-col").on("click",(function(){if(n()){const e=$(this).parents("tr").find(".title-col a"),t=e.attr("data-href")||e.attr("href");if(t)return location.href=t,!1}})),t.find(".has-video-subcol").on("click",(function(e){if(n()){return i($(this).find("a.has-video"),e),!1}}))},e.trackRows($("#track_table tr")),e.inlinePlayerVideoLink=function(t){t=$(t),e.neutralizeAnchors(t.find("a.video-link")),t.find("a.video-link").on("touchend",(function(e){if(n()){return i($(this),e),!1}})),t.find("a.video-link").on("click",(function(e){if(n()){return i($(this),e),!1}}))},window.MediaView&&"phone"==MediaView.mode&&e.inlinePlayerVideoLink($(".inline_player .track_info"));const t=TM("Top",null,"Button text to return to top of page.");function n(){return window.MediaView&&"phone"==MediaView.mode}function i(e,t){if(window.Browser&&"safari"==Browser.make&&"iphone"==Browser.platform)return function(e,t){const n=$(e).attr("data-href-mobile");if(n){const t=n.split("/"),i="//bandcamp.23video.com/"+t[1]+"/"+t[2]+"/"+t[3]+"/standard/thumbnail.png";$(".video-link-loading").text("video"),$(".video-link-loading").removeClass("video-link-loading"),$(e).text("loading..."),$(e).addClass("video-link-loading"),$("video#mobile-player").remove();let a=null;a=e.hasClass("has-video")?e.parents("tr.track_row_view"):e.parents("div.track_info");const o=$("<video/>",{id:"mobile-player",src:"//bandcamp.23video.com"+n,poster:i}).appendTo(a);return o[0].addEventListener("webkitendfullscreen",(function(){$("video#mobile-player").remove(),$(e).removeClass("video-link-loading"),$(e).text("video")}),!1),o[0].addEventListener("playing",(function(){$(e).removeClass("video-link-loading"),$(e).text("video")}),!1),o.get(0).load(),o.show(),o.get(0).play(),!1}}(e);const n=$(e).attr("data-href-mobile");if(n){const t=$(e).attr("data-caption");let i=$("video.featured-video-mobile-player");i[0]||(i=$("video.hidden-video-mobile-player")),i.attr("src",""),i.hide();const a=n.split("/"),o="//bandcamp.23video.com/"+a[1]+"/"+a[2]+"/"+a[3]+"/standard/thumbnail.jpg";return i.attr("poster",o),i.parent().show(),i.attr("src","//bandcamp.23video.com"+n),i.get(0).load(),i.show(),i.get(0).play(),t?($(".video-caption").text(t),$(".video-caption").show()):$(".video-caption").hide(),$("html, body").animate({scrollTop:i.offset().top-20},500),!1}}$('<a class="goto-top-button compound-button"><span>'+t+"</span></a>").appendTo("#pgBd").on("click",(function(e){Dom.scrollToElement(document.body)}))}(Fixup);var PeekabooText={more:function(e){const t=(e=$(e)).prev(".peekaboo-ellipsis"),n=t.closest(".peekaboo-link").prev(".peekaboo-text");t.length&&n.length&&("none"==n.css("display")?(e.html("less"),n.fadeIn("fast"),t.hide()):(e.html("more"),n.hide(),t.show()))}};$(document).ready((function(){$(".peekaboo-link a").click((function(){return PeekabooText.more(this),!1}))}));var ShareTralbumPhone={};!function(e){if(!window.EmbedData)return;const t="track"==TralbumData.current.type,n=(TralbumData.current.title,EmbedData.artist),i=EmbedData.linkback;e.init=function(){$("#share-link").on("click",e.showShare)},e.showShare=function(){if(!window.MediaView||"phone"!=MediaView.mode)return null;const e={linkback:i,is_track:t,title:a,artist:n};var a=TM("Share");return NuDialog.showTemplate("_share_tralbum_phone",e,{title:a,buttons:[],open:function(){SocialControls.initFromDOM($(this))}}),!1}}(ShareTralbumPhone),ShareTralbumPhone.init&&ShareTralbumPhone.init();var AlbumPage={onPlayerInit:function(e){e&&(MediaView&&"desktop"==MediaView.mode&&e.ontrackplayed(AlbumPage.changeLyrics),TralbumLimits.onPlayerInit(e),AlbumPage.videoInit(e))},videoInit:function(e){if(window.VideoPlayer&&window.TralbumData){let n=!1;for(var t=0;TralbumData.trackinfo&&t<TralbumData.trackinfo.length;t++)if(TralbumData.trackinfo[t].video_source_type&&TralbumData.trackinfo[t].video_id){n=!0;break}n&&!window.tracklistVideoPlayer&&TralbumPageVideoPlayer.init(e),window.tracklistVideoPlayer&&$("#pagedata").data("blob").showvid&&($("#pagedata").data("blob").showvid=!1,window.tracklistVideoPlayer.doVideo(TralbumData.trackinfo[t].video_source_type,TralbumData.trackinfo[t].video_id,TralbumData.trackinfo[t].video_caption,!1,!1))}},changeLyrics:function(e){const t=$('tr[rel="tracknum='+(e+1)+'"]'),n=t.parents("#track_table");n.hasClass("auto_lyrics")?n.find(".showlyrics").removeClass("showlyrics"):t.hasClass("showlyrics")&&($(".track_row_view.showlyrics","#track_table").removeClass("showlyrics"),n.addClass("auto_lyrics"))}},API=function(){"use strict";return{Http:function(e,t,n,i,a){const o=$.Deferred(),s=["/api",t,n,i].join("/");return $.ajax({url:s,type:e||"get",data:"post"==e?JSON.stringify(a):a,dataType:"json",success:function(e){e.error?o.reject(e.error):o.resolve(e)},failure:function(e){o.reject(e)}}),o.promise()},PostWithCrumb:function(e,t,n,i){const a=$.Deferred(),o=["/api",e,t,n].join("/");return Crumb.ajax({type:"POST",dataAs:"JSON",url:o,data:i,success:function(e){e.error?a.reject(e.error):a.resolve(e)},error:function(e,t,n){a.reject(n)}}),a.promise()}}}(),TralbumUpdater={DEFAULT_UPDATE_TIME:5,init:function(){const e={trackinfo:TralbumData.trackinfo,refresh_secs:TralbumUpdater.DEFAULT_UPDATE_TIME,tralbum_has_audio:TralbumData.hasAudio};TralbumUpdater._got_new_info(e)},_got_new_info:function(e){let t=!1;const n=e.refresh_secs||TralbumUpdater.DEFAULT_UPDATE_TIME,i=e.trackinfo;for(let e=0;e<i.length;e++)TralbumUpdater._is_different(TralbumData.trackinfo[e],i[e])&&TralbumUpdater._update_info(e,i[e]),i[e].encoding_pending&&(t=!0);TralbumData.hasAudio=e.tralbum_has_audio,t&&setTimeout(TralbumUpdater._do_update,1e3*n)},_is_different:function(e,t){const n=["file","title","id","title_link","encoding_pending","encoding_error","private","album_private"];for(let i=0;i<n.length;i++)if(e[n[i]]!=t[n[i]])return!0;return!1},_update_info:function(e,t){TralbumData.trackinfo[e]=t,gplaylist.update_trackinfo(e,t)},_do_update:function(){const e="/trackinfo?id="+TralbumData.current.id+"&type="+TralbumData.current.type;$.ajax({url:e,type:"GET",dataType:"json",success:function(e){TralbumUpdater._got_new_info(e)},failure:function(e){Log.error("Error updating Tralbum info",e)}})}},Merch=Merch||{};"TralbumData"in window&&"CurrencyData"in window&&function(e,t,n,i,a,o){"use strict";let s=null,r=0,l=null;const c=U.pagedataBlob().cfg||{};function d(){return!!n.packages&&n.packages.some((e=>e.quantity_warning))}function p(){if(!n.packages||c.inventory_updates_off)return;const e=r<15&&d()&&!c.inventory_updates_only_slow?60:300;s&&clearTimeout(s),Log.debug("Scheduling inventory update in "+e+" seconds"),s=setTimeout((function(){s=null,r++,o.updateInventory()}),1e3*e)}function u(i){Log.debug("Rendering package "+i.id);const o=n.packages.indexOf(i),s=t("#pagedata").length&&t("#pagedata").data("blob")||{},r=s.fan_tralbum_data&&s.fan_tralbum_data.subscriptions_by_band_id||{},l={package:i,package_index:o,currency_data:a,digital_preorder:n.album_is_preorder,digital_preorder_release_date:n.album_is_preorder?n.album_release_date:null,cfg:s.cfg||{},gift_card_balance:s.gift_card_balance,is_pkg_subscriber:r[i.band_id]||r[i.selling_band_id],logged_in:!!Identities.user(),login_bounce_url:s.login_bounce_url,artist_service_url:s.artist_service_url,item_sellers:s.item_sellers,merch_item_page:"package"==n.current.type,items_purchased:n.items_purchased,tralbum_collect_info:n.tralbum_collect_info,is_custom_domain:Url.isCustomDomain(),env:s.env,covid_banner_sellers:s.covid_banner_sellers,band_label_name:s.item_sellers[i.selling_band_id].name,live_event_tickets:s.live_event_tickets,campaign_vinyl_merch:s.campaign_vinyl_merch||{}};t("#package-title-"+i.id).renderLiquid("_package_listing_title",l);const c=t("#package-price-"+i.id).renderLiquid("_package_listing_price",l);BCEvents.publish("tralbum.renderInventory"),t('.order_package_link.[data-pkg="'+o+'"]').click((function(i){i.preventDefault();const a=t(this),s=!!a.closest(".send-as-gift")[0];if(a.hasClass("subscriber-only-buy-link")&&!a.hasClass("subscriber-view"))return void(e.location.href="/subscribe");const r=n.packages[o];r&&r.is_live_ticket?e.location.href=r.url:(PackageOrder.begin(o,s),"track"==n.item_type&&Stats.record({kind:"click",click:"t_order_package_link"}))})),e.Fixup&&Fixup.compoundButtons&&Fixup.compoundButtons(c.find(".compound-button"))}t(e.document).ready((function(){d()?o.updateInventory():p()})),o.updateInventory=function(i){if(!n.packages||c.inventory_updates_off)return;if(i&&(r=0),l)return;const a=[];if(n.packages.forEach((e=>{("number"==typeof e.quantity_available||e.options&&e.options.find((e=>"number"==typeof e.quantity_available)))&&a.push(e.id)})),0===a.length)return void Log.debug("Not updating inventory because no packages are quantity-controlled");const o="merch_id="+a.join(",");Log.debug("Fetching merch inventory",o),l=t.getJSON("/api/merch/2/inventory",o).done((function(t){t.error?Log.error("Error updating merch inventory",t):function(t){if(!n.packages)return;Log.debug("Refreshing merch inventory",t),n.packages.forEach((n=>{const i=t[n.id];i&&(n.quantity_available>0&&i.quantity_available,n.quantity_available=i.quantity_available,n.quantity_limits=i.quantity_limits,n.quantity_warning=i.quantity_warning,n.options&&i.options&&n.options.forEach((e=>{e.quantity_available=i.options[e.id]})),e.Trenderer?e.Trenderer.renderQuantity(n):u(n))}))}(t.merch_inventory)})).fail((function(){Log.error(arguments)})).always((function(){l=null,p()}))},o.renderAllInventory=function(){n.packages&&n.packages.forEach((e=>{u(e)}))}}(window,jQuery,TralbumData,BandData,CurrencyData,Merch);var BuyFullDiscographyVM=function(){"use strict";return function(e){const t=this;t.id=e.bundle_id,t.title=e.title,t.artist=e.band_name,t.type="bundle",t.is_set_price=e.is_set_price,t.minimum_price=t.set_price=e.price,t.selling_band_id=e.selling_band_id,t.art_id=e.art_id,t.tralbums=e.tralbums,t.moreTralbums=ko.observableArray(),t.download_pref=TralbumData.PAID,t.tralbum_count=e.tralbum_count,t.has_tracks=!1;for(let n=0;n<e.tralbums.length;n++)"t"==t.tralbums[n].item_type&&(t.has_tracks=!0);t.expandCoverArt=function(e,t){if($(".art.compact").length&&"phone"!=Browser.media_mode){$(".buyFullDiscography .art .more-button").fadeOut(60),$(".buyFullDiscography .art .art-thumb").removeClass("thumb-shadow"),$(".buyFullDiscography .art .art-thumb").removeClass("thumb-glow"),$(".buyFullDiscography .art .art-thumb").slice(5).fadeOut(1);const e=$(".buyFullDiscography .art .art-thumb"),t=function(){$(".buyFullDiscography .art").removeClass("compact");let e=5,t=10;var n=function(){const i=$(".buyFullDiscography .art .art-thumb").slice(e,t);i.length>0&&(i.fadeIn(300),setTimeout(n,300),e+=5,t+=5)};n()};e.promise().done(t),e.animate({marginRight:"6px"},{duration:300})}else $(".art.compact").length||window.open(t.target.href,"_self")},t.tralbumInBuyFullDiscography=function(e){for(let t=0;t<this.tralbums.length;t++){if(this.tralbums[t].item_id===e)return!0}return!1},t.moreTitles=function(e,t){t.target.parentElement.remove(),e.moreTralbums(e.tralbums.slice(8))},t.fullDiscographyBuyDialog=function(e,t){TralbumDownload.begin(t,!1,e)},t.fullDiscographyGiftDialog=function(e,t){TralbumDownload.begin(t,!0,e)}}}();!function(e){"use strict";if(!e)return;const t=TM("Live Stream Ticket","pre",null,"merch type"),n=TM("Live Stream","pre",null,"merch type");if("clientItems"in e.dataset){const i=JSON.parse(e.dataset.clientItems),a=JSON.parse(e.dataset.merchTypes),o=JSON.parse(e.dataset.imageFormat),s=e.lastElementChild;let r=null==s||!s.classList.contains("odd");const l=Date.now(),c=[];i.forEach((function(e){e.sold_out=e.sold_out||null,e.album_art=e.album_art||null,e.filtered=e.filtered||null,e.album_artist=e.album_artist||null,e.sub_name=e.sub_name||null,e.campaign_id=e.campaign_id||null,e.live_event_type=e.live_event_type||null,e.img_format=o,e.merch_type=null,12===e.type_id&&"t"===e.live_event_type?e.merch_type=t:12===e.type_id&&"f"===e.live_event_type?e.merch_type=n:null!==e.type_id&&(e.merch_type=a[e.type_id]),e.odd=r,c.push(Templ.render("merch/grid_item_client",e)),r=!r}));const d=Date.now()-l,p=Date.now();e.insertAdjacentHTML("beforeend",c.join("")),Log.debug("Made "+i.length+" items in "+d+"ms, rendered in "+(Date.now()-p)+"ms")}if("liveTickets"in e.dataset){const t=JSON.parse(e.dataset.liveTickets);Object.keys(t).forEach((n=>{const i=e.querySelector("[data-item-id='".concat(n,"']"));if(i){const e=t[n],a=Templ.filters.time(e.scheduled_start_date,"yyyyMMMMd",Intl.DateTimeFormat().resolvedOptions().timeZone),o=Templ.filters.time(e.scheduled_start_date,"hhmmzz",Intl.DateTimeFormat().resolvedOptions().timeZone);i.querySelector(".live-event-start-date").innerText=a,i.querySelector(".live-event-start-time").innerText=o}}))}}(document.getElementById("merch-grid")),function(e){"use strict";var t,n;if(!e||!("clientItems"in e.dataset))return;const i=JSON.parse(e.dataset.clientItems),a=e.lastElementChild;let o=null==a||!a.classList.contains("odd");const s=Date.now(),r=[],l=null!==(t=(n=e.classList).contains)&&void 0!==t&&t.call(n,"columns-2")?16:2;i.forEach((function(e){e.filtered=e.filtered||null,e.sub_name=e.sub_name||null,e.artist=e.artist||null,e.odd=o,e.art_format=l,r.push(Templ.render("music/grid_item_client",e)),o=!o}));const c=Date.now()-s,d=Date.now();e.insertAdjacentHTML("beforeend",r.join("")),Log.debug("Made "+i.length+" items in "+c+"ms, rendered in "+(Date.now()-d)+"ms")}(document.getElementById("music-grid")),$(document).ready((function(){"use strict";if(void 0!==$().lazyload&&$(".artists-grid img.lazy, .music-grid img.lazy, .merch-grid img.lazy").lazyload({threshold:500,effect:"fadeIn",effectspeed:100}),$("#pagedata").data().blob.buyfulldisco){const e=window.buyFullDiscographyVM=new BuyFullDiscographyVM($("#pagedata").data().blob.buyfulldisco),t=$(".buyItem.buyFullDiscography")[0];t&&ko.applyBindings(e,t)}void 0!==window.PopupImage&&PopupImage.attach("a.popupImage"),$(".tralbum-tags-nu").removeClass("hidden"),"phone"!==MediaView.mode&&$("#sidebar-gift-card-accepted").bc_tooltips({itemSelector:null,tooltipSelector:".sidebar-gift-card-tooltip"}),window.Trackpipe&&Trackpipe.maybeDoTralbumActions();const e=[40,200,500,1e3];function t(t){const n={};return["css","js","img","other"].forEach((function(t){n[t]=function(){const t=e.length+1,n=new Array(t);if(Array.prototype.fill)return n.fill(0);for(let e=0;e<t;e++)n[e]=0;return n}()})),t.forEach((function(t){const i=t.initiatorType,a=function(t){const n=e.length;for(let i=0;i<n;i++)if(t<=e[i])return i;return n}(Math.round(t.responseEnd-t.startTime)),o=new URL(t.name).pathname.split("/").pop().split(".").pop();if("script"==i||"js"==o)n.js[a]++;else switch(o){case"jpg":case"gif":case"png":case"svg":n.img[a]++;break;case"css":n.css[a]++;break;default:n.other[a]++}})),n}$(window).on("load",(function(){setTimeout((function(){if(window.performance&&performance.timing&&(!performance.navigation||performance.navigation.type==PerformanceNavigation.TYPE_NAVIGATE)){if(document.visibilityState&&"visible"!=document.visibilityState)return;const e=$("#pagedata").data().blob||{},n=e.pgload_sample_rate||0,i=Math.random()*n;if(0==n||i<n-1)return;const a={kind:"pgload"};if(function(e){const t=performance.timing;e.pg=t.loadEventEnd-t.navigationStart,e.cnt=t.responseEnd-t.requestStart,e.intr=t.domInteractive-t.responseEnd,e.ren=t.domComplete-t.domInteractive}(a),0==a.pg)return;performance.getEntriesByType&&(function(e){const n=t(window.performance.getEntriesByType("resource"));for(const t in n)e[t]=n[t].join(",")}(a),function(e){const t=window.performance.getEntriesByType("paint");for(let n=0;n<t.length;n++)if("first-contentful-paint"==t[n].name)return void(e.fp=Math.round(t[n].startTime))}(a)),a.sw=screen&&screen.width||0,a.sh=screen&&screen.height||0,a.sd=devicePixelRatio||0,a.vw=window.innerWidth||0,a.vh=window.innerHeight||0;const o=MediaView&&MediaView.mode;a.mode="desktop"==o?"d":"phone"==o?"m":o,a.ip_loc=e.ip_location_country_code,a.a_id=e.album_id,e.track_id&&(a.t_id=e.track_id),a.c_id=ClientID,Stats.record_sendbeacon(a)}}),0)}))})),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/label/band_selector.liquid","warn"):Templ.register({"label/band_selector":[{type:"ef",blocks:[{type:"ncondition",expression:"is_phone ",attachment:["\n\n    <div class='label-band-selector'>\n        ",{type:"translate",nodelist:["Show:"]},"\n        <select data-bind='value: selectedOption'>\n            <option value=\"all\">",{type:"translate",nodelist:["all artists"]},"</option>\n            <option data-bind='value: labelBand().id, text: labelBand().name, visible: labelHasOwnItems'></option>\n            \x3c!-- ko foreach: memberBands --\x3e\n                <option data-bind='value: id, text: name'></option>\n            \x3c!-- /ko --\x3e\n        </select>\n    </div>\n\n"]},{type:"else_ncondition",attachment:["\n\n    <div class='label-band-selector fade-in-on-load loading'>\n        <span class='label'>",{type:"translate",nodelist:["Show:"]},"</span>\n        <ul class='tabs'>\n            <li class='all'>\n                <a class='selected themeable' data-bind='css: {selected: selected_all}, click: select_all'>\n                    ",{type:"translate",nodelist:["all"]},"\n                </a>\n            </li>\n            <li class='bands' data-bind=\"css: columnClasses\">\n                <a class='themeable bands-menu-title' data-bind='css: {selected: selected_member_band}'>\n                    ",{type:"ef",blocks:[{type:"ncondition",expression:"cfg.header_rework_2018 ",attachment:['\n                        \x3c!-- ko if: selected_band() && selected_band().photo --\x3e\n                        <span class="menu-artistpic round">\n                            <img data-bind="src_image: {image_id: selected_band().photo, format: \'art_embedded_player\'}">\n                        </span>\n                        \x3c!-- /ko --\x3e\n                        \x3c!-- ko if: selected_band() && !selected_band().photo --\x3e\n                        <span class="menu-artistpic round">\n                            <img>\n                        </span>\n                        \x3c!-- /ko --\x3e\n                        <span data-bind=\'text: selected_band_name, css: {name: selected_band()}\'>',{type:"translate",nodelist:["artists"]},"</span>\n                    "]},{type:"else_ncondition",attachment:["\n                        <span data-bind='text: selected_band_name'>",{type:"translate",nodelist:["artists"]},"</span>\n                    "]}]},'\n\n                    \x3c!--[if gte IE 9]>\x3c!--\x3e\n                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 4" width="8" height="8">\n                        <path class="caret" d="M 0 0 L 8 0 4 4 0 0" />\n                    </svg>\n                    \x3c!--<![endif]--\x3e\n                    \x3c!--[if lte IE 8]>\n                    <span class="bc-ui menucaret"></span>\n                    <![endif]--\x3e\n                </a>\n                <div class=\'bands-menu multi-column-artist-menu\'>\n                \x3c!-- ko foreach: {data: memberBandCols} --\x3e\n                    <ol data-bind=\'foreach: bands\'>\n                        <li>\n                            <a class="themeable menu-artistitem" data-bind=\'click: $root.select_band\'>\n                                <span class="menu-artistpic ',{type:"ef",blocks:[{type:"ncondition",expression:"cfg.header_rework_2018 ",attachment:["round"]}]},"\">\n                                    \x3c!-- ko if: photo --\x3e\n                                    <img data-bind=\"src_image: {image_id: photo, format: 'bio_navbar'}\">\n                                    \x3c!-- /ko --\x3e\n                                    \x3c!-- ko ifnot: photo --\x3e\n                                    <img>\n                                    \x3c!-- /ko --\x3e\n                                </span>\n                                <span data-bind=\"text: name\" class=\"menu-bandname\"></span>\n                            </a>\n                        </li>\n                    </ol>\n                \x3c!-- /ko --\x3e\n                </div>\n            </li>\n            <li class='label' data-bind='visible: labelHasOwnItems'>\n                <a class='themeable' data-bind='",{type:"ef",blocks:[{type:"ncondition",expression:"merch_page ",attachment:["text: labelBand().name"]}]},", css: {selected: selected_label}, click: select_label'>",{type:"translate",nodelist:["compilations, etc"]},"</a>\n            </li>\n            ",{type:"ef",blocks:[{type:"ncondition",expression:"cfg.header_rework_2018 ",attachment:["\n            \x3c!-- ko if: selected_band() && selected_band().url--\x3e\n            <li>\n                <a data-bind='attr: {href: selected_band().url + \"/stats\"}'>",{type:"translate",nodelist:["artist stat page"]},"</a>\n            </li>\n            \x3c!-- /ko --\x3e\n            "]}]},"\n        </ul>\n    </div>\n\n"]}]},"\n"]}),void 0===window.Templ?Log.server("Premature template registration: common/layout/templates/merch/merch_types.liquid","warn"):Templ.register({"merch/merch_types":[{type:"case",blocks:[{type:"condition",left:"pkg_type_id",right:"0",operator:"==",attachment:[{type:"translate",nodelist:["Other"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"1",operator:"==",attachment:[{type:"translate",nodelist:["Compact Disc (CD)"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"2",operator:"==",attachment:[{type:"translate",nodelist:["Record/Vinyl"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"15",operator:"==",attachment:[{type:"translate",nodelist:["Record/Vinyl"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"16",operator:"==",attachment:[{type:"translate",nodelist:["Record/Vinyl"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"17",operator:"==",attachment:[{type:"translate",nodelist:["Record/Vinyl"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"18",operator:"==",attachment:[{type:"translate",nodelist:["Record/Vinyl"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"3",operator:"==",attachment:[{type:"translate",nodelist:["Cassette"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"4",operator:"==",attachment:[{type:"translate",nodelist:["DVD"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"5",operator:"==",attachment:[{type:"translate",nodelist:["USB Flash Drive"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"6",operator:"==",attachment:[{type:"translate",nodelist:["Sheet Music"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"10",operator:"==",attachment:[{type:"translate",nodelist:["Poster/Print"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"11",operator:"==",attachment:[{type:"translate",nodelist:["T-Shirt/Apparel"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"12",operator:"==",attachment:[{type:"ef",blocks:[{type:"ncondition",expression:"is_live_ticket && live_event_type && live_event_type == 'f' ",attachment:[{type:"translate",nodelist:["Live Stream"]}]},{type:"ncondition",expression:"is_live_ticket ",attachment:[{type:"translate",nodelist:["Live Stream Ticket"]}]},{type:"else_ncondition",attachment:[{type:"translate",nodelist:["Ticket"]}]}]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"13",operator:"==",attachment:[{type:"translate",nodelist:["Button/Pin/Patch"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"14",operator:"==",attachment:[{type:"translate",nodelist:["Bag"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"19",operator:"==",attachment:[{type:"translate",nodelist:["T-Shirt/Shirt"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"20",operator:"==",attachment:[{type:"translate",nodelist:["Sweater/Hoodie"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"21",operator:"==",attachment:[{type:"translate",nodelist:["Hat"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"22",operator:"==",attachment:[{type:"translate",nodelist:["Other Apparel"]},"\n    "],child_relation:null,child_condition:null},{type:"condition",left:"pkg_type_id",right:"23",operator:"==",attachment:[{type:"translate",nodelist:["Book/Magazine"]},"\n"],child_relation:null,child_condition:null}]},"\n"]});var LabelBandSelectorVM=function(e,t){"use strict";return e.widget("bc.bclabelbandselector",{options:{labelBand:null,memberBands:[],onBandSelect:e.noop,labelHasOwnItems:!1,merchPage:!1,queryParam:null,vm:null},_create:function(){const n=this;e(this.element).renderLiquid("label/band_selector",{is_phone:"phone"===MediaView.mode,merch_page:this.options.merchPage,cfg:e("#pagedata").data("blob").cfg});const i=this.options.vm||new LabelBandSelectorVM(this.options);t.applyBindings(i,this.element[0]);const a=this.element.find(".label-band-selector"),o=this.element.find(".bands-menu"),s=this.element.find(".bands-menu-title"),r=this.element.find("select");i.selected_band()&&n._trigger("onBandSelect",null,i.selected_band()),i.selected_band.subscribe((function(e){n._trigger("onBandSelect",null,e),o.bcmenu("hide"),r.blur()})),i.memberBands.subscribe((function(){o.bcmenu("refresh")})),s.click((function(){o.is(":visible")?o.bcmenu("hide"):o.bcmenu("show")})),this._super(),o.bcmenu({triggerElements:o.closest(".bands"),menus:"ul"}),a.removeClass("loading"),this.viewModel=function(){return i}}}),function(e){const n=this,i=e.labelBand,a=e.memberBands||[],o=e.labelHasOwnItems;this.labelBand=t.observable(i),this.memberBands=t.observableArray(a),this.labelHasOwnItems=t.observable(o),this.numCols=t.computed((function(){return Math.min(Math.floor((n.memberBands().length-1)/9)+1,3)})),this.columnClasses=t.computed((function(){let e="col"+n.numCols();return n.numCols()>1&&(e+=" has-multiple-columns"),e})),this.memberBandCols=t.computed((function(){let e,t,i;for(e=n.memberBands.slice(0),t=Math.ceil(e.length/n.numCols()),i=[];e.length>0;)i.push({bands:e.splice(0,t)});return i})),this.selected_band_id=t.observable(function(){if(!e.queryParam)return null;const t=Url.parseQuery(window.location.search),i=parseInt(t[e.queryParam],10);if(!i)return null;const a=n.memberBands().slice();if(a.push(n.labelBand()),Iter.find(a,(function(e){return e.id===i})))return i;return null}()),this.selected_band_id.subscribe((function(t){if(!e.queryParam)return;if("history"in window&&"function"==typeof window.history.replaceState){let n=window.location.pathname;const i=Url.parseQuery(window.location.search);t?i[e.queryParam]=t:delete i[e.queryParam],n=Url.addQueryParams(n,i),window.location.hash&&(n+=window.location.hash),history.replaceState(null,document.title,n)}})),this.selected_band=t.computed((function(){const e=n.selected_band_id();return e===n.labelBand().id?n.labelBand():Iter.find(n.memberBands(),(function(t){return t.id===e}))})),this.select_all=function(){n.selected_band_id(null)},this.selected_all=t.computed((function(){return!n.selected_band_id()})),this.select_label=function(){n.selected_band_id(n.labelBand().id)},this.selected_label=t.computed((function(){return n.selected_band_id()===n.labelBand().id})),this.select_band=function(e){n.selected_band_id(e.id)},this.selected_member_band=t.computed((function(){return n.selected_band()&&n.selected_band()!==n.labelBand()}));const s=TM("artists");this.selected_band_name=t.computed((function(){return n.selected_member_band()?n.selected_band().name:s})),this.selectedOption=t.computed({read:function(){return n.selected_band_id()||"all"},write:function(e){"all"===e?n.selected_band_id(null):n.selected_band_id(parseInt(e,10))}})}}(jQuery,ko);!function(e){"use strict";function t(t,n){const i=n&&n.id;let a=$(".editable-grid"),o=$(".editable-grid > li");const s=$(".featured-grid");if(s.hide(),s.addClass("filtered"),0===a.length&&(a=$(".def-grid"),o=$(".def-grid > dt, .def-grid > dd")),0===a.length)return;if(o.each((function(){const e=$(this).find("a"),t=Url.toHash(e.attr("href")),n=Url.parseQuery(t.search);i?n.filter_band=i:delete n.filter_band,t.search="?"+Url.joinQuery(n),e.attr("href",Url.fromHash(t))})),i){a.addClass("filtered"),s[0]&&e.dataFor(s[0])&&e.dataFor(s[0]).switchFilterMode(!0),o.filter('[data-band-id!="'+i+'"]').hide().removeClass("odd");var r=!0;Iter.each(o.filter('[data-band-id="'+i+'"]'),(function(e){$(e).removeClass("odd"),r&&$(e).addClass("odd"),$(e).show(),r=!r})),$("img.lazy:visible",a).trigger("appear"),0===$(".editable-grid.private > li:visible").length?$("#private-merch-heading").hide():$("#private-merch-heading").show()}else{a.removeClass("filtered"),s.removeClass("filtered"),s[0]&&e.dataFor(s[0])?e.dataFor(s[0]).switchFilterMode(!1):s.show(),o.filter(".featured").hide();r=!0;Iter.each(o.not(".featured"),(function(e){$(e).removeClass("odd"),r&&$(e).addClass("odd"),r=!r})),o.not(".featured").show(),$("#private-merch-heading").show()}const l=$(".editable-grid > li:visible").length;2==l||4==l?(a.removeClass("columns-3"),a.removeClass("columns-4"),a.addClass("columns-2")):l<7?(a.removeClass("columns-2"),a.removeClass("columns-4"),a.addClass("columns-3")):(a.removeClass("columns-2"),a.removeClass("columns-3"),a.addClass("columns-4"))}$(".label-band-selector-grid").each((function(){const e=$(this).data("label-band-selector");e&&$(this).bclabelbandselector({labelBand:e.label_band,memberBands:e.member_bands,labelHasOwnItems:e.label_has_own_items,merchPage:$("#pagedata").data("blob").merch_page,queryParam:"filter_band",onBandSelect:t})}))}(ko);var CartVM=function(e,t){"use strict";return function(t,n){this.$el=e(n),this._cart=t;const i=this._cart;this.checkoutWithCard=function(){i.payment_pref_changed=!0,i.payment_pref="c",i.checkout()}}}(jQuery,ko),Sidecart=null;!function(){"use strict";const e=function(e){const t=this;if(t.cart=e,t.phoneMode=window.MediaView&&"phone"==MediaView.mode,t.postAddItem=function(){t.phoneMode&&BubbleMessage(TM("Item added to cart")).addClass("added-to-cart").on("click",(function(){$(this).remove(),Dom.scrollToElement(document.body),t.show_cart_phone()}))},t.show_cart=function(e,n){t.cart.el.style.display="block","phone"==MediaView.mode&&($("#menubar #cart-item-divider").show(),$("#menubar #cart-item").show(),$("#gift-balance-navbar").hide()),$("#rightColumn").addClass("cart-visible"),e?(t.cart.clear_summary(n),$("#sidecartReveal").slideDown("fast")):$("#sidecartReveal").height("auto")},t.hide_cart=function(e,n){const i=(a=t.cart,o=n,function(){o&&a.item_list_el.removeChild(o.el),a.el.style.display="none",$("#rightColumn").removeClass("cart-visible"),"phone"==MediaView.mode&&($("#menubar #cart-item-divider").hide(),$("#menubar #cart-item").hide(),$("#gift-balance-navbar").show(),$("#menubar-2018-phone.mobile-cd").hide()),a.clear(!0)});var a,o;e?$("#sidecartReveal").slideUp("fast",i):i()},t.toggle_cart_phone=function(){$("#sidecart-phone-reveal").slideToggle("fast"),$("#sidecart").toggleClass("expanded"),$("#menubar #cart-item").toggleClass("expanded"),$("#menubar-2018-phone .cart-mobile").toggleClass("expanded")},t.show_cart_phone=function(){$("#sidecart-phone-reveal").slideDown("fast"),$("#sidecart").addClass("expanded"),$("#menubar #cart-item").addClass("expanded"),$("#menubar-2018-phone .cart-mobile").addClass("expanded")},t.phoneMode){const e=$("#menubar #cart-item a");e.length?(e.off("click"),Dom.hackLinkClicksThanksSafari(e[0],(function(){return Log.note("click on cart element '#menubar #cart-item a':"),t.toggle_cart_phone(),!1}))):($("#sidecartHeader").on("click",(function(){t.toggle_cart_phone()})),HiddenParams.get("cart_redirected")&&t.show_cart_phone())}};window.Cart={NO_AMT:"- -&nbsp;",PAYMENTTYPE_PAYPAL:"p",PAYMENTTYPE_CREDITCARD:"c",PAYFLOW_CURRENCIES:["USD","GBP","AUD","CAD","EUR","JPY"],startup:function(e,t){const n=Object.create(Cart);t&&(t.cart=n),Sidecart=n.init(e,t),window.BCEvents&&BCEvents.publish("cart.startup")},init:function(t,n){const i=this;t=t||window.TrackpipeCartStartup&&TrackpipeCartStartup.init_data,this.initing=!0;const a=U.pagedataBlob();this.cfgFlags=a.cfg,this.el=elt("sidecart"),this.item_list_el=elt("item_list"),this.summary_el=elt("sidecartSummary"),this.saved_card=a.saved_card,$("#sidecartCheckout").click((function(e){i.checkout(e,"cart")})),$(this.el).on("click","a.country-picker",(function(e){i.show_country_pref(e)})),ClientPrefs.update(t),this.payment_pref=this.getPaymentPref(a),this.country_pref=CountryPrefPanel.make((function(e){i.oncountry_change(e)})),this.gift_balance=t&&t.gift_balance,this.payment_pref_changed=!1,this.payment_type_panel=PaymentTypePanel.init((function(e){i.payment_pref=e,i.payment_pref_changed=!0})),this.cart_ui=n||new e(this),this.reset(t),this.initing=!1,this.contains=t&&t.contains;const o=new CartVM(this,"#sidecart");return ko.applyBindings(o,o.$el[0]),this.addListenerForChangePaymentMethod(),this},getPaymentPref:function(e){let t=null;return t=e.payment_type,void 0===t||t!=this.PAYMENTTYPE_PAYPAL&&t!=this.PAYMENTTYPE_CREDITCARD?(t=ClientPrefs.payment_type,void 0===t||t!=this.PAYMENTTYPE_PAYPAL&&t!=this.PAYMENTTYPE_CREDITCARD?null:t):t},reset:function(e){let t;if(this.clear(!1),e){if(this.sync_num=e.sync_num,e.items&&e.items.length>0){for(t=0;t<e.items.length;++t)this.add_item_to_list(e.items[t],!1);this.update_packages()}this.snarf_cart_summary(e,!this.initing)}this.cart_items.length>0?this.show_cart(!1,this.has_shipping):this.hide_cart(!1)},needs_resync:function(e){return e.resync?this.reset(e.cart_data):this.sync_num=e.sync_num,e.resync},add_to_cart:function(e){let t,n,i={},a=!1;if(this.checking_out=this.checking_out||e.checkout_now,n=0===this.cart_items.length,n)this.sync_num=1;else for(t=0;t<this.cart_items.length;++t){const n=this.cart_items[t];if(e.item_type==n.item_type&&e.item_id==n.item_id&&e.gift_recipient_email==n.gift_recipient_email){n.purchase_note!=e.purchase_note&&(n.purchase_note=e.purchase_note,i.purchase_note=e.purchase_note,i.purchase_note_changed=!0),n.notify_me!=e.notify_me&&(n.notify_me=e.notify_me,i.notify_me=e.notify_me,i.notify_me_changed=!0),n.notify_me_label!=e.notify_me_label&&(n.notify_me_label=e.notify_me_label,i.notify_me_label=e.notify_me_label,i.notify_me_label_changed=!0);if("p"==e.item_type&&e.unit_price==n.unit_price&&e.option_id==n.option_id&&e.discount_id==n.discount_id&&e.discount_type==n.discount_type&&(!e.is_gift||this.equalAddresses(e,n))){if(e.is_live_ticket){a=!0;break}e.quantity+=n.quantity,i.req="update_quantity",i.id=n.id,i.quantity=e.quantity,this.update_quantity(n,e.quantity);break}if("a"==e.item_type||"t"==e.item_type||"b"==e.item_type){e.associated_license_id!=n.license_id?a=!0:e.discount_id!=n.discount_id&&e.discount_type!=n.discount_type?(i.req="update_discount_id",i.id=n.id,i.unit_price=e.unit_price,i.discount_id=e.discount_id,i.discount_type=e.discount_type,this.update_discount_id(n,e.unit_price,e.discount_id,e.discount_type)):e.unit_price!=n.unit_price?(i.req="update_unit_price",i.id=n.id,i.unit_price=e.unit_price,this.update_unit_price(n,e.unit_price)):void 0!==i.purchase_note?(i.req="update_purchase_note",i.purchase_note=i.purchase_note||"",i.id=n.id):void 0!==i.notify_me?(i.req="update_notify_me",i.notify_me=i.notify_me||!1,i.id=n.id):void 0!==i.notify_me_label?(i.req="update_notify_me_label",i.notify_me_label=i.notify_me_label||!1,i.id=n.id):a=!0;break}}}if(a)this.checking_out&&this.checkout(null,"dialog");else{($.isEmptyObject(i)||void 0===i.req||null===i.req)&&(e.local_id=""+Math.random(),this.add_item_to_list(e,!n),i={},i.req="add",i.local_id=e.local_id,i.item_type=e.item_type,i.item_id=e.item_id,i.unit_price=e.unit_price,i.quantity=e.quantity,i.option_id=e.option_id,i.discount_id=e.discount_id,i.discount_type=e.discount_type,i.download_type=e.download_type,i.download_id=e.download_id,i.purchase_note=e.purchase_note,i.notify_me=e.notify_me,i.notify_me_label=e.notify_me_label,i.band_id=e.band_id,i.releases=e.releases,i.ip_country_code=e.ip_country_code,i.associated_license_id=e.associated_license_id,e.is_gift&&(i.is_gift=!0,i.gift_sender_name=e.gift_sender_name,i.gift_recipient_email=e.gift_recipient_email,i.gift_recipient_fan_id=e.gift_recipient_fan_id,i.gift_recipient_name=e.gift_recipient_name,i.gift_sender_note=e.gift_sender_note,e.is_physical_gift&&(i.shippable=e.shippable,i.shipping_street=e.shipping_street,i.shipping_street_2=e.shipping_street_2,i.shipping_city=e.shipping_city,i.shipping_state=e.shipping_state,i.shipping_zip=e.shipping_zip,i.shipping_country_code=e.shipping_country_code,i.shipping_country_name=e.shipping_country_name)),window.FanControls&&FanControls.fan_id&&(i.fan_id=FanControls.fan_id)),window.ReferrerToken&&(i.ref_token=window.ReferrerToken),n?this.show_cart(!0,"p"==e.item_type):this.hide_summary(!0,n);const t=this.request(i,!0);this.checking_out&&(this.checkout_after=t)}this.checking_out||this.cart_ui.postAddItem()},equalAddresses:function(e,t){const n=["shipping_street","shipping_street_2","shipping_city","shipping_state","shipping_zip","shipping_country_code"];for(let i=0;i<n.length;i++)if(!this.equalOrEmpty(e[n[i]],t[n[i]]))return!1;return!0},equalOrEmpty:function(e,t){return null==e&&(e=""),null==t&&(t=""),e===t},show_cart:function(e,t){this.checking_out&&!this.paymentTypeDialogAllowed()||this.cart_ui.show_cart(e,t)},delete_from_cart:function(e){let t;t=1==this.cart_items.length,t?(this.delete_item_from_list2(e.local_id),this.hide_cart(!0,e)):(this.delete_item_from_list(e.local_id,null,!0),this.hide_summary(!1)),window.Analytics&&Analytics.cartItemEvent("remove",e),e.id&&this.request({req:"del",id:e.id},!0)},hide_cart:function(e,t){this.cart_ui.hide_cart(e,t)},request:function(e,t){const n=this;let i=null;e.client_id=ClientID,e.sync_num=this.sync_num||1,t&&(i=""+Math.random(),this.last_req_id=e.req_id=i);const a=Url.joinQuery(e);return $.ajax({type:"POST",url:"/cart/cb",data:a,dataType:"JSON"}).success((function(e){n.resp_success(e)})).fail((function(e){n.resp_failure(e)})),i},resp_success:function(e){ClientPrefsObservable.zipIsInvalid(e.invalid_zip_error),"add"==e.req?this.resp_add(e):"del"==e.req?this.resp_del(e):"update_quantity"==e.req||"update_unit_price"==e.req||"update_discount_id"==e.req||"update_purchase_note"==e.req||"update_notify_me"==e.req||"update_notify_me_label"==e.req?this.resp_update(e):"country"==e.req&&this.resp_country(e),e.unexpected_error&&(alert(TM("An unexpected error occurred with the cart.")),this.resp_update(e))},resp_failure:function(e){},resp_add:function(e){if(!this.needs_resync(e)){let t,n=!1;for(t=0;t<this.cart_items.length;++t){const i=this.cart_items[t];if(i.local_id==e.local_id){i.id=e.id,n=!0;break}}n||this.request({req:"del",id:e.id},!0),this.snarf_cart_summary(e,!0),this.update_packages()}this.maybe_checkout(e.req_id)},resp_del:function(e){this.needs_resync(e)||(this.snarf_cart_summary(e,!0),this.update_packages(!0)),this.maybe_checkout(e.req_id)},snarf_cart_summary:function(e,t){e.req_id&&e.req_id!=this.last_req_id||(e.currency&&(this.subtotal=e.subtotal,this.has_shipping=e.has_shipping,this.shipping=e.shipping,this.has_tax=e.has_tax,this.tax=e.tax,ClientPrefs.update(e)),t&&this.update_summary())},clear:function(e){if(this.has_shipping=!1,this.checking_out=!1,this.checkout_after=null,this.checkout_callback=null,this.anim&&this.anim.stop(!1),this.cart_items){let e;for(e=0;e<this.cart_items.length;++e){const t=this.cart_items[e];t.kill(),t.el.parentNode===this.item_list_el&&this.item_list_el.removeChild(t.el)}}this.cart_items=[],this.ko_num_cart_items?this.ko_num_cart_items(0):this.ko_num_cart_items=ko.observable(0),e&&this.clear_summary(!1)},add_item_to_list:function(e,t){const n=CartItem.make(this,e,this.initing);this.cart_items.push(n),this.ko_num_cart_items(this.cart_items.length),this.initing||this.checking_out&&!this.paymentTypeDialogAllowed()||(this.item_list_el.appendChild(n.el),n.animate(!0,null,t),this.update_item_list(),this.update_cart_contains())},delete_item_from_list:function(e,t,n){const i=this.delete_item_from_list2(e),a=(o=this,s=i,r=t,function(){o.item_list_el.removeChild(s.el),r&&r()});var o,s,r;i.animate(!1,a,n),this.update_item_list(),this.update_cart_contains()},delete_item_from_list2:function(e){let t;for(t=0;t<this.cart_items.length;++t){const n=this.cart_items[t];if(n.local_id==e)return this.cart_items.splice(t,1),this.ko_num_cart_items(this.cart_items.length),n}},update_quantity:function(e,t){e.quantity=t,this.checking_out&&!this.paymentTypeDialogAllowed()||e.update()},update_discount_id:function(e,t,n,i){e.discount_id=n,e.discount_type=i,e.unit_price=t,this.checking_out&&!this.paymentTypeDialogAllowed()||e.update()},update_unit_price:function(e,t){e.unit_price=t,this.checking_out&&!this.paymentTypeDialogAllowed()||e.update()},update_item_list:function(){let e=$("#sidecart .cart-number");e.length&&e.text(this.cart_items.length),e=$("#menubar .cart-number"),e.length&&e.text(this.cart_items.length),this.ko_num_cart_items(this.cart_items.length),this.country_pref.hide()},hide_summary:function(e){if(this.checking_out)return;if(this.summary_hidden)return;let t;const n=this;t=function(){const e=elt("cartSubtotal"),t=elt("cartShipping");e&&(e.innerHTML=n.NO_AMT),t&&(t.innerHTML=n.NO_AMT),n.hide_timeout_id=null},e?t():this.hide_timeout_id=setTimeout(t,500),this.summary_hidden=!0},clear_summary:function(e){let t;t={},t.currency=ClientPrefs.currency,t.currency_prefix="",t.has_shipping=e,t.disp_subtotal=this.NO_AMT,t.disp_shipping=this.NO_AMT,t.country=ClientPrefs.country,t.country_name=ClientPrefs.country_name,t.us_state=ClientPrefs.us_state,t.us_zip=ClientPrefs.us_zip,t.disp_total=this.NO_AMT,t.has_tax=!1,t.contains=this.contains,t.header_rework_2018=this.cfgFlags.header_rework_2018,this.renderSidecartSummary(t)},update_summary:function(){let e,t,n;this.hide_timeout_id&&(clearTimeout(this.hide_timeout_id),this.hide_timeout_id=null),this.summary_hidden=!1,0===this.cart_items.length||ClientPrefsObservable.zipIsInvalid()||(this.country_pref.hide(),t=CurrencyData.info[ClientPrefs.currency],e={},e.currency=ClientPrefs.currency,n=this.subtotal,e.has_shipping=this.has_shipping,this.has_shipping&&(e.disp_shipping=TextFormat.currency(this.shipping,t,!0,!0,!0),n+=this.shipping,e.country=ClientPrefs.country,e.country_name=ClientPrefs.country_name,e.us_state=ClientPrefs.us_state,e.us_zip=ClientPrefs.us_zip),e.has_tax=this.has_tax,this.has_tax&&this.tax>0&&(e.disp_tax=TextFormat.currency(this.tax,t,!0,!0,!0),n+=this.tax),e.disp_subtotal=TextFormat.currency(this.subtotal,t,!0,!0,!0),e.disp_total=TextFormat.currency(n,t,!0,!0,!0),"RUP"==ClientPrefs.currency&&n>99&&(e.disp_total="99"),e.media_mode=MediaView.mode,e.currency_prefix=t.prefix,e.contains=this.contains,e.header_rework_2018=this.cfgFlags.header_rework_2018,e.saved_card=this.saved_card,this.renderSidecartSummary(e))},renderSidecartSummary:function(e){this.summary_el.innerHTML=Templ.render("cart/sidecart_summary",e),this.addListenerForChangePaymentMethod()},addListenerForChangePaymentMethod:function(){const e=this.summary_el.querySelector("a.switcher");null==e||e.addEventListener("click",(function(e){e.preventDefault(),window.ChangePaymentMethodPanel.show()}))},update_cart_contains:function(){this.contains={physical_gift:!1};for(let e=0;e<this.cart_items.length;e++)this.cart_items[e].is_gift&&"p"==this.cart_items[e].item_type&&(this.contains.physical_gift=!0)},update_packages:function(e){if(!window.TralbumData||!TralbumData.packages)return;const t=this;let n=!1;Iter.each(TralbumData.packages,(function(e){const i=Iter.find(t.cart_items,(function(t){return"p"===t.item_type&&t.item_id===e.id}));i?(n=!0,e.cart_quantity=i.quantity):e.cart_quantity=null})),(n||e)&&"Merch"in window&&Merch.updateInventory&&Merch.updateInventory(!0)},show_country_pref:function(e){const t=e.target||e.srcElement;e.preventDefault(),this.country_pref.show(t,!1)},oncountry_change:function(e){this.cart_items.length>0&&(this.hide_summary(!1),this.request({req:"country",country:e.country,us_zip:e.us_zip}))},resp_country:function(e){this.snarf_cart_summary(e,!0)},resp_update:function(e){this.needs_resync(e)||this.snarf_cart_summary(e,!0),this.maybe_checkout(e.req_id),this.update_packages()},checkout_wait:function(){PleaseWaitPanel.show()},isCardable:function(e){let t,n,i,a,o,s;return t=!!Iter.find(this.PAYFLOW_CURRENCIES,(function(t){return t===e.currency})),n=!!e.package||"p"===e.item_type,i=e.is_live_ticket,a=!!e.certified_seller,o=n?e.limited_checkout:U.pagedataBlob().limited_checkout,s=(a||!n||i)&&t&&!o,s},hasCardableItems:function(e){const t=this;if(e)return!0;return null!=Iter.find(this.cart_items,(function(e){return t.isCardable(e)}))},hasNonUsdCardableItems:function(){const e=this;return!!Iter.find(this.cart_items,(function(t){return e.isCardable(t)&&"USD"!=t.currency}))},paymentTypeDialogAllowed:function(){return(void 0===this.payment_pref||this.payment_pref!=this.PAYMENTTYPE_PAYPAL&&this.payment_pref!=this.PAYMENTTYPE_CREDITCARD)&&!!this.hasCardableItems()},cancelCheckout:function(){this.checking_out=!1},showPaymentTypeDialog:function(e){const t=this.paymentTypeDialogAllowed(),n=this;return t&&"dialog"!==e&&(this.payment_type_panel.from(e),this.payment_type_panel.show({close:function(){n.cancelCheckout(),$(this).remove()}})),t},maybe_checkout:function(e){if(this.checkout_after&&this.checkout_after==e)if(this.checkout_callback){const e=this.checkout_callback;this.checkout_callback=null,e()}else this.checkout(null,"dialog")},checkout:function(e,t){if(e&&e.preventDefault(),!this.gift_balance&&this.showPaymentTypeDialog(t))return;let n;this.checkout_wait(e);try{const e=window.TralbumData&&TralbumData.url||location.href,i=this.getCheckoutParams(t,e);n=TemplGlobals.siteroot_https+"/cart/checkout_start?"+Url.joinQuery(i)}catch(e){throw new Error("stuck on Please Wait: "+e.message)}window.top.location.href=n},getCheckoutParams:function(e,t){const n={client_id:ClientID,from:e,return_url:t,local_timezone:Time.get_local_timezone()};return window.MediaView&&"phone"==MediaView.mode&&(n.mob="1"),!0===this.payment_pref_changed&&(n.payment_pref=this.payment_pref),void 0!==this.payment_pref_override&&(n.payment_pref_override=this.payment_pref_override,this.payment_pref_override=void 0),n},wiggle:function(){$("#sidecart").addClass("wiggle"),setTimeout((function(){$("#sidecart").removeClass("wiggle")}),650)},toggle_cart_phone:function(){this.cart_ui.toggle_cart_phone()},show_cart_phone:function(){this.cart_ui.show_cart_phone()},zzz:null}}();var CartItem={make:function(e,t,n){return Object.create(CartItem).init(e,t,n)},init:function(e,t,n){return this.cart=e,this.id=t.id,this.item_type=t.item_type,this.item_id=t.item_id,this.item_title=t.item_title,this.item_title2=t.item_title2,this.releases=t.releases,this.band_id=t.band_id,this.artist_name=this.band_name=t.artist_name,this.unit_price=t.unit_price,this.currency=t.currency,this.quantity=t.quantity,this.option_id=t.option_id,this.option_name=t.option_name,this.discount_id=t.discount_id,this.discount_type=t.discount_type,this.url=t.url,this.art_id=t.art_id,this.image_id=t.image_id,this.is_gift=t.is_gift,this.is_live_ticket=t.is_live_ticket,this.gift_recipient_email=t.gift_recipient_email,this.shipping_street=t.shipping_street,this.shipping_street_2=t.shipping_street_2,this.shipping_city=t.shipping_city,this.shipping_state=t.shipping_state,this.shipping_zip=t.shipping_zip,this.shipping_country_code=t.shipping_country_code,this.purchase_note=t.purchase_note,this.notify_me=t.notify_me,this.notify_me_label=t.notify_me_label,this.certified_seller=t.certified_seller,this.limited_checkout=t.limited_checkout,this.license_id=t.license_id,this.ko_num_cart_items=ko.observable(0),n?(this.el=elt("sidecart_item_"+this.id),this.local_id=""+Math.random(),this.add_handlers()):(this.local_id=t.local_id,this.render()),this},kill:function(){this.anim&&this.anim.stop(!1),this.animc&&this.animc.stop(!1)},render:function(){this.el=document.createElement("div"),$(this.el).addClass("item"),this.update()},update:function(){this.disp_price=TextFormat.currency(this.unit_price*this.quantity,CurrencyData.info[this.currency],!1,!0,!1);const e=window.MediaView?MediaView.mode:null;this.el.innerHTML=Templ.render("cart/sidecart_item",{item:this,media_mode:e}),this.add_handlers()},add_handlers:function(){var e;$("a.delete",this.el).click((e=this,function(t){e.delete_click(t)}))},delete_click:function(e){e.preventDefault(),this.cart.delete_from_cart(this)},animate:function(e,t,n){n?e?$("div.cartItemReveal",this.el).slideDown("fast",t):$("div.cartItemReveal",this.el).animate({opacity:"hide",height:"hide"},"fast",t):(e&&$("div.cartItemReveal",this.el).height("auto"),t&&t())},zzz:null},ClientPrefsObservable=new function(){const e=this;return e.country=ko.observable(),e.countryName=ko.observable(),e.currency=ko.observable(),e.usState=ko.observable(),e.usZip=ko.observable(),e.zipIsInvalid=ko.observable(),e.isDefault=ko.observable(),e.paymentType=ko.observable(),e.isEU=function(){return void 0!==window.Geo&&Geo.isEUCountry(e.country())},e.update=function(t){e.country(t.country),e.countryName(t.country_name),e.currency(t.currency),e.usState(t.us_state),e.usZip(t.us_zip),e.paymentType(t.payment_type),e.isDefault(t.is_default)},e},ClientPrefs={country:null,country_name:null,currency:null,us_state:null,us_zip:null,payment_type:null,update:function(e){ClientPrefs.country=e.country,ClientPrefs.country_name=e.country_name,ClientPrefs.currency=e.currency,ClientPrefs.us_state=e.us_state,ClientPrefs.us_zip=e.us_zip,ClientPrefs.payment_type=e.payment_type,ClientPrefs.is_default=e.is_default,ClientPrefsObservable.update(e)},zzz:null},CountryPrefPanel={make:function(e){const t=window.MediaView&&"phone"==MediaView.mode?CountryPrefPanelPhone:CountryPrefPanel;return Object.create(t).init(e)},init:function(e){return this.onchange_func=e,this.dlg=null,this},show:function(e,t){const n=this;let i;i=this.optionHTML(),this.dlg=NuDialog.showTemplate("cart/country_pref",{options:i},{width:"auto",minHeight:0,modal:!0,closeOnEscape:!0,draggable:!1,buttons:[],dialogClass:"no-title no-padding no-border-radius no-bg"});const a=new CountryPrefVM(this,"#country-pref-vm");ko.applyBindings(a,this.dlg[0]),this.dlg.dialog("widget").next(".ui-widget-overlay").addClass("no-overlay").click((function(e){e.preventDefault(),n.hide()})),$("a.country_pref_close",this.dlg).click((function(e){e.preventDefault(),n.hide()})),this.select_el=$(".country_pref_select",this.dlg)[0],$(".country_pref_select",this.dlg).change($.proxy(this.onchange,this)),this.zip_el=$(".country_pref_zip",this.dlg)[0],$(".country_pref_zip",this.dlg).textInput((function(){$(".us-zip-done",this.dlg).toggleClass("disabled",!n.zipIsValid(this.value))})).on("keypress",(function(e){return 13===e.which&&n.onchange(e),!(e.which>=32&&e.which<=47||e.which>57&&e.which<127)}))[0],$(".us-zip-done").click((function(e){return n.onchange(e),!1})),this.dlg.on("dialogclose",(function(){n.dlg=null})),this.selectOption();const o=$(".country_pref_pointer",this.dlg);void 0!==t&&t?(o.css("float","left"),o.css("margin-left","10px"),this.dlg.dialog("option","position",{my:"left top",at:"left bottom",of:e})):(o.css("float","right"),o.css("margin-right","10px"),this.dlg.dialog("option","position",{my:"right top",at:"right bottom",of:e})),Dom.focus(this.select_el)},hide:function(){this.dlg&&(this.dlg.dialog("widget").next(".ui-widget-overlay").removeClass("no-overlay"),this.dlg.dialog("close"))},onclose:function(e){return this.hide(),!1},onchange:function(e){let t,n,i;if(t=this.select_el.value,"US"===t){if(e.target===this.select_el)return void $(".us-zip",this.dlg).slideToggleBool(!0,"fast",(function(){$(this).find(".country_pref_zip").focus()}));if(n=null,i=this.zip_el.value,!this.zipIsValid(i))return void Log.warn("Invalid zip",i)}else n=null,i=null;if(t!=ClientPrefs.country||i!=ClientPrefs.us_zip){const e={};e.country=t,e.us_state=n,e.us_zip=i,CurrencyCodes[t]&&(e.country_name=CountryList.getCountryName(t),e.currency=CurrencyCodes[t]),ClientPrefs.update(e),this.onchange_func&&this.onchange_func(e)}return!1},zipIsValid:function(e){return/^\d{5}$/.test(e)},optionHTML:function(){const e=[];return CountryList.getCountryList().forEach((function(t){const n=t.disabled?"disabled style='color: grey'":"";e.push('<option value="',t.code,'"',n,">",t.name,"</option>")})),e.join("")},selectOption:function(){$(this.select_el).find('option[value="'+ClientPrefs.country+'"]').prop("selected",!0),$(this.dlg).find(".us-zip").toggle("US"===ClientPrefs.country).find(".country_pref_zip").val(ClientPrefs.us_zip).end().find(".us-zip-done").toggleClass("disabled",!this.zipIsValid(ClientPrefs.us_zip))},zzz:null},CountryPrefPanelPhone={init:function(e){return this.onchange_func=e,this.dlg=null,this},show:function(){const e=this;let t=[].concat('<select class="country_pref_select">',this.optionHTML(),"</select>").join("");t+='<div class="us-zip" id="country-pref-vm"><label>'+TM("Zip:")+' <input type="text" size="5" maxlength="5" pattern="[0-9]*" data-bind="style: { border: zipIsInvalid ? \'1px solid red\' : \'1px solid #ccc\' }"/></label><span data-bind="visible: zipIsInvalid" style=\'color: red\'>Please enter a valid zip.</span></div>',this.dlg=NuDialog.alertHTML(TM("Choose your country"),t,{width:"auto",minHeight:0,modal:!0,closeOnEscape:!0,draggable:!1,buttons:[{id:"country-pref-ok",text:TM("OK"),click:function(t){return e.handleUpdate(t),!1}}]}),this.selectOption(),Dom.focus(this.getSelect());const n=new CountryPrefVM(this,"#country-pref-vm");ko.applyBindings(n,this.dlg[0]),$(".country_pref_select",this.dlg).change((function(){const t="US"===$(this).val();$(this).siblings(".us-zip").slideToggleBool(t,"fast",(function(){$(this).find("input").focus()})),e.updateDoneButtonState()})),$(".us-zip input",this.dlg).textInput((function(){e.updateDoneButtonState()})),this.dlg.on("dialogclose",(function(){e.dlg=null}))},hide:function(){this.dlg&&this.dlg.dialog("close")},updateDoneButtonState:function(){const e="US"===$(".country_pref_select",this.dlg).val(),t=$(".us-zip input",this.dlg).val(),n=e&&!CountryPrefPanel.zipIsValid(t);$("#country-pref-ok").prop("disabled",n)},handleUpdate:function(){const e=this.getSelect().val();let t,n;if("US"===e?(t=null,n=$(".us-zip input",this.dlg).val()):(t=null,n=null),e!=ClientPrefs.country||n!=ClientPrefs.us_zip){const i={};i.country=e,i.us_state=t,i.us_zip=n,CurrencyCodes[e]&&(i.country_name=CountryList.getCountryName(e),i.currency=CurrencyCodes[e]),ClientPrefs.update(i),this.onchange_func&&this.onchange_func(i)}},optionHTML:function(){const e=[];return CountryList.getCountryList().forEach((function(t){const n=t.disabled?"disabled style='color: grey'":"";e.push(' \n<option value="',t.code,'"',n,">",t.name,"</option>")})),e},getSelect:function(){return $(".country_pref_select",this.dlg)},selectOption:function(){this.getSelect().find('option[value="'+ClientPrefs.country+'"]').prop("selected",!0),$(".us-zip",this.dlg).toggle("US"===ClientPrefs.country).find("input").val(ClientPrefs.us_zip)},zzz:null},CountryPrefVM=function(e,t){"use strict";return function(e,n){this.zipIsInvalid=t.computed(ClientPrefsObservable.zipIsInvalid)}}(jQuery,ko),PleaseWaitPanel={show:function(e){if(PleaseWaitPanel.panel)return;if(window.MediaView&&"phone"==MediaView.mode)return void PleaseWaitPanel.showPhone();if(void 0===e||e)return void(PleaseWaitPanel.timeout_id=setTimeout((function(){PleaseWaitPanel.show(!1)}),500));PleaseWaitPanel.timeout_id&&(clearTimeout(PleaseWaitPanel.timeout_id),PleaseWaitPanel.timeout_id=null);const t=["<p style='text-align: center; color: #777; font-size: 20px; margin: 0; padding: 1.5em 4.5em; line-height: 1.0'>",TM("Please wait..."),"</p>"];NuDialog.alertHTML(null,t.join(""),{dialogClass:"no-title no-padding no-border-radius",buttons:[],width:"auto",open:function(){const e=$(this);e.css({minHeight:"auto",border:"1px solid black"}).dialog("widget").next(".ui-widget-overlay").css("opacity","0.3"),$(window).resize((function(t){e.dialog("option","position","center")}))}})},showPhone:function(){PleaseWaitPanel.panel=BubbleMessage(TM("Please wait..."),18e4),$(document.body).addClass("nouveau-masked").append('<div class="nouveau-mask">')},zzz:null},CountryOrder={preferred:["US","CA","GB","AU","FR","DE","JP"],general:["AF","AX","AL","DZ","AS","AD","AO","AI","AQ","AG","AR","AM","AW","AC","AU","AT","AZ","BS","BH","BD","BB","BY","BE","BZ","BJ","BM","BT","BO","BA","BW","BV","BR","IO","BN","BG","BF","BI","KH","CM","CA","CV","BQ","KY","CF","TD","CL","CN","CX","CC","CO","KM","CG","CD","CK","CR","CI","HR","CU","CW","CY","CZ","DK","DJ","DM","DO","EC","EG","SV","GQ","ER","EE","ET","FK","FO","FJ","FI","FR","GF","PF","TF","GA","GM","GE","DE","GH","GI","GR","GL","GD","GP","GU","GT","GG","GN","GW","GY","HT","HM","HN","HK","HU","HY","IS","IN","ID","IR","IQ","IE","IM","IL","IT","JM","JP","JE","JO","KZ","KE","KI","XK","KW","KG","LA","LV","LB","LS","LR","LY","LI","LT","LU","MO","MK","MG","MW","MY","MV","ML","MT","MH","MQ","MR","MU","YT","MX","FM","UM","MD","MC","MN","ME","MS","MA","MZ","MM","NA","NR","NP","NL","AN","NC","NZ","NI","NE","NG","NU","NF","KP","MP","NO","OM","PK","PW","PS","PA","PG","PY","PE","PH","PN","PL","PT","PR","QA","RE","RO","RU","RW","BL","SH","KN","LC","MF","PM","VC","WS","SM","ST","SA","SN","RS","SC","SL","SG","SX","SK","SI","SB","SO","ZA","GS","KR","SS","ES","LK","SD","SR","SJ","SZ","SE","CH","SY","TW","TJ","TZ","TH","TL","TG","TK","TO","TT","TA","TN","TR","TM","TC","TV","UG","UA","AE","GB","US","UY","UZ","VU","VA","VE","VN","VG","VI","WF","EH","YE","ZM","ZW"]},CountryNames={UZ:"Uzbekistan",SE:"Sweden",CX:"Christmas Island",PG:"Papua New Guinea",LR:"Liberia",AC:"Ascension",IT:"Italy",VC:"Saint Vincent and the Grenadines",FK:"Falkland Islands (Islas Malvinas)",CM:"Cameroon",ZW:"Zimbabwe",BY:"Belarus",HU:"Hungary",KH:"Cambodia",BN:"Brunei",NF:"Norfolk Island",AZ:"Azerbaijan",MR:"Mauritania",ZA:"South Africa",PS:"Palestine",DM:"Dominica",AO:"Angola",MG:"Madagascar",CY:"Cyprus",PH:"Philippines",LS:"Lesotho",AD:"Andorra",CN:"China",NR:"Nauru",CC:"Cocos (Keeling) Islands",BZ:"Belize",ZM:"Zambia",HK:"Hong Kong",BO:"Bolivia",NG:"Nigeria",KI:"Kiribati",BD:"Bangladesh",GW:"Guinea-Bissau",TF:"French Southern Territories",MS:"Montserrat",GL:"Greenland",PT:"Portugal",MH:"Marshall Islands",SR:"Suriname",VE:"Venezuela",AE:"United Arab Emirates",SG:"Singapore",GA:"Gabon",CZ:"Czech Republic",LT:"Lithuania",FM:"Micronesia",CO:"Colombia",LI:"Liechtenstein",RS:"Serbia",CD:"Congo (Kinshasa)",TR:"Turkey",TG:"Togo",DZ:"Algeria",EC:"Ecuador",MT:"Malta",BE:"Belgium",AQ:"Antarctica",SS:"South Sudan",GM:"Gambia",DO:"Dominican Republic",GB:"United Kingdom",SH:"Saint Helena",LU:"Luxembourg",AF:"Afghanistan",IL:"Israel",UG:"Uganda",HM:"Heard Island and McDonald Islands",BQ:"Caribbean Netherlands",NI:"Nicaragua",WF:"Wallis and Futuna",TH:"Thailand",MU:"Mauritius",BF:"Burkina Faso",GY:"Guyana",ST:"Sao Tome and Principe",GN:"Guinea",AR:"Argentina",YE:"Yemen",VG:"Virgin Islands, British",PK:"Pakistan",DE:"Germany",LV:"Latvia",AG:"Antigua and Barbuda",SI:"Slovenia",US:"United States",IM:"Isle of Man",RU:"Russia",FO:"Faroe Islands",LK:"Sri Lanka",NU:"Niue",CF:"Central African Republic",KW:"Kuwait",HY:"Hyrule",TT:"Trinidad and Tobago",HN:"Honduras",BR:"Brazil",MV:"Maldives",BG:"Bulgaria",EE:"Estonia",PW:"Palau",AS:"American Samoa",MK:"Macedonia",JM:"Jamaica",SJ:"Svalbard and Jan Mayen",GD:"Grenada",PL:"Poland",CR:"Costa Rica",PA:"Panama",IN:"India",LA:"Laos",CG:"Congo (Brazzaville)",BS:"Bahamas",WS:"Samoa",KM:"Comoros",TJ:"Tajikistan",MW:"Malawi",BH:"Bahrain",QA:"Qatar",AT:"Austria",ML:"Mali",SV:"El Salvador",GP:"Guadeloupe",VI:"Virgin Islands, U.S.",SK:"Slovakia",GE:"Georgia",PM:"Saint Pierre and Miquelon",AI:"Anguilla",MA:"Morocco",IO:"British Indian Ocean Territory",RW:"Rwanda",ID:"Indonesia",CH:"Switzerland",KY:"Cayman Islands",LB:"Lebanon",TV:"Tuvalu",KN:"Saint Kitts and Nevis",ER:"Eritrea",BT:"Bhutan",NL:"Netherlands",TK:"Tokelau",EG:"Egypt",MX:"Mexico",BI:"Burundi",NA:"Namibia",VU:"Vanuatu",JO:"Jordan",GQ:"Equatorial Guinea",PY:"Paraguay",AU:"Australia",MM:"Myanmar",PN:"Pitcairn Islands",LY:"Libya",SL:"Sierra Leone",GF:"French Guiana",FR:"France",SA:"Saudi Arabia",CI:"Cote d'Ivoire (Ivory Coast)",KZ:"Kazakhstan",LC:"Saint Lucia",IE:"Ireland",TW:"Taiwan",ES:"Spain",EH:"Western Sahara",TL:"Timor-Leste",MY:"Malaysia",BJ:"Benin",TA:"Tristan da Cunha",GR:"Greece",YT:"Mayotte",MN:"Mongolia",JP:"Japan",SX:"Sint Maarten",MC:"Monaco",JE:"Jersey",SM:"San Marino",GG:"Guernsey",SB:"Solomon Islands",CU:"Cuba",OM:"Oman",IQ:"Iraq",UA:"Ukraine",ET:"Ethiopia",BV:"Bouvet Island",KP:"North Korea",HR:"Croatia",TM:"Turkmenistan",KE:"Kenya",MZ:"Mozambique",NC:"New Caledonia",AW:"Aruba",MO:"Macau",SY:"Syria",GS:"South Georgia and the South Sandwich Islands",SN:"Senegal",GH:"Ghana",DJ:"Djibouti",AL:"Albania",MD:"Moldova",VA:"Vatican City",PE:"Peru",IR:"Iran",SC:"Seychelles",CV:"Cape Verde",RO:"Romania",FI:"Finland",NZ:"New Zealand",CK:"Cook Islands",XK:"Kosovo",UM:"Midway Islands",BW:"Botswana",NO:"Norway",TN:"Tunisia",BL:"Saint BarthÃ©lemy",TC:"Turks and Caicos Islands",BA:"Bosnia and Herzegovina",SZ:"Swaziland",GT:"Guatemala",AX:"Aland",MP:"Northern Mariana Islands",GI:"Gibraltar",DK:"Denmark",AM:"Armenia",ME:"Montenegro",SO:"Somalia",UY:"Uruguay",IS:"Iceland",SD:"Sudan",CW:"CuraÃ§ao",PF:"French Polynesia",CL:"Chile",FJ:"Fiji",TZ:"Tanzania",HT:"Haiti",RE:"Reunion",NP:"Nepal",CA:"Canada",KR:"South Korea",TO:"Tonga",BM:"Bermuda",NE:"Niger",KG:"Kyrgyzstan",GU:"Guam",TD:"Chad",MQ:"Martinique",BB:"Barbados",VN:"Viet Nam",AN:"Netherlands Antilles",MF:"Saint Martin",PR:"Puerto Rico"};if(void 0!==CountryList)Log.server("CountryList initialized more than once","warn");else var CountryList=function(){"use strict";const e={getCountryList:t,getCountryName:function(e){if(void 0===typeof e)return Log.server("getCountryName called with no country code","warn"),"Unknown country";const t=CountryNames[e];if(void 0===t)return Log.server("country with no name: "+e,"warn"),"Unknown country";return t},allCountries:function(){if("undefined"==typeof ko)return Log.server("initializing country list before knockout loaded","error"),null;return ko.observableArray(t())},disableSeparators:function(){if("undefined"==typeof ko)return Log.server("initializing country list before knockout loaded","error"),null;return function(e,t){t&&ko.applyBindingsToNode(e,{disable:"disabled"in t&&t.disabled,style:{color:"disabled"in t&&t.disabled?"#bbb":"inherit"}},t)}}};return"Pseudoloc"in window&&$(document).ready((function(){const e=$("#pagedata").data("blob"),t=e&&e.locale||null;t&&"qq"==t&&Object.keys(CountryNames).forEach((function(e){CountryNames[e]=Pseudoloc.str(CountryNames[e])}))})),e;function t(e,t,n){void 0!==e&&e||(e=[],Array.prototype.push.apply(e,CountryOrder.general)),void 0!==t&&t||(t=[]);const i={};t.forEach((function(e){e&&(i[e]=!0)})),void 0!==n&&n||(n=[],Array.prototype.push.apply(n,CountryOrder.preferred));const a={};e.forEach((function(e){const t=CountryNames[e];a[e]={code:e,name:t}}));const o={};n.length>0&&n.forEach((function(e){const t=a[e];o[e]=t}));const s=[];function r(e){const t=a[e];t&&!(e in i)&&s.push(t)}return n.length>0&&n.forEach(r),s.length>0&&s.push({code:"--",name:"---",disabled:!0}),e.forEach((function(e){r(e)})),s}}();var DownloadPanelVM=function(e,t){"use strict";return function(a,o,s){const r=this;this._init=a,this._parent=o,this.panel=e(s),this.panes={discount:new n(o,a),pricing:new i(o,a)},this.isCardable=t.observable(a.download_info.is_cardable),this.savedCard=t.observable(Sidecart.saved_card),this.giftCardBalance=t.observable(a.gift_card_balance),this.checkout=function(){o.checkout()},this.addToCart=function(){o.checkout("cart")},this.checkoutWithCard=function(){Sidecart.payment_pref_changed=!0,Sidecart.payment_pref="c",o.checkout()},this.switchDefaultPaymentMethod=function(){o.checkout("payment_method")},this.cartMode=t.pureComputed((function(){return r.giftCardBalance()?"neutral":Sidecart.payment_pref==Sidecart.PAYMENTTYPE_PAYPAL?"paypal":Sidecart.payment_pref==Sidecart.PAYMENTTYPE_CREDITCARD?"creditcard":Sidecart.hasCardableItems(r.isCardable())?"neutral":"classic"})),this.isPaypal=t.pureComputed((function(){return"paypal"===r.cartMode()})),this.isClassic=t.pureComputed((function(){return"classic"===r.cartMode()})),this.isCreditCard=t.pureComputed((function(){return"creditcard"===r.cartMode()})),this.isNeutral=t.pureComputed((function(){return"neutral"===r.cartMode()})),this.isNotClassic=t.pureComputed((function(){return!r.isClassic()})),this.viewPackageOptions=function(){const e="track"==TralbumData.current.type?TralbumData.album_url:null;e?window.top.location.href=e:this._parent._dlg.dialog("close")},this.submit=function(){const t=TM("Thanks, an email has been sent to {{email}} with your download instructions.",{email:Text.escapeHtml(ChargeEmail._address)}),n=TM("Oops. Something unexpected happened and your email was not sent. Sorry for the inconvenience. Please try again. If the problem persists, contact support@bandcamp.com."),i=e("#fan_email").serialize(),a=r.panel.closest(".ui-dialog-content"),o=(new Date).getTime();e.post("/email_download",i).done((function(i){if(Trackpipe.showXHRError(i))return;const a=function(){i.ok?(e("#download-panel-busy").hide(),e("#download-panel-complete").show().find(".msg").html(t)):(i.errors&&Log.debug("response.errors",i.errors),e("#download-panel-busy").hide(),e("#download-panel-complete").show().find(".msg").html(n))},s=(new Date).getTime()-o;if(s<800){setTimeout(a,800-s)}else a()})).fail((function(){NuDialog.alert(TM("Network Error"),TM("There was a network error. Please try again."))}));e(".below-pricing").addClass("fade-out"),setTimeout((function(){e("#fan_email").hide(),e("#download-panel-busy").show(),window.MediaView&&"phone"==MediaView.mode&&a.dialog("option","position","center")}),200)},r.countryList=CountryList.allCountries(),r.setOptionDisable=CountryList.disableSeparators()};function n(n,i){const a=this,o=n,s=i.download_info.unitId,r=i.download_info.has_discounts,l=!(!i.download_info.has_discounts&&!i.download_info.subscriberDiscount||i.download_info.freeDownload&&!i.download_info.paidDownload);let c="",d=null;const p=i.download_info.basePrice;let u=null,m=null,_=null;const h=t.observable(null),f=t.observable("editing");l&&h(f());const b=!!i.download_info.subscriberDiscount,g=t.observable(i.download_info.subscriberDiscount),y=t.observable(!1),v=t.observable(""),k=t.computed((function(){return e.trim(v()).toLowerCase()})),w=t.observable(""),T=t.observable(null),x=t.computed((function(){return T()&&"verified"==h()})),C=t.observable(null),P=t.observable(i.download_info.subscriberDiscount),D=t.computed((function(){return P()?P().percent:""})),M=t.computed((function(){return P()||null}));function S(){setTimeout((function(){Log.debug("discount: committing editor"),w(k()),E()}),100)}function E(){if(Log.debug("checkDiscount: start"),!l)return void Log.debug("checkDiscount returning, not enabled");if("verifying"==h())return void Log.debug("checkDiscount returning, already verifying");const t=w();if(""===t)return Log.debug("checkDiscount: empty code"),B(M(),null,!1),"editing"!=f()&&V(),h(f()),b&&g(!0),T(null),C(null),void $();if(t==c)return Log.debug("checkDiscount: code is already verified: ",t),void(t?(V(),h("verified")):h("editing"));if(I(t))return Log.debug("checkDiscount returning, download code detected"),B(M(),null,!1),T(null),void C("/yum?code="+encodeURIComponent(t));const i="package"==TralbumData.current.type?TralbumData.current.associated_license_id||void 0:TralbumData.current.licensed_item_id||void 0,a={item:s,code:t,associated_license_id:i,country_code:Identities.ip_country_code};T(null),C(null),V(),h("verifying"),d=e.post("/lookup_discount_cb",a,null,"json").success((function(i){Log.debug("discount: XHR succeeded for code: ",t,", response: ",i),h("verified"),d=null,i.ok?P()&&P().price<i.price?function(){g(!0),T(null),w(""),v(""),B(P(),null,!0);const e=TM("Best discount"),t=TM("We noticed that your subscriber discount results in a lower price than your code, so weâ€™ve applied the subscriber discount instead."),n={position:{my:"center",at:"center",of:o._dlg.element}};NuDialog.alert(e,t,n),$()}():(B(i,t,!0),T(null),i.pinned?function(t){t=TextFormat.currency(t,n._currency);const i=e.Deferred(),a=TM("The discounted price is below the minimum we can process, so it was adjusted to {{amount}}.",{amount:t});return NuDialog.alertHTML(TM("Discount code"),a,{close:function(){i.resolve()}}),i}(i.price).then($):$()):(B(M(),t,!1),T(TM("Sorry, that discount code is invalid or expired.")),$())})).error((function(e,n){"abort"!=n?(Log.error("discount: XHR failed for code: "+t),h("verified"),T(TM("Sorry, there was an unexpected error. Please try again.")),d=null,B(M(),null,!1),$()):Log.debug("discount: XHR aborted by user")}))}function I(e){return 0===e.search(/^[a-z0-9]{4,5}\-[a-z0-9]{4,5}$/)}function $(){"phone"==MediaView.mode&&Dom.scrollToElement(o._dlg.dialog("widget"),0,!0)}function B(t,i,a){let s=p,r=(t=t||{}).price||null;const l=t.discount_id||null,d=t.discount_type||null;null!==r&&(r!=s?s=r:r=null),u=r,m=l,_=d,c=i||"";let h=e("#orderQuantity")[0];h=h?parseInt(h.value):null,(null===h||isNaN(h))&&(h=1);const f=e(".nyp-summary-price");if(f.length){let t=f.nextAll(".nyp-summary-discounted-price");if(null===r)f.removeClass("disabled"),t.remove();else if(f.addClass("disabled"),t.length||(t=e('<span class="nyp-summary-discounted-price"></span>').insertAfter(f)),t.html(" "+TextFormat.currency(s,n._currency,!1,!1,!0)),a){const t=Form.validate.parsePrice(e("#userPrice").val()),n=e("#userPrice");t&&t<=p&&t>=s?n.val(s):(o._pricingVM.numeric_price(null),o._pricingVM.clearValidation(),n.val("").focus())}o.updateCurrencyDisplay()}else{const t=TextFormat.currency(h*s,n._currency,!0);if(null===r)e("#normal-price-wrapper").toggle(!1),Dom.setText("userPrice",t);else{const i=TextFormat.currency(h*p,n._currency,!0);Dom.setText("normal-price",i),e("#normal-price-wrapper").toggle(!0),Dom.setText("userPrice",t)}}}function A(e){e||"editing"!=h()||S()}function L(e){if(13==e.which)return Log.debug("discount: apply code (Enter)"),S(),!1}function V(){y()&&(Log.debug("discount: blurring editor for mobile safari's sake"),N&&N.dispose(),y(!1),F())}let N=null;function F(){N=y.subscribe(A)}return a.enabled=l,a.hasDiscountCodes=r,a.state=h,a.subscriberDiscountVisible=g,a.entryFocused=y,a.rawEntryText=v,a.codeEntry=w,a.verifyError=T,a.showVerifyError=x,a.yumURL=C,a.subscriberDiscount=P,a.subscriberDiscountPercent=D,a.checkDiscount=E,a.looksLikeDownloadCode=I,a.discountVerified=function(){if(!l)return!0;if("verifying"==h())return NuDialog.alert(TM("A little busy"),TM("We are checking your discount code. Please wait...")),!1;const e=k();return Log.debug("discountVerified: editor:",e,"checkedCode:",c),e==c},a.discountID=function(){return m},a.discountType=function(){return _},a.unitPrice=function(){return!l||null===u||isNaN(u)?p:u},a.basePrice=function(){return p},a.discountedPrice=function(){return u},a.handleEditCode=function(){Log.debug("discount: edit code"),d&&(d.abort(),d=null),h("editing"),e("#discountInput").select()},a.handleApplyCode=function(){return Log.debug("discount: apply code (click)"),!1},a.handleSwitchToCode=function(){g(!1),h("editing")},a.focusSwitchToCode=function(){"editing"!==h()||window.MediaView&&"phone"==MediaView.mode||y(!0)},l&&(e(".discount-section",o._dlg)[0]?(e("#discountInput",o._dlg).keydown(L),F()):Log.error("Missing expected discount code elements"),function(){const e=M();e&&setTimeout((function(){B(e,null,!1)}),0)}()),a}function i(n,i){const a=this,o=i.download_info.isSetPrice,s=(i.download_info.setPrice,i.download_info.minimumPrice),r=void 0!==i.download_info.package,l=i.is_will_call,c=(i.seller.digital_vat_enabled,i.buyer_country),d=CurrencyData.info[i.seller.currency];function p(e){if(void 0===e||isNaN(parseFloat(e)))return a.NOAMOUNT;const t=CurrencyData.info[ClientPrefsObservable.currency()],n=e*a.currencyRate();return TextFormat.currency(n,t,!1,!0,!0)}a.Sidecart=window.Sidecart,a.isSetPrice=t.observable(o),a.subTotal=t.observable(i.sub_total),a.userPrice=t.observable(null),a.unitPrice=t.observable(s),a.maxPrice=t.observable(i.seller.max_price),a.showAsTotal=t.observable(i.show_as_total),a.hasTax=t.observable(i.has_tax),a.shippingAndTax=t.observable(i.shipping_and_tax),a.taxSystem=t.observable(null),a.isGift=t.observable(i.is_gift),a.giftAddress=t.observable(),a.updating=t.observable(),a.buyerCountrySetToUSWithZip=t.computed((function(){return"US"===ClientPrefsObservable.country()&&ClientPrefsObservable.usZip()})),a.buyerCountrySet=t.computed((function(){return"US"!==ClientPrefsObservable.country()||a.buyerCountrySetToUSWithZip()})),a.differentCurrency=t.computed((function(){return ClientPrefsObservable.currency()!=i.seller.currency})),a.buyerIsEU=t.computed((function(){let e;return e=ClientPrefsObservable.isDefault()?c:ClientPrefsObservable.country(),Geo.isEUCountry(e)})),a.currencyRate=t.computed((function(){return a.differentCurrency()?CurrencyData.rates[i.seller.currency]/CurrencyData.rates[ClientPrefsObservable.currency()]:1})),a.isInitialNYP=t.computed((function(){return!a.isSetPrice()&&!a.userPrice()})),a.NOAMOUNT="&nbsp;-&nbsp;-&nbsp;",a.buyerCountryDisplay=t.computed((function(){if(a.updating())return a.NOAMOUNT;let e,t;if(a.giftAddress()){t=a.giftAddress();var n=CountryList.getCountryName(t.country);e=TextFormat.noOrphan(n),"US"===t.country&&t.usZip&&(e+=", "+t.usState+" "+t.usZip)}else{n=CountryList.getCountryName(ClientPrefsObservable.country());e=TextFormat.noOrphan(n),a.buyerCountrySetToUSWithZip()&&(e+=", "+ClientPrefsObservable.usState()+" "+ClientPrefsObservable.usZip())}return e})),a.buyerCurrencyDisplay=t.computed((function(){return ClientPrefsObservable.currency()})),a.subTotalDisplay=t.computed((function(){return p(a.subTotal())})),a.shippingDisplay=t.computed((function(){return a.updating()?a.NOAMOUNT:p(a.shippingAndTax())})),a.currencySummaryVisible=t.computed((function(){return r&&l||a.differentCurrency()||a.hasTax()})),a.shippingSummaryVisible=t.computed((function(){return r&&!l})),a.extrasVisible=t.computed((function(){return a.currencySummaryVisible()||a.shippingSummaryVisible()})),a.subTotalVisible=t.computed((function(){return a.differentCurrency()||r&&null!==a.userPrice()})),a.convertLinkVisible=t.computed((function(){return!a.extrasVisible()||!a.subTotalVisible()})),a.minPriceCurrency=t.computed((function(){const e=a.unitPrice();return void 0===e||isNaN(e)?null:TextFormat.currency(e,d,!1,!0,!1)})),a.absoluteMinCurrency=t.computed((function(){const e=n._absoluteMinPrice||0;return TextFormat.currency(e,d,!1,!0,!1)})),a.maxPriceCurrency=t.computed((function(){const e=a.maxPrice();return void 0===e||isNaN(e)?null:TextFormat.currency(e,d,!1,!0,!1)}));const u={currency:d,numericOnly:!0,informal:!0};a.display_price=t.observable(""),a.numeric_price=a.display_price.extend({price:u,errorKeys:{}}),a.validate_display_price=function(){a.display_price(a.numeric_price())},a.numeric_price.validate=function(o){const s=parseFloat(a.numeric_price()),r=t.utils.unwrapObservable(a.unitPrice()),l=t.utils.unwrapObservable(a.maxPrice());if(a.numeric_price.error_key(isNaN(s)?"nan":s<r?"tooLow":s>0&&s<n._absoluteMinPrice?"absoluteMin":s>l?"tooHigh":null),a.validate_display_price(),a.numeric_price.error_key())e("#userPrice").focus(),o.reject();else{const t=Math.round(100*s);let a=null;if(a=r>0?100*r*10:100*n._absoluteMinPrice*50,t>=a){Stats.record({kind:"click",click:"nyp_conf_dialog_shown"});const s=Math.round(t/a*10)/10;window.Analytics&&Analytics.callOurProperties("send","event","Checkout","nyp_conf_dialog_shown","NYP Confirmation Dialog Shown",s);const r=Money({amount:t,currency:d.symbol});let l=null,c=null;l=n._itemVM?n._itemVM:i.dialog_class_object._package?i.dialog_class_object._package:TralbumData.current,c="bundle"==l.type?TM("Pay {{amount}} for Full Digital Discography by {{band_name}} ({{num_releases}} releases)?",{amount:TextFormat.currency(r),band_name:i.seller.name,num_releases:l.tralbum_count}):TM("Pay {{amount}} for {{item_name}}?",{amount:TextFormat.currency(r),item_name:l.title}),NuDialog.alert(TM("Confirm Price"),c,{buttons:[{text:TM("Pay {{amount}}",{amount:TextFormat.currency(r)}),class:"nyp-dialog-confirm",click:function(){Stats.record({kind:"click",click:"nyp_conf_confirm_amt"}),e(this).dialog("close"),o.resolve()}},{text:TM("Change amount"),class:"secondary",click:function(){Stats.record({kind:"click",click:"nyp_conf_change_amt"}),e("#userPrice").focus(),e(this).dialog("close"),o.reject()}}],dialogClass:"nu-dialog center-title ui-dialog-2018",defaultFocus:function(){e("div.nu-dialog").focus()}})}else o.resolve()}},a.validate=function(){const n=e.Deferred();return t.eachObservable(a,(function(e,t,i){i.validate&&("numeric_price"==t?i.validate(n):i.validate())})),n.promise()},a.hasErrors=t.computed((function(){return!!t.eachObservable(a,(function(e,t,n){return n.error_key&&n.error_key()}))})),a.clearValidation=function(){t.eachObservable(a,(function(e,t,n){n.error_key&&n.error_key(null)}))},a.updateShippingSummary=function(e){a.subTotal(e.subTotal),a.hasTax(e.hasTax),a.shippingAndTax(e.shippingAndTax),a.showAsTotal(e.showAsTotal),a.taxSystem(e.taxSystem),e.giftCountry?a.giftAddress({country:e.giftCountry,countryName:e.giftCountryName,usState:e.giftUsState,usZip:e.giftUsZip}):a.giftAddress(null),a.updating(!1)},a.showCountryPref=function(e,t){i.dialog_class_object.show_country_pref(t)}}}(jQuery,ko),GiftPanelVM=function(e,t){"use strict";const n=this;this.panel=$(t),this.sender_name=ko.observable(e.sender_name||""),this.recipient_name=ko.observable(e.recipient_name||""),this.recipient_email=ko.observable(e.recipient_email||""),this.sender_note=ko.observable(e.sender_note||""),this.is_for_fan=e.is_for_fan,this.recipient_fan_id=e.recipient_fan_id,this.fixing_email=e.fixing_email,this.recipient_email_error=ko.observable(!1),this.submitEnabled=ko.computed((function(){return $.trim(n.sender_name()).length>0&&$.trim(n.recipient_name()).length>0&&(n.is_for_fan||$.trim(n.recipient_email()).length>0)})),this.focus=function(){n.fixing_email?$('input[name="gift-recipient-email"]',n.panel).focus():0===n.sender_name().length||n.is_for_fan?$('input[name="gift-sender-name"]',n.panel).focus():$('input[name="gift-recipient-name"]',n.panel).focus()};const i=$("form",this.panel)[0];ko.utils.registerEventHandler(i,"submit",(function(e){!0!==n.submit(i,e)&&(e.preventDefault?e.preventDefault():e.returnValue=!1)})),this.submit=function(e,t){const i=n.validate();return i&&(i.recipient_fan_id&&0===i.recipient_email.length?TralbumDownload._begin(t,i):TralbumDownload.beginGiftConfirmation(t,i)),!1},this.validate=function(){const e={sender_name:$.trim(n.sender_name()).substring(0,100),recipient_name:$.trim(n.recipient_name()).substring(0,100),recipient_email:$.trim(n.recipient_email()).substring(0,100),sender_note:n.sender_note().substring(0,1e3),recipient_fan_id:n.recipient_fan_id};return 0===e.recipient_email.length&&n.is_for_fan||/(^)([^\s\(\)"'\/><,@]+@\w([^\s\(\)"'\/><&,@]*\w)?\.\w[^\s\(\)"'\/><&,@]*\w)($)/.test(e.recipient_email)?e:(n.recipient_email_error(!0),n.focus_on_error("#gift-recipient-email"),null)},this.focus_on_error=function(e){if("phone"==(window.MediaView?MediaView.mode:null)){const t=$(e)[0];setTimeout((function(){$("html, body").animate({scrollTop:t.offset().top-5})}),10)}$("input",e).focus()},this.recipient_email.subscribe((function(){n.recipient_email_error()&&n.recipient_email_error(!1)})),this.pasteFixup=function(e){const t=/(.+)<(.+@.+)>/.exec(n[e]());if(t){const i=$.trim(t[1]),a=$.trim(t[2]);"recipient_name"==e?(n.recipient_name(i),n.recipient_email(a)):(0===n.recipient_name().length&&n.recipient_name(i),n.recipient_email(a))}},this.pasteNameEvent=function(e,t){return setTimeout((function(){n.pasteFixup("recipient_name")}),0),!0},this.pasteEmailEvent=function(e,t){return setTimeout((function(){n.pasteFixup("recipient_email")}),0),!0}},PaymentPref=function(){"use strict";return{setTitle:function(e){this._dlg.parent().find(".ui-dialog-title").text(e)},showChoosePaymentMethod:function(){const e=this;Sidecart.cancelCheckout(),ChangePaymentMethodPanel.lockDimensions(this._dlg),this._dlg.renderLiquid("cart/change_payment_method",{savedCard:Sidecart.saved_card}),setTimeout((function(){ChangePaymentMethodPanel.setupTransitions(e._dlg);const t=ChangePaymentMethodPanel.getDimensionsCSS();$.extend(t,ChangePaymentMethodPanel.getCenterDialogCSS()),e.setTitle(ChangePaymentMethodPanel.title()),ChangePaymentMethodPanel.setDialog(e._dlg),ChangePaymentMethodPanel.initVM(),e._dlg.parent().css(t),e._dlg.dialog({position:{my:"center center",at:"center center",of:window}})}),1),setTimeout((function(){ChangePaymentMethodPanel.dropTransitions(e._dlg)}),200)},showPaymentPref:function(){const e=this;Sidecart.cancelCheckout(),PaymentTypePanel.init((function(e){Sidecart.payment_pref=e,Sidecart.payment_pref_changed=!0})),PaymentTypePanel.lockDimensions(this._dlg),this._dlg.renderLiquid("cart/payment_pref",{non_usd_cardable_items:Sidecart.hasNonUsdCardableItems()}),setTimeout((function(){PaymentTypePanel.setupTransitions(e._dlg);const t=PaymentTypePanel.getDimensionsCSS();$.extend(t,PaymentTypePanel.getCenterDialogCSS()),e.setTitle(PaymentTypePanel.title()),PaymentTypePanel.setDialog(e._dlg),PaymentTypePanel.registerEvents(),e._dlg.parent().css(t),e._dlg.dialog({position:{my:"center center",at:"center center",of:window}})}),1)},zzz:null}}(),PurchaseNote=function(){"use strict";return{setupPurchaseNote:function(){const e=this;$("#purchase-note-link a").click((function(){return e.revealPurchaseNote(),!1})),$("#purchase-note-footer .cancel").click((function(){return e.cancelPurchaseNote(),!1}))},revealPurchaseNote:function(){$("#purchase-note-link").toggle(!1),$("#purchase-note-entry").toggle(!0),$("#purchase-note-input").focus(),addCharacterCountdownEventListeners(elt("purchase-note-input"),elt("purchase-note-countdown"),300)},cancelPurchaseNote:function(){$("#purchase-note-link").toggle(!0),$("#purchase-note-entry").toggle(!1),$("#purchase-note-input").val(""),window.MediaView&&"phone"==MediaView.mode&&Dom.scrollToElement(this._dlg.dialog("widget"))},purchaseNote:function(){return $.trim($("#purchase-note-input").val())||null}}}(),NotifyMe=function(){"use strict";return{notifyMe:function(){const e=$("#notify-me");return e?$(e).is(":checked"):null},notifyMeLabel:function(){const e=$("#notify-me-label");return e?$(e).is(":checked"):null}}}(),ChargeEmail=function(){"use strict";return{validate_dialog:function(){const e=U.trim(elt("fan_email_address").value);function t(e){window.MediaView&&"phone"==MediaView.mode||Dom.focus(e)}if(!/(^)([^\s\(\)"\'/><,]+@\w([^\s\(\)"\'/><&,]*\w)?\.\w[^\s\(\)"\'/><&,]*\w)($)/.test(e))return ChargeEmail.show_error(TM("Please enter a valid email address.")),t("fan_email_address"),!1;if(ChargeEmail._address=e,"1"!=$("#no_loc").val()){if(/^--/.test($("#fan_email_country").val()))return ChargeEmail.show_error(TM("Please choose a country")),t("fan_email_country"),!1;let e=1;"United States"==$("#fan_email_country").val()&&(e=5);let n=elt("fan_email_postalcode").value;if(n=n.replace(" ","","g"),n.length<e||n.length>10)return ChargeEmail._is_usa()?ChargeEmail.show_error(TM("Please enter a valid zip code.")):ChargeEmail.show_error(TM("Please enter a valid postal code.")),t("fan_email_postalcode"),!1}return!0},update_dialog:function(){if(!/^--/.test($("#fan_email_country").val())){$("#fan_email_postalcode").attr({placeholder:ChargeEmail._postcode_name(),pattern:ChargeEmail._postcode_entry_pattern()}).get(0)}},show_error:function(e){$("#fan_email_error").show().text(e)},filter_returnkey:function(){return!(window.event&&13==window.event.keyCode)},_is_usa:function(){return"US"==$("#fan_email_country").val()},_postcode_name:function(){return ChargeEmail._is_usa()?TM("zip code"):TM("postal code")},_postcode_entry_pattern:function(){return window.MediaView&&"phone"==MediaView.mode&&ChargeEmail._is_usa()?"[0-9]*":".*"}}}(),TralbumDownload=function(){"use strict";return{initialized:!1,init:function(){U.augmentObject(TralbumDownload,WatchInput),U.augmentObject(TralbumDownload,PurchaseNote),U.augmentObject(TralbumDownload,NotifyMe),U.augmentObject(TralbumDownload,PaymentPref)},preloadImage:function(e){const t=$(".buy-dlg .preload"),n=$("<div/>");e=TemplGlobals.static_siteroot+e,n.renderLiquid("cart/_img_preload",{path:e}),t.append(n)},begin:function(e,t,n){const i=U.pagedataBlob().cfg||{};this._itemVM=n;let a=null;a=void 0!==n?n.type:TralbumData.item_type,i.BALLS_disable_digital_sales?NuDialog.alert(TM("Music Sales"),TM("Digital music sales will be back shortly. Please try your purchase again in one hour. Sorry for the inconvenience!")):(t?this.beginGift(e,null,{type:a}):this.beginInner(e),(Sidecart.paymentTypeDialogAllowed()||0===Sidecart.cart_items.length)&&(this.preloadImage("/img/_sprite-bc-cc-cart-20160909.png"),this.preloadImage("/img/_sprite-bc-cc-cart@2x-20160909.png")))},getGiftTitle:function(e){return"bundle"==e.type?TM("Gift - Digital Discography"):"track"==e.type?TM("Gift â€“ Digital Track"):TM("Gift â€“ Digital Album")},beginGift:function(e,t,n){const i=this,a=U.pagedataBlob();if(t=t||{},n=n||{},a&&a.cfg&&!a.cfg.gifting)return;if(this.destroy(),TralbumData.current.download_pref==TralbumData.FREE)return;!t.sender_name&&a.fan_name&&(t.sender_name=a.fan_name),!t.recipient_name&&a.gift_recipient_name&&(t.recipient_name=a.gift_recipient_name),a.gift_recipient_fan_id&&(t.recipient_fan_id=a.gift_recipient_fan_id,t.is_for_fan=!0,delete a.gift_recipient_fan_id);const o=$("<div>"),s=this.getGiftTitle(n);let r;i._dlg=NuDialog.alertHTML(s,o,{dialogClass:"gift-dialog",width:"36em",buttons:[]}),o.renderLiquid("gift_panel",t),r={my:"center center",at:"center center",of:window},this._dlg.dialog("option","position",r);const l=new GiftPanelVM(t,"#gift-panel-vm");return ko.applyBindings(l,l.panel[0]),window.MediaView&&"phone"==MediaView.mode||l.focus(),this._dlg.on("dialogclose",(function(){i._dlg=null})),this._dlg},beginGiftConfirmation:function(e,t){const n=this;this.destroy();const i=TM("Confirm Recipient Email");n._dlg=NuDialog.showTemplate("gift_confirm",t,{title:i,width:"36em",buttons:[]});const a=$("#gift_confirm_form"),o={confirm:a.find("#confirm"),goBack:a.find("#goback")};return o.confirm.on("click",(function(i){n.destroy(),n._begin(e,t)})),o.goBack.on("click",(function(i){n.destroy(),t.fixing_email=!0,n.beginGift(e,t)})),this._dlg.on("dialogclose",(function(){n._dlg=null})),this._dlg},beginInner:function(e){const t=this._itemVM||TralbumData.current;let n=null;if("email"!=PaymentData.paymentType&&PaymentData.paymentDownloadPage){if(t.download_pref==TralbumData.FREE)return window.top.location.href=PaymentData.paymentDownloadPage,null;const e={title:"track"==TralbumData.current.type?TM("Download Track"):TM("Download Album"),buttons:{}};return e.buttons[TM("Re-Download")]=function(){window.top.location.href=PaymentData.paymentDownloadPage},e.buttons[TM("Buy Another")]=function(){TralbumDownload._begin()},n=NuDialog.showTemplate("redownload_confirm",{item_type:TralbumData.current.type,payment_type:PaymentData.paymentType},e),n}return this.freeDownloadBailout()?null:this._begin(e)},_begin:function(e,t){this.destroy();const n=U.pagedataBlob();this.localize_page=n.localize_page||!1,this.locale=n.locale||null;const i=this._itemVM||TralbumData.current,a=1===i.is_set_price;this._seller=n.item_sellers[i.selling_band_id],this._currency=CurrencyData.info[this._seller.currency],this._absoluteMinPrice=this._currency["album"===i.type?"medium_min_price":"small_min_price"];const o=TralbumData.has_discounts&&(a||i.minimum_price>0),s=i.require_email&&("email"!=PaymentData.paymentType||!PaymentData.paymentDownloadPage),r=i.type,l=i.licensed_item_id||i.id;let c,d;a?(c=i.set_price,d=void 0,this.taxablePrice=c):(c=void 0,d=i.minimum_price?i.minimum_price:t?"track"==i.type?this._currency.small_min_price:this._currency.medium_min_price:0,this.taxablePrice=d);const p=n.cfg||{},u=window.MediaView?MediaView.mode:null,m={download_info:{isSetPrice:1==i.is_set_price,setPrice:c,minimumPrice:d,requireEmail:s,offerEmail:this.offerEmailBailout(),hasAudio:TralbumData.hasAudio,freeDownload:i.download_pref==TralbumData.FREE,paidDownload:i.download_pref==TralbumData.PAID,prefix:!1,donation:!1,band:BandData,use_group:"ie"==Browser.type,has_discounts:o,unitId:i.type.charAt(0)+i.id,basePrice:c||d,tralbum_count:i.tralbum_count||1,has_tracks:i.has_tracks,xxx:null},id:i.licensed_item_id||i.id,type:i.license_id?"licensed_"+i.type:i.type,item_type:i.type||"album",band:BandData,no_codes:!0,dialog_class:"TralbumDownload",dialog_class_object:TralbumDownload,fan_id:window.BandFollow&&BandFollow.fan_id,seller:this._seller,seller_currency_prefix:this._currency.prefix,shipping_show_min_price:!i.is_set_price,buyer_currency:ClientPrefs.currency,cart_has_contents:Sidecart.cart_items.length>0,payment_pref:Sidecart.payment_pref,saved_card:Sidecart.saved_card,media_mode:u,platform:Browser.platform,is_mobile_app_compatible:Browser.mobile_app_compatible,cfg:p,is_device:Browser.platform_closed||"android"==Browser.platform,platform_name:Browser.platform_name,show_notify_me:i.download_pref!=TralbumData.FREE,show_notify_me_label:!n.fan_follows_label,options_footer:this.showPurchaseOptionsFooter&&this.generatePackageOptionsStr(TralbumData.packages,TralbumData.is_bonus),has_digital_vat:this.hasDigitalVAT(),is_gift:!!t,gift_card_balance:n.gift_card_balance,gift_card_redeem_link:TralbumDownload.giftCardRedeemLink(!!t,"bundle"===i.type?"bfd":null),buyer_country:this.buyerCountry()};m.download_info.is_cardable=Sidecart.isCardable($.extend({},m.download_info,{currency:this._currency.symbol})),this.showPurchaseOptionsFooter=!1,this.subTotal=a?c:d,m.sub_total=this.subTotal,m.shipping_disp_subtotal=TextFormat.currency(this.converted_subtotal(this.subTotal),CurrencyData.info[ClientPrefs.currency],!1,!0,!0);const _=$("<div>");let h,f="";f="bundle"==i.type?t?TM("Gift: Full Digital Discography"):TM("Full Digital Discography"):"track"==i.type?t?TM("Gift: Digital Track"):TM("Digital Track"):t?TM("Gift: Digital Album"):TM("Digital Album"),this._dlg=NuDialog.alertHTML(f,_,{width:"35.5em",buttons:[],dialogClass:"nu-dialog no-padding"}),_.renderLiquid("download_panel",m),TralbumDownload._attachDownloadPanelEventHandlers(_,this),this.recordBuyDialogEvent(this.locale,a,d,i.download_pref),h={my:"center center",at:"center center",of:window};const b=new DownloadPanelVM(m,this,"#download-panel-vm");ko.applyBindings(b,b.panel[0]),this._dlg.dialog("option","position",h),this.watchInput("userPrice"),this._discountVM=b.panes.discount,this._pricingVM=b.panes.pricing,this.setupPurchaseNote();const g=this;this.country_pref||(this.country_pref=CountryPrefPanel.make((function(e){g.oncountry_change(e,r,l)})));const y={selling_band_id:this._seller.id,item_type:r,item_id:l,item_currency:this._currency.symbol};return i.download_pref!=TralbumData.FREE&&this.request("/api/cart/3/hypothetical_shipping_and_tax",y,(function(e){g.updateShippingAndTax(e)})),window.MediaView&&"phone"==MediaView.mode||Dom.select("userPrice",!0),$("#email-section:visible").length>0&&ChargeEmail.update_dialog(),this._dlg.on("dialogclose",(function(){g.country_pref.hide(),g._dlg=null})),t&&g._dlg.data("gift_details",t),this._dlg},_attachDownloadPanelEventHandlers:function(e,t){$("#fan_email",e).keydown(t.filter_returnkey.bind(t)),$("#currencyToggle",e).click(t.show_currency_summary.bind(t)),$(".download-panel-free-download-link",e).click(TralbumDownload.showButtonsSection.bind(TralbumDownload)),$(".download-panel-checkout-button",e).click((function(){return TralbumDownload.checkout(),!1})),$("#download-panel-complete button",e).click(TralbumDownload.destroy.bind(TralbumDownload)),$("#fan_email_address",e).keydown(ChargeEmail.filter_returnkey.bind(ChargeEmail)),$("#fan_email_postalcode",e).keydown(ChargeEmail.filter_returnkey.bind(ChargeEmail)),$("#fan_email_country",e).change(ChargeEmail.update_dialog.bind(ChargeEmail))},hasDigitalVAT:function(){return this._seller.digital_vat_enabled&&ClientPrefsObservable.isEU()&&this.taxablePrice>0},buyerCountry:function(){const e=U.pagedataBlob().buyer_location;return void 0===e?null:e.country_code},filter_returnkey:function(e){return!e||13!=e.keyCode||(!(!e.target||"purchase-note-input"!=e.target.id)||(TralbumDownload.checkout("cart"),!1))},grab_price_from_dialog:function(){let e;const t=this._itemVM||TralbumData.current;if(this.validPrice=!0,t.download_pref==TralbumData.PAID){if(t.is_set_price)e=this._discountVM.unitPrice();else{e=Form.validate.parsePrice(elt("userPrice").value);const t=this._discountVM.unitPrice();this._pricingVM.unitPrice(t),this.validPrice=!(isNaN(e)||e<t),this.validPrice?this._pricingVM.userPrice(e):(e=t,this._pricingVM.userPrice(null))}this.subTotal=e,this._pricingVM.subTotal(e)}return this.validPrice?e:void 0},inputChanged:function(e){const t=this.grab_price_from_dialog(),n=this;let i="paypal";if(0===t){const e=TralbumData.current.require_email_0&&("email"!=PaymentData.paymentType||!PaymentData.paymentDownloadPage)||this.offerEmailBailout();i=e?"email":"download"}const a=$(".below-pricing"),o=$(".payment-nag-section"),s=o.is(":visible"),r=new TaskQueue;t>0||void 0===t?s?(a.addClass("fade-out"),r.addTask((function(){$(".payment-nag-section").hide(),$("#email-section").hide(),$("#downloadButtons_email").hide(),$("downloadFinalStep_email").hide(),$(".purchase-note-section").show(),$(".format-section").show(),$(".buttons-section").show(),$(".notify-me-section").show(),$(".grey-link").removeClass("grey-link"),$("#downloadButtons_paypal, #downloadFinalStep_paypal, #download-aftercheckout").toggle("paypal"==i),$("#downloadButtons_download, #downloadFinalStep_download").toggle("download"==i),$("#notify-me-section, #notify-me-label-section").toggle("paypal"==i)}),200),r.addTask((function(){a.removeClass("fade-out")}),200)):($(".purchase-note-section").show(),$(".format-section").show(),$(".buttons-section").show(),$(".notify-me-section").show()):0!==t||s||(a.addClass("fade-out"),r.addTask((function(){n.cancelPurchaseNote(),$(".purchase-note-section, .format-section, .buttons-section, .notify-me-section").hide(),$("#downloadButtons_paypal, #downloadFinalStep_paypal, #download-aftercheckout").toggle("paypal"==i),$("#downloadButtons_download, #downloadFinalStep_download").toggle("download"==i),$("#notify-me-section, #notify-me-label-section").toggle("paypal"==i),o.show()}),200),r.addTask((function(){a.removeClass("fade-out")}),200)),this.updateSummary(),this.renderEggs(t),r.run(),"email"==i&&ChargeEmail.update_dialog(),this.isNYP()&&!this._pricingVM.hasErrors()&&this._pricingVM.clearValidation()},renderEggs:function(e){e||(e=0);const t=["en","fr"].map((function(e){return"body:lang("+e+") .nyp-wrapper"})).join(", "),n=[],i=[];Iter.each([{a:[6.66,66.6,666],b:"egg-metal"},{a:[4.2,420],b:"egg-high"},{a:[3.21,3.21,321],b:"egg-space"},{a:[7.77,77.7,777],b:"egg-lucky"}],(function(t){(-1!==t.a.indexOf(e)?n:i).push(t.b)}));const a=$(t);a.removeClass(i.join(" ")),a.addClass(n.join(" "))},showButtonsSection:function(e){return(TralbumData.current.require_email_0&&("email"!=PaymentData.paymentType||!PaymentData.paymentDownloadPage)||this.offerEmailBailout())&&$("#email-section, #downloadButtons_email, #downloadFinalStep_email").toggle(!0),$(".buttons-section").show(),e.target.className="grey-link",!1},updateCurrencyDisplay:function(){this.grab_price_from_dialog()},checkout:function(e){if(!this._dlg)return;const t=this;let n=null;if(this._discountVM.discountVerified())if(this.isNYP())t._pricingVM.validate().done((function(){n=Form.validate.parsePrice(elt("userPrice").value),t.checkoutContinue(e,n)})).fail((function(){}));else{if(!this._itemVM&&TralbumData.current.download_pref==TralbumData.FREE)return this.offerEmailBailout()||!this.freeDownloadBailout(!1)?void this.submitEmail():void $assert(!1,"Unexpected: should have already bailed out to a free/email download");t.checkoutContinue(e,n)}},checkoutContinue:function(e,t){const n=this;if(0===t)return $assert(0===TralbumData.current.minimum_price),void(this.freeDownloadBailout(!0)||this.submitEmail());const i={},a=n._itemVM||TralbumData.current;i.checkout_now="cart"!=e&&"payment_method"!=e,i.item_title=a.title,i.item_title2=null,i.item_type=a.type?a.type[0]:"a",i.item_id=a.id,i.ip_country_code=Identities.ip_country_code||$("#pagedata").data("blob").user_territory,i.associated_license_id=a.licensed_item_id,i.preorder=a.is_preorder,i.has_download=!0,i.band_id=BandData.id,i.artist_name=a.artist,i.unit_price=t||this._discountVM.unitPrice(),i.currency=this._currency.symbol,i.quantity=1,i.option_id=null,i.option_name=null,i.discount_id=this._discountVM.discountID(),i.discount_type=this._discountVM.discountType(),i.url=a.url,i.purchase_note=this.purchaseNote(),i.notify_me=this.notifyMe(),i.notify_me_label=this.notifyMeLabel(),i.releases="b"==i.item_type&&a.tralbum_count?a.tralbum_count:null;const o=n._dlg?n._dlg.data("gift_details"):null;o&&(i.is_gift=!0,i.gift_sender_name=o.sender_name,o.recipient_fan_id&&0===o.recipient_email.length?i.gift_recipient_fan_id=o.recipient_fan_id:i.gift_recipient_email=o.recipient_email,i.gift_recipient_name=o.recipient_name,i.gift_sender_note=o.sender_note),i.art_id=a.art_id,window.Analytics&&Analytics.cartItemEvent("add",i),Sidecart.add_to_cart(i),i.checkout_now&&!Sidecart.paymentTypeDialogAllowed()&&PleaseWaitPanel.show(!1),!1===i.checkout_now&&"payment_method"===e?this.showChoosePaymentMethod():Sidecart.paymentTypeDialogAllowed()&&!1!==i.checkout_now?Sidecart.gift_balance?(this.destroy(),Sidecart.checkout_callback=function(){const e={client_id:ClientID,return_url:window.TralbumData&&TralbumData.url||location.href,from:"dialog"};window.MediaView&&"phone"==MediaView.mode&&(e.mob="1"),window.top.location.href=siteroot_https+"/cart/checkout_start?"+Url.joinQuery(e)}):this.showPaymentPref():this.destroy()},recordBuyDialogEvent:function(e,t,n,i){let a,o;if(i==TralbumData.PAID){a=t?"fixed":n>0?"nyp_nonzero_min":"nyp_zero_min",e=e||"en";const i=this.buyerCountry()||"US",s={kind:"buy dialog",payment_pref:Sidecart.payment_pref,pricing_type:a,locale:e,country:i,item_id:TralbumData.current.id,item_type:TralbumData.current.type};o=$("#abt-album-1").data("abtest"),o&&(s.abt_name=o.test_name,s.abt_bucket=o.bucket,s.abt_variant_id=o.variant_id),Stats.record(s)}},isNYP:function(){return this._itemVM?!this._itemVM.is_set_price:TralbumData.current.download_pref==TralbumData.PAID&&!TralbumData.current.is_set_price},submitEmail:function(){ChargeEmail.validate_dialog()&&this._dlg&&$("form",this._dlg).submit()},generatePackageOptionsStr:function(e,t){let n=null,i=!1,a=!1,o=!1;return e&&$.each(e,(function(e,t){switch(t.type_id){case 1:i||(i=!0);break;case 2:case 15:case 16:case 17:case 18:a||(a=!0);break;case 3:o||(o=!0)}})),n=!i||a||o?i||!a||o?i||a||!o?i&&a&&!o?t?TM("Also available on CD, vinyl or via subscription."):TM("Also available on CD and vinyl."):i&&!a&&o?t?TM("Also available on CD, cassette or via subscription."):TM("Also available on CD and cassette."):!i&&a&&o?t?TM("Also available on vinyl, cassette or via subscription."):TM("Also available on vinyl and cassette."):i&&a&&o?t?TM("Also available on CD, vinyl, cassette or via subscription."):TM("Also available on CD, vinyl, cassette."):t?TM("Also available via subscription."):"":t?TM("Also available on cassette or via subscription."):TM("Also available on cassette."):t?TM("Also available on vinyl or via subscription."):TM("Also available on vinyl."):t?TM("Also available on CD or via subscription."):TM("Also available on CD."),n},offerEmailBailout:function(){const e=TralbumData.current,t=Browser.platform_closed,n="phone"==Browser.media_mode;return(t||n)&&(e.download_pref==TralbumData.FREE&&!e.require_email||e.download_pref==TralbumData.PAID&&!e.is_set_price&&0===e.minimum_price&&!e.require_email_0)},freeDownloadBailout:function(e){const t=this._itemVM||TralbumData.current;let n;if(this.offerEmailBailout())return!1;if(t.download_pref==TralbumData.PAID){if(t.is_set_price||t.minimum_price>0||!e)return!1;n=t.require_email_0}else{if(t.download_pref!=TralbumData.FREE)return $assert(!1,"freeDownloadBailout: should not be making this check on this tralbum (2)"),!1;n=t.require_email}if(n){if("email"==PaymentData.paymentType&&PaymentData.paymentDownloadPage)return this.navigate(PaymentData.paymentDownloadPage),!0}else{if(TralbumData.freeDownloadPage)return this.navigate(TralbumData.freeDownloadPage),!0;$assert(!1,"freeDownloadBailout: missing pure-free download url")}return!1},navigate:function(e){window.top.location.href=e},destroy:function(){this._dlg&&(this._dlg.dialog("close"),$assert(null===this._dlg))},updateSummary:function(){this._pricingVM.updateShippingSummary({subTotal:this.subTotal,hasTax:this.hasTax,shippingAndTax:this.taxAmount,taxSystem:this.taxSystem})},show_currency_summary:function(e){U.stopEvent(e),this.country_pref.show(elt("currencyToggle"),!1)},show_country_pref:function(e){const t=e.target||e.srcElement;e.preventDefault(),this.country_pref.show(t,!0)},oncountry_change:function(e,t,n){const i=this;if(this._dlg){const a={country:e.country,us_zip:e.us_zip,selling_band_id:this._seller.id,item_type:t,item_id:n,item_currency:this._currency.symbol};this._pricingVM.updating(!0),this.request("/api/cart/3/update_client_prefs_location",a,(function(e){i.updateShippingAndTax(e),i.country_pref.hide()}))}},converted_subtotal:function(e){if(this._currency.symbol==ClientPrefs.currency)return e;return e*(CurrencyData.rates[this._currency.symbol]/CurrencyData.rates[ClientPrefs.currency])},request:function(e,t,n){t.client_id=ClientID;for(const e in t)null===t[e]&&delete t[e];this.localize_page&&(t.localize_page=this.localize_page),$.ajax({type:"POST",url:e,data:JSON.stringify(t),dataAs:"JSON",success:function(e){const t=e.error&&"invalid_zip"==e.error_message;ClientPrefsObservable.zipIsInvalid(t),t||n(e)},error:function(e){Log.info("cart api error",e)}})},updateShippingAndTax:function(e){this.hasTax=0!=e.tax.rate,this.taxRate=e.tax.rate,this.taxSystem=e.tax.system,this.taxTerritory=e.tax.territory,this.taxAmount=Math.round(this.subTotal*this.taxRate)/100,ClientPrefs.update(e.client_prefs),this.updateSummary()},handleActionParam:function(){let e=HiddenParams.get("action");const t=HiddenParams.get("buy_id");let n=parseInt(HiddenParams.get("no"))||0;const i=TralbumData.current;if(!i)return;if(("download"===e||"buy"===e)&&i.is_live_ticket&&$("#pagedata").data("blob").attending_event)return void(e=null);if(("download"===e||"buy"===e||"gift"===e)&&!TralbumData.hasAudio&&("track"===TralbumData.item_type||"album"===TralbumData.item_type&&!TralbumData.is_preorder)&&(!TralbumData.packages||TralbumData.packages&&TralbumData.packages.length<1))return;"download"!==e&&"buy"!==e||i.download_pref||(TralbumData.packages&&TralbumData.packages.length>0?(Log.debug("action=download but not downloadable; showing package buy dialog instead."),e="package"):(Log.debug("action=download but not downloadable; ignoring."),e=null)),"download"!==e&&"buy"!==e||t||"track"!==i.type||!i.album_id||(Log.debug("action=download for track-of-album; not showing dialog."),e=null),"package"!==e||TralbumData.packages||(Log.warn("action=package but there are no packages; ignoring."),e=null);const a="gift"===e;if("buy"===e||"gift"===e)if(t){Log.debug("action=buy with buy_id="+t);const a=parseInt(t.substr(1));switch(t[0]){case"b":window.buyFullDiscographyVM?e="bfd":(Log.warn("action=buy buy_id="+t+" but no buyFullDiscographyVM on page"),e=null);break;case"a":case"t":a!==i.id?(Log.warn("action=buy buy_id="+t+" mismatches current tralbum; ignoring"),e=null):e="download";break;case"p":if(TralbumData.packages){n=-1;for(let e=0;e<TralbumData.packages.length;e++)if(TralbumData.packages[e].id===a){n=e;break}-1===n?(Log.warn("action=buy buy_id="+t+" package id not found; ignoring"),e=null):e="package"}else Log.warn("action=buy buy_id="+t+" specified but TralbumData.packages is missing. Bailing."),e=null;break;default:Log.warn("Unknown buy_id type prefix: "+t)}}else{if("gift"===e&&TralbumData.packages&&TralbumData.packages.length>0)return;Log.debug("action=buy without a buy_id; show dialog if it's digital only"),e="buy_digital"}switch(e){case"download":TralbumDownload.showPurchaseOptionsFooter=!0,TralbumDownload.begin(null,a);break;case"package":(n<0||n>=TralbumData.packages.length)&&(n=0),PackageOrder.begin(n,a);break;case"bfd":TralbumDownload.begin(null,a,window.buyFullDiscographyVM);break;case"buy_digital":TralbumData.packages&&0!==TralbumData.packages.length||TralbumDownload.begin(null,a);break;case null:break;default:Log.warn("Unexpected action param: "+e)}},giftCardRedeemLink:function(e,t){const n=TralbumData.current,i={resume_id:n.type[0]+n.id,resume_action:e?"gift":"buy"};return t&&(i.resume_buy_id=t),Url.addQueryParams(siteroot_https+"/redeem",i)},zzz:null}}(),PackageOrder=function(){"use strict";return{init:function(){U.augmentObject(PackageOrder,WatchInput),U.augmentObject(PackageOrder,PurchaseNote),U.augmentObject(PackageOrder,NotifyMe),U.augmentObject(PackageOrder,PaymentPref)},begin:function(e,t){(U.pagedataBlob().cfg||{}).BALLS_disable_merch_sales?NuDialog.alert(TM("Merch Sales"),TM("Merchandise sales will be back shortly. Please try your purchase again in one hour. Sorry for the inconvenience!")):t?this.beginGift(e):this._begin(e)},getGiftTitle:function(e){return Templ.render("_tralbum_physical_gift_title",e)},beginGift:function(e,t,n){const i=this,a=TralbumData.packages[e],o=U.pagedataBlob();if(t=t||{},n=n||{merch_title:Text.escapeHtml(Text.truncate(a.title,38,"...")),merch_type:a.type_id},o&&o.cfg&&(!o.cfg.physical_gifting||o.cfg.BALLS_disable_physical_gifting))return;t.shippable=!a.shipping_exception_mode,i.destroy(),!t.sender_name&&o.fan_name&&(t.sender_name=o.fan_name),!t.recipient_name&&o.gift_recipient_name&&(t.recipient_name=o.gift_recipient_name),t.is_us_buyer=Geo.isUSBuyer(),t.shipping_country_code||(t.shipping_country_code=Geo.getDefaultCountryCode()),o.gift_recipient_fan_id&&(t.recipient_fan_id=o.gift_recipient_fan_id,delete o.gift_recipient_fan_id),t._hide_cancel=!0,t._continue_text=TM("Continue"),o.cfg&&(t._use_zip_regex=o.cfg.physical_gifting_zip_regex);const s=$("<div>");let r;i._dlg=NuDialog.alertHTML(this.getGiftTitle(n),s,{width:"35.5em",buttons:[],dialogClass:"gift-dialog"}),s.renderLiquid("physical_gift_panel",t),r={my:"center center",at:"center center",of:window},this._dlg.dialog("option","position",r);const l=new PhysicalGiftViewModel(t,(function(t){PackageOrder.beginGiftConfirmation(e,t)}));return ko.applyBindings(l,$("#physical-gift-vm")[0]),this._dlg.on("dialogclose",(function(){i._dlg=null})),this._dlg},beginGiftConfirmation:function(e,t){const n=this;this.destroy(),t.shipping_address_lines=Geo.localizeAddressFormat({street:t.shipping_street,street_2:t.shipping_street_2,city:t.shipping_city,state:t.shipping_state,zip:t.shipping_zip,country_code:t.shipping_country_code,country_name:t.shipping_country_name});const i=TM("Confirm Recipient Details");n._dlg=NuDialog.showTemplate("physical_gift_confirm",t,{title:i,width:"35.5em",buttons:[]});const a=new function(){this.submit=function(){PackageOrder._begin(e,t)},this.cancel=function(){PackageOrder.beginGift(e,t)}};return ko.applyBindings(a,$("#physical-confirm-vm")[0]),this._dlg.on("dialogclose",(function(){n._dlg=null})),this._dlg},_begin:function(e,t){this.destroy();const n=U.pagedataBlob();this.localize_page=n.localize_page||!1,this.locale=n.locale||null;const i=TralbumData.packages[e];this._package=i,this._seller=n.item_sellers[i.selling_band_id],this._currency=CurrencyData.info[this._seller.currency],this._absoluteMinPrice=this._currency.medium_min_price;const a=1==i.is_set_price,o=BandData.has_discounts,s=i.shipping_exception_mode,r=n.artist_service_merch_discounts&&n.artist_service_merch_discounts[i.id],l=n.fan_tralbum_data&&n.fan_tralbum_data.subscriptions_by_band_id||{},c=r&&(l[i.band_id]&&r.band||l[i.selling_band_id]&&r.selling_band);if(i.is_live_ticket&&(!Identities.fan()||Identities.fan().private))return void FanAction.doAction("live_ticket",n.lo_querystr,null,i.id,"p",i.band_id,null,{packageIndex:e,isGift:!!t});const d={download_info:{isSetPrice:a,setPrice:i.price,minimumPrice:i.price,package:i,hasAudio:TralbumData.hasAudio,package_title:i.title,encoding_name:"none",show_options:!!i.options_title,options_title:i.options_title,options_data:i.options,paidDownload:2,prefix:!1,donation:!1,band:BandData,certified_seller:!!i.certified_seller,is_live_ticket:i.is_live_ticket,limited_checkout:i.limited_checkout,use_group:"ie"==Browser.type,has_discounts:o,subscriberDiscount:c,unitId:"p"+i.id,basePrice:i.price,xxx:null},id:TralbumData.current.id,type:TralbumData.current.type,item_type:"track"==TralbumData.current.type?"track":"album",band:BandData,no_codes:!0,dialog_class:"PackageOrder",dialog_class_object:PackageOrder,fan_id:window.BandFollow&&BandFollow.fan_id,seller:this._seller,seller_currency_prefix:this._currency.prefix,shipping_country_name:ClientPrefs.country_name,buyer_currency:ClientPrefs.currency,shipping_show_subtotal:ClientPrefs.currency!=this._currency.symbol,shipping_disp_subtotal:this.NO_AMT,shipping_has_tax:!1,cart_has_shipping:Sidecart.has_shipping,payment_pref:Sidecart.payment_pref,saved_card:Sidecart.saved_card,cart_has_contents:Sidecart.cart_items.length>0,media_mode:window.MediaView?MediaView.mode:null,platform:Browser.platform,is_mobile_app_compatible:Browser.mobile_app_compatible,cfg:n.cfg||{},is_device:Browser.platform_closed||"android"==Browser.platform,platform_name:Browser.platform_name,has_shipping_exception:s,show_notify_me:!0,show_notify_me_label:!n.fan_follows_label,is_gift:!!t,is_live_ticket:i.is_live_ticket,gift_card_balance:n.gift_card_balance,gift_card_redeem_link:TralbumDownload.giftCardRedeemLink(!!t,"p"+i.id),covid_shipping_banner:!!n.covid_banner_sellers[i.selling_band_id]&&!s};d.download_info.is_cardable=Sidecart.isCardable($.extend({},d.download_info,{currency:this._currency.symbol}));const p=$("<div>"),u=Text.escapeHtml(Text.truncate(i.title,42,"..."));this._dlg=NuDialog.alertHTML(u,p,{width:"35.5em",buttons:[],dialogClass:"nu-dialog no-padding"}),p.renderLiquid("download_panel",d),TralbumDownload._attachDownloadPanelEventHandlers(p,this);const m=this.calculateMinimumPrice(a,i.price,t);this.recordBuyDialogEvent(this.locale,a,m,i.id);const _=new DownloadPanelVM(d,this,"#download-panel-vm");let h;ko.applyBindings(_,_.panel[0]),h={my:"center center",at:"center center",of:window},this._dlg.dialog("option","position",h),this._discountVM=_.panes.discount,this._pricingVM=_.panes.pricing,this.setupPurchaseNote();const f=this;this.grab_values_from_dialog(),this.country_pref||(this.country_pref=CountryPrefPanel.make((function(e){f.oncountry_change(e)})));const b={selling_band_id:this._seller.id,item_type:"package",item_id:this._package.id,item_currency:this._package.currency,recipient_country:t&&t.shipping_country_code,pkg_is_gift:t?1:null};if(this.request("/api/cart/3/hypothetical_shipping_and_tax",b,(function(e){f.updateShippingAndTax(e)})),this.isNYP()||$("#orderQuantity",this._dlg).val(1),$("#orderQuantity",this._dlg).keydown((function(e){if(e.shiftKey||e.ctrlKey||e.altKey)e.preventDefault();else{const t=e.keyCode||e.which;8==t||9==t||27==t||46==t||t>=35&&t<=40||t>=48&&t<=57||t>=96&&t<=105||e.preventDefault()}})),this.watchInput("userPrice"),this.watchInput("orderQuantity",1,"integer"),!window.MediaView||"phone"!=MediaView.mode){const e=document.getElementById("orderQuantity");void 0!==e&&null!=e?Dom.select("orderQuantity",!0):Dom.select("userPrice",!0)}return this._dlg.on("dialogclose",(function(){f.country_pref.hide(),f._dlg=null})),t&&f._dlg.data("gift_details",t),this._dlg},buyerCountry:function(){const e=U.pagedataBlob().buyer_location;return void 0===e?null:e.country_code},calculateMinimumPrice:function(e,t,n){return e?t=void 0:t||(t=n?this._currency.medium_min_price:0),t},destroy:function(){this._dlg&&(this._dlg.dialog("close"),$assert(null===this._dlg))},taxDisplay:function(e){return e&&0!==e?e==Math.round(e)?e.toString():e==e.toFixed(1)?e.toFixed(1).toString():e==e.toFixed(2)?e.toFixed(2).toString():e.toFixed(3).toString():null},checkout:function(e){if(!this._dlg)return;const t=this._package;if(!t)return;const n=this;let i=null;if(!this.validateQuantity("orderQuantity","item_option"))return;const a=t.is_live_ticket?1:parseInt(elt("orderQuantity").value);if(this._discountVM.discountVerified())if(this.isNYP()){let t=this._seller.max_price/a;t=t>1e3?100*Math.floor(t/100):t>100?10*Math.floor(t/10):Math.floor(t),this._pricingVM.maxPrice(t),n._pricingVM.validate().done((function(){i=Form.validate.parsePrice(elt("userPrice").value),n.checkoutContinue(e,i)})).fail((function(){}))}else n.checkoutContinue(e,i)},checkoutContinue:function(e,t){const n=this,i=n._package,a=i.is_live_ticket?1:parseInt(elt("orderQuantity").value),o={option_id:null,option_name:null},s=elt("item_option");if(s&&i.options){const e=i.options[s.value];e&&(o.option_id=e.id,o.option_name=e.title)}o.checkout_now="cart"!=e&&"payment_method"!=e,o.item_title=i.title,o.item_title2="package"===TralbumData.current.type?null:TralbumData.current.title,o.item_type="p",o.item_id=i.id,o.preorder=(i.download_type||i.album_id)&&TralbumData.album_is_preorder,o.has_download=!!i.download_type,o.band_id=BandData.id,o.artist_name=TralbumData.artist,o.unit_price=t||this._discountVM.unitPrice(),o.currency=this._currency.symbol,o.is_live_ticket=i.is_live_ticket,o.quantity=a,o.discount_id=this._discountVM.discountID(),o.discount_type=this._discountVM.discountType(),o.url=TralbumData.url,o.associated_license_id="package"==TralbumData.current.type?TralbumData.current.associated_license_id:TralbumData.package_associated_license_id,o.ip_country_code=Identities.ip_country_code||$("#pagedata").data("blob").user_territory,i.arts&&i.arts[0]?(o.image_id=i.arts[0].image_id,o.thumb_url=ImageUtils.imageURL(i.arts[0].image_id,"package_thumb",!1),o.https_thumb_url=ImageUtils.imageURL(i.arts[0].image_id,"package_thumb",!0)):i.album_art_id&&(o.art_id=i.album_art_id,o.thumb_url=ImageUtils.artURL(i.album_art_id,"package_thumb",!1),o.https_thumb_url=ImageUtils.artURL(i.album_art_id,"package_thumb",!0));TralbumData.current.license_id;["album","track"].indexOf(TralbumData.current.type)>=0&&i.download_id&&i.download_id>0&&(o.download_type="a",o.download_id="album"===TralbumData.current.type?TralbumData.current.id:TralbumData.current.album_id),o.purchase_note=this.purchaseNote(),o.notify_me=this.notifyMe(),o.notify_me_label=this.notifyMeLabel(),o.certified_seller=!!i.certified_seller,o.limited_checkout=i.limited_checkout;const r=n._dlg?n._dlg.data("gift_details"):null;r&&(o.is_gift=!0,o.is_physical_gift=!0,o.gift_sender_name=r.sender_name,!r.recipient_fan_id||r.recipient_email&&0!==r.recipient_email.length?o.gift_recipient_email=r.recipient_email:o.gift_recipient_fan_id=r.recipient_fan_id,o.gift_recipient_name=r.recipient_name,o.gift_sender_note=r.sender_note,o.shippable=r.shippable,o.shipping_street=r.shipping_street,o.shipping_street_2=r.shipping_street_2,o.shipping_city=r.shipping_city,o.shipping_state=r.shipping_state,o.shipping_zip=r.shipping_zip,o.shipping_country_code=r.shipping_country_code,o.shipping_country_name=r.shipping_country_name),window.Analytics&&Analytics.cartItemEvent("add",o),Sidecart.add_to_cart(o),o.checkout_now&&!Sidecart.paymentTypeDialogAllowed()&&PleaseWaitPanel.show(!1),!1===o.checkout_now&&"payment_method"===e?this.showChoosePaymentMethod():Sidecart.paymentTypeDialogAllowed()&&!1!==o.checkout_now?Sidecart.gift_balance?(this.destroy(),Sidecart.checkout_callback=function(){const e={client_id:ClientID,return_url:window.TralbumData&&TralbumData.url||location.href,from:"dialog"};window.MediaView&&"phone"==MediaView.mode&&(e.mob="1"),window.top.location.href=siteroot_https+"/cart/checkout_start?"+Url.joinQuery(e)}):this.showPaymentPref():this.destroy()},recordBuyDialogEvent:function(e,t,n,i){let a;if(e){const a=t?"fixed":n>0?"nyp_nonzero_min":"nyp_zero_min",o=this.buyerCountry()||"US",s=window.MediaView?MediaView.mode:null;Crumb.ajax({type:"POST",url:"/api/internationalization/1/localized_buy_dialog_presented",dataAs:"JSON",data:{locale:e,pricing_type:a,payment_pref:Sidecart.payment_pref,country:o,media_mode:s,client_id:ClientID,item_id:TralbumData.current.id,item_type:TralbumData.current.type,package_id:i},success:function(e){e.error&&Log.warn("Buy dialog logging event error.",e)},error:function(e){Log.warn("Buy dialog logging failed.",e)}})}if(a=$("#abt-album-1").data("abtest"),a){const e={kind:"buy dialog",physical_item_buy_dialog:!0,abt_name:a.test_name,abt_bucket:a.bucket,abt_variant_id:a.variant_id};Stats.record(e)}},isNYP:function(){return this._package&&!this._package.is_set_price},isLiveTicket:function(){return this._package&&this._package.is_live_ticket},filter_returnkey:function(e){return!e||13!=e.keyCode||(!(!e.target||"purchase-note-input"!=e.target.id)||(PackageOrder.checkout("cart"),!1))},validateQuantity:function(e,t,n,i){const a=this._package;e=elt(e),t=elt(t),n=a.is_live_ticket?null:elt(n||e.id+"_alert"),i=t?elt(i||t.id+"_alert"):null,FormUtils.showHideAlert(n,null);const o=a.is_live_ticket?1:parseInt(e.value);let s=null;if(isNaN(o))s=TM("Please provide a quantity.");else if(o<1)s=TM("The minimum quantity is 1.");else{if(t)if("please_select"==t.value)s=TM("Please select one of the available options."),n=i||n;else{let e=0;Iter.each(a.options[t.value].origins,(function(t){t.quantity_available>e&&(e=t.quantity_available)})),e=e?e.quantity_available:null,0===e?(s=TM("Sorry, this package option is sold out."),n=i||n):null!==e&&o>e&&(s=TM("Sorry, only {{limit}} of that option available.",{limit:e}),n=i||n)}null===s&&null!==a.quantity_limits&&o>a.quantity_limits&&(s=a.quantity_available==a.quantity_limits?TM("Sorry, only {{number}} more available.",{number:a.quantity_available}):TM("Sorry, purchases are limited to {{limit}}.",{limit:a.quantity_limits}))}return!s||(FormUtils.showHideAlert(n,s),!1)},grab_values_from_dialog:function(){let e;try{this.quantity=parseInt(elt("orderQuantity").value)}catch(e){}return(isNaN(this.quantity)||this.quantity<1)&&(this.quantity=1),this._package.is_set_price?this.subTotal=this.quantity*this._discountVM.unitPrice():(e=Form.validate.parsePrice(elt("userPrice").value),this._pricingVM.unitPrice(this._discountVM.unitPrice()),isNaN(e)?(this._pricingVM.userPrice(null),e=this._discountVM.unitPrice()):(this._pricingVM.userPrice(e),e=Math.max(e,this._discountVM.unitPrice())),this.subTotal=this.quantity*e),isNaN(this.subTotal)&&(this.subTotal=this._discountVM.unitPrice()),this._pricingVM.subTotal(this.subTotal),e},inputChanged:function(e){const t=this.grab_values_from_dialog();this._package.is_set_price&&(elt("userPrice").innerHTML=TextFormat.currency(this.subTotal,this._currency,!0));const n=this.quantity*this._discountVM.basePrice();null!==this._discountVM.discountedPrice()&&Dom.setText("normal-price",TextFormat.currency(n,this._currency,!0)),TralbumDownload.renderEggs(t),this.isNYP()&&!this.isLiveTicket()&&this.update_nyp_labels();const i=this._package.shipping_exception_mode;(void 0!==typeof this.shipping_base||i)&&this.update_summary(),this.isNYP()&&!this._pricingVM.hasErrors()&&this._pricingVM.clearValidation()},update_nyp_labels:function(){const e=1!=parseInt(elt("orderQuantity").value),t={items_plausible:e};Templ.renderElem("nyp-header","_per_item",t),$("#nyp-header").toggleClass("nyp-header-middle",e)},updateCurrencyDisplay:function(){this.grab_values_from_dialog(),this.update_summary()},NO_AMT:"&nbsp;-&nbsp;-&nbsp;",update_summary:function(){const e=this._dlg?this._dlg.data("gift_details"):null;this.recalculateShippingAndTax(),this._pricingVM.updateShippingSummary({subTotal:this.subTotal,hasTax:this.hasTax,shippingAndTax:this.shipping_and_tax,taxSystem:this.taxSystem,showAsTotal:this.quantity>1,giftCountryName:e&&e.shipping_country_name,giftCountry:e&&e.shipping_country_code,giftUsState:e&&e.shipping_state,giftUsZip:e&&e.shipping_zip})},recalculateShippingAndTax:function(){this.shipping_is_base?this.shipping_and_tax=this.shipping_base+this.shipping_incr*(this.quantity-1):this.shipping_and_tax=this.shipping_incr*this.quantity,this.hasTax&&(this.shipping_and_tax+=Math.round(this.subTotal*this.taxRate)/100)},show_currency_summary:function(e){U.stopEvent(e),this.country_pref.show(elt("currencyToggle"),!1)},show_country_pref:function(e){const t=e.target||e.srcElement;e.preventDefault(),this.country_pref.show(t,!0)},hasShippingException:function(){return this._package&&this._package.shipping_exception_mode&&""!==this._package.shipping_exception_mode},oncountry_change:function(e){const t=this;if(this._dlg){this._pricingVM.updating(!0);const n={item_type:"package",selling_band_id:this._seller.id,item_id:this._package.id,item_currency:this._package.currency,country:e.country,us_zip:e.us_zip};this.request("/api/cart/3/update_client_prefs_location",n,(function(e){t.updateShippingAndTax(e),t.country_pref.hide()}))}},request:function(e,t,n){t.client_id=ClientID;for(const e in t)null===t[e]&&delete t[e];this.localize_page&&(t.localize_page=this.localize_page),$.ajax({type:"POST",url:e,data:JSON.stringify(t),dataAs:"JSON",success:function(e){const t=e.error&&"invalid_zip"==e.error_message;ClientPrefsObservable.zipIsInvalid(t),t||n(e)},error:function(e){Log.info("cart api error",e)}})},updateShippingAndTax:function(e){e.shipping&&(this.shipping_is_base=e.shipping.is_base,this.shipping_base=e.shipping.base,this.shipping_incr=e.shipping.incr),this.hasTax=0!=e.tax.rate,this.taxRate=e.tax.rate,this.taxSystem=e.tax.system,this.taxTerritory=e.tax.territory,ClientPrefs.update(e.client_prefs),this.update_summary()},zzz:null}}(),Geo=function(){"use strict";const e=["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE"];let t=null;const n={AT:{optionalParameters:{},zipValidator:/^\d{4}$/,zipFormat:"numeric",addressFormat:"ZIP CITY|COUNTRY"},AU:{optionalParameters:{},zipValidator:/^\d{4}$/,zipFormat:"numeric",addressFormat:"CITY STATE ZIP|COUNTRY"},BE:{optionalParameters:{},zipValidator:/^\d{4}$/,zipFormat:"numeric",addressFormat:"ZIP CITY|COUNTRY"},BR:{optionalParameters:{},zipValidator:/^\d{5}[\-]?\d{3}$/,zipFormat:"numeric",addressFormat:"CITY-STATE|ZIP|COUNTRY"},CA:{optionalParameters:{},zipValidator:/^[A-Z]\d[A-Z][ ]?\d[A-Z]\d$/,zipFormat:"alphanumeric",addressFormat:"CITY STATE ZIP|COUNTRY"},CH:{optionalParameters:{},zipValidator:/^\d{4}$/,zipFormat:"numeric",addressFormat:"ZIP CITY|COUNTRY"},CZ:{optionalParameters:{},zipValidator:/^\d{3}[ ]?\d{2}$/,zipFormat:"numeric",addressFormat:"ZIP CITY|COUNTRY"},DE:{optionalParameters:{},zipValidator:/^\d{5}$/,zipFormat:"numeric",addressFormat:"ZIP CITY|COUNTRY"},DK:{optionalParameters:{},zipValidator:/^\d{4}$/,zipFormat:"numeric",addressFormat:"ZIP CITY|COUNTRY"},ES:{optionalParameters:{},zipValidator:/^\d{5}$/,zipFormat:"numeric",addressFormat:"ZIP CITY (STATE)|COUNTRY"},FI:{optionalParameters:{},zipValidator:/^\d{5}$/,zipFormat:"numeric",addressFormat:"ZIP CITY|COUNTRY"},FR:{optionalParameters:{},zipValidator:/^\d{2}[ ]?\d{3}$/,zipFormat:"numeric",addressFormat:"ZIP CITY|COUNTRY"},GB:{optionalParameters:{},zipValidator:/^GIR[ ]?0AA|((AB|AL|B|BA|BB|BD|BH|BL|BN|BR|BS|BT|CA|CB|CF|CH|CM|CO|CR|CT|CV|CW|DA|DD|DE|DG|DH|DL|DN|DT|DY|E|EC|EH|EN|EX|FK|FY|G|GL|GY|GU|HA|HD|HG|HP|HR|HS|HU|HX|IG|IM|IP|IV|JE|KA|KT|KW|KY|L|LA|LD|LE|LL|LN|LS|LU|M|ME|MK|ML|N|NE|NG|NN|NP|NR|NW|OL|OX|PA|PE|PH|PL|PO|PR|RG|RH|RM|S|SA|SE|SG|SK|SL|SM|SN|SO|SP|SR|SS|ST|SW|SY|TA|TD|TF|TN|TQ|TR|TS|TW|UB|W|WA|WC|WD|WF|WN|WR|WS|WV|YO|ZE)(\d[\dA-Z]?[ ]?\d[ABD-HJLN-UW-Z]{2}))|BFPO[ ]?\d{1,4}$/,zipFormat:"alphanumeric",addressFormat:"CITY|ZIP|COUNTRY"},GR:{optionalParameters:{},zipValidator:/^\d{3}[ ]?\d{2}$/,zipFormat:"numeric",addressFormat:"ZIP CITY|COUNTRY"},IE:{optionalParameters:{state:!0},zipValidator:/^/,zipFormat:"alphanumeric",addressFormat:"CITY ZIP|STATE|COUNTRY"},IT:{optionalParameters:{},zipValidator:/^\d{5}$/,zipFormat:"numeric",addressFormat:"ZIP CITY STATE|COUNTRY"},IL:{optionalParameters:{},zipValidator:/(^\d{5}$)|(^\d{7}$)/,zipFormat:"numeric",addressFormat:"ZIP CITY|COUNTRY"},MX:{optionalParameters:{},zipValidator:/^\d{5}$/,zipFormat:"numeric",addressFormat:"ZIP CITY STATE|COUNTRY"},NL:{optionalParameters:{},zipValidator:/^\d{4}[ ]?[A-Z]{2}$/,zipFormat:"alphanumeric",addressFormat:"ZIP CITY|COUNTRY"},NO:{optionalParameters:{},zipValidator:/^\d{4}$/,zipFormat:"numeric",addressFormat:"ZIP CITY|COUNTRY"},NZ:{optionalParameters:{},zipValidator:/^/,zipFormat:"alphanumeric",addressFormat:"CITY ZIP|COUNTRY"},PL:{optionalParameters:{},zipValidator:/^\d{2}-\d{3}$/,zipFormat:"numeric",addressFormat:"ZIP CITY|COUNTRY"},PT:{optionalParameters:{},zipValidator:/^\d{4}([\-]\d{3})?$/,zipFormat:"numeric",addressFormat:"ZIP CITY/STATE|COUNTRY"},RU:{optionalParameters:{},zipValidator:/^(\d{3})|(\d{6})$/,zipFormat:"numeric",addressFormat:"CITY STATE|ZIP|COUNTRY"},SE:{optionalParameters:{},zipValidator:/^\d{3}[ ]?\d{2}$/,zipFormat:"numeric",addressFormat:"ZIP CITY|COUNTRY"},SA:{optionalParameters:{},zipValidator:/(^\d{5}$)|(^\d{5}-\d{4}$)/,zipFormat:"numeric",addressFormat:"CITY, STATE ZIP|COUNTRY"},SG:{optionalParameters:{},zipValidator:/^\d{6}$/,zipFormat:"numeric",addressFormat:"CITY ZIP|COUNTRY"},SK:{optionalParameters:{},zipValidator:/^\d{3}[ ]?\d{2}$/,zipFormat:"numeric",addressFormat:"ZIP CITY|COUNTRY"},US:{optionalParameters:{},zipValidator:/(^\d{5}$)|(^\d{5}-\d{4}$)/,zipFormat:"numeric",addressFormat:"CITY, STATE ZIP|COUNTRY"},JP:{optionalParameters:{},zipValidator:/^\d{3}-\d{4}$|^\d{7}$/,zipFormat:"numeric",addressFormat:"CITY|STATE ZIP|COUNTRY"}};return{localizeAddressFormat:function(e){let t,i,a,o,s,r,l,c,d,p;if(n[e.country_code]&&n[e.country_code].addressFormat){for(t={STREET1:e.street,STREET2:e.street_2,CITY:e.city,STATE:e.state,ZIP:e.zip,COUNTRY:e.country_name},i="STREET1|STREET2|"+n[e.country_code].addressFormat,a=i.split("|"),o=[],s=0;s<a.length;s++){for(r=a[s],p=Object.keys(t),l=p.length>0?new RegExp(p.join("|")).exec(r):null;null!==l;)r=r.replace(l[0],t[l[0]]||""),delete t[l[0]],p=Object.keys(t),l=p.length>0?new RegExp(p.join("|")).exec(r):null;r.length>0&&!t[r]&&o.push(r)}return o}for(c=["street","street_2","city","state","zip","country_name"],d=[],s=0;s<c.length;s++)e[c[s]]&&d.push(e[c[s]]);return d},localize:function(e){if(!("TM"in window)){const e=new Error,t="stack"in e?e.stack:"unknown stack";return void Log.server("load order problem - geo.localize called before TM loaded "+t,"error")}const i={labels:{state:TM("State / Province / Region",{},"generic country state address label"),zip:TM("ZIP / Postal Code",{},"generic country postal code address label"),zipType:"postal-code"},optionalParameters:{state:!0,zip:!0},zipValidator:/^/,zipFormat:"alphanumeric",isFallback:!0};if(e&&e in n){const i=n[e];return t||("TM"in window?t={AT:{zip:TM("Postal Code"),zipType:"postal-code"},AU:{state:TM("State"),zip:TM("Postcode"),zipType:"postcode"},BE:{zip:TM("Postal Code"),zipType:"postal-code"},BR:{state:TM("Province"),zip:TM("Postal Code"),zipType:"postal-code"},CA:{state:TM("Province"),zip:TM("Postal Code"),zipType:"postal-code"},CH:{zip:TM("Postal Code"),zipType:"postal-code"},CZ:{zip:TM("ZIP Code"),zipType:"zip"},DE:{zip:TM("Postal Code"),zipType:"postal-code"},DK:{zip:TM("ZIP Code"),zipType:"zip"},ES:{state:TM("State"),zip:TM("Postal Code"),zipType:"postal-code"},FI:{zip:TM("Postal Code"),zipType:"postal-code"},FR:{zip:TM("Postal Code"),zipType:"postal-code"},GB:{zip:TM("Postcode"),zipType:"postcode"},GR:{zip:TM("ZIP Code"),zipType:"zip"},IE:{state:TM("County"),zip:TM("Postcode"),zipType:"postcode"},IT:{state:TM("Province"),zip:TM("Postal Code"),zipType:"postal-code"},IL:{zip:TM("Postal Code"),zipType:"postal-code"},MX:{state:TM("Province"),zip:TM("Postal Code"),zipType:"postal-code"},NL:{zip:TM("Postal Code"),zipType:"postal-code"},NO:{zip:TM("Postal Code"),zipType:"postal-code"},NZ:{zip:TM("Postcode"),zipType:"postcode"},PL:{zip:TM("Postal Code"),zipType:"postal-code"},PT:{zip:TM("Postal Code"),zipType:"postal-code"},RU:{state:TM("Territory"),zip:TM("Postal Code"),zipType:"postal-code"},SE:{zip:TM("Postal Code"),zipType:"postal-code"},SA:{zip:TM("ZIP Code"),zipType:"zip"},SG:{zip:TM("ZIP Code"),zipType:"zip"},SK:{zip:TM("ZIP Code"),zipType:"zip"},US:{state:TM("State"),zip:TM("ZIP Code"),zipType:"zip"},JP:{street:TM("Street",{},"used for an address in Japan","jp address"),state:TM("Prefecture"),zip:TM("Postal Code"),zipType:"postal-code"}}:Log.server("load order problem - TM needs to load before address form labels are referenced in geo.js","warn")),!("labels"in i)&&t&&e in t&&(i.labels=t[e]),i}return i},isUSBuyer:function(){const e=$("#pagedata").data("blob")||{},t=e.fan_location_country,n=e.ip_location_country_code,i=["US","United States","United States of America","USA"];return t?-1!==$.inArray(t,i):window.ClientPrefs&&!window.ClientPrefs.is_default?"US"===window.ClientPrefs.country:!n||"US"===n},isEUCountry:function(t){return!!Iter.find(e,(function(e){return e===t}))},getDefaultCountryCode:function(){if(window.ClientPrefs&&!window.ClientPrefs.is_default)return window.ClientPrefs.country;return($("#pagedata").data("blob")||{}).ip_location_country_code||""}}}();!function(e,t){"use strict";const n={doAction:function(n,i,a,o,s,r,l,c){const d=U.pagedataBlob()||{};d.cfg;let p=null;const u=Identities.bmgr.bands().length>0,m=Identities.fan()&&!Identities.fan().private&&!Identities.fan().verified;if("wishlist"===n?p=m?"unverified_fan_wishlist_open":u?"logged_out_wishlist_open_band_no_fan":"logged_out_wishlist_open":"follow"===n&&"f"===s?p=m?"unverified_fan_fan_follow_open":u?"logged_out_fan_follow_open_band_no_fan":"logged_out_fan_follow_open":"follow"!==n||s&&"b"!==s?"follow"!==n||s&&"g"!==s?"live_ticket"!==n&&"live_attend"!==n&&"live_attend_immediate"!==n||(p=u?"logged_out_live_ticket_purchase_open_band_no_fan":"logged_out_live_ticket_purchase_open"):p=m?"unverified_fan_follow_open":u?"logged_out_follow_open_band_no_fan":"logged_out_genre_follow_open":p=m?"unverified_fan_follow_open":u?"logged_out_follow_open_band_no_fan":"logged_out_follow_open",p&&Stats.record({kind:"click",click:p}),"wishlist"===n||"follow"===n&&"b"===s){const e={click_type:n,item_id:o,item_type:s,user_type:"guest"};BCTracker.record("click",e)}0===(i=i||"").length&&d.signup_querystrings&&(i=d.signup_querystrings[s+o]||"");const _=a||("follow"==n?"loflwlgn":"lowllgn"),h=a||("follow"==n?"loflwlrn":"lowllrn");let f,b;if(i.length>0?(f=siteroot_https+"/login"+i+"&action="+n+"&from="+_,b=siteroot_https+"/fans"+i+"&action="+n+"&from="+h):(f=siteroot_https+"/login?action="+n+"&from="+_,b=siteroot_https+"/fans?action="+n+"&from="+h),Identities.fan()&&!Identities.fan().private&&!Identities.fan().verified&&e.VerifyNag){const t=d.signup_params.email||e.FanSignup.state.email;e.verifyNag=e.verifyNag||new VerifyNag({fan_email:t}),e.verifyNag.openDialog()}else if(e.FanSignup){const d=(!Identities.fan()||Identities.fan().private)&&Identities.user();if("phone"===MediaView.mode&&d){const t=siteroot_https+"/fan_signup"+i+"&action="+n+"&from="+h+"&pane=existing_artist";e.location.href=t}else if(Url.isCustomDomain()&&d)if(FanSignup.subdomainURL){const t={fan_action_pane:"existing_artist",fan_action:n};e.location.href=Url.addQueryParams(FanSignup.subdomainURL,t)}else e.location.href=siteroot_https+"/fans";else{let e;FanSignup.actionParams={action:n},o&&s?(FanSignup.actionParams.actionItemId=o,FanSignup.actionParams.actionItemType=s,FanSignup.actionParams.actionBandId=r):r&&(FanSignup.actionParams.actionBandId=r),l&&(FanSignup.actionParams.collectData=l),c&&(FanSignup.actionParams=t.extend({},FanSignup.actionParams,c)),FanSignup.actionParams.from=a,FanSignup.actionParams.queryString=i,e=d&&FanSignup.affiliations&&(FanSignup.affiliations.fan||FanSignup.affiliations.fan_already_linked_email)?"dupe_fan":d?"existing_artist":"action",FanSignup.openPane(e,!0)}}else{let t;"wishlist"==n?t=TM("Wishlist"):"follow"===n&&(t=TM("Follow"));const i={title:t,buttons:[],minHeight:100};"desktop"===MediaView.mode&&(i.width="38em"),NuDialog.showTemplate("fan/fan_action_panel",{siteroot:e.siteroot,is_band_member:Identities.bmgr.bands().length>0,action:n,loginUrl:f,signupUrl:b},i)}}};e.FanAction=n,t(document).ready((function(){const n=Url.parseQuery(location.search),i=U.pagedataBlob()||{};i.cfg;if(n.show_nag){const t=i.signup_params.email||e.FanSignup.state.email;e.verifyNag=e.verifyNag||new VerifyNag({fan_email:t}),e.verifyNag.openDialog(),SignupUtils.cleanURL()}t(document).on("visibilitychange",(function(){document.visibilityState&&"visible"===document.visibilityState&&!Identities.user()&&Cookie.get("js_logged_in")&&e.location.reload(!0)}))}))}(window,jQuery),window.PaymentTypePanel=function(){"use strict";return{onchange:function(){},init:function(e,t){return this.dlg=null,this._from=null,"function"==typeof e&&(this.onchange=e),"function"==typeof t&&(this.save=t),this},getCenterDialogCSS:function(){return{left:$(window).width()/2-$(".payment-pref-dlg").width()/2}},getDimensionsCSS:function(){return{height:$(".payment-pref-dlg").height()+$(".ui-dialog-titlebar").outerHeight(),width:$(".payment-pref-dlg").width()}},setDialog:function(e){this.dlg=e},lockDimensions:function(e){const t=e.parent().height(),n=e.parent().width();return e.parent().css({display:"block",float:"left",height:t,width:n}),{height:t,width:n}},setupTransitions:function(e){e.parent().css({"transition-property":"top, left, height, width","transition-duration":"0.2s, 0.2s, 0.2s, 0.2s"})},updateSelection:function(){$(".payment-pref-dlg div").removeClass("selected"),$(".payment-pref-dlg input[name=payment-type]:checked").closest("div").addClass("selected")},from:function(e){if(void 0===e)return this._from||"dialog";this._from=e},save:function(){Sidecart.checkout_wait();const e=$(".payment-pref-dlg input[name=payment-type]:checked").val();return this.onchange(e),this.hide(),Sidecart.checkout(null,this.from()),!1},registerEvents:function(){const e=this;$(".payment-pref-dlg input[name=payment-type]:checked").closest("div").addClass("selected"),$(".payment-pref-dlg input[name=payment-type]").on("change",this.updateSelection),$(".payment-pref-dlg  button").on("click",(function(t){return e.save(),!1})),"phone"===MediaView.mode?$(".payment-pref-dlg form div").on("click",(function(){return $(this).find("input").prop("checked",!0),e.save(),!1})):$(".payment-pref-dlg form div").on("click",(function(){$(this).find("input").prop("checked",!0),e.updateSelection()}))},title:function(){return TM("How would you like to pay?")},show:function(e,t){const n="checkout"===this._from?t:Sidecart.hasNonUsdCardableItems();this.dlg=NuDialog.showTemplate("cart/payment_pref",{non_usd_cardable_items:n},$.extend({width:"auto",minHeight:0,closeOnEscape:!0,title:this.title(),draggable:!0,buttons:[],dialogClass:"no-padding"},e)),this.registerEvents()},hide:function(){this.dlg&&this.dlg.dialog("close")},showPleaseWait:function(){const e=$(".payment-pref-dlg button.proceed");e.prop("disabled",!0),e.text(TM("Please wait..."))},showPaypalWait:function(){$(".payment-pref-dlg").toggleClass("paypal-wait")},zzz:null}}(),window.ChangePaymentMethodVM=function(e,t){"use strict";return function(t,n){const i=this;this.$el=e(n),this._pmPanel=t,this.changeCardDetails=function(){const e=window.TralbumData?TralbumData.url:location.href,t=Sidecart.getCheckoutParams(null,e),n={pane:"creditcard",return_params:Url.joinQuery(t)};window.top.location.href=TemplGlobals.siteroot_https+"/settings?"+Url.joinQuery(n)},this.close=function(){this._pmPanel.hide()},this.startPayPalFlow=function(){PleaseWaitPanel.show(!1),Sidecart.payment_pref_override="p",Sidecart.checkout(),i.close()}}}(jQuery,ko),window.ChangePaymentMethodPanel=function(){"use strict";return{getCenterDialogCSS:function(){return{left:$(window).width()/2-$(".change-payment-method-dlg").width()/2}},getDimensionsCSS:function(){return{height:$(".change-payment-method-dlg").height()+$(".ui-dialog-titlebar").outerHeight(),width:$(".change-payment-method-dlg").width()}},setDialog:function(e){this.dlg=e},lockDimensions:function(e){const t=e.parent().height(),n=e.parent().width();return e.parent().css({display:"block",float:"left",height:t,width:n}),{height:t,width:n}},setupTransitions:function(e){e.parent().css({"transition-property":"top, left, height, width","transition-duration":"0.2s, 0.2s, 0.2s, 0.2s"})},dropTransitions:function(e){e.parent().css({"transition-property":"none","transition-duration":"none"})},hide:function(){this.dlg&&this.dlg.dialog("close")},title:function(){return TM("Change payment method")},show:function(e){this.dlg=NuDialog.showTemplate("cart/change_payment_method",{savedCard:Sidecart.saved_card},$.extend({width:"auto",minHeight:0,closeOnEscape:!0,title:this.title(),draggable:!0,buttons:[],dialogClass:"no-padding"},e)),this.initVM()},initVM:function(){const e=new ChangePaymentMethodVM(this,".change-payment-method-dlg");ko.applyBindings(e,e.$el[0])},zzz:null}}();var GiftPanel={validateGiftDetails:function(e,t,n){const i=100,a=1e3;let o=!1;const s=window.MediaView?MediaView.mode:null,r=function(t){const n=e[t].parent();setTimeout((function(){$("html, body").animate({scrollTop:n.offset().top-5})}),100)},l=function(){if(t||0!==e.senderName.val().length)if(!t&&e.senderName.val().length>=i){e.senderNameError.addClass("alertActive");const t=TM("Your name must be less than {{num}} characters.",{num:i});e.senderNameError.text(t),e.senderName.addClass("has-validation-error"),o||"phone"!=s||r("senderName"),o=!0}else e.senderNameError.removeClass("alertActive"),e.senderName.removeClass("has-validation-error");else e.senderNameError.addClass("alertActive"),e.senderNameError.text(TM("Please enter your name.")),e.senderName.addClass("has-validation-error"),o||"phone"!=s||r("senderName"),o=!0},c=function(){if(t||0!==e.recipientName.val().length)if(!t&&e.recipientName.val().length>=i){e.recipientNameError.addClass("alertActive");const t=TM("The recipientâ€™s name must be less than {{num}} characters.",{num:i});e.recipientNameError.text(t),e.recipientName.addClass("has-validation-error"),o||"phone"!=s||r("recipientName"),o=!0}else e.recipientNameError.removeClass("alertActive"),e.recipientName.removeClass("has-validation-error");else e.recipientNameError.addClass("alertActive"),e.recipientNameError.text(TM("Please enter the recipientâ€™s name.")),e.recipientName.addClass("has-validation-error"),o||"phone"!=s||r("recipientName"),o=!0},d=function(){if(t||0!==e.recipientEmail.val().length&&GiftPanel.emailValid(e.recipientEmail.val()))if(!t&&e.recipientEmail.val().length>=i){e.recipientEmailError.addClass("alertActive");const t=TM("Recipientâ€™s email must be less than {{num}} characters.",{num:i});e.recipientEmailError.text(t),e.recipientEmail.addClass("has-validation-error"),o||"phone"!=s||r("recipientEmail"),o=!0}else e.recipientEmailError.removeClass("alertActive"),e.recipientEmail.removeClass("has-validation-error");else e.recipientEmailError.addClass("alertActive"),e.recipientEmailError.text(TM("Please enter an email like: lucky@duck.com")),e.recipientEmail.addClass("has-validation-error"),o||"phone"!=s||r("recipientEmail"),o=!0},p=function(){if(!t&&e.senderNote.val().length>=a){e.senderNoteError.addClass("alertActive");const t=TM("Sender note must be less than {{num}} characters.",{num:a});e.senderNoteError.text(t),e.senderNote.addClass("has-validation-error"),o||"phone"!=s||r("senderNote"),o=!0}else e.senderNoteError.removeClass("alertActive"),e.senderNote.removeClass("has-validation-error")};if("senderName"===t)l();else if("recipientName"===t)c();else if("recipientEmail"===t)d();else{if("senderName"!==t)return l(),c(),n&&!e.recipientEmail.val().length||d(),p(),!o;p()}},emailValid:function(e){return/(^)([^\s\(\)"'\/><,@]+@\w([^\s\(\)"'\/><&,@]*\w)?\.\w[^\s\(\)"'\/><&,@]*\w)($)/.test(e)}},PhysicalGiftViewModel=function(e,t,n,i){const a=this;function o(){return a.localization.optionalParameters.state?TM("(optional)"):""}function s(){return a.localization.optionalParameters.zip?TM("(optional)"):""}ko.extenders.validate=function(e){return e.subscribe((function(){e().length>0&&e.validate(!0)})),e},a.form="form[name='physical-gift']",a.hasValidationErrors=!1,a.errorTexts={state:{error:TM("Please enter the recipientâ€™s state."),tooLong:TM("Recipientâ€™s state must be less than 60 characters.")},province:{error:TM("Please enter the recipientâ€™s province."),tooLong:TM("Recipientâ€™s province must be less than 60 characters.")},prefecture:{error:TM("Please enter the recipientâ€™s prefecture."),tooLong:TM("Recipientâ€™s prefecture must be less than 60 characters.")},territory:{error:TM("Please enter the recipientâ€™s territory."),tooLong:TM("Recipientâ€™s territory must be less than 60 characters.")},county:{error:TM("Please enter the recipientâ€™s county."),tooLong:TM("Recipientâ€™s county must be less than 60 characters.")},"ZIP code":{error:TM("Sorry, that doesnâ€™t appear to be a valid ZIP code."),tooLong:TM("Recipientâ€™s ZIP code must be less than 20 characters.")},"postal code":{error:TM("Sorry, that doesnâ€™t appear to be a valid postal code."),tooLong:TM("Recipientâ€™s postal code must be less than 20 characters.")},postcode:{error:TM("Sorry, that doesnâ€™t appear to be a valid postcode."),tooLong:TM("Recipientâ€™s postcode must be less than 20 characters.")}},a.senderName=ko.observable(e.sender_name).extend({validate:""}),a.recipientName=ko.observable(e.recipient_name).extend({validate:""}),a.recipientFanId=e.recipient_fan_id,a.recipientEmail=ko.observable(e.recipient_email).extend({validate:""}),a.senderNote=ko.observable(e.sender_note),a.shippable=ko.observable(e.shippable),a.shippingStreet=ko.observable(e.shipping_street).extend({validate:""}),a.shippingStreet2=ko.observable(e.shipping_street_2).extend({validate:""}),a.shippingCity=ko.observable(e.shipping_city).extend({validate:""}),a.shippingState=ko.observable(e.shipping_state).extend({validate:""}),a.shippingStateName=ko.observable(e.shipping_state_name),a.shippingStateCode=ko.observable(e.shipping_state).extend({validate:""}),a.shippingZIP=ko.observable(e.shipping_zip).extend({validate:""}),a.shippingCountry=ko.observable(CountryList.getCountryName(e.shipping_country_code)),a.shippingCountryCode=ko.observable(e.shipping_country_code),a.countryList=CountryList.allCountries(),a.setOptionDisable=CountryList.disableSeparators(),a.prettyShippingCountry=ko.computed((function(){let e="GB"==a.shippingCountryCode()?"the ":"";return e+=a.shippingCountry(),e})),a.isUSBuyer=ko.observable(e.is_us_buyer),a.shippingRestrictionWarningVisible=ko.computed((function(){return!(!a.isUSBuyer()||"US"===a.shippingCountryCode())})),a.shippingToJapanWarningVisible=ko.computed((function(){return"JP"===a.shippingCountryCode()})),a.senderNameError=ko.observable(""),a.recipientNameError=ko.observable(""),a.recipientEmailError=ko.observable(""),a.shippingStreetError=ko.observable(""),a.shippingStreet2Error=ko.observable(""),a.shippingCityError=ko.observable(""),a.shippingStateError=ko.observable(""),a.shippingZIPError=ko.observable(""),a.shippingCountryError=ko.observable(""),a.shippingPhoneNumberError=ko.observable(""),a.localization=Geo.localize(a.shippingCountryCode()),a.shippingStateLabel=ko.observable(a.localization.labels.state),a.shippingZIPLabel=ko.observable(a.localization.labels.zip),a.shippingStatePlaceholder=ko.observable(o()),a.shippingZIPPlaceholder=ko.observable(s()),a.shippingCountryCode.subscribe((function(){a.shippingCountry($(a.form).find("#countrySelect option:selected").text()),a.updateLocalization(),a.shippingZIPError(""),a.shippingStateError(""),a.shippingCityError(""),a.shippingState("")})),a.shippingStateCode.subscribe((function(){a.shippingStateName($(a.form).find("#stateSelect option:selected").text())})),a.submitEnabled=ko.computed((function(){if("addressUpdate"===i)return!0;return a.senderName()&&a.senderName().length>0&&a.recipientName()&&a.recipientName().length>0&&(a.recipientEmail()&&a.recipientEmail().length>0||a.recipientFanId)})),a.useZipRegex=e._use_zip_regex,a.updateLocalization=function(){a.localization=Geo.localize(a.shippingCountryCode()),a.shippingStateLabel(a.localization.labels.state),a.shippingStatePlaceholder(o()),a.shippingZIPLabel(a.localization.labels.zip),a.shippingZIPPlaceholder(s())},a.focused=!1,a.focusOnError=function(e){if(a.focused)return;if("phone"==(window.MediaView?MediaView.mode:null)){const t=$(e).parent();setTimeout((function(){$("html, body").animate({scrollTop:t.offset().top-5})}),10)}$("input",e).focus(),a.focused=!0},a.submit=function(){a.validateAll(),a.hasValidationErrors||(e={sender_name:$.trim(a.senderName()),recipient_name:$.trim(a.recipientName()),recipient_email:$.trim(a.recipientEmail()),recipient_fan_id:$.trim(a.recipientFanId),shipping_street:$.trim(a.shippingStreet()),shipping_street_2:$.trim(a.shippingStreet2()),shipping_city:$.trim(a.shippingCity()),shipping_zip:$.trim(a.shippingZIP()),shipping_country_code:a.shippingCountryCode(),shipping_country_name:a.shippingCountry(),shippable:a.shippable(),is_us_buyer:a.isUSBuyer()},"US"===a.shippingCountryCode()?(e.shipping_state=a.shippingStateCode(),e.shipping_state_name=a.shippingStateName()):e.shipping_state=a.shippingState(),a.senderNote()&&!/^\s+$/.test(a.senderNote())&&(e.sender_note=a.senderNote().substring(0,1e3)),$.isFunction(t)&&t(e))},a.cancel=function(){$.isFunction(n)&&n()},a.senderName.validate=function(e){a.senderName()&&0!==a.senderName().length?a.senderName().length>100?(a.senderNameError(TM("Your name must be less than 100 characters.")),a.hasValidationErrors=!0,a.focusOnError("#gift-sender-name")):a.senderNameError(""):(a.senderNameError(TM("Please enter your name.")),a.hasValidationErrors=!0,a.focusOnError("#gift-sender-name"))},a.recipientName.validate=function(e){a.recipientName()&&0!==a.recipientName().length?a.recipientName().length>100?(a.recipientNameError(TM("The recipientâ€™s name must be less than 100 characters.")),a.hasValidationErrors=!0,a.focusOnError("#gift-recipient-name")):a.recipientNameError(""):(a.recipientNameError(TM("Please enter the recipientâ€™s name.")),a.hasValidationErrors=!0,a.focusOnError("#gift-recipient-name"))},a.recipientEmail.validate=function(e){a.recipientFanId||(a.recipientEmail()&&0!==a.recipientEmail().length&&(e||GiftPanel.emailValid(a.recipientEmail()))?a.recipientEmail().length>100?(a.recipientEmailError(TM("Recipientâ€™s email must be less than 100 characters.")),a.hasValidationErrors=!0,a.focusOnError("#gift-recipient-email")):a.recipientEmailError(""):(a.recipientEmailError(TM("Please enter an email like: lucky@duck.com")),a.hasValidationErrors=!0,a.focusOnError("#gift-recipient-email")))},a.shippingStreet.validate=function(e){a.shippingStreet()&&0!==a.shippingStreet().length?a.shippingStreet().length>150?(a.shippingStreetError(TM("Recipientâ€™s address must be less than 150 characters.")),a.hasValidationErrors=!0,a.focusOnError("#gift-street")):a.shippingStreetError(""):(a.shippingStreetError(TM("Please enter the recipientâ€™s address.")),a.hasValidationErrors=!0,a.focusOnError("#gift-street"))},a.shippingStreet2.validate=function(e){a.shippingStreet2()&&a.shippingStreet2().length>150?(a.shippingStreet2Error(TM("Recipientâ€™s address must be less than 150 characters.")),a.hasValidationErrors=!0,a.focusOnError("#gift-street-2")):a.shippingStreet2Error("")},a.shippingCity.validate=function(e){a.shippingCity()&&0!==a.shippingCity().length?a.shippingCity().length>150?(a.shippingCityError(TM("Recipientâ€™s city must be less than 150 characters.")),a.hasValidationErrors=!0,a.focusOnError("#gift-city")):a.shippingCityError(""):(a.shippingCityError(TM("Please enter the recipientâ€™s city.")),a.hasValidationErrors=!0,a.focusOnError("#gift-city"))},a.shippingState.validate=function(e){let t;if("US"===a.shippingCountryCode())return;const n=a.localization.labels.state?a.localization.labels.state.toLowerCase():null;n&&!a.localization.isFallback&&(a.shippingState()&&0!==a.shippingState().length||a.localization.optionalParameters.state?a.shippingState().length>60?(t=a.errorTexts[n]?a.errorTexts[n].tooLong:a.errorTexts.state.tooLong,a.shippingStateError(t),a.hasValidationErrors=!0,a.focusOnError("#gift-state")):a.shippingStateError(""):(t=a.errorTexts[n]?a.errorTexts[n].error:a.errorTexts.state.error,a.shippingStateError(t),a.hasValidationErrors=!0,a.focusOnError("#gift-state")))},a.shippingStateCode.validate=function(e){"US"===a.shippingCountryCode()&&(e||"--"!==a.shippingStateCode()?a.shippingStateError(""):(a.shippingStateError(TM("Please enter the recipientâ€™s state.")),a.hasValidationErrors=!0))},a.shippingZIP.validate=function(e){const t=a.localization.labels.zip?a.localization.labels.zip.toLowerCase().replace("zip","ZIP"):null;let n;if(!t||a.localization.isFallback)return;a.shippingZIP()&&a.shippingZIP(a.shippingZIP().toUpperCase());let i=!0;a.useZipRegex&&(i=a.localization.zipValidator.test(a.shippingZIP())),a.shippingZIP()&&0!==a.shippingZIP().length&&(e||i)?a.shippingZIP().length>20?(n=a.errorTexts[t]?a.errorTexts[t].tooLong:a.errorTexts["ZIP code"].tooLong,a.shippingZIPError(n),a.hasValidationErrors=!0,a.focusOnError("#gift-zip")):a.shippingZIPError(""):(n=a.errorTexts[t]?a.errorTexts[t].error:a.errorTexts["ZIP code"].error,a.shippingZIPError(n),a.hasValidationErrors=!0,a.focusOnError("#gift-zip"))},a.validateAll=function(){a.hasValidationErrors=!1,a.focused=!1,"addressUpdate"===i?(a.shippingStreet.validate(),a.shippingStreet2.validate(),a.shippingCity.validate(),a.shippingZIP.validate(),a.shippingState.validate(),a.shippingStateCode.validate()):a.shippable()?(a.senderName.validate(),a.recipientName.validate(),a.recipientEmail.validate(),a.shippingStreet.validate(),a.shippingStreet2.validate(),a.shippingCity.validate(),a.shippingZIP.validate(),a.shippingState.validate(),a.shippingStateCode.validate()):(a.senderName.validate(),a.recipientName.validate(),a.recipientEmail.validate())}};CurrencyCodes={AF:"USD",AX:"EUR",AL:"ALL",DZ:"DZD",AS:"USD",AD:"EUR",AO:"USD",AI:"XCD",AQ:"USD",AG:"XCD",AR:"ARS",AM:"EUR",AW:"AWG",AC:"SHP",AU:"AUD",AT:"EUR",AZ:"USD",BS:"BSD",BH:"BHD",BD:"BDT",BB:"BBD",BY:"EUR",BE:"EUR",BZ:"BZD",BJ:"XOF",BM:"BMD",BT:"BTN",BO:"BOB",BA:"EUR",BW:"BWP",BV:"NOK",BR:"BRL",IO:"USD",BN:"BND",BG:"EUR",BF:"XOF",BI:"BIF",KH:"KHR",CM:"XAF",CA:"CAD",CV:"CVE",BQ:"USD",KY:"KYD",CF:"XAF",TD:"XAF",CL:"CLP",CN:"CNY",CX:"AUD",CC:"AUD",CO:"COP",KM:"KMF",CG:"XAF",CD:"USD",CK:"NZD",CR:"CRC",CI:"XOF",HR:"HRK",CU:"USD",CW:"ANG",CY:"EUR",CZ:"CZK",DK:"DKK",DJ:"DJF",DM:"XCD",DO:"DOP",EC:"USD",EG:"EGP",SV:"USD",GQ:"XAF",ER:"USD",EE:"EUR",ET:"ETB",FK:"FKP",FO:"DKK",FJ:"USD",FI:"EUR",FR:"EUR",GF:"EUR",PF:"XPF",TF:"EUR",GA:"XAF",GM:"GMD",GE:"EUR",DE:"EUR",GH:"USD",GI:"GIP",GR:"EUR",GL:"DKK",GD:"XCD",GP:"EUR",GU:"USD",GT:"GTQ",GG:"GBP",GN:"GNF",GW:"XOF",GY:"GYD",HT:"HTG",HM:"AUD",HN:"HNL",HK:"HKD",HU:"HUF",HY:"RUP",IS:"ISK",IN:"INR",ID:"IDR",IR:"USD",IQ:"IQD",IE:"EUR",IM:"GBP",IL:"ILS",IT:"EUR",JM:"JMD",JP:"JPY",JE:"GBP",JO:"JOD",KZ:"KZT",KE:"KES",KI:"AUD",XK:"EUR",KW:"KWD",KG:"USD",LA:"LAK",LV:"EUR",LB:"LBP",LS:"LSL",LR:"LRD",LY:"LYD",LI:"CHF",LT:"EUR",LU:"EUR",MO:"MOP",MK:"MKD",MG:"USD",MW:"MWK",MY:"MYR",MV:"MVR",ML:"XOF",MT:"EUR",MH:"USD",MQ:"EUR",MR:"MRU",MU:"MUR",YT:"EUR",MX:"MXN",FM:"USD",UM:"USD",MD:"MDL",MC:"EUR",MN:"MNT",ME:"EUR",MS:"XCD",MA:"MAD",MZ:"USD",MM:"MMK",NA:"NAD",NR:"AUD",NP:"NPR",NL:"EUR",AN:"ANG",NC:"XPF",NZ:"NZD",NI:"NIO",NE:"XOF",NG:"NGN",NU:"NZD",NF:"AUD",KP:"KPW",MP:"USD",NO:"NOK",OM:"OMR",PK:"PKR",PW:"USD",PS:"ILS",PA:"PAB",PG:"PGK",PY:"PYG",PE:"PEN",PH:"PHP",PN:"NZD",PL:"PLN",PT:"EUR",PR:"USD",QA:"QAR",RE:"EUR",RO:"EUR",RU:"RUB",RW:"USD",BL:"EUR",SH:"SHP",KN:"XCD",LC:"XCD",MF:"EUR",PM:"EUR",VC:"XCD",WS:"WST",SM:"EUR",ST:"STD",SA:"SAR",SN:"XOF",RS:"EUR",SC:"SCR",SL:"SLL",SG:"SGD",SX:"AWG",SK:"EUR",SI:"EUR",SB:"SBD",SO:"SOS",ZA:"ZAR",GS:"GBP",KR:"KRW",SS:"USD",ES:"EUR",LK:"LKR",SD:"USD",SR:"USD",SJ:"NOK",SZ:"SZL",SE:"SEK",CH:"CHF",SY:"SYP",TW:"TWD",TJ:"USD",TZ:"TZS",TH:"THB",TL:"USD",TG:"XOF",TK:"NZD",TO:"TOP",TT:"TTD",TA:"SHP",TN:"TND",TR:"TRY",TM:"USD",TC:"USD",TV:"AUD",UG:"UGX",UA:"UAH",AE:"AED",GB:"GBP",US:"USD",UY:"UYU",UZ:"USD",VU:"VUV",VA:"EUR",VE:"USD",VN:"USD",VG:"USD",VI:"USD",WF:"XPF",EH:"MAD",YE:"YER",ZM:"ZMW",ZW:"USD"},void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/cart/_img_preload.liquid","warn"):Templ.register({"cart/_img_preload":['<img src="',{type:"variable",name:"path",filters:[["a",[]]]},'" alt="preload image">']}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/cart/payment_pref.liquid","warn"):Templ.register({"cart/payment_pref":['\x3c!-- payment_pref.liquid --\x3e\n<div class="payment-pref-dlg">\n    <form>\n        <div>\n            <input name="payment-type" value="p" type="radio" checked id="pick-paypal" data-test="pick-paypal">\n            <label class="paypal" for="pick-paypal">',{type:"translate",nodelist:["PayPal"]},'</label>\n        </div>\n        <div>\n            <input name="payment-type" value="c" type="radio" id="pick-credit-card" data-test="pick-credit-card">\n            <label class="credit-card" for="pick-credit-card"><span>',{type:"translate",nodelist:["Credit card"]},'</span>\n                <ul class="we-accept-these-cards">\n                    <li class="icon-cc visa"></li>\n                    <li class="icon-cc mastercard"></li>\n                    ',{type:"ef",blocks:[{type:"ncondition",expression:"!non_usd_cardable_items ",attachment:['\n                        <li class="icon-cc discover"></li>\n                        <li class="icon-cc amex"></li>\n                    ']}]},'\n                </ul>\n            </label>\n        </div>\n       <button class="proceed" data-test="proceed">',{type:"translate",nodelist:["Proceed to payment"]},'</button>\n    </form>\n    <div class="paypal-wait-msg">\n        <span>',{type:"translate",nodelist:["Youâ€™ll now be taken to PayPal to complete your payment..."]},"</span>\n    </div>\n</div>\n"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/cart/change_payment_method.liquid","warn"):Templ.register({"cart/change_payment_method":['\n\x3c!-- change_payment_method.liquid --\x3e\n<div class="change-payment-method-dlg">\n    <div data-bind="click: changeCardDetails" class="row">\n        <span class="credit-card">',{type:"translate",nodelist:["Change card details"]},"</span>\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"savedCard ",attachment:['\n            <div class="saved-card-details">\n                <span class="icon-cc ',{type:"variable",name:"savedCard.brand_slug",filters:[["a",[]]]},'">',{type:"variable",name:"savedCard.brand_slug",filters:[["h",[]]]},'</span>\n                <span class="last-4">x-',{type:"variable",name:"savedCard.last4",filters:[["h",[]]]},"</span>\n            </div>\n        "]}]},'\n    </div>\n    <div data-bind="click: startPayPalFlow" class="row">\n        <span class="paypal" for="pick-paypal">',{type:"translate",nodelist:["Check out with PayPal"]},"</span>\n    </div>\n</div>\n"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/cart/sidecart_item.liquid","warn"):Templ.register({"cart/sidecart_item":['<div class="cartItemReveal reveal">\n<div class="cartItemContents">\n',{type:"let",variable:"description",expression:"item.item_title "},"\n\n",{type:"ef",blocks:[{type:"ncondition",expression:'!item.is_live_ticket && item.item_title2 && media_mode != "phone" ',attachment:["     ",{type:"capture",to:"description",nodelist:[{type:"variable",name:"item.item_title2",filters:[]},", ",{type:"variable",name:"description",filters:[]}]}]}]},"\n",{type:"ef",blocks:[{type:"ncondition",expression:"item.item_type == 'a' && media_mode != \"phone\" ",attachment:[{type:"capture",to:"description",nodelist:[{type:"translate",nodelist:["",{type:"variable",name:"description",filters:[]},", digital album"]}]}]}]},"\n",{type:"ef",blocks:[{type:"ncondition",expression:"item.item_type == 't' && media_mode != \"phone\" ",attachment:[{type:"capture",to:"description",nodelist:[{type:"translate",nodelist:["",{type:"variable",name:"description",filters:[]},", digital track"]}]}]}]},"\n",{type:"ef",blocks:[{type:"ncondition",expression:"item.item_type == 'b' && media_mode != \"phone\" ",attachment:["\n    ",{type:"capture",to:"description",nodelist:["\n        ",{type:"translate",nodelist:["",{type:"variable",name:"item.band_name",filters:[]},", full digital discography (",{type:"translateVariable",var_name:"num",nodelist:[{type:"variable",name:"item.releases",filters:[["h",[]]]}]}," releases)"]},"\n    "]},"\n"]}]},"\n",{type:"ef",blocks:[{type:"ncondition",expression:'item.option_name && media_mode != "phone" ',attachment:["     ",{type:"capture",to:"description",nodelist:[{type:"variable",name:"description",filters:[]},", ",{type:"variable",name:"item.option_name",filters:[]}]}]}]},"\n",{type:"ef",blocks:[{type:"ncondition",expression:'item.quantity > 1 && media_phone != "phone" ',attachment:["    ",{type:"capture",to:"description",nodelist:[{type:"translate",nodelist:["",{type:"variable",name:"description",filters:[]},", quantity ",{type:"translateVariable",var_name:"num",nodelist:[{type:"variable",name:"item.quantity",filters:[]}]},""]}]}]}]},"\n",{type:"ef",blocks:[{type:"ncondition",expression:"item.unavailable ",attachment:["     ",{type:"capture",to:"description",nodelist:[{type:"translate",nodelist:["",{type:"variable",name:"description",filters:[]}," (no longer available)"]}]}]}]},"\n\n",{type:"ef",blocks:[{type:"ncondition",expression:'media_mode == "phone" ',attachment:["\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"item.item_type == 'a' && !item.item_title2 ",attachment:["\n        ",{type:"capture",to:"item_type_disp",nodelist:[{type:"translate",nodelist:["Digital Album"]}]},"\n    "]},{type:"ncondition",expression:"item.item_type == 't' ",attachment:["\n    ",{type:"capture",to:"item_type_disp",nodelist:[{type:"translate",nodelist:["Digital Track"]}]},"\n    "]},{type:"ncondition",expression:"item.item_type == 'b' ",attachment:["\n        ",{type:"capture",to:"item_type_disp",nodelist:[{type:"translate",nodelist:["Full Digital Discography"]}]},"\n        ",{type:"let",variable:"description",expression:"item.band_name "},"\n    "]},{type:"ncondition",expression:"item.item_title2 ",attachment:["\n        ",{type:"let",variable:"item_type_disp",expression:"description "},"\n        ",{type:"let",variable:"description",expression:"item.item_title2 "},"\n    "]}]},'\n\n    <div class="thumb ',{type:"ef",blocks:[{type:"ncondition",expression:"item.item_type == 'p' ",attachment:["package"]}]},'"',{type:"ef",blocks:[{type:"ncondition",expression:"item.art_id ",attachment:[' style="background-image:url(',{type:"variable",name:"item.art_id",filters:[["art_url",['"art_embedded_player_large"']],["a",[]]]},')"']},{type:"ncondition",expression:"item.image_id ",attachment:[' style="background-image:url(',{type:"variable",name:"item.image_id",filters:[["image_url",['"package_thumb"']],["a",[]]]},')"']}]},"></div>\n\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"item.is_gift ",attachment:['<span class="gifticon bc-ui bc-ui-m"></span>']}]},'\n\n    <a class="itemName notSkinnable',{type:"ef",blocks:[{type:"ncondition",expression:"item.item_type == 'b' ",attachment:[" no-art"]}]},'" href="',{type:"variable",name:"item.url",filters:[["a",[]]]},'">',{type:"variable",name:"description",filters:[["a",[]]]},'</a>\n    <span class="item-price">',{type:"variable",name:"item.disp_price",filters:[]},'</span>\n    <span class="item-type">',{type:"variable",name:"item_type_disp",filters:[["a",[]]]},'</span>\n    \n    <br>\n    <a class="delete notSkinnable" href="#"><span>&#215</span></a>\n']},{type:"else_ncondition",attachment:["\n    <p>\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"item.is_gift ",attachment:['<span class="gifticon bc-ui bc-ui-m"></span>']}]},'\n        <a class="itemName notSkinnable" href="',{type:"variable",name:"item.url",filters:[["a",[]]]},'">',{type:"variable",name:"description",filters:[["h",[]]]},'</a>\n        <br>\n        <a class="delete notSkinnable" href="#"><span>x</span></a>\n        <span class="price">',{type:"variable",name:"item.disp_price",filters:[]},"</span>\n    </p>\n"]}]},"\n</div>\n</div>\n"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/cart/sidecart_summary.liquid","warn"):Templ.register({"cart/sidecart_summary":[{type:"let",variable:"hyrule",expression:"(currency == 'RUP') "},"\n",{type:"let",variable:"wallet",expression:"(hyrule && disp_total == '99') "},'\n\n<table id="summary">\n  ',{type:"ef",blocks:[{type:"ncondition",expression:"has_shipping || has_tax ",attachment:['\n    <tr>\n        <th class="small">',{type:"translate",nodelist:["subtotal"]},'</th>\n        <td id="cartSubtotal" class="small numeric">',{type:"ef",blocks:[{type:"ncondition",expression:"media_mode == 'phone' ",attachment:[{type:"variable",name:"currency_prefix",filters:[]}]}]},{type:"variable",name:"disp_subtotal",filters:[]},'</td>\n        <td class="currency"><a class="country-picker">',{type:"variable",name:"currency",filters:[]},"</a></td>\n    </tr>\n  "]}]},"\n  ",{type:"ef",blocks:[{type:"ncondition",expression:"has_shipping ",attachment:["\n    <tr",{type:"ef",blocks:[{type:"ncondition",expression:"!has_tax ",attachment:[' class="shipping"']}]},'>\n        <th class="small">',{type:"translate",nodelist:["shipping"]},'</th>\n        <td id="cartShipping" class="small numeric">',{type:"ef",blocks:[{type:"ncondition",expression:"media_mode == 'phone' ",attachment:[{type:"variable",name:"currency_prefix",filters:[]}]}]},{type:"variable",name:"disp_shipping",filters:[]},'</span></td>\n        <td class="currency"><a class="country-picker">',{type:"variable",name:"currency",filters:[]},"</a></td>\n    </tr>\n  "]}]},"\n  ",{type:"ef",blocks:[{type:"ncondition",expression:"has_tax ",attachment:['\n    <tr class="shipping">\n        <th class="small">',{type:"translate",nodelist:["tax"]},'</th>\n        <td id="cartTax" class="small numeric">',{type:"ef",blocks:[{type:"ncondition",expression:"media_mode == 'phone' ",attachment:[{type:"variable",name:"currency_prefix",filters:[]}]}]},{type:"variable",name:"disp_tax",filters:[]},'</span></td>\n        <td class="currency"><a class="country-picker">',{type:"variable",name:"currency",filters:[]},"</a></td>\n    </tr>\n  "]}]},'\n    <tr class="total">\n        <th>',{type:"ef",blocks:[{type:"ncondition",expression:"media_mode == 'phone' && header_rework_2018 ",attachment:[{type:"translate",nodelist:["Total:"]}]},{type:"else_ncondition",attachment:[{type:"translate",nodelist:["total"]}]}]},'</th>\n        <td class="numeric',{type:"ef",blocks:[{type:"ncondition",expression:"wallet ",attachment:[" notable"]}]},'">',{type:"ef",blocks:[{type:"ncondition",expression:"media_mode == 'phone' ",attachment:[{type:"variable",name:"currency_prefix",filters:[]}]}]},{type:"variable",name:"disp_total",filters:[]},'</span></td>\n        <td class="currency"><a class="country-picker',{type:"ef",blocks:[{type:"ncondition",expression:"wallet ",attachment:[" notable"]}]},'">',{type:"variable",name:"currency",filters:[]},"</a></td>\n    </tr>\n  ",{type:"ef",blocks:[{type:"ncondition",expression:"header_rework_2018 && media_mode == 'phone' && saved_card ",attachment:['\n    <tr class="total">\n      <th>',{type:"translate",nodelist:["Pay with:"]},'\n            <td colspan="2" class="card-details"><div class="saved-card-details">\n                <span class="icon-cc ',{type:"variable",name:"saved_card.brand_slug",filters:[]},'">',{type:"variable",name:"saved_card.brand_slug",filters:[]},'</span>\n                <span class="last-4">x-',{type:"variable",name:"saved_card.last4",filters:[]},'</span>\n            </div>\n            <a class="switcher" href="#">',{type:"translate",nodelist:["change"]},"</a>\n            </td>\n      </th>\n    </tr>\n  "]}]},"\n  ",{type:"ef",blocks:[{type:"ncondition",expression:"hyrule ",attachment:['\n    <tr><td class="small hyrule" colspan="3">\n    ',{type:"ef",blocks:[{type:"ncondition",expression:"wallet ",attachment:["\n      You need the Giant's Wallet!\n    "]},{type:"else_ncondition",attachment:['\n      Hoo hoot! Link... Look up here! It appears that the time has finally come for you to start your adventure! You will encounter many hardships ahead.. That is your fate. Don\'t feel discouraged, even during the toughest times! <br><br>\n      Did you get all that? <a href="http://www.youtube.com/watch?v=Fc3pFGJDYOM&t=0m6s" target="_blank">No</a> / <a href="http://www.youtube.com/watch?v=H2qF5jXu7ik&t=2m17s" target="_blank">Yes</a>\n    ']}]},"\n    </td></tr>\n  "]}]},'\n</table>\n\n<div class="summary-notes">\n  ',{type:"ef",blocks:[{type:"ncondition",expression:"has_shipping && !contains.physical_gift ",attachment:["\n    <span>",{type:"translate",nodelist:["ship to ",{type:"translateVariable",var_name:"country_list",nodelist:['<a class="country-picker">',{type:"variable",name:"country_name",filters:[["h",[]]]}]},""]},{type:"ef",blocks:[{type:"ncondition",expression:"country == 'US' && us_zip ",attachment:[", ",{type:"variable",name:"us_state",filters:[["h",[]]]}," ",{type:"variable",name:"us_zip",filters:[["h",[]]]}]}]},"</a></span>",{type:"ef",blocks:[{type:"ncondition",expression:"country == 'US' && !us_zip ",attachment:['<span class="small"> ',{type:"translate",nodelist:["(click to change country or set ZIP code, taxes may apply)"]},"</span>"]}]},"\n  "]}]},"\n</div>"]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/cart/country_pref.liquid","warn"):Templ.register({"cart/country_pref":['<div id="country-pref-vm">\n    <div><div class="country_pref_pointer"></div></div>\n    <div style="clear:both"></div>\n    <div class="country_pref_body">\n        <div class="bd">\n            <a class="country_pref_close" href="#">x</a>\n            ',{type:"translate",nodelist:["Select your country:"]},'\n            <div style="clear:both"></div>\n            <select class="country_pref_select">',{type:"variable",name:"options",filters:[]},'</select><br>\n            <div class="us-zip">\n                <label>\n                    ',{type:"translate",nodelist:["Zip:"]},'\n                    <input type="text" class="country_pref_zip" size="5" maxlength="5"\n                        data-bind="style: { border: zipIsInvalid ? \'1px solid red\' : \'1px solid #ccc\' }"/>\n                </label>\n                <a class="us-zip-done">',{type:"translate",nodelist:["Save"]},'</a>\n                <span class="error-msg" data-bind="visible: zipIsInvalid">\n                    Please enter a valid zip.\n                </span>\n            </div>\n        </div>\n    </div>\n</div>']}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/_package_listing_title.liquid","warn"):Templ.register({_package_listing_title:["\n\n\n\n\n",{type:"let",variable:"package_sold_out",expression:"(package.quantity_warning && package.quantity_available <= 0) || (package.quantity_limits && package.quantity_limits <= 0) "},"\n",{type:"let",variable:"cant_buy_package",expression:"package.quantity_limits && package.cart_quantity && package.cart_quantity >= package.quantity_limits "},"\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"package_sold_out || cant_buy_package ",attachment:["\n    ",{type:"variable",name:"package.title",filters:[["h",[]]]},"\n"]},{type:"else_ncondition",attachment:["\n    \n\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"package.subscriber_only && !(is_pkg_subscriber || member_of_current_band) ",attachment:['\n        <a class="buy-link subscribe-link" data-pkg="',{type:"variable",name:"package_index",filters:[["attr",[]]]},'" href="',{type:"variable",name:"artist_service_url",filters:[["a",[]]]},'">\n            <span class="buyItemPackageTitle primaryText">',{type:"variable",name:"package.title",filters:[["h",[]]]},"</span>\n        </a>\n    "]}]},'\n    \n    <button class="order_package_link buy-link ',{type:"ef",blocks:[{type:"ncondition",expression:"package.subscriber_only ",attachment:["subscriber-only-buy-link",{type:"ef",blocks:[{type:"ncondition",expression:"is_pkg_subscriber || member_of_current_band ",attachment:[" subscriber-view"]}]}]}]},'" type="button" data-pkg="',{type:"variable",name:"package_index",filters:[]},'">\n        <span class="buyItemPackageTitle primaryText">',{type:"variable",name:"package.title",filters:[["h",[]]]},"</span>\n    </button>\n"]}]},"\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"package.private && !package.subscriber_only ",attachment:["\n    <span class='notable' style='font-size:70%'>",{type:"translate",nodelist:["(private)"]},"</span>\n"]}]}]}),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/_package_listing_price.liquid","warn"):Templ.register({_package_listing_price:["\n\n\n\n",{type:"let",variable:"package_sold_out",expression:"(package.quantity_warning && package.quantity_available <= 0) || (package.quantity_limits && package.quantity_limits <= 0) "},"\n",{type:"let",variable:"cant_buy_package",expression:"package.quantity_limits && package.cart_quantity && package.cart_quantity >= package.quantity_limits "},"\n",{type:"let",variable:"attending_event",expression:"live_event_tickets && live_event_tickets[package.id] && live_event_tickets[package.id].attending "},"\n",{type:"let",variable:"free_show_doors_open",expression:"package.live_event_type == 'f' && live_event_tickets && live_event_tickets[package.id] && live_event_tickets[package.id].show_live_stream_link "},"\n",{type:"let",variable:"package_is_purchased",expression:"attending_event || free_show_doors_open || (cfg.dupe_purchases_fix && items_purchased && items_purchased.packages[package.id]) "},"\n",{type:"let",variable:"package_for_campaign",expression:"campaign_vinyl_merch && (campaign_vinyl_merch.package_id == package.id) "},"\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"merch_item_page ",attachment:["\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"digital_preorder && (package.album_id || package.download_type) ",attachment:["\n        ",{type:"capture",to:"_buy_text",nodelist:[{type:"translate",nodelist:["Pre-order Now"]}]},"\n    "]},{type:"else_ncondition",attachment:["\n        ",{type:"capture",to:"_buy_text",nodelist:[{type:"translate",nodelist:["Buy Now"]}]},"\n    "]}]},"\n"]},{type:"else_ncondition",attachment:["\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"digital_preorder && (package.album_id || package.download_type) ",attachment:["\n        ",{type:"capture",to:"_buy_text",nodelist:["\n            ",{type:"case",blocks:[{type:"condition",left:"package.type_id",right:"0",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Now"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"1",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Compact Disc"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"2",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Record/Vinyl"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"15",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Record/Vinyl"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"16",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Record/Vinyl"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"17",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Record/Vinyl"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"18",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Record/Vinyl"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"3",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Cassette"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"4",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order DVD"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"5",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order USB Drive"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"6",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Sheet Music"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"10",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Poster/Print"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"11",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order T-Shirt/Apparel"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"12",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Ticket"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"13",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Button/Pin/Patch"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"14",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Bag"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"19",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order T-Shirt/Shirt"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"20",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Sweater/Hoodie"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"21",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Hat"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"22",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Other Apparel"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"23",operator:"==",attachment:[{type:"translate",nodelist:["Pre-order Book/Magazine"]},"\n            "],child_relation:null,child_condition:null}]},"\n        "]},"\n    "]},{type:"else_ncondition",attachment:["\n        ",{type:"capture",to:"_buy_text",nodelist:["\n            ",{type:"case",blocks:[{type:"condition",left:"package.type_id",right:"0",operator:"==",attachment:[{type:"translate",nodelist:["Buy Now"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"1",operator:"==",attachment:[{type:"translate",nodelist:["Buy Compact Disc"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"2",operator:"==",attachment:[{type:"translate",nodelist:["Buy Record/Vinyl"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"15",operator:"==",attachment:[{type:"translate",nodelist:["Buy Record/Vinyl"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"16",operator:"==",attachment:[{type:"translate",nodelist:["Buy Record/Vinyl"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"17",operator:"==",attachment:[{type:"translate",nodelist:["Buy Record/Vinyl"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"18",operator:"==",attachment:[{type:"translate",nodelist:["Buy Record/Vinyl"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"3",operator:"==",attachment:[{type:"translate",nodelist:["Buy Cassette"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"4",operator:"==",attachment:[{type:"translate",nodelist:["Buy DVD"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"5",operator:"==",attachment:[{type:"translate",nodelist:["Buy USB Drive"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"6",operator:"==",attachment:[{type:"translate",nodelist:["Buy Sheet Music"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"10",operator:"==",attachment:[{type:"translate",nodelist:["Buy Poster/Print"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"11",operator:"==",attachment:[{type:"translate",nodelist:["Buy T-Shirt/Apparel"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"12",operator:"==",attachment:[{type:"translate",nodelist:["Buy Ticket"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"13",operator:"==",attachment:[{type:"translate",nodelist:["Buy Button/Pin/Patch"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"14",operator:"==",attachment:[{type:"translate",nodelist:["Buy Bag"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"19",operator:"==",attachment:[{type:"translate",nodelist:["Buy T-Shirt/Shirt"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"20",operator:"==",attachment:[{type:"translate",nodelist:["Buy Sweater/Hoodie"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"21",operator:"==",attachment:[{type:"translate",nodelist:["Buy Hat"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"22",operator:"==",attachment:[{type:"translate",nodelist:["Buy Other Apparel"]},"\n                "],child_relation:null,child_condition:null},{type:"condition",left:"package.type_id",right:"23",operator:"==",attachment:[{type:"translate",nodelist:["Buy Book/Magazine"]},"\n            "],child_relation:null,child_condition:null}]},"\n        "]},"\n    "]}]},"\n"]}]},"\n",{type:"ef",blocks:[{type:"ncondition",expression:"package_for_campaign && !package_is_purchased ",attachment:['\n    <div class="crowdfunding-package-funding secondaryText">\n        ',{type:"ef",blocks:[{type:"ncondition",expression:"campaign_vinyl_merch.amount_pledged ",attachment:["\n            ",{type:"translate",nodelist:["\n            You helped fund this through a <a ",{type:"translateVariable",var_name:"campaign_page_link",nodelist:[' href="',{type:"variable",name:"campaign_vinyl_merch.url",filters:[["a",[]]]},'" ']},">vinyl campaign</a>.\n            "]},"\n        "]},{type:"else_ncondition",attachment:["   \n            ",{type:"translate",nodelist:["\n            Funded by a <a ",{type:"translateVariable",var_name:"campaign_page_link",nodelist:[' href="',{type:"variable",name:"campaign_vinyl_merch.url",filters:[["a",[]]]},'" ']},">vinyl campaign</a>.\n            "]},"\n        "]}]},"\n    </div>\n"]}]},"\n\n",{type:"ef",blocks:[{type:"ncondition",expression:"package_sold_out && !package_is_purchased ",attachment:["\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"package_for_campaign && campaign_vinyl_merch.amount_pledged ",attachment:["\n        ",{type:"include",template_name:"'crowdfunding/vinyl_merch_item_pledge_text'"},"\n    "]}]},'\n    <h4 class="notable">',{type:"translate",nodelist:["Sold Out"]},"</h4>\n"]},{type:"else_ncondition",attachment:["\n\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"cant_buy_package ",attachment:['\n        <div class="buyItemEdition notable">',{type:"translate",nodelist:['You have the maximum quantity of this item in <span class="end">your cart.</span>']},"</div>\n    "]}]},"\n\n    ",{type:"let",variable:"separate_digital_release_date",expression:"package.download_type && digital_preorder_release_date && digital_preorder_release_date != package.release_date "},"\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"separate_digital_release_date ",attachment:['\n        <div class="buyItemEdition secondaryText">',{type:"translate",nodelist:["digital album releases ",{type:"translateVariable",var_name:"date",nodelist:['<span class="end">',{type:"variable",name:"digital_preorder_release_date",filters:[["time",["'yyyyMMMMd'"]]]}]},""]},"</span></div>\n    "]}]},"\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"package.release_date ",attachment:["\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"covid_banner_sellers && covid_banner_sellers[package.selling_band_id] ",attachment:['\n            <div class="covid_19 secondaryText">\n                ',{type:"translate",nodelist:["Message from ",{type:"translateVariable",var_name:"band_name",nodelist:[{type:"variable",name:"band_label_name",filters:[["h",[]]]}]},":"]},"\n                ",{type:"translate",nodelist:["\n                    Due to the COVID-19 pandemic, we are temporarily unable to mail records and other physical merchandise. We appreciate your support, and we will ship your order as soon as we can.\n                "]},"\n            </div>\n        "]},{type:"else_ncondition",attachment:['\n            <div class="buyItemEdition secondaryText">\n                ',{type:"ef",blocks:[{type:"ncondition",expression:"separate_digital_release_date ",attachment:["\n                    ",{type:"translate",nodelist:["\n                    item ships out on or around ",{type:"translateVariable",var_name:"release_date",nodelist:['<span class="end">',{type:"variable",name:"package.release_date",filters:[["time",["'yyyyMMMMd'"]]]},"</span>"]},"\n                    "]},"\n                "]},{type:"else_ncondition",attachment:["\n                    ",{type:"translate",nodelist:["\n                    shipping out on or around ",{type:"translateVariable",var_name:"release_date",nodelist:['<span class="end">',{type:"variable",name:"package.release_date",filters:[["time",["'yyyyMMMMd'"]]]},"</span>"]},"\n                    "]},"\n                "]}]},"\n            </div>\n        "]}]},"\n    "]},{type:"ncondition",expression:"package.shipping_exception_mode != 'w' && package.fulfillment_days && package.fulfillment_days > 0 ",attachment:["\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"covid_banner_sellers && covid_banner_sellers[package.selling_band_id] ",attachment:['\n        <div class="covid_19 secondaryText">\n                ',{type:"translate",nodelist:["Message from ",{type:"translateVariable",var_name:"band_name",nodelist:[{type:"variable",name:"band_label_name",filters:[["h",[]]]}]},":"]},"\n                ",{type:"translate",nodelist:["\n                    Due to the COVID-19 pandemic, we are temporarily unable to mail records and other physical merchandise. We appreciate your support, and we will ship your order as soon as we can.\n                "]},"\n        </div>\n        "]},{type:"else_ncondition",attachment:['\n        <div class="buyItemEdition secondaryText">\n            ',{type:"let",variable:"fulfillment_days",expression:"package.fulfillment_days "},"\n            ",{type:"ef",blocks:[{type:"ncondition",expression:"separate_digital_release_date ",attachment:["\n                ",{type:"translatePlural",blocks:[{type:"ncondition",expression:"fulfillment_days== 1",attachment:['\n                    item ships out within <span class="end">',{type:"variable",name:"fulfillment_days",filters:[["h",[]]]}," day</span>\n                "]},{type:"else_ncondition",attachment:['\n                    item ships out within <span class="end">',{type:"variable",name:"fulfillment_days",filters:[["h",[]]]}," days</span>\n                "]}]},"\n            "]},{type:"else_ncondition",attachment:["\n                ",{type:"translatePlural",blocks:[{type:"ncondition",expression:"fulfillment_days== 1",attachment:['\n                    ships out within <span class="end">',{type:"variable",name:"fulfillment_days",filters:[["h",[]]]}," day</span>\n                "]},{type:"else_ncondition",attachment:['\n                    ships out within <span class="end">',{type:"variable",name:"fulfillment_days",filters:[["h",[]]]}," days</span>\n                "]}]},"\n            "]}]},"\n        </div>\n        "]}]},"\n    "]}]},"\n    \n    ",{type:"ef",blocks:[{type:"ncondition",expression:"(package.edition_size || (package.quantity_warning && package.quantity_available > 0)) && (package.shipping_exception_mode != 'w') ",attachment:['\n    <div class="buyItemEdition secondaryText">\n        ',{type:"ef",blocks:[{type:"ncondition",expression:"package.edition_size ",attachment:["\n           ",{type:"translate",nodelist:["edition of ",{type:"translateVariable",var_name:"edition_size",nodelist:[{type:"variable",name:"package.edition_size",filters:[]}]},""]},"&nbsp;\n        "]}]},"\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"package.quantity_warning && package.quantity_available > 0 ",attachment:['\n            <span class="notable end">',{type:"translate",nodelist:["",{type:"translateVariable",var_name:"quantity_available",nodelist:[{type:"variable",name:"package.quantity_available",filters:[]}]}," remaining"]},"</span>\n        "]}]}," \n    </div>\n    "]}]}," \n\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"package.certified_seller && !package.limited_checkout ",attachment:['\n        <div class="listing-purchasable-with-gift-card ',{type:"ef",blocks:[{type:"ncondition",expression:"gift_card_balance ",attachment:[" user-has-balance "]}]},'">\n            <svg class="icon gift-card-icon-bordered small" width="9px" height="10px" viewBox="0 0 9 10"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#gift-card-icon"></use></svg>\n            ',{type:"translate",nodelist:["Purchasable with gift card"]},"\n        </div>\n    "]}]},"\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"(!package_is_purchased || is_custom_domain) && !package.live_event_over ",attachment:["\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"package_for_campaign && campaign_vinyl_merch.amount_pledged ",attachment:["\n            ",{type:"include",template_name:"'crowdfunding/vinyl_merch_item_pledge_text'"},"\n        "]},{type:"else_ncondition",attachment:['\n            <h4 class="compound-button main-button">\n                ',{type:"ef",blocks:[{type:"ncondition",expression:"package.is_live_ticket && package.live_event_type == 'f' ",attachment:["\n                    ",{type:"let",variable:"live_event_ticket",expression:"live_event_tickets[package.id] "},"\n                    ",{type:"include",template_name:"'common/community/liveevent/templates/free_show_pkg_rsvp_button'"},"\n                "]},{type:"ncondition",expression:"package.is_live_ticket && merch_item_page ",attachment:["\n                    ",{type:"capture",to:"_buy_text",nodelist:["\n                        ",{type:"variable",name:"_buy_text",filters:[]},"\n                        -&nbsp;\n                        ",{type:"let",variable:"package_currency",expression:"item_sellers[package.selling_band_id].currency "},"\n                        ",{type:"capture",to:"price",nodelist:['\n                            <span class="price">',{type:"variable",name:"package.price",filters:[["currency",["package_currency","false","true","true"]]]},'</span>\n                            <span class="buyItemExtra">',{type:"variable",name:"package_currency",filters:[["h",[]]]},"</span>\n                        "]},"\n                        ",{type:"if",blocks:[{type:"condition",left:"package.is_set_price",right:"1",operator:"!=",attachment:["\n                            ",{type:"translate",nodelist:["",{type:"variable",name:"price",filters:[]}," <span ",{type:"translateVariable",var_name:"attr",nodelist:['class="buyItemExtra buyItemNyp"']},">or more</span>"]},"&nbsp;\n                        "],child_relation:null,child_condition:null},{type:"else_condition",attachment:["\n                            ",{type:"translate",nodelist:["",{type:"variable",name:"price",filters:[]},""]},"\n                        "]}]},"\n                    "]},"\n                    ",{type:"include",template_name:"'tralbum_common/package_buy_button'"},"\n                "]},{type:"else_ncondition",attachment:["\n                    ",{type:"include",template_name:"'tralbum_common/package_buy_button'"},'\n                \n                    <span class="nobreak">\n                    ',{type:"let",variable:"package_currency",expression:"item_sellers[package.selling_band_id].currency "},"\n                    ",{type:"capture",to:"price",nodelist:['\n                        <span class="base-text-color">',{type:"variable",name:"package.price",filters:[["currency",["package_currency","false","true","true"]]]},'</span>\n                        <span class="buyItemExtra secondaryText">',{type:"variable",name:"package_currency",filters:[["h",[]]]},"</span>\n                    "]},"\n                    ",{type:"if",blocks:[{type:"condition",left:"package.is_set_price",right:"1",operator:"!=",attachment:["\n                        ",{type:"translate",nodelist:["",{type:"variable",name:"price",filters:[]},' <span class="buyItemExtra buyItemNyp secondaryText">or more</span>']},"&nbsp;\n                    "],child_relation:null,child_condition:null},{type:"else_condition",attachment:["\n                        ",{type:"translate",nodelist:["",{type:"variable",name:"price",filters:[]},""]},"\n                    "]}]},"\n                    </span>\n                "]}]},"\n            </h4>\n        "]}]},"\n    "]}]},"\n\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"package.is_live_ticket && package.live_event_over ",attachment:[' \n        <div class="live-event ended">',{type:"translate",nodelist:["This live stream has ended"]},"</div>\n    "]},{type:"ncondition",expression:"package_is_purchased || (is_custom_domain && !merch_item_page) ",attachment:["\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"package_for_campaign && campaign_vinyl_merch.amount_pledged ",attachment:["\n            ",{type:"include",template_name:"'crowdfunding/vinyl_merch_item_pledge_text'"},"\n                ",{type:"ef",blocks:[{type:"ncondition",expression:"package_sold_out ",attachment:['\n                    <h4 class="notable">',{type:"translate",nodelist:["Sold Out"]},"</h4>\n                "]}]},"\n        "]},{type:"else_ncondition",attachment:["\n            ",{type:"ef",blocks:[{type:"ncondition",expression:"package.is_live_ticket && live_event_tickets ",attachment:["\n                ",{type:"let",variable:"you_own_this_type",expression:"'live-ticket' "},"\n                ",{type:"let",variable:"live_event_ticket",expression:"live_event_tickets[package.id] "},"\n                ",{type:"let",variable:"show_live_stream_link",expression:"live_event_ticket.show_live_stream_link "},"\n                ",{type:"let",variable:"live_event_type",expression:"package.live_event_type "},"\n            "]},{type:"else_ncondition",attachment:["\n                ",{type:"let",variable:"you_own_this_type",expression:"'physical' "},"\n            "]}]},"\n            ",{type:"capture",to:"_buy_text",nodelist:['\n                <span class="buy-again">',{type:"translate",nodelist:["Buy again"]},"</span>\n            "]},"\n            ",{type:"include",template_name:"'tralbum_common/you_own_this'"},"\n        "]}]},"\n    "]}]},"\n    \n    ",{type:"ef",blocks:[{type:"ncondition",expression:"!package_sold_out && !cant_buy_package && cfg.physical_gifting && !cfg.BALLS_disable_physical_gifting && package.type_id != 12 ",attachment:["\n        ",{type:"ef",blocks:[{type:"ncondition",expression:"!package.subscriber_only || (package.subscriber_only && (is_pkg_subscriber || member_of_current_band)) ",attachment:['\n        <h4 class="ft compound-button send-as-gift">\n            <button class="order_package_link buy-link" type="button" data-pkg="',{type:"variable",name:"package_index",filters:[["attr",[]]]},'">',{type:"translate",nodelist:["Send as Gift"]},"</button>&nbsp;\n        </h4>\n        "]}]},"\n    "]}]},"\n\n    ",{type:"ef",blocks:[{type:"ncondition",expression:"!cant_buy_package && package.subscriber_only && !(is_pkg_subscriber || member_of_current_band) && !logged_in ",attachment:['\n        <div class="subscribe-login">',{type:"translate",nodelist:["already a subscriber?"]},' <a href="',{type:"variable",name:"login_bounce_url",filters:[["a",[]]]},'">',{type:"translate",nodelist:["log in"]},"</a></div>\n    "]}]},"\n    \n"]}]},"\n"]}),void 0===window.Templ?Log.server("Premature template registration: common/community/liveevent/templates/free_show_pkg_rsvp_button.liquid","warn"):Templ.register({"common/community/liveevent/templates/free_show_pkg_rsvp_button":['<button class="buy-link live-event-rsvp-button" type="button" data-pkg="',{type:"variable",name:"package_index",filters:[["a",[]]]},'" data-test="live-event-rsvp-button">\n    ',{type:"translate",nodelist:["RSVP"]},"\n</button>&nbsp;\n"]}),function(e){"use strict";var t={fan_id:null,fan_email:null,band_id:null,band_name:null,band_image_id:null,fan_image_id:null,initialized:null,theButton:null,root:null,is_following:!1,init:function(e){const n=0===$("#following-actions").length&&!window.TralbumJSONLD;if(!e||n||this.initialized)return;this.show_follow_tooltip=e.show_follow_tooltip,this.fan_id=e.fan_id,this.fan_email=e.fan_email,this.band_id=e.band_id,this.band_image_id=e.band_image_id,this.fan_image_id=e.fan_image_id,this.is_following=e.is_following;const i=U.pagedataBlob()||{};this.cfg=i.cfg||{},"undefined"!=typeof BandData?this.band_name=BandData.name:void 0!==i.label&&(this.band_name=i.label.label_name);const a=this;$(document).ready((function(){$("#following-actions").renderLiquid("fan/band_follow",e),a.root=$("#following-actions"),a.theButton=$("#follow-unfollow",a.root),"phone"!=MediaView.mode&&a.theButton.on("mouseenter",(function(){$(this).parent().parent().hasClass("show-tooltip")||$(this).hasClass("following")&&$("div",this).html(TM("Unfollow"))})).on("mouseleave",(function(){$(this).parent().parent().hasClass("show-tooltip")||$(this).hasClass("following")&&$("div",this).html(TM("Following"))})),a.theButton.click((function(){if($(this).parent().parent().hasClass("show-tooltip"))return;if(Identities.fan()&&!Identities.fan().private&&(Identities.fan().verified||a.theButton.hasClass("following")))t.followUnfollow(Identities.fan().id,"undefined"!=typeof BandData?BandData.id:null,e.tralbum_id,e.tralbum_type);else{const e=$("#pagedata").data("blob");FanAction.doAction("follow",e.lo_querystr||"",null,"undefined"!=typeof BandData?BandData.id:null,"b",BandData.id)}})),HiddenParams.get("external_follow")&&!a.theButton.hasClass("following")&&(Identities.fan()?t.showConfirmationDialog(e):a.theButton.click())})),this.initialized=!0},followUnfollow:function(e,n,i,a,o,s){s=this.theButton.length?this.theButton.hasClass("following"):s;const r=this,l=s?"unfollow":"follow",c={fan_id:e,action:l};t.updateButton(!s),"follow"==l&&(window.ReferrerToken&&(c.ref_token=window.ReferrerToken),$(".stub-page-content.fan").length>0&&Stats.record({kind:"click",click:"fan_stub_page_follow"})),n&&(c.band_id=n),i&&a&&(c.tralbum_id=i,c.tralbum_type=a),FanControls.doPost("/fan_follow_band_cb",c,(function(e){e&&e.ok?(Log.note("successful: band "+l),t.updateButton(e.is_following),e.is_following&&!o&&t.showMailingListDialog(e.mailing_list_info),r.is_following=e.is_following,BCEvents.publish("bandFollow.followUnfollowBand.success")):t.updateButton(s)})),Stats.record({kind:"click",click:"band_"+l});const d={click_type:l,item_id:i,item_type:a,band_id:n,user_type:"fan"};BCTracker.record("click",d)},showConfirmationDialog:function(e){const t=this;let n=[];n=[{text:TM("Follow"),click:function(){t.theButton.click(),HiddenParams.get("external_follow")&&Stats.record({kind:"click",click:"artist_dash_external_follow"}),$(this).dialog("close")}},{text:TM("No thanks"),click:function(){$(this).dialog("close"),HiddenParams.get("external_follow")&&Stats.record({kind:"click",click:"artist_dash_external_follow_no_thanks"})}}],NuDialog.showTemplate("fan/band_follow_acceptance",{artist:t.band_name},{dialogClass:"nu-dialog external-follow-confirm blank-title",buttons:n,close:function(e){return HiddenParams.get("external_follow")&&Stats.record({kind:"click",click:"artist_dash_external_follow_close"}),!0}})},showMailingListDialog:function(e){const t=this;let n=[],i="nu-dialog mailing-list-opt-in blank-title";e.label_id?(i+=" label",n=[{text:TM("Done"),click:function(){const n=$("#notify-me-band").prop("checked"),i=$("#notify-me-label").prop("checked");if(i||n){const a={address:t.fan_email};n&&(a.band_id=t.band_id),i&&(a.label_id=e.label_id),Crumb.ajax({type:"POST",url:"/band_follow_email_opt_in_cb",data:a,dataType:"json",success:function(e){},error:function(e,t,n){},complete:function(){}})}$(this).dialog("close")}}]):(i+=" band",n=[{text:TM("Yes please!"),click:function(){Crumb.ajax({type:"POST",url:"/band_follow_email_opt_in_cb",data:{address:t.fan_email,band_id:t.band_id},dataType:"json",success:function(e){},error:function(e,t,n){},complete:function(){}}),$(this).dialog("close")}},{text:TM("No thanks"),click:function(){$(this).dialog("close")}}]),NuDialog.showTemplate("fan/band_follow_mailing_list_opt_in",{artist:t.band_name,label:e.label_name,email_address:t.fan_email},{dialogClass:i,buttons:n})},updateButton:function(e){window.TralbumJSONLD||($("div",this.theButton).text(e?TM("Following"):TM("Follow")),e?($(".crowdfunding-success-text").addClass("crowdfunding-none"),$(".crowdfunding-success-text-following").removeClass("crowdfunding-none"),$(".crowdfunding-campaign-end-message-follow-prompt").hide(),$(".crowdfunding-campaign-end-message-follow").show()):($(".crowdfunding-success-text-following").addClass("crowdfunding-none"),$(".crowdfunding-success-text").removeClass("crowdfunding-none"),$(".crowdfunding-campaign-end-message-follow-prompt").show(),$(".crowdfunding-campaign-end-message-follow").hide()),this.theButton[e?"addClass":"removeClass"]("following"))}};e.BandFollow=t}(window),function(e){"use strict";var t={fan_id:null,is_owned:!1,initialized:null,init:function(n,i){const a=U.pagedataBlob(),o=a.cfg||{},s=a.user_testing||{};if(!n||!n.show_collect&&!n.is_collected||this.initialized)return;t.fan_id||(t.fan_id=n.fan_id);const r=function(){const i=[n.fan_id,n.collect_item_id,n.collect_item_type,n.collect_band_id];$("#wishlist-msg").click((function(){let e=null;const n=i[0];let a=i[1],o=i[2],s=i[3];if(window.TralbumData&&(o=o||window.TralbumData.current.type[0],a=a||window.TralbumData.current.id,s=s||window.TralbumData.current.band_id),e=Identities.fan()&&!Identities.fan().private&&Identities.fan().verified,e)t.collectItem(n,a,o,s);else{const e=$("#pagedata").data("blob");FanAction.doAction("wishlist",e.lo_querystr||"",null,a,o,s)}})),$("#wishlisted-msg").click((function(n){$(n.target).closest("a[href]").length||0!==$(n.target).closest(".wishlist-button-tooltip-outer").length||t.uncollectItem.apply(e,i)})),window.Fixup&&Fixup.compoundLinkButtons("#purchased-msg")};$(document).ready((function(){o.dupe_purchases_fix&&(window.TralbumData&&i&&i.packages&&!$.isEmptyObject(i.packages)&&!$(".you-own-this.physical").length&&(TralbumData.items_purchased=i),Identities.fan()&&(TralbumData.tralbum_collect_info=n),$(".buyItem.digital .you-own-this-link, .buyItem.buyFullDiscography .you-own-this-link").attr("href",n.fan_trackpipe_url)),n.is_private_fan=Identities.fan()&&Identities.fan().private,n.cfg=o,n.user_testing=s;const e=$(Templ.render("tralbum_common/tralbum_collect_controls",n));if("phone"==MediaView.mode){if($("#collect-item-placeholder").replaceWith(e),r(),a.embed_info.item_public){const e=$("#wishlisted-msg a.view"),t=$(e).attr("href");$(e).attr("href",t.replace(/#/g,"/"))}}else Share.panelLinkPromise.done((function(){e.insertAfter("#collect-anchor"),r()}))})),this.show_wishlist_tooltip=n.show_wishlist_tooltip||!1,this.show_follow_tooltip=n.show_follow_tooltip||!1,this.is_owned=n.is_purchased||!1,this.initialized=!0},doPost:function(e,t,n){Url.isCustomDomain()&&(e=siteroot_https+e);const i={type:"POST",url:e,data:t,dataType:Url.isCustomDomain()&&!$.support.cors?"jsonp":"json",xhrFields:{withCredentials:!0},success:function(e){Trackpipe.showXHRError(e)?Log.error("XHR POST returned error JSON",e):(Log.note("XHR form submission succeeded with data",e),n(e))},error:function(e,t,i){Log.error("XHR POST failed",e,t,i),e.data?Trackpipe.showXHRError(e.data):NuDialog.alert("Network Error","There was a network error while processing your request. Please try again."),n(e.data)}};Crumb.ajax(i)},collectItem:function(e,n,i,a){!e&&Identities.fan()&&(e=Identities.fan().id),$("#collect-item").addClass("wishlisted").removeClass("wishlist"),$("#wishlist-alert").hide();const o={fan_id:e,item_id:n,item_type:i,band_id:a};window.ReferrerToken&&(o.ref_token=window.ReferrerToken);t.doPost("/collect_item_cb",o,(function(e){!0===e.ok?Log.note("successfully added item to wishlist"):($("#collect-item").addClass("wishlist").removeClass("wishlisted"),$("#wishlist-alert").show())}));const s={click_type:"wishlist",item_id:n,item_type:i,user_type:"fan"};if(BCTracker.record("click",s),window.FanOnboarding&&this.show_wishlist_tooltip&&0===$(".signup-tooltip-parent.show-tooltip").length&&"phone"!==MediaView.mode)if(window.FanOnboarding.setFirstWishlistedItem(TralbumData.current.title,TralbumData.current.type),this.show_wishlist_tooltip=!1,Menubar.initialValues&&Menubar.initialValues.has_collection)window.FanOnboarding.setTooltips(["x"]),window.FanOnboarding.initForView();else{const e=$("#pagedata").data("blob").identities,t=Menubar.initialValues;SignupUtils.renderMenubar(e,t,{action:"wishlist"}),window.FanOnboarding.showTooltip("w")}},uncollectItem:function(e,n,i,a){!e&&Identities.fan()&&(e=Identities.fan().id),$("#collect-item").addClass("wishlist").removeClass("wishlisted"),$("#wishlist-alert").hide();const o={fan_id:e,item_id:n,item_type:i,band_id:a};t.doPost("/uncollect_item_cb",o,(function(e){!0===e.ok?Log.note("successfully removed item from wishlist"):($("#collect-item").addClass("wishlisted").removeClass("wishlist"),$("#wishlist-alert").show())}));const s={click_type:"unwishlist",item_id:n,item_type:i,user_type:"fan"};BCTracker.record("click",s)}};e.FanControls=t,e.FanTralbumFanControls=t}(window),window.CollectedBy={},function(){CollectedBy.initTooltips=function(e){$(e).bc_tooltips({itemSelector:"a.pic"})};CollectedBy.renderFull=function(e,t,n,i,a,o){$.isArray(n)||(n=[n]);const s=o&&o.max_reviews?o.max_reviews:6,r=o&&o.max_thumbs?o.max_thumbs:80,l=!(!o||!o.single_toggle)&&o.single_toggle,c=!o||!o.hide_tooltips,d={reviews:[],no_reviews:[],member_of_current_band:!!i,from_parm:window.TralbumFans?"fanthanks":"alsocollect",max_reviews:s,max_thumbs:r,single_toggle:l,show_tooltips:c};function p(){const e=$(this),t=e.data("fan-id"),n=e.data("item-type"),a=e.data("item-id"),o=e.data("fan-name"),s="s"===o[o.length-1].toLowerCase?o+"'":o+"'s";NuDialog.alertHTML("Remove","Are you sure you want to remove "+Text.escapeHtml(s)+" text? This action cannot be reversed.",{buttons:{OK:function(){i(t,n,a,e.closest(".writing")),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})}function u(){return $(this).fadeOut(200).queue((function(e){m(this),e()})),!1}function m(e){const t=$(e).closest(".collected-by"),n=[];for(let e=d.max_reviews,t=d.reviews.length;e<t;e++){const t={review:d.reviews[e],loop_index:e-d.max_reviews,member_of_current_band:!!i,from_parm:window.TralbumFans?"fanthanks":"alsocollect",show_tooltips:!0};n.push(Templ.render("fan/collection/grid/also_collected_by_review_innards",t))}$("div.writing:last",t).after($(n.join(""))),$("img.lazy",t).lazyload({threshold:500,effect:"fadeIn",effectspeed:100}),CollectedBy.initTooltips(t)}function _(){return $(this).fadeOut(200).queue((function(e){h(this),e()})),!1}function h(e){const t=$(e).closest(".no-writing");for(let e=d.max_thumbs,n=d.no_reviews.length;e<n;e++){const n={fan:d.no_reviews[e],loop_index:e-d.max_thumbs,from_parm:window.TralbumFans?"fanthanks":"alsocollect",show_tooltips:!0},i=$(Templ.render("fan/collection/grid/also_collected_by_no_review_innards",n));$(t).append(i)}$("img.lazy",t).lazyload({threshold:500,effect:"fadeIn",effectspeed:100}),CollectedBy.initTooltips(t)}function f(){return $(this).fadeOut(200).queue((function(e){$(this).data("more-reviews")&&m(this),$(this).data("more-thumbs")&&h(this),e()})),!1}Iter.each(t,(function(e){$.inArray(e.fan_id,n)<0&&d[e.why?"reviews":"no_reviews"].push(e)})),l?d.reviews.length-s+(d.no_reviews.length-r)<15&&(d.max_reviews=d.reviews.length,d.max_thumbs=d.no_reviews.length):(d.no_reviews.length>80&&(d.max_thumbs=50),d.reviews.length>6&&(d.max_reviews=3)),$(e).slideUp(100).queue((function(e){$(this).renderLiquid("fan/collection/grid/also_collected_by_deets",d),$("img.lazy",this).lazyload({threshold:500,effect:"fadeIn",effectspeed:100}),$(this).find(".more-writing").click(u).end().find(".more-thumbs").click(_).end().find(".more-everything").click(f).end().find("a.censor").click(p).end().addClass("populated").end(),a&&$(this).find(".show-less.close").fadeIn("slow").on("click",a),CollectedBy.initTooltips(this),e()})).slideDown(100)}}(),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/_share_tralbum_phone.liquid","warn"):Templ.register({_share_tralbum_phone:[{type:"capture",to:"tweet_text",nodelist:[{type:"ef",blocks:[{type:"ncondition",expression:"is_track ",attachment:[{type:"translate",nodelist:["omg best track ever:"]}," "]},{type:"else_ncondition",attachment:[{type:"translate",nodelist:["omg best album ever:"]}," "]}]}]},"\n",{type:"capture",to:"email_text",nodelist:[{type:"translate",nodelist:["",{type:"variable",name:"title",filters:[]}," by ",{type:"variable",name:"artist",filters:[]},":"]}]},'\n<ul class="share-dialog social-controls" data-url="',{type:"variable",name:"linkback",filters:[["a",[]]]},'">\n    <li class="facebook-share-ctrl" data-stat="facebook_mobile">\n        <a class="facebook-link compound-button">',{type:"translate",nodelist:["Facebook"]},'</a>\n    </li>\n    <li class="twitter-ctrl" data-text="',{type:"variable",name:"tweet_text",filters:[["a",[]]]},'" data-stat="twitter_mobile">\n        <a class="twitter-link compound-button">',{type:"translate",nodelist:["Twitter"]},'</a>\n    </li>\n    <li class="email-ctrl" data-text="',{type:"variable",name:"email_text",filters:[["a",[]]]},'" data-stat="email_mobile">\n        <a class="email-link compound-button">',{type:"translate",nodelist:["Email"]},"</a>\n    </li>\n</ul>\n"]}),function(e,t,n){"use strict";const i={doPost:function(e,n){const i=t.Deferred();Url.isCustomDomain()&&(e=siteroot_https+e);const a={type:"POST",url:e,data:n,dataType:Url.isCustomDomain()&&!t.support.cors?"jsonp":"json",xhrFields:{withCredentials:!0},success:function(e){return e.error?i.reject():i.resolve(e)},error:function(e,t,n){return i.reject()}};return Crumb.ajax(a),i.promise()},get:function(e,i,a,o,s,r,l,c){const d=t.Deferred(),p={tralbum_type:e,tralbum_id:i,token:a,count:o};return r&&(p.exclude_fan_ids=r),"thumbs"===s&&(l&&(p.exclude_gifters=!0),c&&(p.include_reviewers=!0)),t.post("/api/tralbumcollectors/2/"+s,n.toJSON(p)).then((function(e){return e.error?d.reject():d.resolve(e.results,e.more_available)}),(function(){return d.reject()})),d.promise()},getInitial:function(e,i,a,o,s){const r=t.Deferred(),l={tralbum_type:e,tralbum_id:i,reviews_count:a,thumbs_count:o};return s&&(l.exclude_fan_ids=s),t.post("/api/tralbumcollectors/2/initial",n.toJSON(l)).then((function(e){return e.error?r.reject():r.resolve(e.reviews,e.more_reviews_available,e.thumbs,e.more_thumbs_available)}),(function(){return r.reject()})),r.promise()},getReviews:function(e,t,n,i,a){return this.get(e,t,n,i,"reviews",a)},getThumbs:function(e,t,n,i,a,o,s){return this.get(e,t,n,i,"thumbs",a,s)},getBandThumbs:function(e,i,a){const o=t.Deferred(),s={band_id:e,count:i};return a&&(s.include_reviewers=!0),t.post("/api/tralbumcollectors/2/band_thumbs",n.toJSON(s)).then((function(e){return e.error?o.reject():o.resolve(e.results)}),(function(){return o.reject()})),o.promise()},censorReview:function(e,n,i){const a=t.Deferred(),o={fan_id:e,item_type:n[0],item_id:i};return this.doPost("/censor_fan_review",o).then((function(e){return e&&e.ok?a.resolve():a.reject()})),a.promise()}};e.CollectorsAPI=i}(window,jQuery,ko),function(e,t,n){"use strict";const i=900,a=(t("#pagedata").data("blob")||{}).cfg||{},o=function(e,n,i,a,o){const s=this;s.$container=e instanceof jQuery?e:t(e),s.tralbumType=n,s.tralbumId=i,s.initialized=!1,s.reviews=[],s.shownReviews=[],s.thumbs=[],s.shownThumbs=[],s.shownFanIds={},s.options=o||{},s.lastReviewToken=null,s.lastThumbToken=null,s.loadingThumbs=!1,s.loadingReviews=!1,s.context=a||"collection",s.isPhone="phone"===MediaView.mode,s.fanId="collection"===s.context&&FanData&&FanData.fan_id?FanData.fan_id:null,s.isOwnCollection="collection"===a&&s.fanId&&Identities.fan()&&Identities.fan().id===s.fanId,s.memberOfBand="tralbum"===s.context&&(Identities.isPageBandMember()||Identities.isAdmin()),s.MAX_REVIEWS=6,s.PREVIEW_REVIEWS=3,s.MAX_THUMBS=80,s.PREVIEW_THUMBS=60,s.REVIEWS_BATCH_SIZE=10,s.THUMBS_BATCH_SIZE=100,"tralbum"===s.context&&s.isPhone?s.THUMBS_BATCH_SIZE=60:"collection"===s.context&&s.isPhone&&!s.isOwnCollection?(s.MAX_REVIEWS=4,s.PREVIEW_REVIEWS=3,s.MAX_THUMBS=10,s.PREVIEW_THUMBS=6,s.PREVIEW_THUMBS_NO_COMMENTS=6,s.THUMBS_BATCH_SIZE=60):"collection"===s.context?(s.MAX_THUMBS=66,s.PREVIEW_THUMBS=60,s.PREVIEW_THUMBS_NO_COMMENTS=24,s.THUMBS_BATCH_SIZE=60):"feed"===s.context?(s.MAX_THUMBS=14,s.PREVIEW_THUMBS=7,s.PREVIEW_THUMBS_NO_COMMENTS=7,s.THUMBS_BATCH_SIZE=70):"save_the_fans"===s.context?s.MAX_THUMBS=70:"delete_account"===s.context&&(s.MAX_THUMBS=115),s.options.maxReviews&&(s.MAX_REVIEWS=s.options.maxReviews),s.options.previewReviews&&(s.PREVIEW_REVIEWS=s.options.previewReviews),s.options.maxThumbs&&(s.max_thumbs=s.options.maxThumbs),s.options.previewThumbs&&(s.PREVIEW_THUMBS=s.options.previewThumbs),s.$showMoreReviewsEl=null,s.$showMoreThumbsEl=null,s.$loadingReviewsEl=null,s.$loadingThumbsEl=null};o.prototype.initTooltips=function(){"phone"!==MediaView.mode&&this.$container.bc_tooltips({itemSelector:"a.pic"})},o.prototype.updateTokens=function(){this.lastReviewToken=this.reviews.length>0?this.reviews[this.reviews.length-1].token:null,this.lastThumbToken=this.thumbs.length>0?this.thumbs[this.thumbs.length-1].token:null},o.prototype.showMoreReviews=function(){const e=this;if(!e.initialized||e.loadingReviews)return;const n=[];e.fanId&&"collection"===e.context&&n.push(e.fanId),e.loadingReviews=!0,e.$showMoreReviewsEl.hide(),e.$loadingReviewsEl.show();const o=e.lastReviewToken,s=e.REVIEWS_BATCH_SIZE-(e.reviews.length-e.shownReviews.length),r=new Date;CollectorsAPI.getReviews(e.tralbumType,e.tralbumId,o,s,n).then((function(n,o){const s=new Date-r;let l=0;s<i&&(l=i-s),setTimeout((function(){e.$loadingReviewsEl.hide(),e.reviews=e.reviews.concat(n),e.updateTokens();for(let n=e.shownReviews.length;n<e.reviews.length;n++){const i={review:e.reviews[n],loop_index:n-e.shownReviews.length,member_of_current_band:e.memberOfBand,from_parm:"fanthanks",show_tooltips:!0,cfg:a};if(!e.shownFanIds[i.review.fan_id]){const n=t(Templ.render("fan/collection/grid/also_collected_by_review_innards",i));e.$container.find(".writing:last").after(n),e.shownFanIds[i.review.fan_id]=!0}}e.shownReviews=e.reviews,e.$container.find("img.lazy").lazyload({threshold:500,effect:"fadeIn",effectspeed:100}),t("a.censor",e.$container).click((function(){e.doCensor(this)})),e.initTooltips(),e.loadingReviews=!1,o&&e.$showMoreReviewsEl.fadeIn(200)}),l)}),(function(){e.$loadingReviewsEl.hide(),e.loadingReviews=!1}))},o.prototype.showMoreThumbs=function(){const e=this;if(!e.initialized||e.loadingThumbs)return;e.loadingThumbs=!0,e.$showMoreThumbsEl.hide(),e.$loadingThumbsEl.show();const n=e.lastThumbToken,o=e.THUMBS_BATCH_SIZE-(e.thumbs.length-e.shownThumbs.length),s=new Date;CollectorsAPI.getThumbs(e.tralbumType,e.tralbumId,n,o).then((function(n,o){const r=new Date-s;let l=0;r<i&&(l=i-r),setTimeout((function(){e.$loadingThumbsEl.hide(),e.thumbs=e.thumbs.concat(n),e.updateTokens();const i=t(".no-writing",e.$container),s=[];for(let t=e.shownThumbs.length;t<e.thumbs.length;t++){const n={fan:e.thumbs[t],loop_index:t-e.shownThumbs.length,max_thumbs:e.MAX_THUMBS,from_parm:"fanthanks",show_tooltips:!0,cfg:a};e.shownFanIds[n.fan.fan_id]||(s.push(Templ.render("fan/collection/grid/also_collected_by_no_review_innards",n)),e.shownFanIds[n.fan.fan_id]=!0)}t(i).append(t(s.join(""))),e.shownThumbs=e.thumbs,t("img.lazy",i).lazyload({threshold:500,effect:"fadeIn",effectspeed:100}),e.initTooltips(),e.loadingThumbs=!1,o&&e.$showMoreThumbsEl.fadeIn(200)}),l)}),(function(){e.$loadingThumbsEl.hide(),e.loadingThumbs=!1}))},o.prototype.renderFull=function(e){const n=this,o=t.Deferred(),s=function(e,t,i,s){if(n.initialized=!0,0===e.length&&0===i.length)return;n.reviews=e,n.thumbs=i,n.updateTokens();const r={reviews:e,more_reviews_available:t,thumbs:i,more_thumbs_available:s,from_parm:"fanthanks",member_of_current_band:n.memberOfBand,show_tooltips:!0,cfg:a};if(n.shownThumbs=i,n.shownReviews=e,n.shownFanIds={},e&&t&&(r.reviews=r.reviews.slice(0,n.PREVIEW_REVIEWS),n.shownReviews=n.shownReviews.slice(0,n.PREVIEW_REVIEWS)),i&&s){const t=e&&e.length>0?n.PREVIEW_THUMBS_NO_COMMENTS:n.PREVIEW_THUMBS;r.thumbs=r.thumbs.slice(0,t),n.shownThumbs=n.shownThumbs.slice(0,t)}if(r.thumbs){const e=[];Iter.each(r.thumbs,(function(t){n.shownFanIds[t.fan_id]||(n.shownFanIds[t.fan_id]=!0,e.push(t))})),r.thumbs=e}n.$container.renderLiquid("tralbum_common/tralbum_collectors",r),n.$container.addClass("populated"),n.bindToDOM(),n.initTooltips(),o.resolve()};if(e)s(e.reviews,e.more_reviews_available,e.thumbs,e.more_thumbs_available);else{const e=[];n.fanId&&"collection"===n.context&&e.push(n.fanId),n.$container.show();const t=new Date;CollectorsAPI.getInitial(n.tralbumType,n.tralbumId,n.MAX_REVIEWS,n.MAX_THUMBS,e).then((function(e,n,a,o){const r=new Date-t;let l=0;r<i&&(l=i-r),setTimeout((function(){s(e,n,a,o)}),l)}))}return o.promise()},o.prototype.set=function(e){const t=this;e=e||{},t.reviews=e.reviews||[],t.thumbs=e.thumbs||[],t.shownReviews=e.shown_reviews||[],t.shownThumbs=e.shown_thumbs||[],t.moreReviewsAvailable=e.more_reviews_available,t.moreThumbsAvailable=e.more_thumbs_available,t.shownFanIds={},Iter.each(t.shownThumbs,(function(e){t.shownFanIds[e.fan_id]||(t.shownFanIds[e.fan_id]=!0)})),t.updateTokens()},o.prototype.bindToDOM=function(){const e=this;e.$showMoreReviewsEl=t(".more-writing",e.$container),e.$showMoreThumbsEl=t(".more-thumbs",e.$container),e.$loadingReviewsEl=t(".loading-writing",e.$container),e.$loadingThumbsEl=t(".loading-thumbs",e.$container),e.$showMoreReviewsEl.click((function(){e.showMoreReviews()})),e.$showMoreThumbsEl.click((function(){e.showMoreThumbs()})),t("a.censor",e.$container).click((function(){e.doCensor(this)})),e.initTooltips(),e.$container.find("img.lazy").lazyload({threshold:500,effect:"fadeIn",effectspeed:100}),e.initialized=!0},o.prototype.renderNano=function(e,t,n,i){const a=this;t=t||a.MAX_THUMBS;const o=function(e){const o={collectors:t?e.slice(0,t):e,from_parm:n,target_blank:i};a.$container.renderLiquid("fan/collection/grid/also_collected_by_nano",o)};e?o(e.collectors):"delete_account"===a.context&&a.options.bandId?(a.$container.show(),CollectorsAPI.getBandThumbs(a.options.bandId,t,!0).then((function(e){o(e)}))):(a.$container.show(),CollectorsAPI.getThumbs(a.tralbumType,a.tralbumId,null,t,null,!0,!0).then((function(e){o(e)})))},o.prototype.doCensor=function(e){const n=t(e),i=n.closest(".writing"),a=n.data("fan-id"),o=n.data("item-type"),s=n.data("item-id"),r=n.data("fan-name"),l="s"===r[r.length-1].toLowerCase?r+"'":r+"'s";NuDialog.alert("Remove","Are you sure you want to remove "+l+" text? This action cannot be reversed.",{buttons:{OK:function(){CollectorsAPI.censorReview(a,o,s).then((function(){i.slideToggleBool(!1)})),t(this).dialog("close")},Cancel:function(){t(this).dialog("close")}}})},e.FanTralbumCollectors=o}(window,jQuery,ko),function(e,t,n){"use strict";t(document).ready((function(){const e=t("#collectors-data").data("blob");if(e){t(".collected-by").show(),t(".collected-by .message").show();const n=new FanTralbumCollectors(t(".collected-by .deets")[0],TralbumData.current.type[0],TralbumData.current.id,"tralbum");n.set(e),n.bindToDOM()}}))}(window,jQuery,ko);var VideoElementWrapper=function(){function e(e){this.element=e,this.state="init";const t=["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","stalled","suspend","waiting"],n=this;function i(e){return function(){n.handleEvent(e)}}for(let e=0;e<t.length;e++)this.element.addEventListener(t[e],i(t[e]));this.$blackout=$('<div class="wrapped-video-blackout">'),this.$poster=$('<img class="wrapped-video-poster">'),this.$play=$('<div class="wrapped-video-play video-play-button">'),this.$loading=$('<div class="wrapped-video-loading video-loading-indicator">'),$(e).after(this.$blackout,this.$poster,this.$play,this.$loading),this.changeState("loading"),this.$poster.add(this.$play).click((function(){e.play()}));const a=$(e).attr("poster");a&&(this.setPoster(a),this.changeState("ready")),this._stateTransitions={init:{canplay:"ready",playing:"playing",ended:"ready",error:"error",progress:"ready"},error:{abort:"init",emptied:"init",suspend:"init"},ready:{play:"loading",playing:"playing",emptied:"loading"},playing:{emptied:"loading",ended:"ended",waiting:"loading",error:"error"},ended:{play:"loading",playing:"playing",emptied:"loading"},"loading-playing":{abort:"init",playing:"playing",ended:"ready",error:"error"},"loading-notplaying":{abort:"init",canplay:"ready",suspend:"ready",ended:"ready",error:"error"}}}return e.prototype.changeState=function(e){e&&this.state!=e&&($(this.element).parent().removeClass("state-"+this.state),Log.debug("new state: "+e),this.state=e,$(this.element).parent().addClass("state-"+this.state))},e.prototype.handleEvent=function(e){let t=this.state;"loading"==t&&(t=this.element.paused?"loading-notplaying":"loading-playing"),Log.debug("videoevent: "+e+" in "+t);const n=this._stateTransitions[t];this.changeState(n&&n[e])},e.prototype.setPoster=function(e){this.$poster.attr("src",e)},e}();!function(e,t){"use strict";function n(e,t,n){this.init(e,t,n)}e.VideoPlayer=n,t.extend(n.prototype,{videoId:null,sourceType:null,prev_sourceType:null,properties:null,genericContainerSelector:null,genericIFrameElem:null,genericPlayer:null,captionText:null,trackinfo:null,musicPlaylist:null,currOnTrackPlayed:null,state:null,postAnimateFn:null,featuredId:null,init:function(e,n,i){if(this.isPhone())return;let a=!1;if(e){this.trackinfo=e;for(let t=0;t<e.length&&!a;t++)"t"==e[t].video_source_type&&(a=!0)}if(n&&(this.genericContainerSelector=n),this.properties=i||{},this.properties.root_class_name||(this.properties.root_class_name="video-player"),this.properties.siteroot||(this.properties.siteroot=siteroot_current),this.properties.guideElem&&this.properties.parallelElem){const e=this,n=t(e.properties.parallelElem).css("padding-top"),i=function(i){i?t(e.properties.parallelElem).css("padding-top",t(e.properties.guideElem).offset().top-t(e.properties.parallelElem).offset().top+"px"):t(e.properties.parallelElem).css("padding-top",n)};this.postAnimateFn=i}if(this.properties.featuredSelector){const e=t(this.properties.featuredSelector).attr("data-id");e&&(this.featuredId=e)}t(this.genericContainerSelector+" video.native-video-player").on("ended",(function(){this.currentTime=0}))},doVideo:function(e,i,a,o,s){if(!this.isPhone())if(this.trackinfo&&this.featuredId==i){if(this.justHide(),this.state=null,s){t("html, body").animate({scrollTop:t(".featured-video-wrapper").offset().top-20},500);const e=t(".featured-video-wrapper iframe")[0],i=t(".featured-video-wrapper video.native-video-player")[0];e&&(Log.debug("posting play message to featured iframe"),e.contentWindow.postMessage("play","*")),i&&(n.featuredWrapper||(n.featuredWrapper=new VideoElementWrapper(i)),i.load(),i.play())}}else{if("open"==this.state&&this.sourceType==e&&this.videoId==i)return this.justHide(),void(this.state=null);this.state="open",this.preLoad(e),this.sourceType=e,this.videoId=i,this.captionText=a,"t"==e&&this.do23(i,o,s)}},_loadVideo:function(e,i,a,o){if(e){const t={message:o?"startvideo":"loadvideo",id:a,from:this.musicPlaylist?"a":"t"};Log.debug("posting message to videoframe: "+JSON.stringify(t)),e.contentWindow.postMessage(t,"*")}else if(i){n.wrapper||(n.wrapper=new VideoElementWrapper(i));let e=null;for(let t=0;t<TralbumData.trackinfo.length;t++)if(TralbumData.trackinfo[t].video_id==a){let n=TralbumData.trackinfo[t].video_mobile_url;n=n.replace("video_mobile_high","video_hd"),e={src:"http://bandcamp.23video.com/"+n,poster:"//bandcamp.23video.com/"+TralbumData.trackinfo[t].video_poster_url};break}e?(i.pause(),Log.debug("loading video with url "+e.src),n.wrapper.setPoster(e.poster),t(i).attr(e)):Log.error("do not have a video url for video id "+a)}},do23:function(n,i,a){const o=this,s=t(this.genericContainerSelector+" iframe"),r=s[0],l=t(this.genericContainerSelector+" video.native-video-player")[0];if(!r&&!l)return;let c=this.properties.siteroot+"/videoframe?video_id="+n;i&&(c+="&autoplay=1"),BandData&&BandData.id&&(c+="&band_id="+BandData.id),this.musicPlaylist?c+="from='a'":c+="from='t'",this.genericIFrameElem=s,this.postLoad("t"),t(this.genericContainerSelector).addClass(this.properties.root_class_name+"-viz"),this.showCaption();const d=this.genericContainerSelector;if(!(this.prev_sourceType||this.properties.noAnimation))t("#bio-container").addClass("anim-hidden"),t(this.genericContainerSelector).slideDown({complete:function(){if("open"==o.state?o._loadVideo(r,l,n,i):(r.contentWindow.location.replace(c),o._loadVideo(null,l,n,i)),o.postAnimateFn&&o.postAnimateFn(!0),a){const n=t(e).scrollTop();if(t(d).offset().top<n){const e=t(d).offset().top-20;t("html, body").animate({scrollTop:e},500)}}t("#bio-container").removeClass("anim-hidden")}});else if(t(this.genericContainerSelector).show(),"open"==o.state?o._loadVideo(r,l,n,i):(r.contentWindow.location.replace(c),o._loadVideo(null,l,n,i)),this.postAnimateFn&&this.postAnimateFn(!0),a){const n=t(e).scrollTop();if(t(d).offset().top<n){const e=t(d).offset().top-20;t("html, body").animate({scrollTop:e},500)}}t(this.genericContainerSelector).removeClass(this.properties.root_class_name+"-hidden")},preLoad:function(){this.prev_sourceType},postLoad:function(e){if(!this.prev_sourceType||this.prev_sourceType==e)return;const t=this.genericContainerSelector;this.justHide(t,!1),this.state=null},justHide:function(e,n){const i=this;if(!this.sourceType||!this.videoId)return;if(e||(e=this.genericContainerSelector),this.captionText){const e=t("."+this.properties.root_class_name+"-caption");e.html(""),e.hide(),this.captionText=null}n?t(e).slideUp({complete:function(){i.postAnimateFn&&i.postAnimateFn(!1)}}):(t(e).hide(),this.postAnimateFn(!1)),t(e).removeClass(this.properties.root_class_name+"-viz"),t(e).addClass(this.properties.root_class_name+"-hidden");const a=t(e+" iframe")[0],o=t(e+" video.native-video-player")[0];a&&(Log.debug("posting stop message to player iframe"),a.contentWindow.postMessage("stop","*")),o&&(Log.debug("pausing video element"),o.pause())},_playTrackListener:function(e,t){let n=null;t||(t=this),++e;for(let i=0;i<t.trackinfo.length;i++)if(t.trackinfo[i].track_num==e){n=TralbumData.trackinfo[i];break}if(!n||!n.video_id)return this.justHide(null,!0),void(this.state=null);Log.debug("queuing video track: "+e),this.doVideo(n.video_source_type,n.video_id,n.video_caption,!1,!1)},setPlaylistListeners:function(e){if(this.isPhone())return;const t=this;e.ontrackplayed((function(e){e!=t.currOnTrackPlayed&&(t.currOnTrackPlayed=e,Log.debug("VideoPlayer: ontrackplayed: "+e),t._playTrackListener(e,t))})),this.musicPlaylist=e},showCaption:function(){let e=!1;const n=t("."+this.properties.root_class_name+"-caption"),i=t("."+this.properties.root_class_name);return this.captionText?(n.html(this.captionText),n.show(),i&&i.addClass("caption-viz"),e=!0):n&&(n.hide(),i&&i.removeClass("caption-viz")),e},isPhone:function(){return e.MediaView&&"phone"==MediaView.mode},xxx:null});var i={_hiddenForDialogs:[],init:function(a,o){if(e.Browser&&"safari"==Browser.make&&"iphone"==Browser.platform&&(t(document).on("bc_dialog_open",(function(e,n){Log.debug("hiding video for IOS while dialog is open"),i._hiddenForDialogs.push(t("video:visible").hide())})),t(document).on("bc_dialog_close",(function(e,n){const a=i._hiddenForDialogs;t.each(a,(function(e,t){Log.debug("restoring hidden video because dialog is closing"),t.show()})),i._hiddenForDialogs=[]}))),t("video.native-video-player").each((function(){t(this).parents(".featured-video-wrapper")[0]?n.featuredWrapper||(n.featuredWrapper=new VideoElementWrapper(this)):n.wrapper||(n.wrapper=new VideoElementWrapper(this))})),!e.tracklistVideoPlayer){const t=new n(e.TralbumData.trackinfo,".middleColumn .video-wrapper",{root_class_name:"video-wrapper",parallelElem:"#rightColumn",guideElem:"#tralbumArt",noAnimation:!!o,featuredSelector:".featured-video-wrapper"});e.tracklistVideoPlayer=t}a&&e.tracklistVideoPlayer.setPlaylistListeners(a)}};e.TralbumPageVideoPlayer=i}(window,jQuery);var CrossFrame=function(){"use strict";function e(e,t,n){this.serial=1,this.domain=n,this.deferred=[],this.methodHandlers={},this.eventHandlers={},this.thisWindow=e,"*"==n&&Log.error("warning: using * for CrossFrame domain; you should specify a specific domain");const i=this;function a(e,n,a){function o(e){t.postMessage({message:"crossframe_call_fail",serial:a,error:e},i.domain)}const s=i.methodHandlers[e];if(s)try{s(n).then((function(e){!function(e){t.postMessage({message:"crossframe_call_result",serial:a,result:e},i.domain)}(e)})).fail((function(e){o(e)}))}catch(e){o(err)}else o("no such method")}function o(e){const t=i.deferred[e];return t?delete i.deferred[e]:Log.debug("hmm, didn't find a promise for call "+e),t}function s(e){switch(e.message){case"crossframe_call":a(e.name,e.arg,e.serial);break;case"crossframe_emit":!function(e,t){const n=i.eventHandlers[e];if(n)for(let i=0;i<n.length;i++){Log.debug("calling handler for "+e+" with arg "+JSON.stringify(t));try{n[i].call(this,t)}catch(e){Log.debug("caught exception in handler: "+e)}}else Log.debug("no handlers for "+e)}(e.name,e.arg);break;case"crossframe_call_result":!function(e,t){const n=o(e);n?n.resolve(t):Log.debug("hmm, didn't find a promise for call "+e)}(e.serial,e.result);break;case"crossframe_call_fail":!function(e,t){const n=o(e);n?n.fail(t):Log.debug("hmm, didn't find a promise for failed call "+e)}(e.serial,e.error)}}this.call=function(e,n){const i={message:"crossframe_call",name:e,arg:n,serial:this.serial++},a=$.Deferred();return this.deferred[i.serial]=a,t.postMessage(i,this.domain),a.promise()},this.emit=function(e,n){const i={message:"crossframe_emit",name:e,arg:n};t.postMessage(i,this.domain)},this.messageListener=function(e){"*"!=i.domain&&i.domain!=e.origin||s(e.data)},e.addEventListener("message",this.messageListener),this.handlers={}}return e.prototype.handleMethod=function(e,t){this.methodHandlers[e]=t},e.prototype.on=function(e,t){let n=this.eventHandlers[e];n||(n=[],this.eventHandlers[e]=n),n.push(t)},e.prototype.destroy=function(){this.thisWindow.removeEventListener("message",this.messageListener),this.methodHandlers=null,this.eventHandlers=null},e}();window.TralbumLimits=function(){"use strict";let e=!1,t=!1,n=null,i=!1,a=null;return{onPlayerInit:function(t){e="album"==TralbumData.item_type,i=TralbumData.on_crowdfunding_page,n="album"==TralbumData.item_type?"limited_tralbum_nag_ap":"limited_tralbum_nag_tp",t.ontrackchanged((function(e){$.inArray(t.get_state(),["PLAYING","BUFFERING"])<0||s(e.id)&&l(e.id)})),t.onscrubbedback((function(e){Log.debug("scrubbed back for track_id "+e),s(e)&&l(e)})),t.ontrackcapped(l),t.oncompletedplay((function(e,n){if(!o()&&TralbumData.play_cap_data&&TralbumData.play_cap_data.streaming_limits_enabled){let n=null;(n=r(e))&&(n.play_count+=1,$.ajax({url:(Url.isCustomDomain()?siteroot_https:"")+"/capture_play",type:"post",data:{track_id:e,phase:"complete",client_id_sig:TralbumData.client_id_sig},dataType:Url.isCustomDomain()&&!$.support.cors?"jsonp":"json",xhrFields:Url.isCustomDomain()?{withCredentials:!0}:null}),function(e){if(!e)return!1;const t=TralbumData.play_cap_data;return!(!t||!t.streaming_limits_enabled||e.has_free_download)&&e.play_count>=t.streaming_limit}(n)&&(n.is_capped=!0,t.cap_playback_for_track(e)))}}))},closeNag:function(){a.dialog("close")},updatePlayCounts:function(e){if(!o()&&window.TralbumData.play_cap_data&&TralbumData.play_cap_data.streaming_limits_enabled){TralbumData.client_id_sig=e.client_id_sig;const t=e.play_counts;for(let e=0;e<TralbumData.trackinfo.length;e++){const n=TralbumData.trackinfo[e];n.play_count=t[n.id]?t[n.id].play_count:0,n.is_capped=n.play_count>=TralbumData.play_cap_data.streaming_limit}}},triggerNag:l};function o(){return window.FanControls&&window.FanControls.is_owned}function s(e){let t=null,n=!1;const i=r(e);return i&&(n=(t=TralbumData.play_cap_data)&&t.streaming_limits_enabled&&!i.has_free_download&&i.play_count+1>=t.streaming_limit),n}function r(e){let t=null;for(let n=0;TralbumData.trackinfo&&n<TralbumData.trackinfo.length;n++)if(TralbumData.trackinfo[n].id==e){t=TralbumData.trackinfo[n];break}return t}function l(o){if(t||!0===$(".ui-dialog-content").dialog("isOpen"))return;a=NuDialog.showTemplate("limits/band_play_limits_dialog",{band_name:BandData.name,band_image_id:BandData.image_id,fan_name:FanData.name,fan_image_id:FanData.image_id,tralbum_title:TralbumData.current.title,tralbum_art_id:TralbumData.art_id,purchase_type:TralbumData.item_type,is_mobile:"desktop"!=MediaView.mode,logged_in:FanData.logged_in,login_bounce_url:U.pagedataBlob().login_bounce_url},{draggable:!1,width:"35em",buttons:[],closeOnEscape:!1,dialogClass:"nu-dialog no-title"}),t=!0;const s={scroll_type:"nag-dialog",feature:"tralbum-page",band_id:BandData.id};$("#play-limits-dialog-buy-btn",a).click((function(l){if(l.preventDefault(),a.dialog("close"),t=!1,i||!e&&!r(o).is_downloadable)if(TralbumData.album_url){new Cookie.CommChannel("playlist").send("stop");const e=Url.addQueryParams(TralbumData.album_url,{action:"download",from:"ltngtpbn"});window.top.location.href=e}else Stats.record({kind:"click",click:n+"_buy_now"+(FanData.image_id&&BandData.image_id?"":"_sans_image")}),BCTracker.record("click",Object.assign(s,{click_type:n+"_buy_now"})),Log.error("Streaming limit reached but track is not purchasable");else{Stats.record({kind:"click",click:n+"_buy_now"+(FanData.image_id&&BandData.image_id?"":"_sans_image")}),BCTracker.record("click",Object.assign(s,{click_type:n+"_buy_now"}));const e=document.querySelector("#purchase-options");e&&TralbumData.packages.length>0?TralbumPageSmoothScrollY(e):(TralbumDownload.showPurchaseOptionsFooter=!0,TralbumDownload.begin(l))}})),$("#play-limits-dialog-cancel-btn",a).click((function(){if(Stats.record({kind:"click",click:n+"_no_thanks"+(FanData.image_id&&BandData.image_id?"":"_sans_image")}),BCTracker.record("click",Object.assign(s,{"click-type":n+"_no_thanks"})),$(".play-limits-dialog-header").length){$(".play-limits-dialog-button-pane > button").unbind("click").prop("disabled",!0),$("#play-limits-dialog-fan-img").animate({left:["-=50px","linear"],opacity:0},150),$("#play-limits-dialog-band-img").animate({right:["-=50px","linear"],opacity:0},150),$(".play-limits-dialog-perks, .play-limits-dialog-button-pane, .play-limits-dialog-footer").animate({opacity:0},250),$(".play-limits-dialog > h2").animate({opacity:.25},250);const e=$("#play-limits-dialog-heart-img");let t=$(e).attr("src");t.indexOf(".png")>-1&&(t=t.replace(".png",".gif"),$(e).attr("src",t+"?g="+Math.random()).load((function(){setTimeout(window.TralbumLimits.closeNag,2100)})).error((function(){a.dialog("close")})))}else a.dialog("close");t=!1})),Stats.record({kind:"click",click:n}),BCTracker.record("scroll",s)}}(),function(e,t,n){"use strict";e.OwnerStreaming={init:function(n){const i=t(".inline_player");TralbumData.is_purchased=!0,Iter.each(TralbumData.trackinfo,(function(e){!e.file&&n[e.id]?e.file=n[e.id]:e.file&&n[e.id]&&n[e.id]["mp3-v0"]&&(e.file["mp3-v0"]=n[e.id]["mp3-v0"])})),e.Player&&(TralbumData.is_purchased=!0,Player.update(TralbumData),i.removeClass("hidden"))}}}(window,jQuery,ko),function(e,t,n){"use strict";const i={isWishlisted:function(e,t){const n=FanControls.getTralbumLookup(e+t);return n&&!n.purchased},isFollowedFan:function(e){return FanControls.isFollowedFan(e)},wishlist:function(n,i,a,o){const s=this;if(!Identities.fan()||e.TralbumJSONLD&&Identities.fan().private)e.TralbumJSONLD&&FanAction.doAction("wishlist",U.pagedataBlob().lo_querystr||"",null,i,n,a);else{if(e.TralbumJSONLD||!e.TralbumData||!TralbumData.current||!TralbumData.current.id){const e={fan_id:Identities.fan().id,item_type:n,item_id:i,band_id:a,purchased:null};o&&t.each(o,(function(t,n){o[t]&&(e[t]=n)}));const r=t('.collect-item[data-collect-item="'+n+i+'"]');t.merge(r,t('.collection-item-container[data-tralbumid="'+i+'"][data-tralbumtype="'+n+'"]'));const l=function(){FanControls.toggleItem(e),r.toggleClass("wishlisted"),BCEvents.publish("fanControls.wishlist.toggle")};return FanControls._started=!1,FanControls.start(),FanControls.initializeItems(),FanControls.getData().then((function(){const t=s.isWishlisted(n,i);!t&&e.stat_token&&Stats.record({kind:"click",click:e.stat_token}),l(),FanControls.doPost(t?"/uncollect_item_cb":"/collect_item_cb",e,(function(e){!0===e.ok?Log.note("item "+(t?"removed":"added")+" from wishlist"):l()}))}))}FanControls.collectItem(Identities.fan().id,TralbumData.current.id,TralbumData.current.type,TralbumData.current.band_id)}},followBand:function(n,i,a){const o=e.BandData||null;if(!e.TralbumJSONLD||Identities.fan()&&!Identities.fan().private)if(o)BandFollow.followUnfollow(Identities.fan().id,o.id,TralbumData.current?TralbumData.current.id:null,TralbumData.current?TralbumData.current.type:null,i,a);else{const e={band_id:n,fan_id:Identities.fan().id,action:a?"unfollow":"follow"},i=t('.follow-band[data-follow-band="'+n+'"]');t.merge(i,t("#follow-unfollow-band_"+n));const o=function(){t(".following-msg",i).html(TM("Following")),i.toggleClass("following"),BCEvents.publish("fanControls.followBand.toggle")};FanControls._started=!1,FanControls.start(),FanControls.initializeItems(),FanControls.getData().then((function(){o(),FanControls.doPost("/fan_follow_band_cb",e,(function(e){!0===e.ok?Log.note("fan followed"):o()}))}))}else FanAction.doAction("follow",U.pagedataBlob().lo_querystr||"",null,n,"b",n);BCEvents.publish("fanControls.followBand")},followFan:function(e,n){const i=this,a={fan_id:Identities.fan().id,follow_id:e};n&&t.each(n,(function(e,t){n[e]&&(a[e]=t)}));const o=t('.follow-fan[data-follow-fan="'+e+'"]');t.merge(o,t("#follow-unfollow_"+e)),FanControls._started=!1,FanControls.start(),o.addClass("following"),FanControls.getData().then((function(){FanControls.initializeItems(),o.addClass("following");const t=i.isFollowedFan(e);!t&&a.stat_token&&Stats.record({kind:"click",click:a.stat_token}),FanControls.toggleFan(a),FanControls.doPost("/fan_follow_cb",a,(function(e){!0===e.ok&&Log.note("fan "+(t?"followed":"unfollowed"))}))}))}};e.FanControls2=i}(window,$,ko),function(){"use strict";function e(e){const n=this,i=$(e);n.stateChangeCallback=function(e){"COMPLETED"!==e.newstate&&"PAUSED"!==e.newstate||(i.find(".album-art-container").removeClass("playing"),"PAUSED"===e.newstate&&t("discover-footer_playpause",n.currentItem,!1))},n.playlist=new Player.Playlist(new WrapperSoundPlayer,"recommendations_footer",null,{no_trackstate:!0}),n.playlist.onstatechanged(n.stateChangeCallback),n.currentItem=null,n.playpauseItem=function(e){if(n.currentItem&&n.currentItem.featuredTrack.id==e.featuredTrack.id)n.playlist.playpause();else{n.currentItem=e,n.playlist.load([e.featuredTrack]),n.playlist.play(1);const i=n.currentItem.featuredTrack.clickType;Stats.record({kind:"click",click:i}),t("discover-footer_playpause",e,!0)}}}function t(e,t,n){const i={feature:"tralbum-discover-footer",action:"item-click"};i.type=e,"discover-footer_playpause"===e?(i.item={title:t.featuredTrack.title,artist:t.featuredTrack.artist,band_id:t.featuredTrack.artist_id,item_id:t.featuredTrack.album_id},i.is_play=n):i.next_page={type:e,url:t.delegateTarget.href},BCTracker.record("click",i)}$(document).ready((function(){!function(n){const i=$(n);i.find(".album-art-container").on("mouseenter",(function(){i.find(".recommended-album").removeClass("selected"),$(this.parentNode).addClass("selected"),i.find(".first-row").addClass("expanded")})),i.find(".title-and-artist").on("mouseenter",(function(){i.find(".recommended-album").removeClass("selected"),$(this.parentNode).addClass("selected"),i.find(".first-row").addClass("expanded")})),i.find(".first-row").on("mouseleave",(function(){i.find(".first-row").removeClass("expanded"),i.find(".recommended-album").removeClass("selected")})),i.find(".bcw-image").on("mouseenter",(function(){i.find(".bcw-blurb").addClass("img-hover")})),i.find(".bcw-image").on("mouseleave",(function(){i.find(".bcw-blurb").removeClass("img-hover")}));const a=new e(n);i.find(".album-art-container .play-button").on("click",(function(){$(this).parent().children(".recommended-album .album-art").click()})),i.find(".recommended-album .album-art").on("click",(function(){const e="#"+this.parentNode.parentNode.id+".recommended-album",t=i.find(e).data("trackid"),n=i.find(e).data("albumtitle"),o=i.find(e).data("albumid"),s=i.find(e).data("artist"),r=i.find(e).data("artistid"),l=i.find(e).data("audiourl"),c=i.find(e).data("duration"),d=i.find(e).data("from");let p;d.startsWith("footer-ar")?p="footer_artist_rec_play":d.startsWith("footer-cc")?p="footer_cc_rec_play":d.startsWith("footer-nn")?p="footer_nn_rec_play":d.startsWith("footer-aotd")?p="footer_aotd_rec_play":d.startsWith("footer-bcw")&&(p="footer_bcw_rec_play");const u={featuredTrack:{id:t,title:n,album_id:o,artist:s,artist_id:r,file:l,duration:c,clickType:p}};i.find(".album-art-container").removeClass("playing"),$(this).parent().addClass("playing"),a.playpauseItem(u)}));const o=document.getElementById("recommendations_container");void 0!==o&&null!=o&&ScrollDepthTracker.track(o,{element:"scroll_discover_footer"}),i.find(".title-and-artist p").bcTruncate(TruncateProfile.get("footer_four")),i.find(".comment-contents").bcTruncate(TruncateProfile.get("footer_fan_comment")),i.find(".artist-recs > .section-title").bcTruncate(TruncateProfile.get("footer_two")),i.find(".comment-author").bcTruncate(TruncateProfile.get("footer_one")),i.find(".recommended-album.footer-ar .album-link").on("click",(function(e){Stats.record({kind:"click",click:"footer_artist_rec_click"}),t("discover_footer_to_album",e)})),i.find(".recommended-album.footer-cc .album-link").on("click",(function(e){Stats.record({kind:"click",click:"footer_cc_rec_click"}),t("discover_footer_to_album",e)})),i.find(".recommended-album.footer-nn .album-link").on("click",(function(e){Stats.record({kind:"click",click:"footer_nn_rec_click"}),t("discover_footer_to_album",e)})),i.find(".recommended-album.footer-aotd .album-link").on("click",(function(e){Stats.record({kind:"click",click:"footer_aotd_rec_click"}),t("discover_footer_to_album",e)})),i.find(".recommended-album.footer-bcw .album-link").on("click",(function(e){Stats.record({kind:"click",click:"footer_bcw_rec_click"}),t("discover_footer_to_album",e)})),i.find(".recommended-story.artist-related .daily-link").on("click",(function(e){Stats.record({kind:"click",click:"footer_artist_article_click"}),t("discover_footer_to_article",e)})),i.find(".recommended-story.genre-related .daily-link").on("click",(function(e){Stats.record({kind:"click",click:"footer_genre_article_click"}),t("discover_footer_to_article",e)})),i.find(".recommended-story.fallback .daily-link").on("click",(function(e){Stats.record({kind:"click",click:"footer_fallback_article_click"}),t("discover_footer_to_article",e)})),i.find(".recommended-story.override .daily-link").on("click",(function(e){Stats.record({kind:"click",click:"footer_override_article_click"}),t("discover_footer_to_article",e)})),i.find(".bc-weekly-section .bcw-link").on("click",(function(e){Stats.record({kind:"click",click:"footer_bcw_click"}),t("discover_footer_to_bcradio",e)})),i.find(".bc-daily-section .section-title .bcd-title").on("click",(function(e){Stats.record({kind:"click",click:"footer_bcd_click"}),t("discover_footer_to_bcdaily",e)}));const s=i.find("img.lazy.first-row-beacon");if(s&&s.length>0){const e=s.data("clicks");s.lazyload({appear:function(){Stats.record({kind:"click batch",clicks:e})}})}const r=i.find("img.lazy.editorial-seen-beacon");if(r&&r.length>0){const e=r.data("clicks");r.lazyload({appear:function(){Stats.record({kind:"click batch",clicks:e})}})}}($(".recommendations-container")[0])}))}(),function(){"use strict";const e=$("#pagedata").data("blob");if(!e.live_event_tickets||$.isEmptyObject(e.live_event_tickets))return;const t={initializeLiveTicketLinks:function(){TralbumData.current.is_live_ticket?($(".live-event-stream-button").click((function(){const e=$(this).data("pkg"),t=TralbumData.packages[e];t&&("f"===t.live_event_type?LiveEventTicket.attendEvent(e):window.location.href=t.live_event_url)})),$(".live-event-rsvp-button").click((function(e){e.preventDefault();const t=$(this).data("pkg")||0;return LiveEventTicket.attendEvent(t),!1})),$(".live-event-attending-button").click((function(e){e.preventDefault();const t=$(this).data("pkg")||0;if("f"===TralbumData.packages[t].live_event_type)return LiveEventTicket.unattendEvent(t),!1}))):$(".live-event-stream-button, .live-event-rsvp-button").click((function(){const e=$(this).data("pkg"),t=TralbumData.packages[e];t&&(window.location.href=t.live_event_url)}))}};window.LiveEventTicketCommon=t,$(document).ready((function(){t.initializeLiveTicketLinks(),BCEvents.subscribe("tralbum.renderInventory",t.initializeLiveTicketLinks)}))}();
